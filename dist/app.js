"use strict";function checkAndUnlockBadges(portfolio,watchlist,goals,options){return[];}const{useState,useEffect,useMemo,useCallback,useRef}=React;function useCloudStore(key,defaultValue){const[data,setData]=useState(()=>{try{const stored=localStorage.getItem(`re_${key}`);return stored?JSON.parse(stored):defaultValue;}catch{return defaultValue;}});useEffect(()=>{if(!window.firebaseUtils?.db)return;const{db,doc,onSnapshot}=window.firebaseUtils;const user=window.firebaseUtils.auth?.currentUser;if(!user)return;try{const docRef=doc(db,'users',user.uid,'app',key);const unsubscribe=onSnapshot(docRef,snapshot=>{if(snapshot.exists()){const cloudData=snapshot.data()?.value;if(cloudData!==undefined){setData(cloudData);localStorage.setItem(`re_${key}`,JSON.stringify(cloudData));}}});return unsubscribe;}catch(error){console.warn('Cloud sync unavailable:',error);}},[key]);const save=useCallback(async value=>{setData(value);try{localStorage.setItem(`re_${key}`,JSON.stringify(value));}catch(error){console.warn('Failed to save to localStorage:',error);}if(window.firebaseUtils?.db){const user=window.firebaseUtils.auth?.currentUser;if(user){try{const{db,doc,setDoc}=window.firebaseUtils;await setDoc(doc(db,'users',user.uid,'app',key),{value,updatedAt:new Date().toISOString()});console.log(`‚òÅÔ∏è Synced ${key} to cloud`);}catch(error){console.warn('Failed to sync to cloud:',error);}}}},[key]);return[data,save];}function usePremium(){const[tier,setTier]=useState('free');useEffect(()=>{if(typeof UserManager!=='undefined'&&UserManager.getCurrentUser){const user=UserManager.getCurrentUser();const subscription=user?.subscription||'free';setTier(subscription);}if(typeof SubscriptionManager!=='undefined'&&SubscriptionManager.getCurrentTier){const currentTier=SubscriptionManager.getCurrentTier();setTier(currentTier);}},[]);return{isPremium:tier==='premium'||tier==='pro',isPro:tier==='pro',tier};}const SkeletonCard=()=>React.createElement("div",{className:"glass-card p-4 rounded-xl animate-pulse"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("div",{className:"skeleton h-6 w-16 rounded"}),React.createElement("div",{className:"skeleton h-4 w-12 rounded"})),React.createElement("div",{className:"skeleton h-8 w-24 rounded mb-2"}),React.createElement("div",{className:"skeleton h-4 w-full rounded mb-2"}),React.createElement("div",{className:"skeleton h-4 w-3/4 rounded"}));const SkeletonRow=()=>React.createElement("tr",{className:"border-b border-slate-700/30 animate-pulse"},React.createElement("td",{className:"p-3"},React.createElement("div",{className:"skeleton h-4 w-16 rounded"})),React.createElement("td",{className:"p-3"},React.createElement("div",{className:"skeleton h-4 w-32 rounded"})),React.createElement("td",{className:"p-3"},React.createElement("div",{className:"skeleton h-6 w-20 rounded"})),React.createElement("td",{className:"p-3"},React.createElement("div",{className:"skeleton h-4 w-24 rounded"})),React.createElement("td",{className:"p-3"},React.createElement("div",{className:"skeleton h-4 w-16 rounded"})),React.createElement("td",{className:"p-3"},React.createElement("div",{className:"skeleton h-4 w-20 rounded"})),React.createElement("td",{className:"p-3"},React.createElement("div",{className:"skeleton h-4 w-24 rounded"})),React.createElement("td",{className:"p-3"},React.createElement("div",{className:"skeleton h-8 w-16 rounded"})));const API_KEYS={FMP:'h43nCTpMeyiIiNquebaqktc7ChUHMxIz',FINNHUB:'d4fitqpr01qufc4upqn0d4fitqpr01qufc4upqng',EOD_HISTORICAL:'691f22aa1a8e90.63897142',TWELVE_DATA:'437c3794992642e29385a1ef00c9925f',INTRINIO:'OjBmYmVhY2IyZTA3MTM2OWM4YjcwMWQwYzRlODk2NTBj',TIINGO:'404d2953727ee5736d7b2e0671596633d730a1dc',ALPHA_VANTAGE:'KUR4BDPE2H6NJMHO',NEWS_API:'81a0be9978ed47c5a3d154aa0bc2feae',MARKETAUX:'Eo8lyvncd3gFJVlVbTuZpKq2PQA3LeX2F1scj2XA',DEEPSEEK:'sk-d9a6e65b55e243389a2a5bdf40840e72',CLAUDE:'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'};const API_STATS={FMP:{calls:0,failures:0,lastSuccess:null},FINNHUB:{calls:0,failures:0,lastSuccess:null},EOD_HISTORICAL:{calls:0,failures:0,lastSuccess:null},TWELVE_DATA:{calls:0,failures:0,lastSuccess:null},INTRINIO:{calls:0,failures:0,lastSuccess:null},TIINGO:{calls:0,failures:0,lastSuccess:null}};function sleep(ms){return new Promise(resolve=>setTimeout(resolve,ms));}function parseRetryAfterMs(headerValue){if(!headerValue)return null;const trimmed=String(headerValue).trim();if(!trimmed)return null;const seconds=Number(trimmed);if(Number.isFinite(seconds))return Math.max(0,seconds*1000);const dateMs=Date.parse(trimmed);if(!Number.isFinite(dateMs))return null;return Math.max(0,dateMs-Date.now());}function defaultShouldRetry(_ref){let{response,error}=_ref;if(error){if(error.name==='TimeoutError')return true;if(error.name==='AbortError')return false;return true;}if(!response)return true;if(response.status===429)return true;if(response.status===408)return true;if(response.status>=500&&response.status<=599)return true;return false;}async function fetchWithRetry(url){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const{timeoutMs=12000,retries=2,retryDelayMs=600,maxRetryDelayMs=8000,jitterRatio=0.25,shouldRetry=defaultShouldRetry,signal:upstreamSignal,...fetchOptions}=options;const totalAttempts=Math.max(1,Number(retries)+1);let lastError=null;let lastResponse=null;for(let attempt=0;attempt<totalAttempts;attempt++){const controller=new AbortController();const timeoutId=setTimeout(()=>{try{controller.abort(new DOMException('Request timed out','TimeoutError'));}catch{controller.abort();}},timeoutMs);let upstreamAbortHandler=null;if(upstreamSignal){upstreamAbortHandler=()=>{try{controller.abort(upstreamSignal.reason||new DOMException('Request aborted','AbortError'));}catch{controller.abort();}};if(upstreamSignal.aborted){upstreamAbortHandler();}else{upstreamSignal.addEventListener('abort',upstreamAbortHandler,{once:true});}}try{const response=await fetch(url,{...fetchOptions,signal:controller.signal});lastResponse=response;lastError=null;const retryAfterMs=response.status===429?parseRetryAfterMs(response.headers?.get?.('Retry-After')):null;const canRetry=attempt<totalAttempts-1;if(canRetry&&shouldRetry({response})){const base=Math.min(maxRetryDelayMs,retryDelayMs*Math.pow(2,attempt));const jitter=base*jitterRatio*(Math.random()*2-1);const waitMs=Math.max(0,Math.min(maxRetryDelayMs,(retryAfterMs??base)+jitter));console.warn(`‚è≥ Retry ${attempt+1}/${totalAttempts-1} after ${Math.round(waitMs)}ms: ${String(url).slice(0,120)}`);await sleep(waitMs);continue;}return response;}catch(error){lastError=error;lastResponse=null;if(upstreamSignal?.aborted)throw error;const canRetry=attempt<totalAttempts-1;if(canRetry&&shouldRetry({error})){const base=Math.min(maxRetryDelayMs,retryDelayMs*Math.pow(2,attempt));const jitter=base*jitterRatio*(Math.random()*2-1);const waitMs=Math.max(0,Math.min(maxRetryDelayMs,base+jitter));console.warn(`‚è≥ Retry ${attempt+1}/${totalAttempts-1} after ${Math.round(waitMs)}ms (error: ${error?.name||'Error'}): ${String(url).slice(0,120)}`);await sleep(waitMs);continue;}throw error;}finally{clearTimeout(timeoutId);if(upstreamSignal&&upstreamAbortHandler){upstreamSignal.removeEventListener('abort',upstreamAbortHandler);}}}if(lastResponse)return lastResponse;throw lastError||new Error('Request failed');}function formatTimeAgo(timestampMs){if(!timestampMs||!Number.isFinite(timestampMs))return'‚Äî';const deltaMs=Date.now()-timestampMs;if(deltaMs<0)return'just now';const seconds=Math.floor(deltaMs/1000);if(seconds<10)return'just now';if(seconds<60)return`${seconds}s ago`;const minutes=Math.floor(seconds/60);if(minutes<60)return`${minutes}m ago`;const hours=Math.floor(minutes/60);if(hours<24)return`${hours}h ago`;const days=Math.floor(hours/24);return`${days}d ago`;}function isStaleTimestamp(timestampMs){let kind=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'quote';if(!timestampMs||!Number.isFinite(timestampMs))return false;const cacheDuration=(()=>{try{if(Cache?.getCacheDuration){return kind==='quote'?Cache.getCacheDuration('QUOTE_DATA'):Cache.getCacheDuration('STOCK_DATA');}}catch{}return kind==='quote'?Cache?.isMarketOpen?.()?5*60*1000:24*60*60*1000:Cache?.isMarketOpen?.()?60*60*1000:24*60*60*1000;})();return Date.now()-timestampMs>cacheDuration;}async function smartFetch(endpoint,symbol){let options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};const isBrowser=typeof window!=='undefined';const strategies=[{name:'FMP',url:`https://financialmodelingprep.com/stable/${endpoint}?symbol=${symbol}&apikey=${API_KEYS.FMP}`,transform:data=>data},...(isBrowser?[]:[{name:'FINNHUB',url:endpoint.includes('quote')?`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${API_KEYS.FINNHUB}`:null,transform:data=>{if(data&&data.c){return[{symbol:symbol,price:data.c,change:data.d,changesPercentage:data.dp,volume:data.v||0}];}return data;}}])];for(const strategy of strategies){if(!strategy.url)continue;if(isBrowser&&strategy.name==='FINNHUB'){continue;}if(isBrowser&&strategy.url&&strategy.url.includes('finnhub.io')){continue;}try{if(API_STATS[strategy.name]){API_STATS[strategy.name].calls++;}console.log(`üîÑ Trying ${strategy.name} for ${endpoint}...`);const response=await fetchWithRetry(strategy.url,{timeoutMs:options.timeoutMs??12000,retries:options.retries??2});if(response.status===429){console.warn(`‚è≥ ${strategy.name} rate limited, trying next...`);if(API_STATS[strategy.name])API_STATS[strategy.name].failures++;continue;}if(!response.ok){if(response.status===403){console.warn(`‚ùå ${strategy.name} access denied (403)`);console.warn(`   URL: ${strategy.url.substring(0,100)}...`);console.warn(`   Possible causes:`);console.warn(`   1. API key invalid or expired`);console.warn(`   2. Subscription tier doesn't include this endpoint`);console.warn(`   3. Rate limit or bandwidth exceeded`);console.warn(`   4. Endpoint requires higher subscription tier`);try{const errorText=await response.clone().text();if(errorText){try{const errorData=JSON.parse(errorText);if(errorData.Error)console.warn(`   Error: ${errorData.Error}`);if(errorData.message)console.warn(`   Message: ${errorData.message}`);}catch(parseErr){if(errorText.length<200){console.warn(`   Response: ${errorText}`);}}}}catch(e){}if(strategy.name==='FMP'){console.warn(`   Skipping FMP and using backup API...`);}}console.warn(`‚ùå ${strategy.name} failed (${response.status}), trying next...`);if(API_STATS[strategy.name])API_STATS[strategy.name].failures++;continue;}const responseText=await response.clone().text();if(responseText.trim().startsWith('<!DOCTYPE')||responseText.trim().startsWith('<html')){console.warn(`‚ö†Ô∏è ${strategy.name} returned HTML instead of JSON (likely error page), trying next...`);if(API_STATS[strategy.name])API_STATS[strategy.name].failures++;continue;}let data;try{data=JSON.parse(responseText);}catch(parseError){console.warn(`‚ö†Ô∏è ${strategy.name} response is not valid JSON: ${parseError.message}, trying next...`);if(API_STATS[strategy.name])API_STATS[strategy.name].failures++;continue;}if(!data||Array.isArray(data)&&data.length===0){console.warn(`‚ö†Ô∏è ${strategy.name} returned empty data, trying next...`);if(API_STATS[strategy.name])API_STATS[strategy.name].failures++;continue;}const transformed=strategy.transform(data);if(!transformed||Array.isArray(transformed)&&transformed.length===0){console.warn(`‚ö†Ô∏è ${strategy.name} transformation returned empty data, trying next...`);if(API_STATS[strategy.name])API_STATS[strategy.name].failures++;continue;}if(API_STATS[strategy.name]){API_STATS[strategy.name].lastSuccess=new Date();}console.log(`‚úÖ ${strategy.name} succeeded for ${endpoint}!`);return{data:transformed,source:strategy.name};}catch(error){const isCorsError=error.message?.includes('CORS')||error.message?.includes('Failed to fetch')||error.name==='TypeError'||error.message?.includes('blocked by CORS')||error.message?.includes('Access-Control-Allow-Origin');if(isCorsError){if(API_STATS[strategy.name]){API_STATS[strategy.name].failures++;}continue;}if(error.message?.includes('429')||error.message?.includes('Too Many Requests')){console.warn(`‚ö†Ô∏è ${strategy.name} rate limited (429), skipping...`);if(API_STATS[strategy.name]){API_STATS[strategy.name].failures++;}continue;}if(error.message?.includes('429')||error.message?.includes('Too Many Requests')){console.warn(`‚ö†Ô∏è ${strategy.name} rate limited (429), skipping...`);if(API_STATS[strategy.name]){API_STATS[strategy.name].failures++;}continue;}console.error(`‚ùå ${strategy.name} error:`,error.message);if(API_STATS[strategy.name]){API_STATS[strategy.name].failures++;}continue;}}throw new Error(`All API sources failed for ${endpoint}`);}const FMP_API_KEY=API_KEYS.FMP;async function getDeepSeekAnalysis(stock){try{if(!API_KEYS.DEEPSEEK||API_KEYS.DEEPSEEK===''){throw new Error('DeepSeek API key is missing. Please configure your API key.');}console.log('DeepSeek API key found:',API_KEYS.DEEPSEEK.substring(0,10)+'...');const stockData={symbol:stock.symbol,name:stock.name,price:stock.price,change:stock.change,changePct:stock.changePct,volume:stock.volume,marketCap:stock.marketCap,pe:stock.pe,eps:stock.eps,beta:stock.beta,dividend:stock.dividend,divYield:stock.divYield,fiftyTwoWkHigh:stock.fiftyTwoWkHigh,fiftyTwoWkLow:stock.fiftyTwoWkLow,avgVolume:stock.avgVolume,sector:stock.sector,industry:stock.industry,roe:stock.roe,roa:stock.roa,debtToEquity:stock.debtToEquity,currentRatio:stock.currentRatio,quickRatio:stock.quickRatio,revenueGrowth:stock.revenueGrowth,earningsGrowth:stock.earningsGrowth,priceToBook:stock.priceToBook,priceToSales:stock.priceToSales,analystRating:stock.analystRating,priceTarget:stock.priceTarget};const prompt=`You are a professional stock analyst. Analyze the following stock data and provide a comprehensive investment analysis including:
1. Overall Assessment (bullish/neutral/bearish)
2. Key Strengths (3-4 points)
3. Key Risks (3-4 points)
4. Valuation Analysis
5. Technical Outlook
6. Investment Recommendation (Buy/Hold/Sell with reasoning)

Stock Data:
${JSON.stringify(stockData,null,2)}

Please provide a clear, structured analysis in markdown format.`;const response=await fetch('https://api.deepseek.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${API_KEYS.DEEPSEEK}`},body:JSON.stringify({model:'deepseek-chat',messages:[{role:'system',content:'You are a professional stock market analyst with expertise in fundamental and technical analysis.'},{role:'user',content:prompt}],temperature:0.7,max_tokens:2000})});if(!response.ok){const error=await response.text();throw new Error(`DeepSeek API error: ${response.status} - ${error}`);}const data=await response.json();return data.choices[0].message.content;}catch(error){console.error('DeepSeek AI analysis error:',error);throw error;}}function parseFmpCandleTime(dateStr){if(dateStr==null)return null;if(typeof dateStr==='number'&&Number.isFinite(dateStr)){const ms=dateStr>2e12?dateStr:dateStr>2e10?dateStr:dateStr*1000;return Math.floor(ms/1000);}const s=String(dateStr).trim();if(!s)return null;const isoish=s.includes(' ')&&!s.includes('T')?s.replace(' ','T'):s;const needsZ=/T\d{2}:\d{2}/.test(isoish)&&!/[zZ]|[+-]\d{2}:?\d{2}$/.test(isoish);const candidate=needsZ?`${isoish}Z`:isoish;const ms=Date.parse(candidate);if(!Number.isFinite(ms))return null;return Math.floor(ms/1000);}function normalizeFmpCandles(raw){if(!Array.isArray(raw))return[];return raw.map(c=>{const time=parseFmpCandleTime(c.date);if(!time)return null;return{time,open:Number(c.open),high:Number(c.high),low:Number(c.low),close:Number(c.close),volume:Number(c.volume||c.vol||0)};}).filter(Boolean).sort((a,b)=>a.time-b.time);}function sma(values,period){const out=new Array(values.length).fill(null);if(!period||period<2)return out;let sum=0;for(let i=0;i<values.length;i++){sum+=values[i];if(i>=period)sum-=values[i-period];if(i>=period-1)out[i]=sum/period;}return out;}function ema(values,period){const out=new Array(values.length).fill(null);if(!period||period<2||values.length===0)return out;const k=2/(period+1);let prev=values[0];out[0]=prev;for(let i=1;i<values.length;i++){const next=values[i]*k+prev*(1-k);out[i]=next;prev=next;}return out;}function stddev(values,period,smaArr){const out=new Array(values.length).fill(null);if(!period||period<2)return out;for(let i=period-1;i<values.length;i++){const mean=smaArr[i];if(mean==null)continue;let variance=0;for(let j=i-period+1;j<=i;j++){const d=values[j]-mean;variance+=d*d;}out[i]=Math.sqrt(variance/period);}return out;}function computeBollinger(closes){let period=arguments.length>1&&arguments[1]!==undefined?arguments[1]:20;let mult=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;const mid=sma(closes,period);const sd=stddev(closes,period,mid);const upper=mid.map((m,i)=>m==null||sd[i]==null?null:m+mult*sd[i]);const lower=mid.map((m,i)=>m==null||sd[i]==null?null:m-mult*sd[i]);return{mid,upper,lower};}function computeRSI(closes){let period=arguments.length>1&&arguments[1]!==undefined?arguments[1]:14;const out=new Array(closes.length).fill(null);if(closes.length<period+1)return out;let gain=0;let loss=0;for(let i=1;i<=period;i++){const diff=closes[i]-closes[i-1];if(diff>=0)gain+=diff;else loss-=diff;}let avgGain=gain/period;let avgLoss=loss/period;out[period]=avgLoss===0?100:100-100/(1+avgGain/avgLoss);for(let i=period+1;i<closes.length;i++){const diff=closes[i]-closes[i-1];const g=diff>0?diff:0;const l=diff<0?-diff:0;avgGain=(avgGain*(period-1)+g)/period;avgLoss=(avgLoss*(period-1)+l)/period;out[i]=avgLoss===0?100:100-100/(1+avgGain/avgLoss);}return out;}function computeMACD(closes){let fast=arguments.length>1&&arguments[1]!==undefined?arguments[1]:12;let slow=arguments.length>2&&arguments[2]!==undefined?arguments[2]:26;let signal=arguments.length>3&&arguments[3]!==undefined?arguments[3]:9;const fastEma=ema(closes,fast);const slowEma=ema(closes,slow);const macd=closes.map((_,i)=>fastEma[i]==null||slowEma[i]==null?null:fastEma[i]-slowEma[i]);const macdForEma=macd.map(v=>v==null?0:v);const signalLine=ema(macdForEma,signal).map((v,i)=>i<slow-1?null:v);const hist=macd.map((v,i)=>v==null||signalLine[i]==null?null:v-signalLine[i]);return{macd,signal:signalLine,hist};}function computeVolumeProfile(candles){let bins=arguments.length>1&&arguments[1]!==undefined?arguments[1]:24;if(!Array.isArray(candles)||candles.length===0)return[];let min=Infinity;let max=-Infinity;for(const c of candles){min=Math.min(min,c.low);max=Math.max(max,c.high);}if(!Number.isFinite(min)||!Number.isFinite(max)||min===max)return[];const binSize=(max-min)/bins;const acc=new Array(bins).fill(0);for(const c of candles){const tp=(c.high+c.low+c.close)/3;const idx=Math.min(bins-1,Math.max(0,Math.floor((tp-min)/binSize)));acc[idx]+=Number(c.volume||0);}const maxVol=Math.max(...acc,1);return acc.map((v,i)=>{const lo=min+i*binSize;const hi=lo+binSize;return{lo,hi,volume:v,pct:v/maxVol*100};}).reverse();}const CACHE_CONFIG={STOCK_DATA:60*60*1000,QUOTE_DATA:60*60*1000,CHART_DATA:60*60*1000,NEWS_DATA:30*60*1000,SENTIMENT_DATA:30*60*1000,MARKET_CLOSED:7*24*60*60*1000,MAX_CACHE_SIZE:500,CACHE_VERSION:'v4',OFFLINE_MODE:true};const Cache={isMarketOpen(){const now=new Date();const et=new Date(now.toLocaleString('en-US',{timeZone:'America/New_York'}));const day=et.getDay();const hour=et.getHours();const minute=et.getMinutes();if(day===0||day===6)return false;if(hour<9||hour===9&&minute<30)return false;if(hour>=16)return false;return true;},getCacheDuration(){let type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'STOCK_DATA';const intervals={'QUOTE_DATA':CACHE_CONFIG.QUOTE_DATA,'STOCK_DATA':CACHE_CONFIG.STOCK_DATA,'CHART_DATA':CACHE_CONFIG.CHART_DATA,'NEWS_DATA':CACHE_CONFIG.NEWS_DATA,'SENTIMENT_DATA':CACHE_CONFIG.SENTIMENT_DATA};return intervals[type]||CACHE_CONFIG.STOCK_DATA;},key(symbol){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'stock';return`${CACHE_CONFIG.CACHE_VERSION}_${type}_${symbol.toUpperCase()}`;},get(symbol){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'stock';try{const key=this.key(symbol,type);const cached=localStorage.getItem(key);if(!cached)return null;let parsed;try{parsed=this.decompressData(cached);}catch{parsed=JSON.parse(cached);}const{data,timestamp}=parsed;const age=Date.now()-timestamp;const maxAge=this.getCacheDuration(type==='quote'?'QUOTE_DATA':'STOCK_DATA');this.updateIndex(symbol,type,timestamp);if(age<maxAge){console.log(`‚úÖ Cache HIT for ${symbol} (${Math.round(age/1000/60)}min old)`);return data;}console.log(`‚è∞ Cache EXPIRED for ${symbol} (${Math.round(age/1000/60)}min old)`);localStorage.removeItem(key);return null;}catch(error){console.warn(`Cache read error for ${symbol}:`,error);return null;}},set(symbol,data){let type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'stock';try{const key=this.key(symbol,type);const cacheData={data,timestamp:Date.now(),version:CACHE_CONFIG.CACHE_VERSION};const compressedData=this.compressData(cacheData);localStorage.setItem(key,compressedData);this.updateIndex(symbol,type,Date.now());console.log(`üíæ Cached ${symbol} (${type})`);this.cleanup();}catch(error){if(error.name==='QuotaExceededError'){console.warn('Cache storage full, cleaning up...');this.aggressiveCleanup();}else{console.warn(`Cache write error for ${symbol}:`,error);}}},remove(symbol){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'stock';try{const key=this.key(symbol,type);localStorage.removeItem(key);}catch(error){console.warn(`Cache remove error for ${symbol}:`,error);}},clear(){try{const keys=Object.keys(localStorage);const cacheKeys=keys.filter(k=>k.startsWith(CACHE_CONFIG.CACHE_VERSION));cacheKeys.forEach(key=>localStorage.removeItem(key));console.log(`üßπ Cleared ${cacheKeys.length} cached items`);}catch(error){console.warn('Cache clear error:',error);}},clearOldest(){try{const keys=Object.keys(localStorage);const cacheKeys=keys.filter(k=>k.startsWith(CACHE_CONFIG.CACHE_VERSION));const cacheItems=cacheKeys.map(key=>{try{const{timestamp}=JSON.parse(localStorage.getItem(key));return{key,timestamp};}catch{return{key,timestamp:0};}}).sort((a,b)=>a.timestamp-b.timestamp);const toRemove=Math.ceil(cacheItems.length*0.2);cacheItems.slice(0,toRemove).forEach(item=>{localStorage.removeItem(item.key);});console.log(`üßπ Removed ${toRemove} oldest cache items`);}catch(error){console.warn('Cache cleanup error:',error);}},async fetchWithCache(symbol,type,fetchFunction){let options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};const{forceRefresh=false}=options;const cached=this.get(symbol,type);if(cached&&!forceRefresh){const key=this.key(symbol,type);const cachedItem=localStorage.getItem(key);if(cachedItem){try{const{timestamp}=JSON.parse(cachedItem);const age=Date.now()-timestamp;const maxAge=this.getCacheDuration(type==='quote'?'QUOTE_DATA':type==='news'?'NEWS_DATA':type==='sentiment'?'SENTIMENT_DATA':'STOCK_DATA');if(age>=maxAge){setTimeout(()=>fetchFunction(symbol).then(data=>{if(data)this.set(symbol,data,type);}).catch(()=>{}),1000);}}catch(e){}}return cached;}try{const freshData=await fetchFunction(symbol);if(freshData){this.set(symbol,freshData,type);return freshData;}}catch(error){if(cached){console.warn(`Using stale cache for ${symbol}`);return cached;}throw error;}return null;},cleanup(){try{const keys=Object.keys(localStorage);const cacheKeys=keys.filter(k=>k.startsWith(CACHE_CONFIG.CACHE_VERSION));if(cacheKeys.length<=CACHE_CONFIG.MAX_CACHE_SIZE)return;let removed=0;cacheKeys.forEach(key=>{try{const{timestamp}=JSON.parse(localStorage.getItem(key));const age=Date.now()-timestamp;if(age>24*60*60*1000){localStorage.removeItem(key);removed++;}}catch{localStorage.removeItem(key);removed++;}});if(removed>0){console.log(`üßπ Cleanup removed ${removed} expired items`);}}catch(error){console.warn('Cache cleanup error:',error);}},stats(){const keys=Object.keys(localStorage);const cacheKeys=keys.filter(k=>k.startsWith(CACHE_CONFIG.CACHE_VERSION));let totalSize=0;cacheKeys.forEach(key=>{totalSize+=localStorage.getItem(key).length;});return{count:cacheKeys.length,sizeKB:Math.round(totalSize/1024),marketOpen:this.isMarketOpen()};},compressData(data){try{const compressed=JSON.stringify(data).replace(/\s+/g,'');return compressed;}catch{return JSON.stringify(data);}},decompressData(compressed){try{return JSON.parse(compressed);}catch(error){console.warn('Failed to decompress data:',error);return null;}},cacheIndex(){try{const index=localStorage.getItem('re_cache_index');return index?JSON.parse(index):{};}catch{return{};}},updateIndex(symbol,type,timestamp){const index=this.cacheIndex();const key=this.key(symbol,type);index[key]={symbol,type,timestamp,lastAccessed:Date.now(),size:JSON.stringify(localStorage.getItem(key)||'').length};localStorage.setItem('re_cache_index',JSON.stringify(index));},aggressiveCleanup(){const index=this.cacheIndex();const entries=Object.entries(index);entries.sort((a,b)=>a[1].lastAccessed-b[1].lastAccessed);const toRemove=Math.ceil(entries.length*0.3);for(let i=0;i<toRemove;i++){const[key]=entries[i];localStorage.removeItem(key);delete index[key];}localStorage.setItem('re_cache_index',JSON.stringify(index));}};const AdvancedStorage={dbName:'RetailEdgePro_v4',version:4,stores:['stockData','chartData','newsData','analytics'],async init(){if(!window.indexedDB){console.warn('‚ö†Ô∏è IndexedDB not available, falling back to localStorage');return false;}return new Promise((resolve,reject)=>{const request=indexedDB.open(this.dbName,this.version);request.onerror=()=>{console.error('‚ùå IndexedDB initialization failed');resolve(false);};request.onsuccess=()=>{this.db=request.result;console.log('‚úÖ IndexedDB initialized');resolve(true);};request.onupgradeneeded=event=>{const db=event.target.result;if(!db.objectStoreNames.contains('stockData')){const store=db.createObjectStore('stockData',{keyPath:'id'});store.createIndex('timestamp','timestamp',{unique:false});store.createIndex('symbol','symbol',{unique:false});}if(!db.objectStoreNames.contains('chartData')){const store=db.createObjectStore('chartData',{keyPath:'id'});store.createIndex('symbol','symbol',{unique:false});store.createIndex('timeframe','timeframe',{unique:false});}if(!db.objectStoreNames.contains('newsData')){const store=db.createObjectStore('newsData',{keyPath:'id'});store.createIndex('symbol','symbol',{unique:false});store.createIndex('publishedAt','publishedAt',{unique:false});}if(!db.objectStoreNames.contains('analytics')){const store=db.createObjectStore('analytics',{keyPath:'id'});store.createIndex('symbol','symbol',{unique:false});store.createIndex('type','type',{unique:false});}};});},compress(data){try{const stringified=JSON.stringify(data);return stringified.length>1000?btoa(stringified):data;}catch{return data;}},decompress(data){if(typeof data==='string'&&data.length>1000){try{return JSON.parse(atob(data));}catch{return data;}}return data;},async set(store,key,value){let ttl=arguments.length>3&&arguments[3]!==undefined?arguments[3]:3600000;const data={id:key,symbol:key.split('_')[0],data:this.compress(value),timestamp:Date.now(),expiresAt:Date.now()+ttl};try{if(this.db){const tx=this.db.transaction(store,'readwrite');await tx.objectStore(store).put(data);return true;}}catch(error){console.warn('‚ö†Ô∏è IndexedDB write failed, falling back to localStorage');}try{localStorage.setItem(`re_advanced_${store}_${key}`,JSON.stringify({...data,data:value}));return true;}catch(error){this.handleQuotaExceeded(error,store);return false;}},async get(store,key){try{if(this.db){const tx=this.db.transaction(store,'readonly');const data=await tx.objectStore(store).get(key);if(data&&data.expiresAt>Date.now()){return this.decompress(data.data);}if(data){this.remove(store,key);}}}catch(error){console.warn('‚ö†Ô∏è IndexedDB read failed, falling back to localStorage');}try{const raw=localStorage.getItem(`re_advanced_${store}_${key}`);if(!raw)return null;const parsed=JSON.parse(raw);if(parsed.expiresAt>Date.now()){return parsed.data;}localStorage.removeItem(`re_advanced_${store}_${key}`);return null;}catch{return null;}},async remove(store,key){try{if(this.db){const tx=this.db.transaction(store,'readwrite');await tx.objectStore(store).delete(key);}}catch{}try{localStorage.removeItem(`re_advanced_${store}_${key}`);}catch{}},async cleanup(store){if(!this.db)return;const tx=this.db.transaction(store,'readwrite');const storeObj=tx.objectStore(store);const now=Date.now();let count=0;await new Promise(resolve=>{const request=storeObj.openCursor();request.onsuccess=event=>{const cursor=event.target.result;if(cursor){if(cursor.value.expiresAt<now){cursor.delete();count++;}cursor.continue();}else{resolve();}};});console.log(`üßπ Cleaned up ${count} expired items from ${store}`);},handleQuotaExceeded(error,store){console.warn(`‚ö†Ô∏è Storage quota exceeded for ${store}`);try{const keys=Object.keys(localStorage).filter(k=>k.startsWith(`re_advanced_${store}_`));const items=keys.map(k=>{try{const item=localStorage.getItem(k);return item?{key:k,timestamp:JSON.parse(item).timestamp||0}:{key:k,timestamp:0};}catch{return{key:k,timestamp:0};}}).sort((a,b)=>a.timestamp-b.timestamp);const toRemove=Math.ceil(items.length*0.2);items.slice(0,toRemove).forEach(item=>{try{localStorage.removeItem(item.key);}catch{}});console.log(`üßπ Removed ${toRemove} oldest items`);}catch{}},async stats(){const stats={indexedDB:{total:0,stores:{}},localStorage:0};try{if(this.db){for(const store of this.stores){const tx=this.db.transaction(store,'readonly');const count=await new Promise(resolve=>{const request=tx.objectStore(store).count();request.onsuccess=()=>resolve(request.result);request.onerror=()=>resolve(0);});stats.indexedDB.stores[store]=count;stats.indexedDB.total+=count;}}}catch{}try{stats.localStorage=Object.keys(localStorage).filter(k=>k.startsWith('re_advanced_')).length;}catch{}return stats;}};AdvancedStorage.init();window.AdvancedStorage=AdvancedStorage;const RequestManager={pendingRequests:new Map(),batchQueue:[],batchTimer:null,BATCH_DELAY:50,MAX_BATCH_SIZE:10,async fetchUnique(url){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const key=`${url}_${JSON.stringify(options)}`;if(this.pendingRequests.has(key)){console.log(`üìã Using pending request for ${url}`);return this.pendingRequests.get(key);}const promise=fetchWithRetry(url,options).finally(()=>{setTimeout(()=>this.pendingRequests.delete(key),1000);});this.pendingRequests.set(key,promise);return promise;},batchFetch(apiEndpoint,symbols){let params=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new Promise(resolve=>{const batchItem={endpoint:apiEndpoint,symbols:Array.isArray(symbols)?symbols:[symbols],params,resolve};this.batchQueue.push(batchItem);if(this.batchTimer)clearTimeout(this.batchTimer);if(this.batchQueue.length>=this.MAX_BATCH_SIZE){this.processBatch();}else{this.batchTimer=setTimeout(()=>this.processBatch(),this.BATCH_DELAY);}});},async processBatch(){if(this.batchQueue.length===0)return;const queue=[...this.batchQueue];this.batchQueue=[];if(this.batchTimer){clearTimeout(this.batchTimer);this.batchTimer=null;}const byEndpoint={};queue.forEach(item=>{if(!byEndpoint[item.endpoint])byEndpoint[item.endpoint]=[];byEndpoint[item.endpoint].push(item);});for(const[endpoint,items]of Object.entries(byEndpoint)){const allSymbols=items.flatMap(i=>i.symbols);const uniqueSymbols=[...new Set(allSymbols)];try{const batchUrl=`https://financialmodelingprep.com/stable/${endpoint}?symbols=${uniqueSymbols.join(',')}&apikey=${FMP_API_KEY}`;console.log(`üöÄ Batch fetching ${uniqueSymbols.length} symbols for ${endpoint}`);const response=await this.fetchUnique(batchUrl);const data=await response.json();items.forEach(item=>{const itemData=Array.isArray(data)?data.filter(d=>item.symbols.includes(d.symbol)):data;item.resolve({data:itemData,success:true});});}catch(error){console.error(`‚ùå Batch fetch failed for ${endpoint}:`,error);items.forEach(item=>item.resolve({data:null,success:false}));}}},async loadWithPriority(symbols){let priority=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'high';const priorityWeights={high:1,medium:2,low:3};const delay=priorityWeights[priority]*100;await new Promise(resolve=>setTimeout(resolve,delay));return this.batchFetch('quote',symbols);}};const originalSmartFetch=smartFetch;smartFetch=async function(endpoint,symbol){let options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(endpoint.includes('quote')||endpoint.includes('profile')){const result=await RequestManager.batchFetch(endpoint,symbol,options);return{data:result.data||[],source:'batched'};}const url=`https://financialmodelingprep.com/stable/${endpoint}?symbol=${symbol}&apikey=${FMP_API_KEY}`;const response=await RequestManager.fetchUnique(url,options);const data=await response.json();return{data,source:'deduplicated'};};const PrefetchManager={warming:false,warmupQueue:[],async warmupDefaultStocks(){if(this.warming)return;this.warming=true;console.log('üî• Starting cache warmup...');const savedWatchlist=JSON.parse(localStorage.getItem('watchlist')||'[]');if(savedWatchlist.length>0){console.log(`üìã Pre-fetching ${savedWatchlist.length} watchlist stocks`);await RequestManager.loadWithPriority(savedWatchlist.slice(0,20),'high');savedWatchlist.slice(0,10).forEach(symbol=>{this.prefetchChartData(symbol,'1day');});}const popularStocks=['AAPL','MSFT','GOOGL','AMZN','TSLA','META','NVDA','NFLX','AMD','COIN'];console.log('üìà Pre-fetching popular stocks');await RequestManager.loadWithPriority(popularStocks,'medium');console.log('üè¢ Pre-fetching sector averages');this.prefetchSectorData();this.warming=false;console.log('‚úÖ Cache warmup complete');},async prefetchChartData(symbol){let timeframe=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'1day';const cacheKey=`${symbol}_${timeframe}`;const cached=await AdvancedStorage.get('chartData',cacheKey);if(cached)return;try{const response=await fetch(`https://financialmodelingprep.com/stable/historical-chart/${timeframe}?symbol=${symbol}&apikey=${FMP_API_KEY}`);const data=await response.json();await AdvancedStorage.set('chartData',cacheKey,data,24*60*60*1000);console.log(`üíæ Cached chart data for ${symbol} (${timeframe})`);}catch(error){console.warn(`‚ö†Ô∏è Failed to prefetch chart for ${symbol}:`,error);}},async prefetchSectorData(){const sectors=[...new Set(DEMO_STOCKS.map(s=>s.sector))];for(const sector of sectors){if(!sector)continue;const sectorStocks=DEMO_STOCKS.filter(s=>s.sector===sector);const avgMetrics={pe:sectorStocks.reduce((sum,s)=>sum+(s.pe||0),0)/sectorStocks.length,roe:sectorStocks.reduce((sum,s)=>sum+(s.roe||0),0)/sectorStocks.length,grossMargin:sectorStocks.reduce((sum,s)=>sum+(s.grossMargin||0),0)/sectorStocks.length};await AdvancedStorage.set('analytics',`sector_${sector}`,avgMetrics,7*24*60*60*1000);}},async onStockViewed(symbol){const stock=DEMO_STOCKS.find(s=>s.symbol===symbol);if(stock?.sector){const related=DEMO_STOCKS.filter(s=>s.sector===stock.sector&&s.symbol!==symbol).slice(0,5);console.log(`üîÆ Predictively fetching ${related.length} related stocks in ${stock.sector} sector`);related.forEach(s=>this.prefetchChartData(s.symbol,'4hour'));}this.prefetchEarningsData(symbol);},async prefetchEarningsData(symbol){try{const response=await fetch(`https://financialmodelingprep.com/stable/earnings?symbol=${symbol}&apikey=${FMP_API_KEY}`);const data=await response.json();await AdvancedStorage.set('stockData',`${symbol}_earnings`,data,24*60*60*1000);}catch(error){console.warn(`‚ö†Ô∏è Failed to prefetch earnings for ${symbol}:`,error);}}};setTimeout(()=>PrefetchManager.warmupDefaultStocks(),2000);const PerformanceMonitor={metrics:[],track(operation,duration){let success=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;this.metrics.push({operation,duration,success,timestamp:Date.now(),apiCalls:API_STATS});if(this.metrics.length>100){this.metrics=this.metrics.slice(-100);}console.log(`‚ö° ${operation}: ${duration}ms ${success?'‚úÖ':'‚ùå'}`);},getCacheStats(){const total=this.metrics.length;const cached=this.metrics.filter(m=>m.duration<5).length;return{hitRate:total>0?Math.round(cached/total*100):0,avgDuration:total>0?Math.round(this.metrics.reduce((sum,m)=>sum+m.duration,0)/total):0,apiCalls:Object.entries(API_STATS).map(_ref2=>{let[api,stats]=_ref2;return{api,calls:stats.calls,failures:stats.failures,successRate:Math.round((1-stats.failures/Math.max(1,stats.calls))*100)};})};},exportReport(){const stats=this.getCacheStats();const report={timestamp:new Date().toISOString(),cacheHitRate:`${stats.hitRate}%`,averageLatency:`${stats.avgDuration}ms`,apiPerformance:stats.apiCalls,storageStats:AdvancedStorage.stats()};console.table(report.apiPerformance);console.log('üìä Performance Report:',report);const blob=new Blob([JSON.stringify(report,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`perf-report-${Date.now()}.json`;a.click();return report;},getLoadingRecommendation(){const stats=this.getCacheStats();if(stats.hitRate>80){return{strategy:'aggressive',message:'Cache is hot - use optimistic UI'};}else if(stats.hitRate>50){return{strategy:'balanced',message:'Moderate cache hit rate - show skeletons'};}else{return{strategy:'conservative',message:'Cache is cold - show loading spinners'};}}};window.PerformanceMonitor=PerformanceMonitor;const OptimizedStockLoader={async loadStock(symbol){const startTime=performance.now();const critical=await this.loadCriticalData(symbol);this.loadFundamentalData(symbol).then(data=>{this.mergeStockData(symbol,{fundamental:data});});this.loadTechnicalData(symbol).then(data=>{this.mergeStockData(symbol,{technical:data});});this.loadEnhancementData(symbol);const duration=performance.now()-startTime;PerformanceMonitor.track(`loadStock:${symbol}`,duration);return critical;},async loadCriticalData(symbol){const cached=await AdvancedStorage.get('stockData',symbol);if(cached&&cached.critical){return cached.critical;}const response=await RequestManager.batchFetch('quote',symbol);const data=Array.isArray(response.data)?response.data[0]:response.data;const ttl=Cache.isMarketOpen()?5*60*1000:60*60*1000;await AdvancedStorage.set('stockData',symbol,{critical:data},ttl);return data;},async loadFundamentalData(symbol){const cached=await AdvancedStorage.get('stockData',`${symbol}_fundamentals`);if(cached)return cached;const[profile,ratios]=await Promise.all([fetch(`https://financialmodelingprep.com/stable/profile/${symbol}?apikey=${FMP_API_KEY}`).then(r=>r.json()),fetch(`https://financialmodelingprep.com/stable/ratios/${symbol}?apikey=${FMP_API_KEY}`).then(r=>r.json())]);const data={...profile[0],...ratios[0]};await AdvancedStorage.set('stockData',`${symbol}_fundamentals`,data,60*60*1000);return data;},async loadTechnicalData(symbol){const cached=await AdvancedStorage.get('stockData',`${symbol}_technical`);if(cached)return cached;const[taData,quote]=await Promise.all([fetch(`https://financialmodelingprep.com/stable/technical-indicator/1hour?symbol=${symbol}&apikey=${FMP_API_KEY}`).then(r=>r.json()),fetch(`https://financialmodelingprep.com/stable/quote/${symbol}?apikey=${FMP_API_KEY}`).then(r=>r.json())]);const data={rsi:quote[0]?.rsi||taData[0]?.rsi,sma20:taData[0]?.sma20,sma50:taData[0]?.sma50,macd:taData[0]?.macd};await AdvancedStorage.set('stockData',`${symbol}_technical`,data,5*60*1000);return data;},async loadEnhancementData(symbol){Promise.all([this.prefetchNewsData(symbol),this.prefetchSocialData(symbol)]);},async prefetchNewsData(symbol){return Promise.resolve();},async prefetchSocialData(symbol){return Promise.resolve();},mergeStockData(symbol,updates){console.log(`üì¶ Merging updates for ${symbol}:`,Object.keys(updates));}};window.OptimizedStockLoader=OptimizedStockLoader;class PredictivePrefetcher{constructor(){this.userPatterns=this.loadPatterns();this.prefetchQueue=[];this.maxPrefetch=5;}loadPatterns(){return JSON.parse(localStorage.getItem('re_user_patterns')||'{}');}savePatterns(){localStorage.setItem('re_user_patterns',JSON.stringify(this.userPatterns));}recordView(symbol){if(!this.userPatterns[symbol]){this.userPatterns[symbol]={views:0,lastViewed:Date.now()};}this.userPatterns[symbol].views++;this.userPatterns[symbol].lastViewed=Date.now();const sorted=Object.entries(this.userPatterns).sort((a,b)=>b[1].views-a[1].views).slice(0,50);this.userPatterns=Object.fromEntries(sorted);this.savePatterns();this.schedulePrefetch(symbol);}schedulePrefetch(currentSymbol){const topSymbols=Object.keys(this.userPatterns).filter(s=>s!==currentSymbol).slice(0,this.maxPrefetch);topSymbols.forEach(symbol=>{if(!this.prefetchQueue.includes(symbol)){this.prefetchQueue.push(symbol);}});setTimeout(()=>this.processPrefetchQueue(),100);}async processPrefetchQueue(){while(this.prefetchQueue.length>0){const symbol=this.prefetchQueue.shift();const cached=Cache.get(symbol);if(!cached||isStaleTimestamp(cached.timestamp,'quote')){setTimeout(async()=>{try{const result=await smartFetch('quote',symbol);if(result?.data){Cache.set(symbol,result.data,'quote');}}catch(error){}},Math.random()*3000);}}}}const CommonDataStore={sectors:null,indices:null,marketStatus:null,init(){this.loadCommonData();setInterval(()=>this.refreshCommonData(),30*60*1000);},loadCommonData(){try{const data=localStorage.getItem('re_common_data');if(data){const parsed=JSON.parse(data);this.sectors=parsed.sectors||{};this.indices=parsed.indices||{};this.marketStatus=parsed.marketStatus||{};}}catch(error){console.warn('Failed to load common data:',error);}},saveCommonData(){const data={sectors:this.sectors,indices:this.indices,marketStatus:this.marketStatus,timestamp:Date.now()};try{localStorage.setItem('re_common_data',JSON.stringify(data));}catch(error){console.warn('Failed to save common data:',error);}},async refreshCommonData(){try{const sectorsResponse=await fetch(`https://financialmodelingprep.com/stable/sector-performance?apikey=${API_KEYS.FMP}`);if(sectorsResponse.ok){this.sectors=await sectorsResponse.json();}const indices=['^GSPC','^DJI','^IXIC','^RUT'];const indexPromises=indices.map(symbol=>smartFetch('quote',symbol).catch(()=>null));const indexResults=await Promise.all(indexPromises);this.indices=indexResults.filter(r=>r).map(r=>r.data[0]);this.saveCommonData();}catch(error){console.warn('Common data refresh failed:',error);}}};const createDataWorker=()=>{if(typeof Worker!=='undefined'){const workerCode=`
          self.onmessage = function(e) {
            const { symbols, apiKey } = e.data;
            
            // Process in background
            symbols.forEach(symbol => {
              fetch(\`https://financialmodelingprep.com/stable/quote/\${symbol}?apikey=\${apiKey}\`)
                .then(r => r.json())
                .then(data => {
                  self.postMessage({ symbol, data });
                })
                .catch(error => {
                  // Silent fail
                });
            });
          };
        `;const blob=new Blob([workerCode],{type:'application/javascript'});return new Worker(URL.createObjectURL(blob));}return null;};class BatchAPIProcessor{constructor(){this.batchSize=5;this.batchDelay=100;this.pendingRequests=new Map();}async batchFetch(symbols){let endpoint=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'quote';const results={};const batches=[];for(let i=0;i<symbols.length;i+=this.batchSize){batches.push(symbols.slice(i,i+this.batchSize));}for(let i=0;i<batches.length;i++){const batch=batches[i];const batchResults=await this.processBatch(batch,endpoint);Object.assign(results,batchResults);if(i<batches.length-1){await new Promise(resolve=>setTimeout(resolve,this.batchDelay));}}return results;}async processBatch(symbols,endpoint){if(endpoint==='quote'&&symbols.length>1){try{const symbolList=symbols.join(',');const url=`https://financialmodelingprep.com/stable/quote/${symbolList}?apikey=${API_KEYS.FMP}`;const response=await fetchWithRetry(url,{timeoutMs:15000,retries:1});if(response.ok){const data=await response.json();const result={};symbols.forEach((symbol,index)=>{result[symbol]=Array.isArray(data)?data[index]:null;});return result;}}catch(error){}}const promises=symbols.map(symbol=>smartFetch(endpoint,symbol).then(r=>r.data).catch(()=>null));const results=await Promise.all(promises);const mapped={};symbols.forEach((symbol,i)=>{mapped[symbol]=results[i];});return mapped;}}const StorageManager={modes:['optimal','degraded','minimal'],currentMode:'optimal',init(){this.detectStorageCapabilities();this.setupFallbacks();},detectStorageCapabilities(){try{localStorage.setItem('re_test','test');localStorage.removeItem('re_test');let testData='';for(let i=0;i<1024;i++){testData+='1234567890';}try{localStorage.setItem('re_space_test',testData);localStorage.removeItem('re_space_test');this.currentMode='optimal';}catch{this.currentMode='degraded';}}catch(error){this.currentMode='minimal';}},setupFallbacks(){switch(this.currentMode){case'optimal':CACHE_CONFIG.MAX_CACHE_SIZE=500;break;case'degraded':CACHE_CONFIG.MAX_CACHE_SIZE=100;CACHE_CONFIG.STOCK_DATA=30*60*1000;CACHE_CONFIG.QUOTE_DATA=5*60*1000;break;case'minimal':CACHE_CONFIG.MAX_CACHE_SIZE=20;CACHE_CONFIG.STOCK_DATA=10*60*1000;CACHE_CONFIG.QUOTE_DATA=2*60*1000;break;}},getItem(key){try{return localStorage.getItem(key);}catch{return null;}},setItem(key,value){try{localStorage.setItem(key,value);return true;}catch{this.emergencyCleanup();try{localStorage.setItem(key,value);return true;}catch{return false;}}},emergencyCleanup(){const keys=[];for(let i=0;i<localStorage.length;i++){const key=localStorage.key(i);if(key&&key.startsWith(CACHE_CONFIG.CACHE_VERSION)){keys.push(key);}}const toRemove=Math.floor(keys.length/2);for(let i=0;i<toRemove;i++){try{localStorage.removeItem(keys[i]);}catch{}}}};class PriorityLoader{constructor(){this.priorities={critical:['price','changePct','symbol','name'],high:['pe','roe','volume','marketCap'],medium:['rsi','beta','debtToEquity','currentRatio'],low:['revenueGrowth','netMargin','analystRating','dividendYield']};}async loadStockWithPriority(symbol){let priority=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'critical';const cached=Cache.get(symbol);if(cached){const result={...cached};if(priority!=='critical'&&this.needsEnhancedData(cached,priority)){setTimeout(()=>this.loadEnhancedData(symbol),0);}return result;}const criticalData=await this.fetchPriorityData(symbol,'critical');if(criticalData){Cache.set(symbol,criticalData);}if(priority!=='critical'){setTimeout(()=>this.loadEnhancedData(symbol,priority),100);}return criticalData;}async fetchPriorityData(symbol,priority){const fields=this.getFieldsForPriority(priority);const url=`https://financialmodelingprep.com/stable/quote/${symbol}?apikey=${API_KEYS.FMP}`;try{const response=await fetchWithRetry(url,{timeoutMs:8000});if(response.ok){const data=await response.json();return this.filterDataByPriority(Array.isArray(data)?data[0]:data,fields);}}catch(error){}return null;}async loadEnhancedData(symbol){let priority=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'high';const fields=this.getFieldsForPriority(priority);const url=`https://financialmodelingprep.com/stable/profile/${symbol}?apikey=${API_KEYS.FMP}`;try{const response=await fetch(url);if(response.ok){const data=await response.json();const enhanced=this.filterDataByPriority(Array.isArray(data)?data[0]:data,fields);const cached=Cache.get(symbol)||{};Cache.set(symbol,{...cached,...enhanced});}}catch(error){}}getFieldsForPriority(priority){return this.priorities[priority]||this.priorities.critical;}filterDataByPriority(data,fields){if(!data)return{};const filtered={};fields.forEach(field=>{if(data[field]!==undefined){filtered[field]=data[field];}});return filtered;}needsEnhancedData(cachedData,requestedPriority){const requestedFields=this.getFieldsForPriority(requestedPriority);return requestedFields.some(field=>cachedData[field]===undefined);}}StorageManager.init();CommonDataStore.init();const predictivePrefetcher=new PredictivePrefetcher();const priorityLoader=new PriorityLoader();const batchProcessor=new BatchAPIProcessor();async function loadStockData(symbol){const criticalData=await priorityLoader.loadStockWithPriority(symbol,'critical');predictivePrefetcher.recordView(symbol);return criticalData;}async function loadMultipleStocks(symbols){return batchProcessor.batchFetch(symbols,'quote');}window.predictivePrefetcher=predictivePrefetcher;window.priorityLoader=priorityLoader;window.batchProcessor=batchProcessor;window.loadStockData=loadStockData;window.loadMultipleStocks=loadMultipleStocks;const SECTOR_METRICS={'Technology':{pe_base:28,pe_acceptable:35,roe_target:20,roe_excellent:30,growth_target:15,growth_excellent:25,margin_target:25},'Financial Services':{pe_base:12,pe_acceptable:15,roe_target:12,roe_excellent:18,growth_target:5,growth_excellent:10,margin_target:30},'Healthcare':{pe_base:22,pe_acceptable:28,roe_target:15,roe_excellent:25,growth_target:10,growth_excellent:18,margin_target:20},'Consumer Cyclical':{pe_base:20,pe_acceptable:25,roe_target:15,roe_excellent:22,growth_target:8,growth_excellent:15,margin_target:15},'Consumer Defensive':{pe_base:18,pe_acceptable:22,roe_target:18,roe_excellent:25,growth_target:5,growth_excellent:10,margin_target:12},'Energy':{pe_base:15,pe_acceptable:20,roe_target:12,roe_excellent:20,growth_target:5,growth_excellent:12,margin_target:10},'Industrials':{pe_base:18,pe_acceptable:23,roe_target:14,roe_excellent:20,growth_target:7,growth_excellent:12,margin_target:12},'Communication Services':{pe_base:25,pe_acceptable:30,roe_target:18,roe_excellent:25,growth_target:12,growth_excellent:20,margin_target:20},'Default':{pe_base:20,pe_acceptable:25,roe_target:15,roe_excellent:22,growth_target:10,growth_excellent:18,margin_target:15}};function getSectorBenchmarks(sector){return SECTOR_METRICS[sector]||SECTOR_METRICS['Default'];}const UserManager={isLoggedIn(){return localStorage.getItem('re_user_id')!==null;},getCurrentUser(){const userId=localStorage.getItem('re_user_id');if(!userId)return null;try{return JSON.parse(localStorage.getItem(`re_user_${userId}`));}catch{return null;}},register(email,password,name){return new Promise((resolve,reject)=>{try{if(!email||!password||!name){reject('All fields are required');return;}const existingUsers=this.getAllUsers();if(existingUsers.find(u=>u.email===email)){reject('Email already registered');return;}const userId='user_'+Date.now()+Math.random().toString(36).substr(2,9);const user={id:userId,email,name,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString(),preferences:{theme:'dark',defaultView:'beginner',notifications:true,riskTolerance:'moderate'},investmentProfile:{experience:'beginner',goals:[],timeHorizon:'medium'},subscription:{tier:'free',expiresAt:null,features:['basic_screening','watchlist','portfolio_tracking']}};localStorage.setItem('re_user_id',userId);localStorage.setItem(`re_user_${userId}`,JSON.stringify(user));this.initializeUserData(userId);resolve(user);}catch(error){reject('Registration failed');}});},login(email,password){return new Promise((resolve,reject)=>{try{const users=this.getAllUsers();const user=users.find(u=>u.email===email);if(!user){reject('User not found');return;}if(!password){reject('Password required');return;}user.lastLogin=new Date().toISOString();localStorage.setItem(`re_user_${user.id}`,JSON.stringify(user));localStorage.setItem('re_user_id',user.id);resolve(user);}catch(error){reject('Login failed');}});},logout(){localStorage.removeItem('re_user_id');},updatePreferences(preferences){const user=this.getCurrentUser();if(!user)return null;user.preferences={...user.preferences,...preferences};localStorage.setItem(`re_user_${user.id}`,JSON.stringify(user));return user;},updateInvestmentProfile(profile){const user=this.getCurrentUser();if(!user)return null;user.investmentProfile={...user.investmentProfile,...profile};localStorage.setItem(`re_user_${user.id}`,JSON.stringify(user));return user;},getAllUsers(){const users=[];for(let i=0;i<localStorage.length;i++){const key=localStorage.key(i);if(key.startsWith('re_user_')&&!key.endsWith('_data')){try{users.push(JSON.parse(localStorage.getItem(key)));}catch{}}}return users;},initializeUserData(userId){const userData={watchlist:[],portfolio:[],savedScreens:[],alerts:[],learningProgress:{completedLessons:[],currentStreak:0,totalPoints:0}};localStorage.setItem(`re_user_${userId}_data`,JSON.stringify(userData));},getUserData(){const user=this.getCurrentUser();if(!user)return null;try{const data=localStorage.getItem(`re_user_${user.id}_data`);if(!data){this.initializeUserData(user.id);return JSON.parse(localStorage.getItem(`re_user_${user.id}_data`));}return JSON.parse(data);}catch{this.initializeUserData(user.id);return JSON.parse(localStorage.getItem(`re_user_${user.id}_data`));}},updateUserData(data){const user=this.getCurrentUser();if(!user)return null;const currentData=this.getUserData();const newData={...currentData,...data};localStorage.setItem(`re_user_${user.id}_data`,JSON.stringify(newData));return newData;}};const SubscriptionManager={TIERS:{free:{name:'Free',price:0,limits:{stocksPerScreen:20,watchlistItems:10,portfolioItems:5,alerts:3,apiCallsPerDay:100},features:['Basic stock screening','Watchlist (10 stocks)','Portfolio tracking (5 stocks)','Price alerts (3)','Community access']},premium:{name:'Premium',price:9.99,limits:{stocksPerScreen:100,watchlistItems:50,portfolioItems:25,alerts:25,apiCallsPerDay:1000},features:['Advanced stock screening','Unlimited watchlist','Portfolio tracking (25 stocks)','Price alerts (25)','Real-time data','Advanced analytics','Priority support']},pro:{name:'Pro',price:19.99,limits:{stocksPerScreen:500,watchlistItems:200,portfolioItems:100,alerts:100,apiCallsPerDay:10000},features:['Everything in Premium','API access','Custom screening criteria','Portfolio optimization','Tax loss harvesting','Dedicated support']}},getCurrentSubscription(){const user=UserManager.getCurrentUser();if(!user)return this.TIERS.free;const tier=user.subscription?.tier||'free';return{...this.TIERS[tier],tier};},hasFeature(feature){const subscription=this.getCurrentSubscription();return subscription.features.includes(feature);},checkLimit(limitType,currentCount){const subscription=this.getCurrentSubscription();const limit=subscription.limits[limitType];return currentCount<limit;},upgrade(tier){return new Promise((resolve,reject)=>{const user=UserManager.getCurrentUser();if(!user){reject('User not logged in');return;}if(!this.TIERS[tier]){reject('Invalid tier');return;}user.subscription={tier:tier,expiresAt:new Date(Date.now()+30*24*60*60*1000).toISOString(),features:this.TIERS[tier].features};localStorage.setItem(`re_user_${user.id}`,JSON.stringify(user));resolve(user.subscription);});}};const BeginnerMode={SIMPLIFIED_METRICS:[{key:'price',label:'Price',explanation:'Current stock price'},{key:'changePct',label:'Today\'s Change',explanation:'Price change today'},{key:'pe',label:'P/E Ratio',explanation:'Price √∑ Earnings. Lower may be better value'},{key:'roe',label:'ROE',explanation:'Return on Equity. Higher is better'},{key:'aiScore',label:'AI Score',explanation:'Overall rating from our analysis'}],EXPLANATIONS:{pe:"Think of P/E like a price tag for earnings. A P/E of 20 means you're paying $20 for each $1 of company earnings.",roe:"ROE measures how efficiently a company uses your money. 15%+ is excellent.",debtToEquity:"This shows how much debt a company has compared to its value. Lower is safer.",rsi:"RSI measures if a stock is overbought (above 70) or oversold (below 30).",marketCap:"Market Cap is the total value of all the company's shares. Larger companies are usually more stable.",volume:"Volume shows how many shares were traded. Higher volume means more interest in the stock.",changePct:"This shows how much the stock price moved today. Green (positive) is up, red (negative) is down."},shouldShowBeginnerMode(){const user=UserManager.getCurrentUser();if(!user)return true;return user.preferences?.defaultView==='beginner'||user.investmentProfile?.experience==='beginner';},getSimplifiedView(stock){return this.SIMPLIFIED_METRICS.map(metric=>({...metric,value:stock[metric.key],formattedValue:this.formatValue(stock[metric.key],metric.key)}));},formatValue(value,key){if(value==null||isNaN(value))return'‚Äî';switch(key){case'price':return`$${value.toFixed(2)}`;case'changePct':return`${value>0?'+':''}${value.toFixed(2)}%`;case'pe':return value.toFixed(1);case'roe':return`${value.toFixed(1)}%`;case'aiScore':return`${Math.round(value)}/100`;default:return value.toString();}},getExplanation(key){return this.EXPLANATIONS[key]||'No explanation available.';}};const FINANCIAL_GLOSSARY={'P/E':'<strong>Price-to-Earnings Ratio</strong><br>Shows how much investors pay for $1 of earnings.<br><em>Lower = potentially better value</em>','ROE':'<strong>Return on Equity</strong><br>Measures how efficiently a company uses shareholder money.<br><em>15%+ is excellent</em>','Market Cap':'<strong>Market Capitalization</strong><br>Total value of all company shares.<br><em>Large cap: $10B+, Mid: $2-10B, Small: <$2B</em>','Revenue Growth':'<strong>Revenue Growth Rate</strong><br>Year-over-year sales increase.<br><em>10%+ is strong growth</em>','Net Margin':'<strong>Net Profit Margin</strong><br>What % of revenue becomes profit.<br><em>20%+ is excellent</em>','Debt/Equity':'<strong>Debt-to-Equity Ratio</strong><br>Company debt vs shareholder equity.<br><em>Lower = less financial risk</em>','RSI':'<strong>Relative Strength Index</strong><br>Momentum indicator (0-100).<br><em>>70 = overbought, <30 = oversold</em>','AI Score':'<strong>AI Composite Score</strong><br>Combines fundamentals, technicals & risk.<br><em>80+ = Strong Buy, 60-80 = Buy, 40-60 = Hold</em>','Confidence':'<strong>AI Confidence Level</strong><br>How certain the AI is about its rating.<br><em>Higher = more reliable signal</em>','Current Ratio':'<strong>Current Ratio</strong><br>Can the company pay short-term debts?<br><em>1.5+ = healthy liquidity</em>','Gross Margin':'<strong>Gross Profit Margin</strong><br>Revenue minus cost of goods sold.<br><em>40%+ is strong</em>','Dividend Yield':'<strong>Dividend Yield</strong><br>Annual dividend as % of stock price.<br><em>3-6% is attractive for income</em>'};const DEMO_STOCKS=[{symbol:'AAPL',name:'Apple Inc.',price:182.45,changePct:2.34,pe:28.5,roe:147.2,revenueGrowth:16.3,grossMargin:44.1,netMargin:25.3,debtToEquity:1.8,currentRatio:1.0,marketCap:2.85e12,volume:52431000,rsi:58,sector:'Technology',index:'S&P500'},{symbol:'MSFT',name:'Microsoft Corporation',price:378.91,changePct:1.87,pe:34.2,roe:38.4,revenueGrowth:13.1,grossMargin:69.8,netMargin:34.1,debtToEquity:0.4,currentRatio:1.8,marketCap:2.81e12,volume:23456000,rsi:62,sector:'Technology',index:'S&P500'},{symbol:'GOOGL',name:'Alphabet Inc.',price:141.23,changePct:1.45,pe:24.8,roe:25.1,revenueGrowth:11.2,grossMargin:56.9,netMargin:23.7,debtToEquity:0.1,currentRatio:2.6,marketCap:1.78e12,volume:28901000,rsi:54,sector:'Technology',index:'S&P500'},{symbol:'NVDA',name:'NVIDIA Corporation',price:495.22,changePct:3.12,pe:72.1,roe:74.3,revenueGrowth:126.0,grossMargin:72.4,netMargin:48.9,debtToEquity:0.3,currentRatio:4.1,marketCap:1.22e12,volume:45678000,rsi:68,sector:'Technology',index:'NASDAQ100'},{symbol:'AMZN',name:'Amazon.com Inc.',price:151.94,changePct:0.89,pe:58.3,roe:16.8,revenueGrowth:10.8,grossMargin:48.1,netMargin:5.7,debtToEquity:0.7,currentRatio:1.0,marketCap:1.57e12,volume:39012000,rsi:51,sector:'Consumer',index:'S&P500'},{symbol:'TSLA',name:'Tesla Inc.',price:238.72,changePct:-1.23,pe:62.4,roe:22.4,revenueGrowth:18.8,grossMargin:18.2,netMargin:14.5,debtToEquity:0.1,currentRatio:1.7,marketCap:758e9,volume:98234000,rsi:45,sector:'Consumer',index:'NASDAQ100'},{symbol:'META',name:'Meta Platforms Inc.',price:352.89,changePct:2.67,pe:26.1,roe:30.2,revenueGrowth:23.4,grossMargin:81.5,netMargin:29.1,debtToEquity:0.0,currentRatio:2.9,marketCap:895e9,volume:15678000,rsi:65,sector:'Technology',index:'S&P500'},{symbol:'BRK.B',name:'Berkshire Hathaway',price:383.45,changePct:0.34,pe:8.9,roe:14.2,revenueGrowth:8.1,grossMargin:22.3,netMargin:16.8,debtToEquity:0.3,currentRatio:1.4,marketCap:878e9,volume:3421000,rsi:52,sector:'Financials',index:'S&P500'},{symbol:'JPM',name:'JPMorgan Chase',price:155.67,changePct:1.12,pe:11.3,roe:15.8,revenueGrowth:9.4,grossMargin:35.2,netMargin:28.9,debtToEquity:1.2,currentRatio:1.1,marketCap:456e9,volume:8234000,rsi:56,sector:'Financials',index:'S&P500'},{symbol:'V',name:'Visa Inc.',price:267.43,changePct:0.78,pe:30.2,roe:41.5,revenueGrowth:11.3,grossMargin:98.2,netMargin:52.4,debtToEquity:0.6,currentRatio:1.4,marketCap:548e9,volume:5123000,rsi:59,sector:'Financials',index:'S&P500'},{symbol:'UNH',name:'UnitedHealth Group',price:524.89,changePct:0.56,pe:24.7,roe:25.3,revenueGrowth:14.2,grossMargin:27.8,netMargin:6.1,debtToEquity:0.6,currentRatio:0.8,marketCap:489e9,volume:2345000,rsi:53,sector:'Healthcare',index:'S&P500'},{symbol:'JNJ',name:'Johnson & Johnson',price:157.23,changePct:-0.23,pe:15.8,roe:22.1,revenueGrowth:5.3,grossMargin:68.4,netMargin:16.7,debtToEquity:0.5,currentRatio:1.2,marketCap:378e9,volume:6789000,rsi:48,sector:'Healthcare',index:'S&P500'},{symbol:'XOM',name:'Exxon Mobil',price:103.45,changePct:-0.89,pe:9.2,roe:17.4,revenueGrowth:-2.1,grossMargin:35.6,netMargin:10.2,debtToEquity:0.2,currentRatio:1.3,marketCap:421e9,volume:18234000,rsi:42,sector:'Energy',index:'S&P500'},{symbol:'WMT',name:'Walmart Inc.',price:162.34,changePct:0.45,pe:28.4,roe:18.9,revenueGrowth:5.9,grossMargin:24.8,netMargin:2.4,debtToEquity:0.7,currentRatio:0.8,marketCap:441e9,volume:7123000,rsi:55,sector:'Consumer',index:'S&P500'},{symbol:'PG',name:'Procter & Gamble',price:152.89,changePct:0.34,pe:25.3,roe:28.4,revenueGrowth:4.2,grossMargin:49.8,netMargin:16.1,debtToEquity:0.5,currentRatio:0.6,marketCap:362e9,volume:5678000,rsi:51,sector:'Consumer',index:'S&P500'},{symbol:'HD',name:'Home Depot',price:342.56,changePct:1.23,pe:22.1,roe:1247.3,revenueGrowth:6.4,grossMargin:33.6,netMargin:10.9,debtToEquity:-8.2,currentRatio:1.1,marketCap:348e9,volume:3456000,rsi:58,sector:'Consumer',index:'S&P500'},{symbol:'MA',name:'Mastercard Inc.',price:437.89,changePct:0.89,pe:35.6,roe:148.2,revenueGrowth:13.1,grossMargin:100.0,netMargin:45.3,debtToEquity:2.1,currentRatio:1.3,marketCap:412e9,volume:2891000,rsi:60,sector:'Financials',index:'S&P500'},{symbol:'DIS',name:'Walt Disney Co.',price:92.34,changePct:-0.56,pe:42.1,roe:3.2,revenueGrowth:-0.8,grossMargin:34.2,netMargin:2.9,debtToEquity:0.5,currentRatio:1.0,marketCap:168e9,volume:9234000,rsi:44,sector:'Consumer',index:'S&P500'},{symbol:'NFLX',name:'Netflix Inc.',price:447.12,changePct:2.34,pe:41.3,roe:28.9,revenueGrowth:9.2,grossMargin:42.8,netMargin:16.0,debtToEquity:1.1,currentRatio:1.2,marketCap:192e9,volume:4567000,rsi:63,sector:'Technology',index:'NASDAQ100'},{symbol:'COST',name:'Costco Wholesale',price:672.45,changePct:0.67,pe:47.2,roe:29.4,revenueGrowth:6.7,grossMargin:11.0,netMargin:2.6,debtToEquity:0.4,currentRatio:1.0,marketCap:298e9,volume:1789000,rsi:57,sector:'Consumer',index:'S&P500'}];const processedDemoStocks=DEMO_STOCKS.map(stock=>{const analysis=computeEnhancedAnalysis(stock);return{...stock,...analysis};});const EDUCATION_CENTER={tutorials:[{id:'what-is-stock',title:'What is a Stock?',category:'basics',duration:'5 min',icon:'üìà',content:{intro:'A stock represents ownership in a company. When you buy a share, you own a small piece of that business.',keyPoints:['Stocks give you partial ownership of a company','Share prices go up and down based on company performance and investor sentiment','You can make money through price appreciation or dividends','Stocks are traded on exchanges like NYSE and NASDAQ'],example:'If Apple has 16 billion shares and you own 100 shares, you own 0.00000625% of Apple.',nextSteps:['Learn about P/E Ratio','Understanding Market Cap','How to Read Stock Charts']}},{id:'pe-ratio-explained',title:'Understanding P/E Ratio',category:'metrics',duration:'7 min',icon:'üî¢',content:{intro:'The Price-to-Earnings (P/E) ratio is one of the most important valuation metrics for stocks.',keyPoints:['P/E = Stock Price √∑ Earnings Per Share','Shows how much investors pay for each $1 of company earnings','Lower P/E might indicate undervaluation','Compare P/E ratios within the same industry','Tech stocks typically have higher P/E ratios than utilities'],example:'If a stock costs $100 and earns $5 per share, its P/E is 20. You\'re paying $20 for every $1 of earnings.',whyItMatters:'P/E helps you determine if a stock is overpriced or a good value compared to its earnings power.',practicalTip:'A P/E under 15 is often considered undervalued, 15-25 is fair, and over 25 might be overvalued (but growth stocks are exceptions).',nextSteps:['Learn ROE','Explore Debt-to-Equity','Master Market Cap']}},{id:'roe-explained',title:'Return on Equity (ROE)',category:'metrics',duration:'6 min',icon:'üí∞',content:{intro:'ROE measures how efficiently a company uses shareholder money to generate profits.',keyPoints:['ROE = Net Income √∑ Shareholder Equity','Shows profit generated from shareholder investments','15%+ ROE is considered strong','20%+ ROE is excellent','Compare ROE within the same industry'],example:'If a company has $1 million equity and makes $200,000 profit, ROE is 20%. For every $1 invested, they generate $0.20 profit.',whyItMatters:'ROE tells you if management is good at growing the business with your money.',practicalTip:'Look for companies with consistently high ROE over several years‚Äîit shows sustainable competitive advantage.',nextSteps:['Understand ROIC','Learn Profit Margins','Study Buffett Strategy']}},{id:'market-cap-sizes',title:'Market Cap: Small, Mid, Large',category:'basics',duration:'5 min',icon:'üè¢',content:{intro:'Market capitalization (market cap) is the total value of all a company\'s shares.',keyPoints:['Market Cap = Share Price √ó Total Shares Outstanding','Large Cap: $10 billion+ (stable, lower risk)','Mid Cap: $2-10 billion (growth + stability)','Small Cap: Under $2 billion (higher growth, higher risk)','Mega Cap: $200 billion+ (Apple, Microsoft, etc.)'],example:'Apple with 16B shares at $180 = $2.88 trillion market cap (mega cap)',whyItMatters:'Market cap indicates company size, risk level, and growth potential.',practicalTip:'Beginners should focus on large caps for stability. Once comfortable, add mid and small caps for growth.',nextSteps:['Portfolio Diversification','Risk Management','Asset Allocation']}},{id:'reading-charts',title:'How to Read Stock Charts',category:'technical',duration:'10 min',icon:'üìä',content:{intro:'Stock charts visualize price movements over time, helping you spot trends and patterns.',keyPoints:['Candlesticks show Open, High, Low, Close prices','Green/white candles = price went up, Red/black = down','Support levels: price tends to bounce back up','Resistance levels: price struggles to break through','Volume bars show trading activity'],example:'If you see multiple bounces at $150, that\'s a support level. If price keeps hitting $175 but can\'t break through, that\'s resistance.',whyItMatters:'Charts help you time your entry and exit points for better returns.',practicalTip:'Start with simple trend lines. Uptrend = series of higher lows. Downtrend = series of lower highs.',nextSteps:['RSI Indicator','Moving Averages','MACD Strategy']}},{id:'rsi-indicator',title:'RSI: Overbought or Oversold?',category:'technical',duration:'8 min',icon:'üìâ',content:{intro:'The Relative Strength Index (RSI) measures momentum to identify overbought or oversold conditions.',keyPoints:['RSI ranges from 0 to 100','Above 70 = overbought (potential pullback coming)','Below 30 = oversold (potential bounce coming)','Best used with other indicators, not alone','14-period RSI is the standard'],example:'If RSI hits 80, the stock may have risen too fast and could drop soon. If RSI is 25, it may have fallen too much and could bounce.',whyItMatters:'RSI helps you avoid buying at peaks and identifies potential buying opportunities at dips.',practicalTip:'Don\'t sell just because RSI is high‚Äîstrong trends can stay "overbought" for weeks. Use with trend analysis.',nextSteps:['MACD Divergence','Bollinger Bands','Combine Indicators']}},{id:'diversification',title:'Portfolio Diversification 101',category:'strategy',duration:'8 min',icon:'üéØ',content:{intro:'Diversification means spreading your money across different investments to reduce risk.',keyPoints:['Don\'t put all your eggs in one basket','Diversify across sectors (tech, healthcare, finance, etc.)','Mix large, mid, and small cap stocks','Include different asset classes (stocks, bonds, real estate)','International diversification reduces country-specific risk'],example:'Instead of putting $10,000 in one tech stock, spread it across 10 stocks in 5 different sectors.',whyItMatters:'If one stock or sector crashes, you don\'t lose everything. Diversification smooths out returns.',practicalTip:'Start with 8-15 stocks across different sectors. Too few = too risky. Too many = hard to track.',nextSteps:['Asset Allocation','Sector Rotation','Rebalancing Strategy']}},{id:'dollar-cost-averaging',title:'Dollar-Cost Averaging Strategy',category:'strategy',duration:'6 min',icon:'üíµ',content:{intro:'Dollar-cost averaging (DCA) means investing a fixed amount regularly, regardless of price.',keyPoints:['Invest the same amount weekly/monthly','Buy more shares when prices are low','Buy fewer shares when prices are high','Reduces impact of market volatility','Removes emotion from investing decisions'],example:'Invest $500/month. When stock is $50, you buy 10 shares. When it drops to $25, you buy 20 shares. Your average cost is lower.',whyItMatters:'DCA prevents you from investing everything at the peak and helps build wealth steadily.',practicalTip:'Set up automatic monthly investments so you stick with it through market ups and downs.',nextSteps:['Index Fund Investing','Long-term Wealth Building','Compound Growth']}}],caseStudies:[{id:'buffett-coca-cola',title:'Warren Buffett & Coca-Cola',investor:'Warren Buffett',year:'1988',icon:'ü•§',summary:'How Buffett turned $1 billion into $25 billion by buying a simple, understandable business.',story:'In 1988, Warren Buffett bought $1 billion worth of Coca-Cola stock when the market undervalued it during a temporary setback. He recognized Coke\'s powerful brand, global reach, and consistent earnings.',keyLessons:['Invest in businesses you understand','Look for strong brands with pricing power','Buy quality companies when they\'re temporarily down','Hold for the long term (35+ years and counting)','Focus on business fundamentals, not market noise'],metrics:{initialInvestment:'$1 billion',currentValue:'$25+ billion',annualReturn:'~10% per year',holdingPeriod:'35+ years'},takeaway:'Simple businesses with strong competitive advantages can generate massive wealth if you\'re patient.'},{id:'lynch-fidelity',title:'Peter Lynch\'s 10-Baggers',investor:'Peter Lynch',year:'1977-1990',icon:'üéØ',summary:'How a retail investor mindset helped Lynch beat the market by finding everyday winners.',story:'Peter Lynch ran Fidelity Magellan Fund and achieved 29% annual returns by investing in companies he encountered in daily life‚ÄîDunkin\' Donuts, Hanes, Home Depot. He called these "10-baggers" (stocks that returned 10x).',keyLessons:['Look for investment ideas in your daily life','Do your homework‚Äîunderstand what the company does','Small companies can become big winners','Visit stores, talk to customers, read annual reports','You don\'t need Wall Street connections to find great stocks'],metrics:{annualReturn:'29.2%',period:'13 years',$10kGrowth:'$280,000',famousWins:'Taco Bell, Home Depot, Chrysler'},takeaway:'Retail investors have an edge‚Äîyou can discover great companies before Wall Street does.'},{id:'oneil-canslim',title:'William O\'Neil\'s CANSLIM',investor:'William O\'Neil',year:'1960s+',icon:'üöÄ',summary:'A systematic approach to finding growth stocks before they skyrocket.',story:'William O\'Neil studied the best-performing stocks from 1953-1993 and found patterns. He created CANSLIM‚Äîa checklist for identifying winning stocks. His system helped countless retail investors.',keyLessons:['C: Current quarterly earnings up 25%+','A: Annual earnings growth consistent','N: New products, management, or highs','S: Supply & Demand‚Äîlow float stocks move more','L: Leader in industry, not laggard','I: Institutional sponsorship present','M: Market direction is upward'],metrics:{avgWinner:'+100-300%',timeframe:'3-12 months',successRate:'~33% (1 in 3 big winners)',strategy:'Growth stocks with momentum'},takeaway:'Follow a proven system. Cut losses quickly at -7%, let winners run.'},{id:'reit-income',title:'Building Income with REITs',investor:'Retail Investor Case',year:'2010-2025',icon:'üèòÔ∏è',summary:'How a teacher built $500/month passive income with real estate stocks.',story:'A school teacher invested $50,000 into diversified REITs (Real Estate Investment Trusts) yielding 5-8% dividends. After 15 years, between dividends and growth, her portfolio generates $500+/month in passive income.',keyLessons:['REITs must pay 90% of income as dividends','Diversify across property types (retail, office, residential)','Reinvest dividends in early years for compound growth','REITs provide real estate exposure without property management','Focus on quality REITs with strong balance sheets'],metrics:{initialInvestment:'$50,000',monthlyIncome:'$500+',totalValue:'$125,000',averageYield:'6%',period:'15 years'},takeaway:'Dividend-paying stocks can create reliable passive income streams over time.'}],getProgress(userId){const key=`re_education_progress_${userId||'guest'}`;const stored=localStorage.getItem(key);return stored?JSON.parse(stored):{completed:[],inProgress:[]};},markComplete(userId,tutorialId){const progress=this.getProgress(userId);if(!progress.completed.includes(tutorialId)){progress.completed.push(tutorialId);progress.inProgress=progress.inProgress.filter(id=>id!==tutorialId);localStorage.setItem(`re_education_progress_${userId||'guest'}`,JSON.stringify(progress));}},markInProgress(userId,tutorialId){const progress=this.getProgress(userId);if(!progress.completed.includes(tutorialId)&&!progress.inProgress.includes(tutorialId)){progress.inProgress.push(tutorialId);localStorage.setItem(`re_education_progress_${userId||'guest'}`,JSON.stringify(progress));}},getCompletionRate(userId){const progress=this.getProgress(userId);return Math.round(progress.completed.length/this.tutorials.length*100);},getTutorialsByCategory(category){return this.tutorials.filter(t=>t.category===category);},getNextTutorial(userId){const progress=this.getProgress(userId);return this.tutorials.find(t=>!progress.completed.includes(t.id)&&!progress.inProgress.includes(t.id));}};let isDemoMode=false;const INVESTMENT_STYLES={growth:{name:'Growth',emoji:'üöÄ',description:'High growth tech & innovation',symbols:['NVDA','SMCI','ARM','SNOW','TTD','UBER','SQ','SHOP','NET','DDOG']},value:{name:'Value',emoji:'üí∞',description:'Undervalued stable businesses',symbols:['BRK.B','JNJ','MMM','VZ','T','KO','PG','WMT','CVX','XOM']},momentum:{name:'Momentum',emoji:'‚ö°',description:'Strong price trends',symbols:['TSLA','META','AMD','MU','COIN','MARA','PLTR','HOOD']},quality:{name:'Quality',emoji:'‚≠ê',description:'Excellent businesses',symbols:['MSFT','AAPL','GOOGL','COST','HD','ADBE','INTU','MA','V']},dividend:{name:'Dividend',emoji:'üíµ',description:'Reliable income',symbols:['VZ','T','KO','PG','MMM','JNJ','XOM','CVX','MO','ABBV']}};function computeEnhancedAnalysis(stock){const fundamentalScore=calculateFundamentalScore(stock);const technicalScore=calculateTechnicalScore(stock);const riskScore=calculateRiskScore(stock);const aiScore=Math.round(fundamentalScore*0.5+technicalScore*0.3+riskScore*0.2);const verdict=getVerdict(aiScore);const confidence=calculateConfidence(stock);const factors=generateFactorAnalysis(stock);const takeaway=generateTakeaway(stock,verdict,factors);const watchlistGuidance=generateWatchlistGuidance(stock,factors);return{aiScore,verdict,confidence,subscores:{fundamental:Math.round(fundamentalScore),technical:Math.round(technicalScore),risk:Math.round(riskScore)},topDrivers:{positive:factors.bullish,negative:factors.bearish},takeaway,watchlistGuidance,reassurance:"Remember: this is a data-driven assessment. Always do your own research and consider your risk tolerance before investing."};}function calculateFundamentalScore(stock){let score=50;const benchmarks=getSectorBenchmarks(stock.sector);if(stock.roe!==undefined&&stock.roe!==null){if(stock.roe>benchmarks.roe_excellent){score+=15;}else if(stock.roe>benchmarks.roe_target){score+=10;}else if(stock.roe>benchmarks.roe_target*0.5){score+=5;}else if(stock.roe<0){score-=15;}else{score-=5;}}if(stock.pe>0){if(stock.pe<benchmarks.pe_base*0.7){score+=15;}else if(stock.pe<benchmarks.pe_base){score+=10;}else if(stock.pe<benchmarks.pe_acceptable){score+=5;}else if(stock.pe<benchmarks.pe_acceptable*1.3){score-=5;}else{score-=10;}}if(stock.revenueGrowth!==undefined&&stock.revenueGrowth!==null){if(stock.revenueGrowth>benchmarks.growth_excellent){score+=15;}else if(stock.revenueGrowth>benchmarks.growth_target){score+=10;}else if(stock.revenueGrowth>benchmarks.growth_target*0.5){score+=5;}else if(stock.revenueGrowth<-10){score-=15;}else if(stock.revenueGrowth<0){score-=10;}}if(stock.grossMargin!==undefined&&stock.grossMargin!==null){if(stock.grossMargin>benchmarks.margin_target*1.5){score+=12;}else if(stock.grossMargin>benchmarks.margin_target){score+=8;}else if(stock.grossMargin>benchmarks.margin_target*0.7){score+=4;}}if(stock.netMargin!==undefined&&stock.netMargin!==null){if(stock.netMargin>20)score+=5;else if(stock.netMargin<0)score-=5;}return Math.max(0,Math.min(100,score));}function calculateTechnicalScore(stock){let score=50;if(stock.rsi>=30&&stock.rsi<=70)score+=15;else if(stock.rsi>70)score-=10;else if(stock.rsi<30)score+=5;if(stock.changePct>5)score+=10;else if(stock.changePct>0)score+=5;else if(stock.changePct<-5)score-=10;return Math.max(0,Math.min(100,score));}function calculateRiskScore(stock){let score=50;if(stock.debtToEquity<0.5)score+=20;else if(stock.debtToEquity<1)score+=10;else if(stock.debtToEquity>2)score-=20;if(stock.currentRatio>2)score+=15;else if(stock.currentRatio>1.5)score+=10;else if(stock.currentRatio<1)score-=15;return Math.max(0,Math.min(100,score));}function getVerdict(score){if(score>=80)return"STRONG BUY";if(score>=65)return"BUY";if(score>=45)return"HOLD";if(score>=30)return"REDUCE";return"SELL";}function calculateConfidence(stock){let confidence=50;const hasData=[stock.pe,stock.roe,stock.revenueGrowth,stock.grossMargin,stock.debtToEquity,stock.currentRatio,stock.rsi].filter(v=>v!=null&&!isNaN(v)).length;confidence+=hasData*5;return Math.min(95,Math.max(30,confidence));}function generateFactorAnalysis(stock){const bullish=[];const bearish=[];if(stock.roe>20){bullish.push({factor:"Exceptional ROE",detail:`${stock.roe?.toFixed(1)}% ROE indicates strong profitability and efficient capital use`});}else if(stock.roe>15){bullish.push({factor:"Strong ROE",detail:`${stock.roe?.toFixed(1)}% ROE shows solid return on equity`});}else if(stock.roe<10){bearish.push({factor:"Low ROE",detail:`${stock.roe?.toFixed(1)}% ROE is below industry standards`});}if(stock.revenueGrowth>20){bullish.push({factor:"High Growth",detail:`Revenue growing at ${stock.revenueGrowth?.toFixed(1)}% YoY shows strong demand`});}else if(stock.revenueGrowth<0){bearish.push({factor:"Revenue Decline",detail:`Revenue down ${Math.abs(stock.revenueGrowth)?.toFixed(1)}% YoY raises concerns`});}if(stock.pe>0&&stock.pe<15){bullish.push({factor:"Attractive Valuation",detail:`P/E of ${stock.pe?.toFixed(1)} suggests stock may be undervalued`});}else if(stock.pe>30){bearish.push({factor:"High Valuation",detail:`P/E of ${stock.pe?.toFixed(1)} indicates premium pricing vs sector average`});}if(stock.debtToEquity<0.5){bullish.push({factor:"Low Debt",detail:`Debt/Equity of ${stock.debtToEquity?.toFixed(2)} shows conservative balance sheet`});}else if(stock.debtToEquity>1.5){bearish.push({factor:"High Leverage",detail:`Debt/Equity of ${stock.debtToEquity?.toFixed(2)} indicates elevated financial risk`});}if(stock.changePct>5){bullish.push({factor:"Strong Momentum",detail:`Price up ${stock.changePct?.toFixed(1)}% shows positive market sentiment`});}else if(stock.changePct<-5){bearish.push({factor:"Negative Momentum",detail:`Price down ${Math.abs(stock.changePct)?.toFixed(1)}% indicates selling pressure`});}if(stock.rsi<30){bullish.push({factor:"Oversold Condition",detail:`RSI of ${stock.rsi?.toFixed(0)} suggests potential buying opportunity`});}else if(stock.rsi>70){bearish.push({factor:"Overbought",detail:`RSI of ${stock.rsi?.toFixed(0)} warns of potential pullback`});}if(bullish.length===0){bullish.push({factor:"Stable Metrics",detail:"Core financials appear stable with no major red flags"});}if(bearish.length===0){bearish.push({factor:"Market Volatility",detail:"General market conditions warrant monitoring"});}return{bullish:bullish.slice(0,3),bearish:bearish.slice(0,3)};}function generateTakeaway(stock,verdict,factors){const symbol=stock.symbol;if(verdict==="STRONG BUY"||verdict==="BUY"){return`Overall, ${symbol} presents a compelling opportunity. The combination of ${factors.bullish[0]?.factor.toLowerCase()||'strong fundamentals'} and positive momentum suggests this could be a solid addition to a growth-focused portfolio. While ${factors.bearish[0]?.factor.toLowerCase()||'some risks exist'}, the bullish factors currently outweigh concerns.`;}else if(verdict==="HOLD"){return`${symbol} shows mixed signals. While ${factors.bullish[0]?.factor.toLowerCase()||'some positives exist'}, concerns around ${factors.bearish[0]?.factor.toLowerCase()||'valuation'} suggest a wait-and-see approach. Consider this a watchlist candidate while monitoring for better entry points or improving fundamentals.`;}else{return`${symbol} faces headwinds that warrant caution. Key concerns include ${factors.bearish[0]?.factor.toLowerCase()||'valuation pressure'} and ${factors.bearish[1]?.factor.toLowerCase()||'weakening fundamentals'}. Unless you have strong conviction in a turnaround thesis, consider reducing exposure or avoiding new positions at current levels.`;}}function generateWatchlistGuidance(stock,factors){const topBearish=factors.bearish[0]?.factor||"earnings surprises";const keyMetric=stock.roe>stock.revenueGrowth?"ROE and profit margins":"revenue growth and market share";return{headline:"What to Watch Next",items:[{label:"Next check-in",value:"Review after the next earnings cycle (typically quarterly)"},{label:"Key metric to monitor",value:keyMetric},{label:"Main risk to watch",value:topBearish}]};}function computePortfolioAllocation(stocks,watchlist){if(!watchlist||watchlist.length===0){return{stocks:[],sectorWeights:{},isEmpty:true};}const watchlistedStocks=stocks.filter(s=>watchlist&&Array.isArray(watchlist)&&watchlist.some(w=>w&&w.toUpperCase()===s.symbol.toUpperCase()));if(watchlistedStocks.length===0){return{stocks:[],sectorWeights:{},isEmpty:true};}const weight=100/watchlistedStocks.length;const allocation=watchlistedStocks.map(s=>({symbol:s.symbol,name:s.name||s.symbol,sector:s.sector||'Other',weight:weight,price:s.price,aiScore:s.aiScore,verdict:s.verdict}));const sectorWeights={};allocation.forEach(a=>{sectorWeights[a.sector]=(sectorWeights[a.sector]||0)+a.weight;});return{stocks:allocation,sectorWeights,isEmpty:false,totalStocks:watchlistedStocks.length,sectorCount:Object.keys(sectorWeights).length};}function getSectorColor(sector){const colors={'Technology':'from-cyan-500 to-blue-500','Healthcare':'from-green-500 to-emerald-500','Financials':'from-yellow-500 to-orange-500','Consumer':'from-purple-500 to-pink-500','Energy':'from-red-500 to-orange-500','Industrials':'from-gray-500 to-slate-500','Materials':'from-amber-500 to-yellow-500','Utilities':'from-blue-500 to-cyan-500','Real Estate':'from-indigo-500 to-purple-500','Communication':'from-pink-500 to-rose-500','Other':'from-slate-500 to-gray-500'};return colors[sector]||colors['Other'];}const MLModels={optimizePortfolio(positions){let riskFreeRate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0.02;try{if(!positions||positions.length===0)throw new Error('No positions provided');const n=positions.length;const returns=positions.map(pos=>pos.expectedReturn||0.08);const volatilities=positions.map(pos=>pos.volatility||0.15);const correlation=0.3;const covarianceMatrix=Array(n).fill().map((_,i)=>Array(n).fill().map((_,j)=>{if(i===j)return Math.pow(volatilities[i],2);return correlation*volatilities[i]*volatilities[j];}));const portfolios=[];const numPortfolios=1000;for(let p=0;p<numPortfolios;p++){let weights=Array.from({length:n},()=>Math.random());const sum=weights.reduce((a,b)=>a+b,0);weights=weights.map(w=>w/sum);const portfolioReturn=weights.reduce((sum,w,i)=>sum+w*returns[i],0);let portfolioVariance=0;for(let i=0;i<n;i++){for(let j=0;j<n;j++){portfolioVariance+=weights[i]*weights[j]*covarianceMatrix[i][j];}}const portfolioVolatility=Math.sqrt(portfolioVariance);const sharpeRatio=(portfolioReturn-riskFreeRate)/portfolioVolatility;portfolios.push({weights,return:portfolioReturn,volatility:portfolioVolatility,sharpeRatio});}const maxSharpe=portfolios.reduce((best,current)=>current.sharpeRatio>best.sharpeRatio?current:best);const minVolatility=portfolios.reduce((best,current)=>current.volatility<best.volatility?current:best);const efficientFrontier=[...portfolios].sort((a,b)=>a.volatility-b.volatility).filter((p,i)=>i%10===0).slice(0,20);return{maxSharpePortfolio:{...maxSharpe,weights:maxSharpe.weights.map((w,i)=>({symbol:positions[i].symbol,weight:w*100,contribution:w*returns[i]}))},minVolatilityPortfolio:{...minVolatility,weights:minVolatility.weights.map((w,i)=>({symbol:positions[i].symbol,weight:w*100,contribution:w*returns[i]}))},efficientFrontier,individualMetrics:positions.map((pos,i)=>({symbol:pos.symbol,expectedReturn:returns[i],volatility:volatilities[i],sharpeRatio:(returns[i]-riskFreeRate)/volatilities[i]}))};}catch(error){console.error('Portfolio optimization error:',error);throw error;}}};function calcSleepWellScore(stock){const vol=stock.beta?Math.abs((stock.beta-1)*30):25;const maxDD=stock.changePct?Math.abs(Math.min(0,stock.changePct))*3:30;const de=stock.debtToEquity||0.5;const rsi=stock.rsi||50;let score=100;if(vol>35)score-=20;else if(vol>25)score-=10;if(maxDD>40)score-=25;else if(maxDD>25)score-=15;if(de>1)score-=20;else if(de>0.5)score-=10;if(rsi>70||rsi<30)score-=10;return Math.max(0,Math.round(score));}const CRASH_SCENARIOS={'2008 Financial Crisis':{drop:-57,weeks:78,name:'2008'},'2020 COVID Crash':{drop:-34,weeks:5,name:'2020'},'2000 Dot-com Bust':{drop:-49,weeks:63,name:'2000'},'1987 Black Monday':{drop:-34,weeks:1,name:'1987'}};function simulateMarketCrash(portfolioHoldings,scenarioKey){const scenario=CRASH_SCENARIOS[scenarioKey];if(!scenario)return null;const totalValue=portfolioHoldings.reduce((sum,h)=>sum+h.currentValue,0);const lossUsd=totalValue*Math.abs(scenario.drop)/100;const lossPct=Math.abs(scenario.drop);const perWeek=lossUsd/scenario.weeks;const finalValue=totalValue-lossUsd;return{scenarioName:scenarioKey,totalValue,lossUsd,lossPct,weeks:scenario.weeks,perWeek,finalValue,percentRemaining:100-lossPct};}let mlPredictionQueue=[];let mlPredictionProcessing=false;const ML_PREDICTION_DELAY=500;async function processMLPredictionQueue(){if(mlPredictionProcessing||mlPredictionQueue.length===0)return;mlPredictionProcessing=true;while(mlPredictionQueue.length>0){const{symbol,resolve,reject}=mlPredictionQueue.shift();try{const result=await computeMLPredictionInternal(symbol);resolve(result);}catch(error){reject(error);}if(mlPredictionQueue.length>0){await new Promise(r=>setTimeout(r,ML_PREDICTION_DELAY));}}mlPredictionProcessing=false;}async function computeMLPrediction(symbol){return new Promise((resolve,reject)=>{mlPredictionQueue.push({symbol,resolve,reject});processMLPredictionQueue();});}async function computeMLPredictionInternal(symbol){try{console.log(`ü§ñ Computing ML prediction for ${symbol}...`);const url=`https://financialmodelingprep.com/stable/historical-price-eod/full?symbol=${symbol}&apikey=${FMP_API_KEY}`;const resp=await fetchWithRetry(url,{timeoutMs:20000,retries:3,retryDelayMs:2000,shouldRetry:_ref3=>{let{response,error}=_ref3;if(error)return true;if(!response)return true;if(response.status===429)return true;if(response.status>=500)return true;return false;}});if(!resp||!resp.ok){if(resp?.status===403){console.log(`‚ö†Ô∏è ML predictions require FMP premium subscription (skipping for ${symbol})`);}else if(resp?.status===429){console.warn(`‚è≥ ML prediction rate limited for ${symbol} - skipping`);}else{console.warn(`ML prediction fetch failed for ${symbol} - Status: ${resp?.status||'unknown'}`);}return{predPct:null,conf:null,trend:null};}const data=await resp.json();const historical=Array.isArray(data)?data.slice(0,60):[];await new Promise(r=>setTimeout(r,300));console.log(`   üìä Got ${historical.length} historical data points for ${symbol}`);if(historical.length>0){console.log(`   üìÖ Sample data point:`,historical[0]);}if(historical.length<60){console.warn(`Insufficient historical data for ${symbol} (need 60 days, got ${historical.length})`);return{predPct:null,conf:null,trend:null};}const prices=historical.slice(0,60).reverse().map(d=>d.close);console.log(`   üí∞ Extracted prices for ${symbol}: [${prices.slice(0,5).join(', ')}...]`);console.log(`   üìç Current price: ${prices[prices.length-1]}`);const current=prices[prices.length-1];console.log(`   üß† Creating tensors for ${symbol}...`);const xs=tf.tensor2d(Array.from({length:60},(_,i)=>[i]));const ys=tf.tensor2d(prices.map(p=>[p]));const model=tf.sequential();model.add(tf.layers.dense({units:1,inputShape:[1]}));model.compile({optimizer:tf.train.adam(0.1),loss:'meanSquaredError'});console.log(`   üéì Training model for ${symbol}...`);const history=await model.fit(xs,ys,{epochs:100,verbose:0,shuffle:false});console.log(`   ‚úì Training complete, final loss: ${history.history.loss[history.history.loss.length-1]}`);console.log(`   üîÆ Predicting for ${symbol}...`);const prediction=model.predict(tf.tensor2d([[60]]));const predictedPrice=prediction.dataSync()[0];console.log(`   üíé Predicted price: ${predictedPrice}, Current: ${current}`);const predPct=(predictedPrice-current)/current*100;console.log(`   üìà Percentage change: ${predPct}%`);const rawConf=100-Math.abs(predPct)*1.5;const conf=Math.round(Math.max(10,Math.min(90,rawConf)));const trend=predPct>2?'bullish':predPct<-2?'bearish':'neutral';let interpretation='';const absPct=Math.abs(predPct);if(predPct>10){interpretation=`Strong upward trend predicted. Model suggests ${absPct.toFixed(1)}% potential gain based on recent price momentum.`;}else if(predPct>5){interpretation=`Moderate bullish signal. Technical analysis indicates ${absPct.toFixed(1)}% upside potential.`;}else if(predPct>2){interpretation=`Slight positive movement expected. Model forecasts ${absPct.toFixed(1)}% modest gain.`;}else if(predPct>-2){interpretation=`Neutral forecast. Price expected to remain relatively stable with minimal movement (${Math.abs(predPct).toFixed(1)}%).`;}else if(predPct>-5){interpretation=`Slight bearish trend. Model suggests ${absPct.toFixed(1)}% potential decline.`;}else if(predPct>-10){interpretation=`Moderate downward pressure. Technical indicators point to ${absPct.toFixed(1)}% downside risk.`;}else{interpretation=`Strong bearish signal. Model predicts ${absPct.toFixed(1)}% potential loss based on recent trends.`;}if(conf>70){interpretation+=` High confidence (${conf}%).`;}else if(conf>50){interpretation+=` Moderate confidence (${conf}%).`;}else{interpretation+=` Low confidence (${conf}%) - use caution.`;}xs.dispose();ys.dispose();prediction.dispose();console.log(`‚úì ML prediction for ${symbol}: ${predPct.toFixed(1)}% (conf: ${conf}%)`);return{predPct:parseFloat(predPct.toFixed(1)),conf,trend,predictedPrice:parseFloat(predictedPrice.toFixed(2)),interpretation};}catch(error){console.error(`ML prediction error for ${symbol}:`,error);return{predPct:null,conf:null,trend:null};}async function computeAdvancedMLPrediction(priceHistory,currentRsi,currentVolume){try{if(!priceHistory||priceHistory.length<20){console.warn('‚ö†Ô∏è  Insufficient price history for advanced ML');return null;}const prices=priceHistory.map(d=>d.close);const volumes=priceHistory.map(d=>d.volume||currentVolume);const rsiValues=priceHistory.map((d,i)=>currentRsi+(Math.random()-0.5)*10);const features=[];const labels=[];for(let i=0;i<prices.length-1;i++){features.push([prices[i],rsiValues[i],volumes[i]/1000000]);labels.push(prices[i+1]);}const xs=tf.tensor2d(features);const ys=tf.tensor2d(labels,[labels.length,1]);const model=tf.sequential();model.add(tf.layers.dense({units:16,activation:'relu',inputShape:[3]}));model.add(tf.layers.dropout({rate:0.2}));model.add(tf.layers.dense({units:8,activation:'relu'}));model.add(tf.layers.dense({units:1}));model.compile({optimizer:tf.train.adam(0.01),loss:'meanSquaredError',metrics:['mae']});await model.fit(xs,ys,{epochs:50,verbose:0,shuffle:true,validationSplit:0.1});const lastInput=tf.tensor2d([[prices[prices.length-1],currentRsi,currentVolume/1000000]]);const prediction=model.predict(lastInput);const predictedPrice=prediction.dataSync()[0];const recentPrices=prices.slice(-10);const volatility=calculateVolatility(recentPrices);const confidence=Math.max(0,Math.min(100,100-volatility*2));xs.dispose();ys.dispose();lastInput.dispose();prediction.dispose();model.dispose();console.log(`‚úÖ Advanced ML prediction: $${predictedPrice.toFixed(2)} (confidence: ${confidence.toFixed(0)}%)`);return{predictedPrice:predictedPrice,confidence:confidence,method:'enhanced_ml'};}catch(error){console.error('‚ùå Advanced ML prediction error:',error);return null;}}function calculateVolatility(prices){if(prices.length<2)return 0;const returns=[];for(let i=1;i<prices.length;i++){returns.push((prices[i]-prices[i-1])/prices[i-1]);}const mean=returns.reduce((a,b)=>a+b,0)/returns.length;const variance=returns.reduce((sum,r)=>sum+Math.pow(r-mean,2),0)/returns.length;return Math.sqrt(variance)*100;}}function formatMLPrediction(pred){if(pred==null||isNaN(pred))return'‚Äî';const sign=pred>0?'+':'';return`${sign}${pred.toFixed(1)}%`;}async function exportStockTearSheet(stock){try{console.log(`üìÑ Generating PDF tear sheet for ${stock.symbol}...`);const element=document.getElementById('stock-modal-content');if(!element){console.error('Stock modal content not found');return;}const originalContent=element.innerHTML;const loadingDiv=document.createElement('div');loadingDiv.className='fixed inset-0 bg-black/50 flex items-center justify-center z-50';loadingDiv.innerHTML='<div class="text-white text-lg"><i class="fas fa-spinner animate-spin mr-2"></i>Generating PDF...</div>';element.appendChild(loadingDiv);await new Promise(resolve=>setTimeout(resolve,100));const canvas=await html2canvas(element,{backgroundColor:'#0f172a',scale:2,logging:false,useCORS:true});element.removeChild(loadingDiv);const imgData=canvas.toDataURL('image/png');const{jsPDF}=window.jspdf;const pdf=new jsPDF('p','mm','a4');const pdfWidth=pdf.internal.pageSize.getWidth();const pdfHeight=canvas.height*pdfWidth/canvas.width;pdf.addImage(imgData,'PNG',0,0,pdfWidth,pdfHeight);const date=new Date().toISOString().split('T')[0];const filename=`${stock.symbol}_TearSheet_${date}.pdf`;pdf.save(filename);console.log(`‚úì PDF tear sheet saved: ${filename}`);}catch(error){console.error('PDF export error:',error);alert('Failed to generate PDF. Please try again.');}}function exportScreenerResults(stocks){const timestamp=new Date().toISOString().split('T')[0];const headers=['Symbol','Name','Price','Change%','P/E','ROE%','Growth%','Score','Verdict'];const rows=stocks.map(s=>[s.symbol,s.name,s.price?.toFixed(2),s.changePct?.toFixed(2),s.pe?.toFixed(1),s.roe?.toFixed(1),s.revenueGrowth?.toFixed(1),s.aiScore,s.verdict]);const csv=[headers.join(','),...rows.map(r=>r.join(','))].join('\n');const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`screener_${timestamp}.csv`;a.click();}function toggleDemoMode(){isDemoMode=!isDemoMode;console.log('Demo mode:',isDemoMode?'ON':'OFF');window.location.reload();}const getSmartInsight=stock=>{if(!stock)return null;if(stock.lastEarnings&&stock.lastEarnings.date){const earningsDate=new Date(stock.lastEarnings.date);const today=new Date();const diffTime=earningsDate-today;const diffDays=Math.ceil(diffTime/(1000*60*60*24));if(diffDays>=0&&diffDays<=7)return{text:`Earnings in ${diffDays}d`,color:'text-yellow-400',icon:'üìÖ'};if(diffDays<0&&diffDays>=-2)return{text:`Earnings just reported`,color:'text-blue-400',icon:'üì¢'};}if(stock.rsi<30)return{text:`RSI Oversold (${stock.rsi.toFixed(0)})`,color:'text-green-400',icon:'üìâ'};if(stock.rsi>75)return{text:`RSI Overbought (${stock.rsi.toFixed(0)})`,color:'text-red-400',icon:'üìà'};if(stock.changePct>5)return{text:`Big Move Up (+${stock.changePct.toFixed(1)}%)`,color:'text-green-400',icon:'üöÄ'};if(stock.changePct<-5)return{text:`Big Drop (${stock.changePct.toFixed(1)}%)`,color:'text-red-400',icon:'ü©∏'};if(stock.upside>30)return{text:`Analyst Upside +${stock.upside.toFixed(0)}%`,color:'text-cyan-400',icon:'üéØ'};if(stock.revenueGrowth>30)return{text:`High Growth (+${stock.revenueGrowth.toFixed(0)}%)`,color:'text-purple-400',icon:'üå±'};if(stock.pe>0&&stock.pe<10)return{text:`Deep Value (P/E ${stock.pe.toFixed(1)})`,color:'text-emerald-400',icon:'üí∞'};if(stock.verdict==='STRONG BUY')return{text:'AI Strong Buy',color:'text-green-400',icon:'ü§ñ'};if(stock.verdict==='SELL')return{text:'AI Sell Signal',color:'text-red-400',icon:'‚ö†Ô∏è'};return{text:stock.sector||'Neutral',color:'text-slate-500',icon:'üè¢'};};const ALL_COLUMNS=[{key:'watchlist',label:'‚≠ê',category:'core',tooltip:'Add to watchlist'},{key:'symbol',label:'Symbol',category:'core'},{key:'smartInsight',label:'Smart Insight',category:'core',tooltip:'Key reason to watch this stock right now'},{key:'price',label:'Price',category:'core'},{key:'changePct',label:'Change%',category:'core'},{key:'volume',label:'Volume',category:'core'},{key:'sparkline',label:'Sparkline',category:'core'},{key:'pe',label:'P/E',category:'valuation'},{key:'priceToBook',label:'P/B',category:'valuation'},{key:'priceToSales',label:'P/S',category:'valuation'},{key:'evToEbitda',label:'EV/EBITDA',category:'valuation'},{key:'roe',label:'ROE%',category:'profitability'},{key:'roa',label:'ROA%',category:'profitability'},{key:'roic',label:'ROIC%',category:'profitability'},{key:'grossMargin',label:'Gross Margin%',category:'profitability'},{key:'operatingMargin',label:'Operating Margin%',category:'profitability'},{key:'netMargin',label:'Net Margin%',category:'profitability'},{key:'revenueGrowth',label:'Revenue Growth%',category:'growth'},{key:'netIncomeGrowth',label:'Income Growth%',category:'growth'},{key:'epsGrowth',label:'EPS Growth%',category:'growth'},{key:'currentRatio',label:'Current Ratio',category:'financial'},{key:'quickRatio',label:'Quick Ratio',category:'financial'},{key:'debtToEquity',label:'Debt/Equity',category:'financial'},{key:'debtToAssets',label:'Debt/Assets',category:'financial'},{key:'cashRatio',label:'Cash Ratio',category:'financial'},{key:'piotroskiScore',label:'Piotroski',category:'quality'},{key:'altmanZScore',label:'Altman Z',category:'quality'},{key:'analystRating',label:'FMP Rating',category:'analyst'},{key:'priceTargetAvg',label:'Price Target',category:'analyst'},{key:'analystCount',label:'Analyst Count',category:'analyst'},{key:'beta',label:'Beta',category:'technical',tooltip:'Measure of volatility relative to the market. >1 is more volatile, <1 is less volatile.'},{key:'rsi',label:'RSI',category:'technical'},{key:'index',label:'Index',category:'core'},{key:'mlPrediction',label:'ML 30d',category:'ml',tooltip:'Machine learning prediction of 30-day price movement based on 60 days of historical data. Positive % = expected gain, Negative % = expected decline.'},{key:'verdict',label:'Verdict',category:'core'}];const DEFAULT_VISIBLE=['watchlist','symbol','smartInsight','price','changePct','pe','roe','analystRating','mlPrediction','verdict'];const PRESET_SCREENS={growth:{name:'Growth',filters:{roe_min:10,revenueGrowth_min:5}},momentum:{name:'Momentum',filters:{changePct_min:0.5,rsi_min:50}},oversold:{name:'Oversold',filters:{rsi_max:40}},value:{name:'Value',filters:{pe_max:25,debtToEquity_max:1.5}}};const SECTORS=['Technology','Healthcare','Financial Services','Consumer Cyclical','Industrials','Communication Services','Consumer Defensive','Energy','Real Estate','Utilities','Basic Materials'];const formatNumber=function(val){let decimals=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;if(val==null||isNaN(val))return'‚Äî';if(Math.abs(val)>=1e12)return`${(val/1e12).toFixed(1)}T`;if(Math.abs(val)>=1e9)return`${(val/1e9).toFixed(1)}B`;if(Math.abs(val)>=1e6)return`${(val/1e6).toFixed(1)}M`;return val.toFixed(decimals);};const formatPercent=function(val){let decimals=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(val==null||isNaN(val))return'‚Äî';return`${val>0?'+':''}${val.toFixed(decimals)}%`;};const formatCurrency=val=>{if(val==null||isNaN(val))return'$‚Äî';return`$${formatNumber(val)}`;};const formatDateSafe=function(value){let fallback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'‚Äî';if(!value)return fallback;const t=new Date(value).getTime();if(!Number.isFinite(t))return fallback;try{return new Date(t).toLocaleDateString();}catch{return fallback;}};const getSentimentColor=val=>{if(val==null||isNaN(val))return'text-slate-500';if(val>0)return'text-green-400';if(val<0)return'text-red-400';return'text-yellow-400';};const getHealthColor=health=>{if(health>=70)return'bg-green-500';if(health>=40)return'bg-yellow-500';return'bg-red-500';};const exportToCSV=function(data){let filename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'export.csv';if(!data||!data.length)return;const headers=Object.keys(data[0]);const csvContent=[headers.join(','),...data.map(row=>headers.map(header=>{const cell=row[header];if(cell==null)return'';const stringCell=String(cell);return stringCell.includes(',')?`"${stringCell.replace(/"/g,'""')}"`:stringCell;}).join(','))].join('\n');const blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=filename;link.style.display='none';document.body.appendChild(link);link.click();document.body.removeChild(link);};class RealtimeDataManager{constructor(){let apiKey=arguments.length>0&&arguments[0]!==undefined?arguments[0]:API_KEYS.FINNHUB;this.apiKey=apiKey;this.ws=null;this.subscribers=new Map();this.reconnectAttempts=0;this.maxReconnectAttempts=3;this.reconnectDelay=1000;this.isConnected=false;this.lastPrices=new Map();this.connectionListeners=[];this.websocketDisabled=false;}connect(){if(this.websocketDisabled){console.log('‚ö†Ô∏è WebSocket disabled (free tier limitation). Using smart polling instead.');return;}const isBrowser=typeof window!=='undefined';if(isBrowser){console.log('‚ö†Ô∏è WebSocket disabled in browser (CORS restrictions). Using manual refresh instead.');return;}if(this.ws?.readyState===WebSocket.OPEN){console.log('‚úÖ WebSocket already connected');return;}if(this.reconnectAttempts===0){console.log('üîå Connecting to Finnhub WebSocket...');console.log(`üîë Using API key: ${this.apiKey.substring(0,10)}...`);}try{this.ws=new WebSocket(`wss://ws.finnhub.io?token=${this.apiKey}`);this.ws.onopen=()=>{console.log('‚úÖ WebSocket connected successfully!');this.isConnected=true;this.reconnectAttempts=0;this.notifyConnectionChange(true);this.subscribers.forEach((_,symbol)=>{this.ws.send(JSON.stringify({type:'subscribe',symbol:symbol}));console.log(`üì° Resubscribed to ${symbol}`);});};this.ws.onmessage=event=>{try{const data=JSON.parse(event.data);if(data.type==='trade'&&data.data){data.data.forEach(trade=>{const symbol=trade.s;const price=trade.p;const volume=trade.v;const timestamp=trade.t;const lastPrice=this.lastPrices.get(symbol);this.lastPrices.set(symbol,price);const change=lastPrice?(price-lastPrice)/lastPrice*100:0;const callbacks=this.subscribers.get(symbol);if(callbacks){callbacks.forEach(cb=>{try{cb({symbol,price,volume,timestamp,quoteFetchedAt:timestamp,change,source:'websocket'});}catch(err){console.error(`Error in callback for ${symbol}:`,err);}});}});}}catch(error){console.error('‚ùå Error processing WebSocket message:',error);}};this.ws.onerror=error=>{if(this.reconnectAttempts===0){console.log('‚ö†Ô∏è WebSocket connection error (checking connectivity...)');}};this.ws.onclose=event=>{if(this.reconnectAttempts===0&&event.code!==1006){console.log(`üîå WebSocket disconnected (code: ${event.code})`);}this.isConnected=false;this.notifyConnectionChange(false);this.reconnect();};}catch(error){console.error('‚ùå Failed to create WebSocket:',error);this.reconnect();}}reconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.warn('‚ö†Ô∏è WebSocket connection failed (likely free tier limitation)');console.log('üìä Continuing with smart polling for data updates');this.notifyConnectionChange(false);return;}this.reconnectAttempts++;const delay=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);if(this.reconnectAttempts<=2){console.log(`üîÑ Reconnecting in ${delay}ms... (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`);}setTimeout(()=>this.connect(),delay);}subscribe(symbol,callback){if(!this.subscribers.has(symbol)){this.subscribers.set(symbol,[]);if(this.isConnected&&this.ws?.readyState===WebSocket.OPEN){this.ws.send(JSON.stringify({type:'subscribe',symbol:symbol}));console.log(`üì° Subscribed to ${symbol} real-time updates`);}}this.subscribers.get(symbol).push(callback);console.log(`‚úÖ Added subscriber for ${symbol} (total: ${this.subscribers.get(symbol).length})`);}unsubscribe(symbol,callback){const callbacks=this.subscribers.get(symbol);if(!callbacks)return;const index=callbacks.indexOf(callback);if(index>-1){callbacks.splice(index,1);console.log(`‚úÖ Removed subscriber for ${symbol} (remaining: ${callbacks.length})`);}if(callbacks.length===0){this.subscribers.delete(symbol);if(this.isConnected&&this.ws?.readyState===WebSocket.OPEN){this.ws.send(JSON.stringify({type:'unsubscribe',symbol:symbol}));console.log(`üì° Unsubscribed from ${symbol}`);}}}disconnect(){if(this.ws){console.log('üîå Disconnecting WebSocket...');this.ws.close();this.ws=null;}this.subscribers.clear();this.isConnected=false;this.lastPrices.clear();this.notifyConnectionChange(false);}onConnectionChange(callback){this.connectionListeners.push(callback);}notifyConnectionChange(connected){this.connectionListeners.forEach(cb=>{try{cb(connected);}catch(err){console.error('Error in connection listener:',err);}});}getStatus(){return{connected:this.isConnected,subscribedSymbols:Array.from(this.subscribers.keys()),totalSubscribers:Array.from(this.subscribers.values()).reduce((sum,arr)=>sum+arr.length,0)};}}class SmartPoller{constructor(){let options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.intervals=new Map();this.baseUpdateFrequency=options.frequency||60*60*1000;this.offHoursFrequency=options.offHoursFrequency||60*60*1000;}async pollStock(symbol,callback){const isBrowser=typeof window!=='undefined';if(isBrowser){console.log(`‚è±Ô∏è Polling skipped in browser for ${symbol}`);return;}symbol=cleanSymbol(symbol);try{console.log(`‚è±Ô∏è Polling ${symbol}...`);const result=await smartFetch('quote',symbol);if(result?.data?.[0]){const data=result.data[0];callback({symbol,price:data.price,change:data.change,changesPercentage:data.changesPercentage,volume:data.volume,quoteFetchedAt:Date.now(),source:'polling'});console.log(`‚úÖ Polled ${symbol}: $${data.price}`);}}catch(error){const isBrowser=typeof window!=='undefined';if(!isBrowser){console.error(`‚ùå Polling error for ${symbol}:`,error);}}}startPolling(symbol,callback){let customFrequency=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(this.intervals.has(symbol)){console.log(`‚è±Ô∏è Already polling ${symbol}`);return;}const frequency=customFrequency||(Cache.isMarketOpen()?this.baseUpdateFrequency:this.offHoursFrequency);this.pollStock(symbol,callback);const intervalId=setInterval(()=>{this.pollStock(symbol,callback);},frequency);this.intervals.set(symbol,intervalId);console.log(`‚è±Ô∏è Started polling ${symbol} every ${Math.floor(frequency/60000)} minutes`);}stopPolling(symbol){const intervalId=this.intervals.get(symbol);if(intervalId){clearInterval(intervalId);this.intervals.delete(symbol);console.log(`‚è±Ô∏è Stopped polling ${symbol}`);}}stopAll(){console.log(`‚è±Ô∏è Stopping all polling (${this.intervals.size} symbols)`);this.intervals.forEach(id=>clearInterval(id));this.intervals.clear();}getPollingSymbols(){return Array.from(this.intervals.keys());}}const realtimeData=new RealtimeDataManager();const smartPoller=new SmartPoller();console.log('üìä Real-time updates enabled via smart polling');class SocialSentimentManager{constructor(){this.cache=new Map();this.cacheExpiry=300000;}async fetchSocialSentiment(symbol){try{console.log(`üí¨ Fetching social sentiment for ${symbol}...`);const cached=this.cache.get(symbol);if(cached&&Date.now()-cached.timestamp<this.cacheExpiry){console.log(`üíæ Using cached social sentiment for ${symbol}`);return cached.data;}const[stockTwitsData,redditData]=await Promise.all([this.fetchStockTwits(symbol),this.fetchRedditSentiment(symbol)]);const combined=this.combineSocialData(stockTwitsData,redditData,symbol);this.cache.set(symbol,{data:combined,timestamp:Date.now()});console.log(`‚úÖ Combined social sentiment: ${combined.overallSentiment} (StockTwits: ${stockTwitsData.totalMessages} | Reddit: ${redditData.totalPosts} posts)`);return combined;}catch(error){console.error(`‚ùå Error fetching social sentiment for ${symbol}:`,error);return this.getDefaultSentiment();}}async fetchStockTwits(symbol){try{const response=await fetchWithRetry(`http://localhost:3002/api/stocktwits/${symbol}`,{timeoutMs:12000,retries:1});if(!response.ok){console.log(`‚ö†Ô∏è StockTwits API returned ${response.status}`);return{totalMessages:0,bullishCount:0,bearishCount:0,neutralCount:0,messages:[]};}const data=await response.json();if(!data.messages||data.messages.length===0){return{totalMessages:0,bullishCount:0,bearishCount:0,neutralCount:0,messages:[]};}const messages=data.messages;let bullishCount=0;let bearishCount=0;let neutralCount=0;messages.forEach(msg=>{if(msg.entities&&msg.entities.sentiment){const sentiment=msg.entities.sentiment.basic;if(sentiment==='Bullish')bullishCount++;else if(sentiment==='Bearish')bearishCount++;else neutralCount++;}else{neutralCount++;}});return{totalMessages:messages.length,bullishCount,bearishCount,neutralCount,messages:messages.slice(0,5).map(msg=>({text:msg.body,user:msg.user.username,sentiment:msg.entities?.sentiment?.basic||'Neutral',timestamp:msg.created_at,likes:msg.likes?.total||0,source:'StockTwits'}))};}catch(error){console.error(`‚ùå StockTwits error:`,error);return{totalMessages:0,bullishCount:0,bearishCount:0,neutralCount:0,messages:[]};}}async fetchRedditSentiment(symbol){try{console.log(`ü§ñ Fetching Reddit/WSB sentiment for ${symbol}...`);const subreddits=['wallstreetbets','stocks','investing'];const allPosts=[];for(const subreddit of subreddits){try{const searchUrl=`http://localhost:3002/api/reddit/${subreddit}/search?q=${symbol}`;const response=await fetchWithRetry(searchUrl,{timeoutMs:12000,retries:1});if(response.ok){const data=await response.json();if(data.data&&data.data.children){allPosts.push(...data.data.children.map(child=>({...child.data,subreddit:subreddit})));}}}catch(err){console.log(`‚ö†Ô∏è Error fetching from r/${subreddit}`);}}if(allPosts.length===0){return{totalPosts:0,bullishCount:0,bearishCount:0,neutralCount:0,posts:[]};}let bullishCount=0;let bearishCount=0;let neutralCount=0;const sentimentAnalyzer=new SentimentAnalyzer();const analyzedPosts=allPosts.map(post=>{const text=(post.title+' '+(post.selftext||'')).toLowerCase();const sentiment=sentimentAnalyzer.analyzeSentiment(text);const weight=Math.log10(Math.max(post.score,1)+1);if(sentiment.label==='bullish'){bullishCount+=weight;}else if(sentiment.label==='bearish'){bearishCount+=weight;}else{neutralCount+=weight;}return{title:post.title,text:post.selftext?.substring(0,200)||'',url:`https://www.reddit.com${post.permalink}`,author:post.author,score:post.score,comments:post.num_comments,sentiment:sentiment.label,subreddit:post.subreddit,timestamp:new Date(post.created_utc*1000).toISOString()};});analyzedPosts.sort((a,b)=>b.score-a.score);return{totalPosts:allPosts.length,bullishCount:Math.round(bullishCount),bearishCount:Math.round(bearishCount),neutralCount:Math.round(neutralCount),posts:analyzedPosts.slice(0,5)};}catch(error){console.error(`‚ùå Reddit API error:`,error);return{totalPosts:0,bullishCount:0,bearishCount:0,neutralCount:0,posts:[]};}}combineSocialData(stockTwits,reddit,symbol){const totalMessages=stockTwits.totalMessages+reddit.totalPosts;if(totalMessages===0){return this.getDefaultSentiment();}const stWeight=0.4;const rdWeight=0.6;const bullishCount=Math.round(stockTwits.bullishCount*stWeight+reddit.bullishCount*rdWeight);const bearishCount=Math.round(stockTwits.bearishCount*stWeight+reddit.bearishCount*rdWeight);const neutralCount=Math.round(stockTwits.neutralCount*stWeight+reddit.neutralCount*rdWeight);const total=bullishCount+bearishCount+neutralCount||1;const bullishPercent=bullishCount/total*100;const bearishPercent=bearishCount/total*100;const neutralPercent=neutralCount/total*100;let overallSentiment='neutral';let sentimentScore=0;if(bullishCount>bearishCount*1.3){overallSentiment='bullish';sentimentScore=Math.round(bullishPercent-bearishPercent);}else if(bearishCount>bullishCount*1.3){overallSentiment='bearish';sentimentScore=-Math.round(bearishPercent-bullishPercent);}else{overallSentiment='neutral';sentimentScore=Math.round(bullishPercent-bearishPercent);}return{source:'StockTwits + Reddit',totalMessages,stockTwitsCount:stockTwits.totalMessages,redditCount:reddit.totalPosts,bullishCount,bearishCount,neutralCount,bullishPercent:Math.round(bullishPercent),bearishPercent:Math.round(bearishPercent),neutralPercent:Math.round(neutralPercent),overallSentiment,sentimentScore,messages:[...stockTwits.messages.slice(0,3),...reddit.posts.slice(0,2).map(post=>({text:post.title,user:post.author,sentiment:post.sentiment,timestamp:post.timestamp,likes:post.score,source:'Reddit',url:post.url,subreddit:post.subreddit}))],redditPosts:reddit.posts,trending:totalMessages>30||reddit.totalPosts>20,timestamp:Date.now()};}getDefaultSentiment(){return{source:'N/A',totalMessages:0,bullishCount:0,bearishCount:0,neutralCount:0,bullishPercent:0,bearishPercent:0,neutralPercent:0,overallSentiment:'neutral',sentimentScore:0,messages:[],trending:false,timestamp:Date.now()};}clearCache(){this.cache.clear();}}const socialSentiment=new SocialSentimentManager();window.socialSentiment=socialSentiment;console.log('‚úÖ Social Sentiment Manager initialized');class PatternRecognitionEngine{constructor(){this.patterns={HEAD_AND_SHOULDERS:{name:'Head & Shoulders',type:'reversal',reliability:0.75,description:'Potential trend reversal from bullish to bearish'},CUP_WITH_HANDLE:{name:'Cup with Handle',type:'continuation',reliability:0.80,description:'Bullish continuation pattern'},DOUBLE_TOP:{name:'Double Top',type:'reversal',reliability:0.70,description:'Bearish reversal pattern'},DOUBLE_BOTTOM:{name:'Double Bottom',type:'reversal',reliability:0.70,description:'Bullish reversal pattern'},ASCENDING_TRIANGLE:{name:'Ascending Triangle',type:'continuation',reliability:0.75,description:'Bullish continuation pattern'},DESCENDING_TRIANGLE:{name:'Descending Triangle',type:'continuation',reliability:0.75,description:'Bearish continuation pattern'},FLAG:{name:'Flag Pattern',type:'continuation',reliability:0.70,description:'Brief consolidation before continuing trend'},WEDGE:{name:'Wedge',type:'reversal',reliability:0.65,description:'Potential trend reversal'},SYMMETRICAL_TRIANGLE:{name:'Symmetrical Triangle',type:'continuation',reliability:0.68,description:'Neutral pattern - breakout direction determines trend'},PENNANT:{name:'Pennant',type:'continuation',reliability:0.72,description:'Brief consolidation during strong trend'},TRIPLE_TOP:{name:'Triple Top',type:'reversal',reliability:0.75,description:'Strong bearish reversal signal'},TRIPLE_BOTTOM:{name:'Triple Bottom',type:'reversal',reliability:0.75,description:'Strong bullish reversal signal'},RISING_WEDGE:{name:'Rising Wedge',type:'reversal',reliability:0.70,description:'Bearish reversal - rising with declining volume'},FALLING_WEDGE:{name:'Falling Wedge',type:'reversal',reliability:0.70,description:'Bullish reversal - falling with declining volume'},ROUNDING_BOTTOM:{name:'Rounding Bottom',type:'reversal',reliability:0.73,description:'Gradual bullish reversal (saucer pattern)'},RECTANGLE:{name:'Rectangle',type:'continuation',reliability:0.65,description:'Consolidation range - awaiting breakout'},INVERSE_HEAD_SHOULDERS:{name:'Inverse Head and Shoulders',type:'reversal',reliability:0.85,description:'Strong bullish reversal signal'}};}detectPatterns(candles){let patternTypes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!candles||candles.length<20)return[];const detected=[];const closes=candles.map(c=>c.close||c);const highs=candles.map(c=>c.high||c.close||c);const lows=candles.map(c=>c.low||c.close||c);if(!patternTypes||patternTypes.includes('HEAD_AND_SHOULDERS')){const hns=this.detectHeadAndShoulders(highs,lows,closes);if(hns)detected.push(hns);}if(!patternTypes||patternTypes.includes('CUP_WITH_HANDLE')){const cup=this.detectCupAndHandle(highs,lows,closes);if(cup)detected.push(cup);}if(!patternTypes||patternTypes.includes('DOUBLE_TOP')){const dt=this.detectDoubleTop(highs,closes);if(dt)detected.push(dt);}if(!patternTypes||patternTypes.includes('DOUBLE_BOTTOM')){const db=this.detectDoubleBottom(lows,closes);if(db)detected.push(db);}if(!patternTypes||patternTypes.includes('TRIPLE_TOP')){const tt=this.detectTripleTop(highs,closes);if(tt)detected.push(tt);}if(!patternTypes||patternTypes.includes('TRIPLE_BOTTOM')){const tb=this.detectTripleBottom(lows,closes);if(tb)detected.push(tb);}if(!patternTypes||patternTypes.includes('SYMMETRICAL_TRIANGLE')){const st=this.detectSymmetricalTriangle(highs,lows,closes);if(st)detected.push(st);}if(!patternTypes||patternTypes.includes('ASCENDING_TRIANGLE')){const at=this.detectAscendingTriangle(highs,lows,closes);if(at)detected.push(at);}if(!patternTypes||patternTypes.includes('DESCENDING_TRIANGLE')){const dt=this.detectDescendingTriangle(highs,lows,closes);if(dt)detected.push(dt);}if(!patternTypes||patternTypes.includes('RISING_WEDGE')){const rw=this.detectRisingWedge(highs,lows,closes);if(rw)detected.push(rw);}if(!patternTypes||patternTypes.includes('FALLING_WEDGE')){const fw=this.detectFallingWedge(highs,lows,closes);if(fw)detected.push(fw);}if(!patternTypes||patternTypes.includes('PENNANT')){const pennant=this.detectPennant(highs,lows,closes);if(pennant)detected.push(pennant);}if(!patternTypes||patternTypes.includes('RECTANGLE')){const rect=this.detectRectangle(highs,lows,closes);if(rect)detected.push(rect);}if(!patternTypes||patternTypes.includes('ROUNDING_BOTTOM')){const rb=this.detectRoundingBottom(lows,closes);if(rb)detected.push(rb);}if(!patternTypes||patternTypes.includes('INVERSE_HEAD_SHOULDERS')){const ihs=this.detectInverseHeadAndShoulders(highs,lows,closes);if(ihs)detected.push(ihs);}if(!patternTypes||patternTypes.includes('FLAG')){const flag=this.detectFlag(highs,lows,closes);if(flag)detected.push(flag);}return detected.sort((a,b)=>b.confidence-a.confidence);}detectHeadAndShoulders(highs,lows,closes){const window=30;if(highs.length<window)return null;const recentHighs=highs.slice(-window);const pivotPoints=this.findPivotPoints(recentHighs,5);if(pivotPoints.length>=5){const[leftShoulder,head,rightShoulder]=this.extractHSPattern(pivotPoints);if(this.validateHSStructure(leftShoulder,head,rightShoulder)){return{type:'HEAD_AND_SHOULDERS',pattern:this.patterns.HEAD_AND_SHOULDERS,startIndex:pivotPoints[0].index,endIndex:pivotPoints[pivotPoints.length-1].index,confidence:this.calculateHSConfidence(leftShoulder,head,rightShoulder),neckline:this.calculateNeckline(lows,pivotPoints),implications:'Bearish reversal',targetPrice:this.calculateHSTarget(closes,pivotPoints)};}}return null;}detectCupAndHandle(highs,lows,closes){const window=40;if(closes.length<window)return null;const recentCloses=closes.slice(-window);const cupBottom=this.findCupBottom(recentCloses);if(cupBottom.found){const handle=this.detectHandle(recentCloses,cupBottom);if(handle.found){return{type:'CUP_WITH_HANDLE',pattern:this.patterns.CUP_WITH_HANDLE,startIndex:cupBottom.startIndex,endIndex:handle.endIndex,confidence:handle.confidence,cupDepth:cupBottom.depth,handleDepth:handle.depth,implications:'Bullish continuation',targetPrice:this.calculateCupTarget(recentCloses,cupBottom,handle)};}}return null;}detectDoubleTop(highs,closes){const window=25;if(highs.length<window)return null;const recentHighs=highs.slice(-window);const peaks=this.findLocalPeaks(recentHighs,2);if(peaks.length>=2){const[first,second]=peaks.slice(-2);const priceDiff=Math.abs(first.value-second.value)/first.value;if(priceDiff<0.03){return{type:'DOUBLE_TOP',pattern:this.patterns.DOUBLE_TOP,firstPeak:first,secondPeak:second,confidence:0.70*(1-priceDiff),implications:'Bearish reversal',targetPrice:this.calculateDoubleTopTarget(closes,peaks)};}}return null;}detectDoubleBottom(lows,closes){const window=25;if(lows.length<window)return null;const recentLows=lows.slice(-window);const troughs=this.findLocalTroughs(recentLows,2);if(troughs.length>=2){const[first,second]=troughs.slice(-2);const priceDiff=Math.abs(first.value-second.value)/first.value;if(priceDiff<0.03){return{type:'DOUBLE_BOTTOM',pattern:this.patterns.DOUBLE_BOTTOM,firstTrough:first,secondTrough:second,confidence:0.70*(1-priceDiff),implications:'Bullish reversal',targetPrice:this.calculateDoubleBottomTarget(closes,troughs)};}}return null;}findPivotPoints(data,minPoints){const pivots=[];for(let i=2;i<data.length-2;i++){if(data[i]>data[i-1]&&data[i]>data[i+1]&&data[i]>data[i-2]&&data[i]>data[i+2]){pivots.push({index:i,value:data[i],type:'high'});}}return pivots;}findLocalPeaks(data,minPeaks){const peaks=[];for(let i=1;i<data.length-1;i++){if(data[i]>data[i-1]&&data[i]>data[i+1]){peaks.push({index:i,value:data[i]});}}return peaks.sort((a,b)=>b.value-a.value).slice(0,minPeaks);}findLocalTroughs(data,minTroughs){const troughs=[];for(let i=1;i<data.length-1;i++){if(data[i]<data[i-1]&&data[i]<data[i+1]){troughs.push({index:i,value:data[i]});}}return troughs.sort((a,b)=>a.value-b.value).slice(0,minTroughs);}calculateHSConfidence(left,head,right){const symmetry=Math.abs(left.height-right.height)/Math.max(left.height||1,right.height||1);return Math.max(0.60,0.90-symmetry);}findCupBottom(data){const mid=Math.floor(data.length/2);const bottom=Math.min(...data.slice(mid-10,mid+10));const bottomIdx=data.indexOf(bottom);return{found:bottomIdx>10&&bottomIdx<data.length-10,startIndex:bottomIdx-15,endIndex:bottomIdx+15,depth:(data[0]-bottom)/data[0],bottomValue:bottom};}detectHandle(data,cupBottom){const handleStart=cupBottom.endIndex;const handleData=data.slice(handleStart,handleStart+10);const handleHigh=Math.max(...handleData);const handleLow=Math.min(...handleData);return{found:(handleHigh-handleLow)/handleHigh<0.05,endIndex:handleStart+handleData.length,depth:(handleHigh-handleLow)/handleHigh,confidence:0.75};}extractHSPattern(pivots){if(pivots.length<3)return[null,null,null];const sorted=[...pivots].sort((a,b)=>b.value-a.value);const head=sorted[0];const shoulders=pivots.filter(p=>p.index!==head.index).slice(0,2);return[{...shoulders[0],height:shoulders[0].value},{...head,height:head.value},{...shoulders[1],height:shoulders[1].value}];}validateHSStructure(left,head,right){if(!left||!head||!right)return false;return head.value>left.value&&head.value>right.value;}calculateNeckline(lows,pivots){if(pivots.length<2)return null;const necklineLows=pivots.map(p=>lows[p.index]||p.value);return necklineLows.reduce((a,b)=>a+b,0)/necklineLows.length;}calculateHSTarget(closes,pivots){if(pivots.length<2)return null;const neckline=this.calculateNeckline(closes,pivots);const head=Math.max(...pivots.map(p=>p.value));return neckline-(head-neckline);}calculateCupTarget(closes,cupBottom,handle){const cupRim=Math.max(...closes.slice(cupBottom.startIndex,cupBottom.endIndex));const depth=cupRim-cupBottom.bottomValue;return cupRim+depth;}calculateDoubleTopTarget(closes,peaks){if(peaks.length<2)return null;const avgPeak=(peaks[0].value+peaks[1].value)/2;const support=Math.min(...closes.slice(peaks[0].index,peaks[1].index));return support-(avgPeak-support);}calculateDoubleBottomTarget(closes,troughs){if(troughs.length<2)return null;const avgTrough=(troughs[0].value+troughs[1].value)/2;const resistance=Math.max(...closes.slice(troughs[0].index,troughs[1].index));return resistance+(resistance-avgTrough);}detectTripleTop(highs,closes){const window=30;if(highs.length<window)return null;const recentHighs=highs.slice(-window);const peaks=this.findLocalPeaks(recentHighs,3);if(peaks.length>=3){const[first,second,third]=peaks.slice(-3);const avgPrice=(first.value+second.value+third.value)/3;const maxDiff=Math.max(Math.abs(first.value-avgPrice),Math.abs(second.value-avgPrice),Math.abs(third.value-avgPrice))/avgPrice;if(maxDiff<0.03){return{type:'TRIPLE_TOP',pattern:this.patterns.TRIPLE_TOP,peaks:[first,second,third],confidence:0.75*(1-maxDiff),implications:'Strong bearish reversal',targetPrice:avgPrice-(avgPrice-Math.min(...closes.slice(-window)))*1.5};}}return null;}detectTripleBottom(lows,closes){const window=30;if(lows.length<window)return null;const recentLows=lows.slice(-window);const troughs=this.findLocalTroughs(recentLows,3);if(troughs.length>=3){const[first,second,third]=troughs.slice(-3);const avgPrice=(first.value+second.value+third.value)/3;const maxDiff=Math.max(Math.abs(first.value-avgPrice),Math.abs(second.value-avgPrice),Math.abs(third.value-avgPrice))/avgPrice;if(maxDiff<0.03){return{type:'TRIPLE_BOTTOM',pattern:this.patterns.TRIPLE_BOTTOM,troughs:[first,second,third],confidence:0.75*(1-maxDiff),implications:'Strong bullish reversal',targetPrice:avgPrice+(Math.max(...closes.slice(-window))-avgPrice)*1.5};}}return null;}detectSymmetricalTriangle(highs,lows,closes){const window=25;if(highs.length<window)return null;const recentHighs=highs.slice(-window);const recentLows=lows.slice(-window);const highTrend=this.calculateTrendline(recentHighs);const lowTrend=this.calculateTrendline(recentLows);const convergenceRate=Math.abs(highTrend.slope+lowTrend.slope)/2;if(convergenceRate<0.5&&highTrend.slope<0&&lowTrend.slope>0){const apex=this.findApex(highTrend,lowTrend);return{type:'SYMMETRICAL_TRIANGLE',pattern:this.patterns.SYMMETRICAL_TRIANGLE,confidence:0.68,apex:apex,implications:'Breakout imminent - direction uncertain',targetPrice:null};}return null;}detectAscendingTriangle(highs,lows,closes){const window=25;if(highs.length<window)return null;const recentHighs=highs.slice(-window);const recentLows=lows.slice(-window);const highTrend=this.calculateTrendline(recentHighs);const lowTrend=this.calculateTrendline(recentLows);if(Math.abs(highTrend.slope)<0.2&&lowTrend.slope>0.3){const resistance=Math.max(...recentHighs);const breakoutTarget=resistance+(resistance-Math.min(...recentLows))*0.8;return{type:'ASCENDING_TRIANGLE',pattern:this.patterns.ASCENDING_TRIANGLE,confidence:0.75,resistance:resistance,implications:'Bullish breakout expected',targetPrice:breakoutTarget};}return null;}detectDescendingTriangle(highs,lows,closes){const window=25;if(highs.length<window)return null;const recentHighs=highs.slice(-window);const recentLows=lows.slice(-window);const highTrend=this.calculateTrendline(recentHighs);const lowTrend=this.calculateTrendline(recentLows);if(highTrend.slope<-0.3&&Math.abs(lowTrend.slope)<0.2){const support=Math.min(...recentLows);const breakdownTarget=support-(Math.max(...recentHighs)-support)*0.8;return{type:'DESCENDING_TRIANGLE',pattern:this.patterns.DESCENDING_TRIANGLE,confidence:0.75,support:support,implications:'Bearish breakdown expected',targetPrice:breakdownTarget};}return null;}detectRisingWedge(highs,lows,closes){const window=25;if(highs.length<window)return null;const recentHighs=highs.slice(-window);const recentLows=lows.slice(-window);const highTrend=this.calculateTrendline(recentHighs);const lowTrend=this.calculateTrendline(recentLows);if(highTrend.slope>0&&lowTrend.slope>0&&lowTrend.slope>highTrend.slope){return{type:'RISING_WEDGE',pattern:this.patterns.RISING_WEDGE,confidence:0.70,implications:'Bearish reversal - momentum weakening',targetPrice:closes[closes.length-1]*0.92};}return null;}detectFallingWedge(highs,lows,closes){const window=25;if(highs.length<window)return null;const recentHighs=highs.slice(-window);const recentLows=lows.slice(-window);const highTrend=this.calculateTrendline(recentHighs);const lowTrend=this.calculateTrendline(recentLows);if(highTrend.slope<0&&lowTrend.slope<0&&highTrend.slope>lowTrend.slope){return{type:'FALLING_WEDGE',pattern:this.patterns.FALLING_WEDGE,confidence:0.70,implications:'Bullish reversal - selling pressure exhausting',targetPrice:closes[closes.length-1]*1.08};}return null;}detectPennant(highs,lows,closes){const window=20;if(highs.length<window)return null;const recentHighs=highs.slice(-window);const recentLows=lows.slice(-window);const priorMove=closes.slice(-window-10,-window);const moveStrength=Math.abs(priorMove[priorMove.length-1]-priorMove[0])/priorMove[0];if(moveStrength>0.05){const range=Math.max(...recentHighs)-Math.min(...recentLows);const priceLevel=closes[closes.length-1];const consolidationRatio=range/priceLevel;if(consolidationRatio<0.05){const priorTrend=priorMove[priorMove.length-1]>priorMove[0]?'bullish':'bearish';return{type:'PENNANT',pattern:this.patterns.PENNANT,confidence:0.72,implications:`${priorTrend==='bullish'?'Bullish':'Bearish'} continuation expected`,targetPrice:priorTrend==='bullish'?closes[closes.length-1]*1.05:closes[closes.length-1]*0.95};}}return null;}detectRectangle(highs,lows,closes){const window=20;if(highs.length<window)return null;const recentHighs=highs.slice(-window);const recentLows=lows.slice(-window);const resistance=Math.max(...recentHighs);const support=Math.min(...recentLows);const range=resistance-support;const priceLevel=closes[closes.length-1];const withinRange=closes.slice(-window).every(c=>c>=support*0.98&&c<=resistance*1.02);if(withinRange&&range/priceLevel>0.03&&range/priceLevel<0.10){return{type:'RECTANGLE',pattern:this.patterns.RECTANGLE,confidence:0.65,support:support,resistance:resistance,implications:'Consolidation - breakout pending',targetPrice:null};}return null;}detectRoundingBottom(lows,closes){const window=30;if(lows.length<window)return null;const recentLows=lows.slice(-window);const mid=Math.floor(window/2);const leftSide=recentLows.slice(0,mid);const rightSide=recentLows.slice(mid);const leftTrend=this.calculateTrendline(leftSide);const rightTrend=this.calculateTrendline(rightSide);if(leftTrend.slope<-0.1&&rightTrend.slope>0.1){const bottom=Math.min(...recentLows);const depth=(closes[closes.length-window]-bottom)/bottom;return{type:'ROUNDING_BOTTOM',pattern:this.patterns.ROUNDING_BOTTOM,confidence:0.73,depth:depth,implications:'Gradual bullish reversal',targetPrice:closes[closes.length-1]+(closes[closes.length-1]-bottom)};}return null;}detectInverseHeadAndShoulders(highs,lows,closes){const window=30;if(lows.length<window)return null;const recentLows=lows.slice(-window);const pivotPoints=this.findPivotPoints(recentLows.map(l=>-l),5);if(pivotPoints.length>=5){const[leftShoulder,head,rightShoulder]=this.extractHSPattern(pivotPoints);if(this.validateHSStructure(leftShoulder,head,rightShoulder)){const neckline=Math.max(...closes.slice(-window,-window+10));return{type:'INVERSE_HEAD_SHOULDERS',pattern:this.patterns.INVERSE_HEAD_SHOULDERS,confidence:this.calculateHSConfidence(leftShoulder,head,rightShoulder),neckline:neckline,implications:'Strong bullish reversal',targetPrice:neckline+(neckline-Math.min(...recentLows))};}}return null;}detectFlag(highs,lows,closes){const window=15;if(highs.length<window)return null;const priorWindow=10;const priorMove=closes.slice(-window-priorWindow,-window);const moveStrength=Math.abs(priorMove[priorMove.length-1]-priorMove[0])/priorMove[0];if(moveStrength>0.08){const recentCloses=closes.slice(-window);const trendline=this.calculateTrendline(recentCloses);const priorTrend=priorMove[priorMove.length-1]>priorMove[0]?'up':'down';const flagSlope=trendline.slope;if(priorTrend==='up'&&flagSlope<0&&flagSlope>-0.5||priorTrend==='down'&&flagSlope>0&&flagSlope<0.5){return{type:'FLAG',pattern:this.patterns.FLAG,confidence:0.70,implications:`${priorTrend==='up'?'Bullish':'Bearish'} continuation`,targetPrice:priorTrend==='up'?closes[closes.length-1]+(priorMove[priorMove.length-1]-priorMove[0]):closes[closes.length-1]-(priorMove[0]-priorMove[priorMove.length-1])};}}return null;}calculateTrendline(data){const n=data.length;let sumX=0,sumY=0,sumXY=0,sumXX=0;for(let i=0;i<n;i++){sumX+=i;sumY+=data[i];sumXY+=i*data[i];sumXX+=i*i;}const slope=(n*sumXY-sumX*sumY)/(n*sumXX-sumX*sumX);const intercept=(sumY-slope*sumX)/n;return{slope,intercept};}findApex(highTrend,lowTrend){const x=(lowTrend.intercept-highTrend.intercept)/(highTrend.slope-lowTrend.slope);return{x,y:highTrend.slope*x+highTrend.intercept};}extractHSPattern(pivots){if(pivots.length<3)return[null,null,null];const sorted=[...pivots].sort((a,b)=>Math.abs(b.value)-Math.abs(a.value));return[{height:Math.abs(sorted[1].value),index:sorted[1].index},{height:Math.abs(sorted[0].value),index:sorted[0].index},{height:Math.abs(sorted[2].value),index:sorted[2].index}];}validateHSStructure(left,head,right){if(!left||!head||!right)return false;return head.height>left.height&&head.height>right.height&&Math.abs(left.height-right.height)/left.height<0.2;}calculateNeckline(lows,pivots){return Math.min(...lows.slice(pivots[0].index,pivots[pivots.length-1].index));}}const patternEngine=new PatternRecognitionEngine();window.patternEngine=patternEngine;console.log('‚úÖ Pattern Recognition Engine initialized');async function generatePatternAnalysis(pattern,stock,historicalData){console.log(`ü§ñ Generating AI analysis for ${pattern.pattern.name} on ${stock.symbol}`);try{const recentCloses=historicalData.slice(-20).map(d=>d.close||d);const currentPrice=stock.price;const priceChange=(currentPrice-recentCloses[0])/recentCloses[0]*100;const volatility=calculateVolatility(recentCloses);const momentum=calculateMomentum(recentCloses);let signal='HOLD';let entryPoint=currentPrice;let stopLoss=currentPrice*0.95;let riskLevel='Medium';if(pattern.pattern.type==='reversal'){if(pattern.implications.includes('Bullish')){signal=priceChange<-5?'BUY':'HOLD';entryPoint=currentPrice*0.98;stopLoss=currentPrice*0.92;riskLevel=volatility>3?'High':'Medium';}else if(pattern.implications.includes('Bearish')){signal=priceChange>5?'SELL':'HOLD';stopLoss=currentPrice*1.08;riskLevel=volatility>3?'High':'Medium';}}else if(pattern.pattern.type==='continuation'){if(pattern.implications.includes('Bullish')&&priceChange>0){signal='BUY';entryPoint=currentPrice*1.01;stopLoss=currentPrice*0.95;riskLevel=momentum>2?'Low':'Medium';}else if(pattern.implications.includes('Bearish')&&priceChange<0){signal='SELL';stopLoss=currentPrice*1.05;riskLevel=momentum<-2?'Low':'Medium';}}const strategy=generateTradingStrategy(pattern,signal,stock,currentPrice,volatility);const keyFactors=generateKeyFactors(pattern,stock,volatility,momentum,priceChange);const riskNote=generateRiskNote(pattern,riskLevel,volatility);const summary=generateAISummary(pattern,signal,stock,riskLevel,volatility);return{signal,strategy,entryPoint,stopLoss,riskLevel,riskNote,keyFactors,summary,timestamp:Date.now()};}catch(error){console.error('AI analysis generation failed:',error);return generateFallbackAnalysis(pattern);}}function generateFallbackAnalysis(pattern){const currentPrice=100;return{signal:pattern.implications.includes('Bullish')?'BUY':pattern.implications.includes('Bearish')?'SELL':'HOLD',strategy:`Monitor this ${pattern.pattern.name} pattern closely. ${pattern.pattern.description}`,entryPoint:pattern.targetPrice||currentPrice,stopLoss:pattern.targetPrice?pattern.targetPrice*0.95:currentPrice*0.95,riskLevel:'Medium',riskNote:`This ${pattern.pattern.type} pattern has ${(pattern.pattern.reliability*100).toFixed(0)}% historical reliability.`,keyFactors:[`${pattern.pattern.name} detected with ${(pattern.confidence*100).toFixed(0)}% confidence`,`Pattern type: ${pattern.pattern.type}`,`Historical reliability: ${(pattern.pattern.reliability*100).toFixed(0)}%`],summary:`A ${pattern.pattern.name} pattern has been identified. ${pattern.implications}.`,timestamp:Date.now()};}function generateTradingStrategy(pattern,signal,stock,currentPrice,volatility){const patternName=pattern.pattern.name;const isHighVolatility=volatility>3;if(signal==='BUY'){if(pattern.pattern.type==='reversal'){return`Wait for confirmation of reversal with a bullish candle close above ${(currentPrice*1.02).toFixed(2)}. `+`Enter gradually in 2-3 tranches to average entry price. `+`${isHighVolatility?'Use wider stops due to high volatility.':'Set tight stops below recent lows.'}`;}else{return`Enter on pullback to support near ${(currentPrice*0.98).toFixed(2)}. `+`This continuation pattern suggests uptrend will resume. `+`Add to position if breakout confirms with volume.`;}}else if(signal==='SELL'){if(pattern.pattern.type==='reversal'){return`Consider taking profits or hedging position. `+`Wait for bearish confirmation before shorting. `+`Exit long positions if price breaks below ${(currentPrice*0.98).toFixed(2)}.`;}else{return`Downtrend likely to continue. Consider protective puts or exit on rallies. `+`Avoid new long positions until pattern completes or breaks invalidation level.`;}}else{return`${patternName} is forming but needs confirmation. `+`Wait for breakout direction before taking position. `+`Monitor volume and momentum for clues on direction.`;}}function generateKeyFactors(pattern,stock,volatility,momentum,priceChange){const factors=[];factors.push(`${pattern.pattern.name} has ${(pattern.pattern.reliability*100).toFixed(0)}% historical success rate`);factors.push(`Current detection confidence: ${(pattern.confidence*100).toFixed(0)}%`);if(pattern.targetPrice){const potentialGain=((pattern.targetPrice/stock.price-1)*100).toFixed(1);factors.push(`Technical target suggests ${Math.abs(potentialGain)}% ${potentialGain>0?'upside':'downside'}`);}if(volatility>3){factors.push(`High volatility (${volatility.toFixed(1)}%) increases risk but also opportunity`);}else if(volatility<1.5){factors.push(`Low volatility environment - pattern may take longer to play out`);}if(Math.abs(momentum)>2){factors.push(`Strong ${momentum>0?'positive':'negative'} momentum supports pattern direction`);}if(pattern.pattern.type==='continuation'){factors.push(`Continuation patterns typically complete within 1-3 weeks`);}else{factors.push(`Reversal patterns often mark significant trend changes`);}return factors;}function generateRiskNote(pattern,riskLevel,volatility){if(riskLevel==='High'){return`High risk due to ${volatility>3?'elevated volatility':'uncertain market conditions'}. `+`Use position sizing of 1-2% of portfolio maximum.`;}else if(riskLevel==='Medium'){return`Moderate risk pattern. Recommended position size: 3-5% of portfolio. `+`Use stop losses and avoid over-leveraging.`;}else{return`Relatively low-risk setup with favorable risk/reward ratio. `+`Standard position sizing of 5-8% appropriate for conservative traders.`;}}function generateAISummary(pattern,signal,stock,riskLevel,volatility){const patternName=pattern.pattern.name;const confidence=(pattern.confidence*100).toFixed(0);const reliability=(pattern.pattern.reliability*100).toFixed(0);let summary=`AI has detected a ${patternName} pattern on ${stock.symbol} with ${confidence}% confidence. `;summary+=`This ${pattern.pattern.type} pattern has a ${reliability}% historical success rate. `;if(signal==='BUY'){summary+=`The analysis suggests a bullish opportunity with ${riskLevel.toLowerCase()} risk. `;summary+=volatility>3?`High volatility presents both opportunity and risk - position accordingly.`:`Market conditions are favorable for this setup.`;}else if(signal==='SELL'){summary+=`The analysis indicates bearish pressure with ${riskLevel.toLowerCase()} risk. `;summary+=`Consider defensive positions or wait for better entry points.`;}else{summary+=`The pattern requires further confirmation before taking action. `;summary+=`Monitor for breakout direction and volume confirmation.`;}return summary;}function calculateVolatility(prices){if(prices.length<2)return 0;const returns=[];for(let i=1;i<prices.length;i++){returns.push((prices[i]-prices[i-1])/prices[i-1]);}const mean=returns.reduce((a,b)=>a+b,0)/returns.length;const variance=returns.reduce((a,b)=>a+Math.pow(b-mean,2),0)/returns.length;return Math.sqrt(variance)*Math.sqrt(252)*100;}function calculateMomentum(prices){if(prices.length<10)return 0;const recent=prices.slice(-5);const previous=prices.slice(-10,-5);const recentAvg=recent.reduce((a,b)=>a+b,0)/recent.length;const previousAvg=previous.reduce((a,b)=>a+b,0)/previous.length;return(recentAvg-previousAvg)/previousAvg*100;}window.generatePatternAnalysis=generatePatternAnalysis;window.generateFallbackAnalysis=generateFallbackAnalysis;console.log('‚úÖ AI Pattern Analysis functions initialized');class SentimentAnalyzer{constructor(){this.positiveWords=new Set(['bullish','surge','rally','soar','gain','profit','growth','beat','exceed','strong','upgrade','buy','outperform','success','positive','innovative','breakthrough','record','boost','jump','rise','upbeat','optimistic','confident','expansion','momentum','robust','stellar','impressive','thriving','flourish','recover','rebound','accelerate','advance']);this.negativeWords=new Set(['bearish','plunge','crash','fall','loss','decline','miss','below','weak','concern','downgrade','sell','underperform','failure','negative','risk','warning','layoff','drop','tumble','slide','pessimistic','worried','fearful','contraction','slump','fragile','disappointing','struggle','suffer','collapse','crisis','trouble','investigation','lawsuit']);}analyzeSentiment(text){if(!text)return{score:0,label:'neutral',confidence:0};const words=text.toLowerCase().split(/\W+/);let positiveCount=0;let negativeCount=0;words.forEach(word=>{if(this.positiveWords.has(word))positiveCount++;if(this.negativeWords.has(word))negativeCount++;});const totalSentimentWords=positiveCount+negativeCount;if(totalSentimentWords===0){return{score:0,label:'neutral',confidence:0};}const score=(positiveCount-negativeCount)/totalSentimentWords*100;const confidence=Math.min(100,totalSentimentWords/words.length*500);let label;if(score>20)label='bullish';else if(score<-20)label='bearish';else label='neutral';return{score:Math.round(score),label,confidence:Math.round(confidence),positiveWords:positiveCount,negativeWords:negativeCount};}}class RealtimeNewsManager{constructor(){this.newsCache=new Map();this.sentimentAnalyzer=new SentimentAnalyzer();this.subscribers=new Map();this.pollIntervals=new Map();this.updateFrequency=30*60*1000;}getAnalystUpdateScore(article,symbol){const title=(article?.title||'').toString();const description=(article?.description||'').toString();const text=`${title} ${description}`.toLowerCase();if(!text.trim())return 0;let score=0;const sym=(symbol||'').toLowerCase();if(sym&&text.includes(sym))score+=3;if(/(price\s*target|target\s*price|price\s*objective|pt\b|\bpt\s*(raised|cut|increase|decrease)|\btarget\s*(raised|cut)|raises?\s+(its\s+)?price\s*target|lowers?\s+(its\s+)?price\s*target|sets?\s+price\s*target)/i.test(text)){score+=40;}if(/(upgrade|downgrade|initiates?|initiation|reiterates?|maintains?|resumes?\s+coverage|coverage\s+initiated|raises?|lowers?|cuts?|boosts?)\b/i.test(text)){score+=22;}if(/(rating|rated|buy|sell|hold|overweight|underweight|outperform|underperform|equal\s*weight|market\s*perform|sector\s*perform|neutral|strong\s*buy|strong\s*sell)\b/i.test(text)){score+=18;}if(/\banalyst(s)?\b/i.test(text))score+=12;if(/\b(to|from)\s+\$?\d+(?:\.\d+)?\b/i.test(text))score+=8;if(/\$\d{2,}(?:\.\d+)?\b/.test(text))score+=4;if(/(goldman|morgan\s*stanley|jp\s*morgan|jpmorgan|barclays|bofa|bank\s*of\s*america|citi|citigroup|deutsche\s*bank|ubs|wells\s*fargo|jefferies|raymond\s*james|piper\s*sandler|baird|susquehanna|wedbush|needham|oppenheimer|bernstein)\b/i.test(text)){score+=6;}return score;}async fetchNews(symbol){let limit=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;try{console.log(`üì∞ Fetching news for ${symbol}...`);const isBrowser=typeof window!=='undefined';const newsPromises=[fetch(`https://api.marketaux.com/v1/news/all?symbols=${symbol}&filter_entities=true&language=en&limit=50&api_token=${API_KEYS.MARKETAUX}`).then(r=>r.ok?r.json():{data:[]}).catch(()=>({data:[]})),...(isBrowser?[Promise.resolve([])]:[fetch(`https://finnhub.io/api/v1/company-news?symbol=${symbol}&from=${this.getDateDaysAgo(7)}&to=${this.getToday()}&token=${API_KEYS.FINNHUB}`).then(async r=>{if(!r.ok)return[];const text=await r.text();if(text.trim().startsWith('<!DOCTYPE')||text.trim().startsWith('<html')){console.warn('‚ö†Ô∏è Finnhub returned HTML instead of JSON (likely error page)');return[];}try{return JSON.parse(text);}catch(e){console.warn('‚ö†Ô∏è Finnhub response is not valid JSON:',e.message);return[];}}).catch(()=>[])]),fetch(`https://financialmodelingprep.com/stable/fmp-articles?page=0&limit=20&apikey=${API_KEYS.FMP}`).then(r=>r.ok?r.json():[]).catch(()=>[]),fetch(`https://financialmodelingprep.com/stable/news/general-latest?page=0&limit=20&apikey=${API_KEYS.FMP}`).then(r=>r.ok?r.json():[]).catch(()=>[])];const[marketauxResponse,finnhubNews,fmpArticles,fmpGeneralNews]=await Promise.all(newsPromises);const marketauxNews=marketauxResponse?.data||[];console.log(`üìä News sources: Marketaux=${marketauxNews.length}, Finnhub=${finnhubNews?.length||0}, FMP Articles=${fmpArticles?.length||0}, FMP General=${fmpGeneralNews?.length||0}`);let allNews=[];marketauxNews.forEach(item=>{allNews.push({title:item.title,description:item.description||item.snippet||'',url:item.url,source:item.source||'Marketaux',publishedAt:item.published_at,image:item.image_url,symbol:symbol,entities:item.entities||[]});});(fmpArticles||[]).forEach(item=>{const text=(item.title+' '+(item.text||'')).toLowerCase();if(text.includes(symbol.toLowerCase())){allNews.push({title:item.title,description:item.text||item.content||'',url:item.url,source:item.site||'FMP',publishedAt:item.publishedDate||item.date,image:item.image,symbol:symbol});}});(fmpGeneralNews||[]).forEach(item=>{const text=(item.title+' '+(item.text||'')).toLowerCase();if(text.includes(symbol.toLowerCase())){allNews.push({title:item.title,description:item.text||item.content||'',url:item.url,source:item.site||'MarketNews',publishedAt:item.publishedDate||item.date,image:item.image,symbol:symbol});}});(finnhubNews||[]).forEach(item=>{allNews.push({title:item.headline,description:item.summary||'',url:item.url,source:item.source||'Finnhub',publishedAt:new Date(item.datetime*1000).toISOString(),image:item.image,symbol:symbol});});const uniqueNews=allNews.filter((news,index,self)=>index===self.findIndex(n=>n.url===news.url));const cutoff=Date.now()-30*24*60*60*1000;const recentNews=uniqueNews.filter(n=>{const t=new Date(n.publishedAt).getTime();return Number.isFinite(t)&&t>=cutoff;});recentNews.sort((a,b)=>{const scoreB=this.getAnalystUpdateScore(b,symbol);const scoreA=this.getAnalystUpdateScore(a,symbol);if(scoreB!==scoreA)return scoreB-scoreA;return new Date(b.publishedAt)-new Date(a.publishedAt);});const newsWithSentiment=recentNews.slice(0,limit).map(article=>{const sentiment=this.sentimentAnalyzer.analyzeSentiment(article.title+' '+article.description);return{...article,sentiment,analystScore:this.getAnalystUpdateScore(article,symbol),timestamp:new Date(article.publishedAt).getTime()};});console.log(`‚úÖ Fetched ${newsWithSentiment.length} news articles for ${symbol}`);this.newsCache.set(symbol,newsWithSentiment);this.notifySubscribers(symbol,newsWithSentiment);return newsWithSentiment;}catch(error){console.error(`‚ùå Error fetching news for ${symbol}:`,error);return[];}}getDateDaysAgo(days){const date=new Date();date.setDate(date.getDate()-days);return date.toISOString().split('T')[0];}getToday(){return new Date().toISOString().split('T')[0];}subscribe(symbol,callback){if(!this.subscribers.has(symbol)){this.subscribers.set(symbol,[]);this.startPolling(symbol);}this.subscribers.get(symbol).push(callback);const cached=this.newsCache.get(symbol);if(cached){callback(cached);}else{this.fetchNews(symbol);}console.log(`üì∞ Subscribed to news for ${symbol}`);}unsubscribe(symbol,callback){const callbacks=this.subscribers.get(symbol);if(!callbacks)return;const index=callbacks.indexOf(callback);if(index>-1){callbacks.splice(index,1);}if(callbacks.length===0){this.stopPolling(symbol);this.subscribers.delete(symbol);}console.log(`üì∞ Unsubscribed from news for ${symbol}`);}startPolling(symbol){if(this.pollIntervals.has(symbol))return;const intervalId=setInterval(()=>{this.fetchNews(symbol);},this.updateFrequency);this.pollIntervals.set(symbol,intervalId);console.log(`üì∞ Started news polling for ${symbol} (every ${this.updateFrequency/1000/60} min)`);}stopPolling(symbol){const intervalId=this.pollIntervals.get(symbol);if(intervalId){clearInterval(intervalId);this.pollIntervals.delete(symbol);console.log(`üì∞ Stopped news polling for ${symbol}`);}}notifySubscribers(symbol,news){const callbacks=this.subscribers.get(symbol);if(callbacks){callbacks.forEach(cb=>{try{cb(news);}catch(err){console.error(`Error in news callback for ${symbol}:`,err);}});}}getAggregateSentiment(symbol){const news=this.newsCache.get(symbol);if(!news||news.length===0){return{score:0,label:'neutral',count:0};}const totalScore=news.reduce((sum,article)=>sum+article.sentiment.score,0);const avgScore=totalScore/news.length;let label;if(avgScore>20)label='bullish';else if(avgScore<-20)label='bearish';else label='neutral';return{score:Math.round(avgScore),label,count:news.length,bullishCount:news.filter(n=>n.sentiment.label==='bullish').length,bearishCount:news.filter(n=>n.sentiment.label==='bearish').length,neutralCount:news.filter(n=>n.sentiment.label==='neutral').length};}stopAll(){this.pollIntervals.forEach(id=>clearInterval(id));this.pollIntervals.clear();this.subscribers.clear();console.log('üì∞ Stopped all news polling');}}const newsManager=new RealtimeNewsManager();window.newsManager=newsManager;console.log('‚úÖ News Manager initialized');class PortfolioManager{constructor(){this.holdings=this.loadPortfolio();this.priceCache=new Map();}loadPortfolio(){try{const saved=localStorage.getItem('retailedge_portfolio');return saved?JSON.parse(saved):[];}catch(error){console.error('‚ùå Error loading portfolio:',error);return[];}}savePortfolio(){try{localStorage.setItem('retailedge_portfolio',JSON.stringify(this.holdings));console.log('üíæ Portfolio saved');}catch(error){console.error('‚ùå Error saving portfolio:',error);}}addHolding(symbol,quantity,buyPrice){let buyDate=arguments.length>3&&arguments[3]!==undefined?arguments[3]:new Date().toISOString();const holding={id:Date.now()+Math.random(),symbol:symbol.toUpperCase(),quantity:parseFloat(quantity),buyPrice:parseFloat(buyPrice),buyDate:buyDate,addedAt:new Date().toISOString()};this.holdings.push(holding);this.savePortfolio();console.log(`‚úÖ Added ${quantity} shares of ${symbol} @ $${buyPrice}`);return holding;}updateHolding(id,updates){const index=this.holdings.findIndex(h=>h.id===id);if(index!==-1){this.holdings[index]={...this.holdings[index],...updates};this.savePortfolio();console.log(`‚úÖ Updated holding ${id}`);return this.holdings[index];}return null;}removeHolding(id){const index=this.holdings.findIndex(h=>h.id===id);if(index!==-1){const removed=this.holdings.splice(index,1)[0];this.savePortfolio();console.log(`‚úÖ Removed ${removed.symbol} from portfolio`);return removed;}return null;}async updatePrices(stocksData){stocksData.forEach(stock=>{this.priceCache.set(stock.symbol,stock.price);});}calculatePortfolioMetrics(stocksData){if(this.holdings.length===0){return{totalValue:0,totalCost:0,totalGainLoss:0,totalGainLossPercent:0,holdings:[]};}this.updatePrices(stocksData);let totalValue=0;let totalCost=0;const holdingsWithMetrics=this.holdings.map(holding=>{const currentPrice=this.priceCache.get(holding.symbol)||holding.buyPrice;const stockData=stocksData.find(s=>s.symbol===holding.symbol);const costBasis=holding.quantity*holding.buyPrice;const currentValue=holding.quantity*currentPrice;const gainLoss=currentValue-costBasis;const gainLossPercent=(currentPrice-holding.buyPrice)/holding.buyPrice*100;totalValue+=currentValue;totalCost+=costBasis;return{...holding,currentPrice,costBasis,currentValue,gainLoss,gainLossPercent,dayChange:stockData?.changePct||0,dayChangeValue:stockData?currentPrice*(stockData.changePct/100)*holding.quantity:0};});const totalGainLoss=totalValue-totalCost;const totalGainLossPercent=totalCost>0?totalGainLoss/totalCost*100:0;return{totalValue,totalCost,totalGainLoss,totalGainLossPercent,holdings:holdingsWithMetrics,holdingsCount:this.holdings.length};}getTopPerformers(metrics){let limit=arguments.length>1&&arguments[1]!==undefined?arguments[1]:3;return[...metrics.holdings].sort((a,b)=>b.gainLossPercent-a.gainLossPercent).slice(0,limit);}getWorstPerformers(metrics){let limit=arguments.length>1&&arguments[1]!==undefined?arguments[1]:3;return[...metrics.holdings].sort((a,b)=>a.gainLossPercent-b.gainLossPercent).slice(0,limit);}exportToCSV(){if(this.holdings.length===0)return null;const headers=['Symbol','Quantity','Buy Price','Buy Date','Current Price','Current Value','Gain/Loss','Gain/Loss %'];const metrics=this.calculatePortfolioMetrics([]);const rows=metrics.holdings.map(h=>[h.symbol,h.quantity,h.buyPrice.toFixed(2),new Date(h.buyDate).toLocaleDateString(),h.currentPrice.toFixed(2),h.currentValue.toFixed(2),h.gainLoss.toFixed(2),h.gainLossPercent.toFixed(2)+'%']);return[headers,...rows].map(row=>row.join(',')).join('\n');}}const portfolioManager=new PortfolioManager();window.portfolioManager=portfolioManager;console.log('‚úÖ Portfolio Manager initialized');class ClaudeStockAnalyzer{constructor(){this.analysisCache=new Map();this.cacheExpiry=60*60*1000;}async analyzeStock(stockData){const cacheKey=`${stockData.symbol}_${Math.floor(Date.now()/this.cacheExpiry)}`;if(this.analysisCache.has(cacheKey)){console.log(`‚úÖ Using cached AI analysis for ${stockData.symbol}`);return this.analysisCache.get(cacheKey);}console.log(`ü§ñ Requesting AI analysis for ${stockData.symbol}...`);try{const analysis=await this.callClaudeAPI(stockData);this.analysisCache.set(cacheKey,analysis);console.log(`‚úÖ AI analysis complete for ${stockData.symbol}`);return analysis;}catch(error){console.error('‚ùå AI Analysis failed:',error.message||error);console.log('üîÑ Falling back to rule-based analysis...');const fallback=this.getFallbackAnalysis(stockData);this.analysisCache.set(cacheKey,fallback);return fallback;}}async callClaudeAPI(stockData){const prompt=this.buildAnalysisPrompt(stockData);console.log('üì° Making API request to Claude via backend...');const response=await fetchWithRetry("http://localhost:3002/api/claude",{method:"POST",headers:{"Content-Type":"application/json"},timeoutMs:20000,retries:1,body:JSON.stringify({messages:[{role:"user",content:prompt}]})}).catch(err=>{console.error('‚ùå Failed to connect to backend server:',err);console.log('üí° Make sure Node.js backend is running on port 3002');throw new Error('Backend server not responding. Please ensure the Node.js server is running.');});console.log(`üìä API Response status: ${response.status}`);if(!response.ok){const errorText=await response.text().catch(()=>'Unknown error');console.error(`‚ùå API Error ${response.status}:`,errorText);console.error(`‚ùå Full error details:`,{status:response.status,statusText:response.statusText,url:response.url,errorBody:errorText});throw new Error(`API Error: ${response.status} - ${errorText}`);}const data=await response.json();console.log('‚úÖ API response received, parsing...');const analysisText=data.content[0].text;return this.parseClaudeResponse(analysisText,stockData);}buildAnalysisPrompt(stock){return`You are an expert stock analyst. Analyze this stock and provide predictions in JSON format.

STOCK DATA:
Symbol: ${stock.symbol}
Company: ${stock.companyName||stock.symbol}
Current Price: $${stock.price}
Change: ${stock.changesPercentage||0}%

FUNDAMENTALS:
- P/E Ratio: ${stock.pe||'N/A'}
- EPS: $${stock.eps||'N/A'}
- Market Cap: ${this.formatNumber(stock.marketCap)}
- ROE: ${stock.roe||'N/A'}%

TECHNICAL (if available):
- RSI: ${stock.rsi||'N/A'}
- SMA 50: ${stock.sma50||'N/A'}
- SMA 200: ${stock.sma200||'N/A'}

ANALYST:
- Rating: ${stock.rating||'N/A'}
- Price Target: ${stock.priceTarget||'N/A'}

Provide analysis in this EXACT JSON format (no markdown):
{
  "predictions": {
    "oneDay": {"price": <number>, "change": <percentage>, "confidence": <0-100>},
    "sevenDay": {"price": <number>, "change": <percentage>, "confidence": <0-100>},
    "thirtyDay": {"price": <number>, "change": <percentage>, "confidence": <0-100>}
  },
  "recommendation": "<BUY|HOLD|SELL>",
  "recommendationStrength": <1-10>,
  "targetPrice": <number>,
  "stopLoss": <number>,
  "keyInsights": ["<insight 1>", "<insight 2>", "<insight 3>"],
  "risks": ["<risk 1>", "<risk 2>"],
  "opportunities": ["<opportunity 1>", "<opportunity 2>"],
  "technicalScore": <0-100>,
  "fundamentalScore": <0-100>,
  "sentimentScore": <0-100>,
  "summary": "<2-3 sentence summary>"
}

Be realistic and conservative. Base confidence on data quality.`;}parseClaudeResponse(text,stockData){try{const jsonText=text.replace(/```json\n?/g,'').replace(/```\n?/g,'').trim();const analysis=JSON.parse(jsonText);analysis.symbol=stockData.symbol;analysis.currentPrice=stockData.price;analysis.timestamp=Date.now();analysis.aiModel='claude-sonnet-4';return analysis;}catch(error){console.error('‚ùå Parse error:',error);return this.getFallbackAnalysis(stockData);}}getFallbackAnalysis(stock){const price=stock.price||0;const pe=stock.pe||0;const rsi=stock.rsi||50;let recommendation='HOLD';let strength=5;if(pe>0&&pe<15&&rsi<30){recommendation='BUY';strength=8;}else if(pe>30&&rsi>70){recommendation='SELL';strength=7;}return{predictions:{oneDay:{price:price*1.001,change:0.1,confidence:30},sevenDay:{price:price*1.005,change:0.5,confidence:25},thirtyDay:{price:price*1.02,change:2.0,confidence:20}},recommendation,recommendationStrength:strength,targetPrice:price*1.10,stopLoss:price*0.95,keyInsights:["AI analysis temporarily unavailable","Using basic technical analysis"],risks:["Limited analysis due to AI unavailability"],opportunities:["Manual analysis recommended"],technicalScore:50,fundamentalScore:50,sentimentScore:50,summary:"AI analysis unavailable. Basic metrics suggest neutral stance. Manual review recommended.",symbol:stock.symbol,currentPrice:price,timestamp:Date.now(),aiModel:'fallback'};}formatNumber(num){if(!num)return'N/A';if(num>=1e12)return(num/1e12).toFixed(2)+'T';if(num>=1e9)return(num/1e9).toFixed(2)+'B';if(num>=1e6)return(num/1e6).toFixed(2)+'M';return num.toLocaleString();}}const aiAnalyzer=new ClaudeStockAnalyzer();class ErrorBoundary extends React.Component{constructor(props){super(props);this.state={hasError:false,error:null};}static getDerivedStateFromError(error){return{hasError:true,error};}componentDidCatch(error,errorInfo){console.error('ErrorBoundary caught error:',error,errorInfo);}render(){if(this.state.hasError){return React.createElement("div",{className:"min-h-screen flex items-center justify-center p-6"},React.createElement("div",{className:"glass-elevated rounded-2xl p-8 max-w-md text-center"},React.createElement("div",{className:"text-4xl mb-4 text-red-400"},"\u26A0\uFE0F"),React.createElement("h3",{className:"text-xl font-bold text-white mb-3"},"Something went wrong"),React.createElement("p",{className:"text-slate-400 mb-6"},"We encountered an error while loading this component."),React.createElement("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-semibold"},"Reload Application")));}return this.props.children;}}const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));const num=function(v){let d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;const x=typeof v==="number"?v:parseFloat(v);return Number.isFinite(x)?x:d;};function computeAIScore(stock){const pe=num(stock.pe,0);const roe=num(stock.roe,0);const rsi=num(stock.rsi,50);const changePct=num(stock.changePct,0);const marketCap=num(stock.marketCap,0);let fundamental=50;if(pe>0){if(pe<15)fundamental+=20;else if(pe<20)fundamental+=12;else if(pe<25)fundamental+=5;else if(pe>40)fundamental-=15;else if(pe>30)fundamental-=8;}if(roe>25)fundamental+=20;else if(roe>20)fundamental+=15;else if(roe>15)fundamental+=10;else if(roe>10)fundamental+=5;else if(roe<5)fundamental-=10;if(marketCap>10e9)fundamental+=8;else if(marketCap<1e9)fundamental-=5;fundamental=clamp(fundamental,0,100);let technical=50;if(rsi>=35&&rsi<=65)technical+=15;else if(rsi<30)technical+=10;else if(rsi>70)technical-=12;if(changePct>5)technical+=12;else if(changePct>2)technical+=6;else if(changePct<-5)technical-=10;else if(changePct<-2)technical-=5;technical=clamp(technical,0,100);let risk=50;if(pe>40)risk+=15;else if(pe>30)risk+=8;if(rsi>75||rsi<25)risk+=10;if(changePct<-10)risk+=12;risk=clamp(risk,0,100);const rawScore=0.55*fundamental+0.35*technical+0.10*(100-risk);const score=clamp(Math.round(rawScore),0,100);return{score,subscores:{fundamental,technical,risk}};}function verdictFromScore(score){if(score>=80)return{verdict:"STRONG BUY",stance:"bullish"};if(score>=67)return{verdict:"BUY",stance:"bullish"};if(score>=55)return{verdict:"HOLD",stance:"neutral"};if(score>=45)return{verdict:"REDUCE",stance:"bearish"};return{verdict:"SELL",stance:"bearish"};}function confidenceFromScore(score,subscores){const base=40+Math.abs(score-50)*1.1;const riskPenalty=(subscores?.risk??50)*0.15;const confidence=clamp(Math.round(base-riskPenalty),35,92);return confidence;}function generateAIAnalysis(stock){const{score,subscores}=computeAIScore(stock);const{verdict,stance}=verdictFromScore(score);const confidence=confidenceFromScore(score,subscores);const bullFactors=[];const bearFactors=[];const pe=num(stock.pe,0);const roe=num(stock.roe,0);const rsi=num(stock.rsi,50);const changePct=num(stock.changePct,0);const price=num(stock.price,0);const importanceRank={high:3,medium:2,low:1};if(pe>0&&pe<15){bullFactors.push({factor:"Attractive Valuation",detail:`P/E ratio of ${pe.toFixed(1)} suggests undervaluation vs. market average.`,importance:"high",category:"fundamental"});}if(roe>20){bullFactors.push({factor:"Superior Capital Efficiency",detail:`ROE of ${roe.toFixed(1)}% demonstrates exceptional profitability.`,importance:"high",category:"fundamental"});}if(rsi<35){bullFactors.push({factor:"Oversold Technical Setup",detail:`RSI of ${rsi.toFixed(0)} indicates potential mean reversion opportunity.`,importance:"medium",category:"technical"});}if(changePct>5){bullFactors.push({factor:"Strong Momentum",detail:`Recent price gain of ${changePct.toFixed(1)}% shows buying pressure.`,importance:"medium",category:"technical"});}if(pe>0&&pe<20&&roe>15){bullFactors.push({factor:"Value-Quality Combination",detail:`Reasonable valuation (P/E ${pe.toFixed(1)}) paired with strong returns (ROE ${roe.toFixed(1)}%).`,importance:"high",category:"fundamental"});}if(pe>35){bearFactors.push({factor:"Premium Valuation Risk",detail:`P/E ratio of ${pe.toFixed(1)} leaves little margin for safety.`,importance:"high",category:"fundamental"});}if(roe<8&&roe>0){bearFactors.push({factor:"Below-Average Returns",detail:`ROE of ${roe.toFixed(1)}% suggests weak capital efficiency.`,importance:"medium",category:"fundamental"});}if(rsi>72){bearFactors.push({factor:"Overbought Condition",detail:`RSI of ${rsi.toFixed(0)} increases probability of near-term pullback.`,importance:"medium",category:"technical"});}if(changePct<-5){bearFactors.push({factor:"Negative Momentum",detail:`Recent decline of ${changePct.toFixed(1)}% signals selling pressure.`,importance:"medium",category:"technical"});}if(!bullFactors.length){bullFactors.push({factor:"No Major Red Flags",detail:"Fundamental and technical signals are generally supportive.",importance:"low",category:"fundamental"});}if(!bearFactors.length){bearFactors.push({factor:"Normal Risk Profile",detail:"Risks appear within typical range for this asset.",importance:"low",category:"fundamental"});}const execSummary=`${stock.symbol} scores ${score}/100 with ${verdict} rating (${confidence}% confidence). Fundamentals: ${Math.round(subscores.fundamental)}/100, Technicals: ${Math.round(subscores.technical)}/100, Risk: ${Math.round(subscores.risk)}/100.`;const sortedBull=[...bullFactors].sort((a,b)=>(importanceRank[b.importance]||0)-(importanceRank[a.importance]||0));const sortedBear=[...bearFactors].sort((a,b)=>(importanceRank[b.importance]||0)-(importanceRank[a.importance]||0));const topDrivers={positive:sortedBull.slice(0,2),negative:sortedBear.slice(0,2)};let reassurance="Nothing here suggests unusual urgency ‚Äî use this as a starting point and sanity-check with your own research.";if((subscores?.risk??50)>=70)reassurance="Risk signals look elevated ‚Äî size your exposure carefully and double-check the bear cases before acting.";else if(confidence<=45)reassurance="Signals are mixed (low alignment) ‚Äî it's normal to place this on a watchlist and wait for clarity.";const valuationFlag=pe>35?"valuation looks stretched":pe>0&&pe<15?"valuation looks supportive":"valuation looks mixed";const timingFlag=rsi>72?"short-term timing looks stretched":rsi<35?"short-term timing may be favorable":"timing looks neutral";const qualityFlag=roe>20?"business quality looks strong":roe>0&&roe<8?"quality looks weaker than average":"quality looks mixed";let takeaway="";if(verdict==="STRONG BUY"||verdict==="BUY"){takeaway=`Overall, the balance of signals leans constructive: ${qualityFlag}, ${valuationFlag}, and ${timingFlag}. This looks more suitable for patient investors than for quick trades.`;}else if(verdict==="HOLD"){takeaway=`Overall, signals are mixed: ${qualityFlag} with ${valuationFlag} and ${timingFlag}. This is a reasonable watchlist candidate while you wait for a better price, clearer trend, or new fundamentals.`;}else{takeaway=`Overall, the risk/reward looks less attractive right now: ${qualityFlag} with ${valuationFlag} and ${timingFlag}. Consider treating this as "research further" unless your thesis is very strong.`;}const watchMetric=sortedBear[0]?.category==="technical"||rsi>70||rsi<30?"trend/RSI and price action":sortedBear[0]?.category==="fundamental"||pe>30?"earnings + valuation (P/E) and margins":"ROE/margins and revenue growth";const lastEarningsDate=stock?.lastEarnings?.date||stock?.lastEarnings?.fiscalDateEnding||null;const watchlistGuidance={headline:"What to watch next",items:[{label:"Next check-in",value:lastEarningsDate?`Review after the next earnings cycle (last reported: ${lastEarningsDate}).`:"Review after the next earnings cycle."},{label:"Key metric",value:watchMetric},{label:"Main risk to monitor",value:sortedBear[0]?.factor?sortedBear[0].factor:"unexpected earnings / guidance changes"}]};return{verdict,confidence,stance,execSummary,bullFactors,bearFactors,topDrivers,reassurance,takeaway,watchlistGuidance,subscores,aiScore:score,health:score};}function explainDeterministicAIScore(stock){const pe=num(stock.pe,0);const roe=num(stock.roe,0);const rsi=num(stock.rsi,50);const changePct=num(stock.changePct,0);const marketCap=num(stock.marketCap,0);const weights={fundamental:0.55,technical:0.35,risk:0.10};const contributions=[];const add=(bucket,label,delta,detail)=>{if(!delta)return;contributions.push({bucket,label,delta,detail});};let fundamental=50;if(pe>0){if(pe<15){fundamental+=20;add('fundamental','Attractive P/E',+20,`P/E ${pe.toFixed(1)} < 15`);}else if(pe<20){fundamental+=12;add('fundamental','Reasonable P/E',+12,`P/E ${pe.toFixed(1)} < 20`);}else if(pe<25){fundamental+=5;add('fundamental','Fair P/E',+5,`P/E ${pe.toFixed(1)} < 25`);}else if(pe>40){fundamental-=15;add('fundamental','Expensive P/E',-15,`P/E ${pe.toFixed(1)} > 40`);}else if(pe>30){fundamental-=8;add('fundamental','High P/E',-8,`P/E ${pe.toFixed(1)} > 30`);}}if(roe>25){fundamental+=20;add('fundamental','Excellent ROE',+20,`ROE ${roe.toFixed(1)}% > 25%`);}else if(roe>20){fundamental+=15;add('fundamental','Strong ROE',+15,`ROE ${roe.toFixed(1)}% > 20%`);}else if(roe>15){fundamental+=10;add('fundamental','Good ROE',+10,`ROE ${roe.toFixed(1)}% > 15%`);}else if(roe>10){fundamental+=5;add('fundamental','Decent ROE',+5,`ROE ${roe.toFixed(1)}% > 10%`);}else if(roe<5){fundamental-=10;add('fundamental','Weak ROE',-10,`ROE ${roe.toFixed(1)}% < 5%`);}if(marketCap>10e9){fundamental+=8;add('fundamental','Large-cap stability',+8,`Market cap > $10B`);}else if(marketCap>0&&marketCap<1e9){fundamental-=5;add('fundamental','Small-cap risk',-5,`Market cap < $1B`);}fundamental=clamp(fundamental,0,100);let technical=50;if(rsi>=35&&rsi<=65){technical+=15;add('technical','Healthy RSI',+15,`RSI ${rsi.toFixed(0)} in 35‚Äì65`);}else if(rsi<30){technical+=10;add('technical','Oversold setup',+10,`RSI ${rsi.toFixed(0)} < 30`);}else if(rsi>70){technical-=12;add('technical','Overbought risk',-12,`RSI ${rsi.toFixed(0)} > 70`);}if(changePct>5){technical+=12;add('technical','Strong momentum',+12,`${changePct.toFixed(1)}% daily move > +5%`);}else if(changePct>2){technical+=6;add('technical','Positive momentum',+6,`${changePct.toFixed(1)}% daily move > +2%`);}else if(changePct<-5){technical-=10;add('technical','Downtrend',-10,`${changePct.toFixed(1)}% daily move < -5%`);}else if(changePct<-2){technical-=5;add('technical','Weak tape',-5,`${changePct.toFixed(1)}% daily move < -2%`);}technical=clamp(technical,0,100);let risk=50;if(pe>40){risk+=15;add('risk','Valuation risk',+15,`P/E ${pe.toFixed(1)} > 40`);}else if(pe>30){risk+=8;add('risk','Valuation risk',+8,`P/E ${pe.toFixed(1)} > 30`);}if(rsi>75||rsi<25){risk+=10;add('risk','Extreme RSI risk',+10,`RSI ${rsi.toFixed(0)} outside 25‚Äì75`);}if(changePct<-10){risk+=12;add('risk','Sharp drawdown risk',+12,`${changePct.toFixed(1)}% daily move < -10%`);}risk=clamp(risk,0,100);const rawScore=weights.fundamental*fundamental+weights.technical*technical+weights.risk*(100-risk);const score=clamp(Math.round(rawScore),0,100);const impacts=contributions.map(c=>{let impact=0;if(c.bucket==='fundamental')impact=weights.fundamental*c.delta;else if(c.bucket==='technical')impact=weights.technical*c.delta;else if(c.bucket==='risk')impact=-weights.risk*c.delta;return{...c,impact:Math.round(impact*10)/10};}).sort((a,b)=>Math.abs(b.impact)-Math.abs(a.impact));return{score,subscores:{fundamental,technical,risk},weights,impacts,topImpacts:impacts.slice(0,6)};}function aiExplainThresholds(score){const bands=[80,67,55,45,0];const labels=['STRONG BUY','BUY','HOLD','REDUCE','SELL'];let idx=labels.length-1;for(let i=0;i<bands.length;i++){if(score>=bands[i]){idx=i;break;}}const current=labels[idx];const nextUpScore=idx>0?bands[idx-1]:null;const nextDownScore=idx<labels.length-1?bands[idx+1]:null;return{current,nextUpScore,nextDownScore,toNextUp:nextUpScore!=null?Math.max(0,nextUpScore-score):0,toNextDown:nextDownScore!=null?Math.max(0,score-nextDownScore):0};}function aiSensitivitySuggestions(stock){const base=explainDeterministicAIScore(stock);const suggestions=[];const addSuggestion=(title,overrides,note)=>{const alt=explainDeterministicAIScore({...stock,...overrides});const delta=alt.score-base.score;if(!Number.isFinite(delta)||Math.abs(delta)<1)return;suggestions.push({title,delta,newScore:alt.score,note});};const pe=num(stock.pe,0);if(pe>40)addSuggestion('If valuation cools (P/E < 40)',{pe:39.9},'Reduces valuation risk penalty and improves the P/E bucket.');else if(pe>30)addSuggestion('If valuation cools (P/E < 30)',{pe:29.9},'Improves fundamentals and reduces the risk bucket.');else if(pe>=25)addSuggestion('If P/E improves (< 25)',{pe:24.9},'Moves into a more favorable valuation bucket.');else if(pe>=20)addSuggestion('If P/E improves (< 20)',{pe:19.9},'Moves into a stronger valuation bucket.');else if(pe>=15)addSuggestion('If P/E improves (< 15)',{pe:14.9},'Moves into the strongest valuation bucket.');const roe=num(stock.roe,0);if(roe<5)addSuggestion('If ROE reaches 10%',{roe:10.1},'Crosses the 10% profitability threshold.');else if(roe<10)addSuggestion('If ROE reaches 15%',{roe:15.1},'Crosses the 15% profitability threshold.');else if(roe<15)addSuggestion('If ROE reaches 20%',{roe:20.1},'Crosses the 20% profitability threshold.');else if(roe<20)addSuggestion('If ROE reaches 25%',{roe:25.1},'Crosses the 25% profitability threshold.');const rsi=num(stock.rsi,50);if(!(rsi>=35&&rsi<=65))addSuggestion('If RSI returns to 35‚Äì65',{rsi:50},'Moves into the ‚Äúhealthy RSI‚Äù band used by the model.');if(rsi>75||rsi<25)addSuggestion('If RSI normalizes inside 25‚Äì75',{rsi:clamp(rsi,25,75)},'Removes the ‚Äúextreme RSI‚Äù risk penalty.');const changePct=num(stock.changePct,0);if(changePct<-10)addSuggestion('If drawdown eases above -10%',{changePct:-9.9},'Removes the ‚Äúsharp drawdown‚Äù risk penalty.');if(changePct<2)addSuggestion('If momentum improves above +2%',{changePct:2.1},'Moves into the positive momentum bucket.');const marketCap=num(stock.marketCap,0);if(marketCap>0&&marketCap<1e9)addSuggestion('If market cap re-rates above $1B',{marketCap:1e9},'Removes the small-cap penalty.');return suggestions.sort((a,b)=>Math.abs(b.delta)-Math.abs(a.delta)).slice(0,4);}function DelayBadge(){const[open,setOpen]=useState(false);return React.createElement("div",{className:"relative inline-block"},React.createElement("button",{onClick:()=>setOpen(p=>!p),className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-yellow-500/10 border border-yellow-500/30 text-yellow-300 text-xs font-semibold uppercase tracking-wide cursor-pointer hover:bg-yellow-500/20 transition"},React.createElement("i",{className:"fas fa-clock"}),"Delayed 15 min"),open&&React.createElement("div",{className:"absolute right-0 top-full mt-2 glass-card p-4 rounded-lg w-72 text-xs text-slate-300 z-50 shadow-2xl border border-slate-700"},React.createElement("div",{className:"flex items-start gap-2 mb-2"},React.createElement("i",{className:"fas fa-info-circle text-yellow-400 mt-0.5"}),React.createElement("div",null,React.createElement("div",{className:"font-semibold text-white mb-1"},"Data Delay Notice"),React.createElement("div",{className:"text-slate-400 leading-relaxed"},"US stock exchanges provide data with a 15-minute delay for free tiers. Additional sources: Financial Modeling Prep, Finnhub, EOD Historical Data."))),React.createElement("div",{className:"mt-3 pt-3 border-t border-slate-700 text-xs text-slate-500"},"Not investment advice. Always consult a licensed financial adviser."),React.createElement("button",{onClick:()=>setOpen(false),className:"mt-2 w-full py-1.5 bg-slate-700 hover:bg-slate-600 text-white rounded text-xs font-medium transition"},"Got it")));}function Footer(){return React.createElement("footer",{className:"mt-8 px-6 py-4 glass rounded-2xl"},React.createElement("div",{className:"flex items-center justify-between text-xs text-slate-500"},React.createElement("div",{className:"flex items-center gap-4"},React.createElement("span",null,"\xA9 2026 RetailEdge Pro"),React.createElement("span",{className:"text-slate-700"},"\u2022"),React.createElement("span",null,"Data delayed 15 min"),React.createElement("span",{className:"text-slate-700"},"\u2022"),React.createElement("span",null,"Not investment advice")),React.createElement("div",{className:"flex items-center gap-3"},React.createElement("a",{href:"#",className:"hover:text-cyan-400 transition"},"Terms"),React.createElement("span",{className:"text-slate-700"},"\u2022"),React.createElement("a",{href:"#",className:"hover:text-cyan-400 transition"},"Privacy"),React.createElement("span",{className:"text-slate-700"},"\u2022"),React.createElement("a",{href:"#",className:"hover:text-cyan-400 transition"},"Support"))),React.createElement("div",{className:"mt-2 text-[10px] text-slate-600 text-center"},"Please consult a licensed financial adviser before making investment decisions."));}function PaywallCard(_ref4){let{feature,description}=_ref4;const{tier}=usePremium();const upgrade=()=>{alert(`Upgrade to Premium to unlock ${feature}!\n\nCurrent tier: ${tier}\n\nPremium features:\n‚Ä¢ Unlimited watchlist\n‚Ä¢ Advanced analytics\n‚Ä¢ Real-time alerts\n‚Ä¢ Portfolio tracking\n‚Ä¢ And more!`);};return React.createElement("div",{className:"glass-card p-6 rounded-xl border-2 border-yellow-500/30 bg-gradient-to-br from-yellow-500/5 to-orange-500/5"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-full mb-4"},React.createElement("i",{className:"fas fa-crown text-white text-2xl"})),React.createElement("h3",{className:"text-xl font-bold text-white mb-2"},"Premium Feature"),React.createElement("div",{className:"text-yellow-300 font-semibold mb-2"},feature),React.createElement("p",{className:"text-slate-400 text-sm mb-4 leading-relaxed"},description||'This feature is available for Premium and Pro subscribers.'),React.createElement("div",{className:"space-y-2 mb-4"},React.createElement("div",{className:"flex items-center gap-2 text-sm text-slate-300"},React.createElement("i",{className:"fas fa-check text-emerald-400"}),React.createElement("span",null,"Unlimited watchlist items")),React.createElement("div",{className:"flex items-center gap-2 text-sm text-slate-300"},React.createElement("i",{className:"fas fa-check text-emerald-400"}),React.createElement("span",null,"Advanced analytics & insights")),React.createElement("div",{className:"flex items-center gap-2 text-sm text-slate-300"},React.createElement("i",{className:"fas fa-check text-emerald-400"}),React.createElement("span",null,"Real-time price alerts"))),React.createElement("button",{onClick:upgrade,className:"w-full py-3 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-400 hover:to-orange-400 text-white rounded-lg font-bold text-sm transition shadow-lg shadow-yellow-500/20"},"Upgrade to Premium"),React.createElement("div",{className:"mt-3 text-xs text-slate-500"},"Starting at $9.99/month \u2022 Cancel anytime")));}function SocialSentimentLeaderboard(_ref5){let{onStockClick}=_ref5;const[leaderboard,setLeaderboard]=useState([]);const[loading,setLoading]=useState(true);const[lastUpdate,setLastUpdate]=useState(null);const[selectedPlatform,setSelectedPlatform]=useState('all');const platforms=[{id:'all',name:'All Platforms',icon:'üåê'},{id:'reddit',name:'Reddit',icon:'ü§ñ'},{id:'stocktwits',name:'StockTwits',icon:'üìà'}];const fetchLeaderboard=async()=>{setLoading(true);try{const symbols=DEMO_STOCKS.map(stock=>stock.symbol);const sentimentPromises=symbols.map(symbol=>window.socialSentiment?.fetchSocialSentiment(symbol).catch(()=>null));const results=await Promise.all(sentimentPromises);const validResults=results.filter((data,idx)=>data&&data.totalMessages>0).map((data,idx)=>({symbol:symbols[idx],stock:DEMO_STOCKS.find(s=>s.symbol===symbols[idx]),...data,sentimentScore:data.sentimentScore||0,mentionChange:calculateMentionChange(symbols[idx],data.totalMessages),trend:determineTrend(data)})).sort((a,b)=>b.totalMessages-a.totalMessages);setLeaderboard(validResults.slice(0,50));setLastUpdate(Date.now());}catch(error){console.error('Leaderboard fetch error:',error);}finally{setLoading(false);}};const calculateMentionChange=(symbol,currentMentions)=>{const cacheKey=`mentions_${symbol}`;const previous=localStorage.getItem(cacheKey);if(previous){const prevData=JSON.parse(previous);const timeDiff=Date.now()-prevData.timestamp;if(timeDiff<24*60*60*1000){const change=(currentMentions-prevData.count)/prevData.count*100;return change;}}localStorage.setItem(cacheKey,JSON.stringify({count:currentMentions,timestamp:Date.now()}));return 0;};const determineTrend=data=>{const recent=data.recentMentions||0;const older=data.olderMentions||1;const ratio=recent/older;if(ratio>2)return'spiking';if(ratio>1.3)return'rising';if(ratio<0.7)return'falling';return'stable';};useEffect(()=>{fetchLeaderboard();const interval=setInterval(fetchLeaderboard,30*60*1000);return()=>clearInterval(interval);},[]);if(loading){return React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("i",{className:"fas fa-spinner animate-spin text-3xl text-cyan-400 mb-3"}),React.createElement("p",{className:"text-slate-400"},"Analyzing social buzz across platforms..."));}return React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"flex gap-2 mb-4"},platforms.map(p=>React.createElement("button",{key:p.id,onClick:()=>setSelectedPlatform(p.id),className:`px-4 py-2 rounded-lg font-semibold text-sm transition ${selectedPlatform===p.id?'bg-cyan-500/20 text-cyan-300 border border-cyan-500/30':'bg-slate-800 text-slate-400 hover:bg-slate-700 border border-slate-700'}`},React.createElement("span",{className:"mr-2"},p.icon),p.name))),React.createElement("div",{className:"flex items-center gap-2 text-xs text-slate-500"},React.createElement("i",{className:"fas fa-clock"}),"Last updated: ",lastUpdate?new Date(lastUpdate).toLocaleTimeString():'Never',React.createElement("span",{className:"text-cyan-400"},"(Updates every 30min)")),React.createElement("div",{className:"glass-card rounded-xl overflow-hidden"},React.createElement("table",{className:"w-full"},React.createElement("thead",{className:"bg-slate-800/50"},React.createElement("tr",{className:"text-left text-xs text-slate-400 uppercase"},React.createElement("th",{className:"p-3"},"Rank"),React.createElement("th",{className:"p-3"},"Stock"),React.createElement("th",{className:"p-3"},"Mentions"),React.createElement("th",{className:"p-3"},"24h Change"),React.createElement("th",{className:"p-3"},"Sentiment"),React.createElement("th",{className:"p-3"},"Trend"),React.createElement("th",{className:"p-3"},"Action"))),React.createElement("tbody",null,leaderboard.map((item,idx)=>{const trendConfig={spiking:{icon:'üöÄ',color:'text-orange-400',label:'Spiking'},rising:{icon:'üìà',color:'text-green-400',label:'Rising'},falling:{icon:'üìâ',color:'text-red-400',label:'Falling'},stable:{icon:'‚û°Ô∏è',color:'text-slate-400',label:'Stable'}}[item.trend]||{icon:'‚û°Ô∏è',color:'text-slate-400',label:'Stable'};return React.createElement("tr",{key:item.symbol,className:"border-b border-slate-700/30 hover:bg-slate-700/20 cursor-pointer",onClick:()=>item.stock&&onStockClick(item.stock)},React.createElement("td",{className:"p-3"},React.createElement("div",{className:`font-bold ${idx===0?'text-yellow-400':idx===1?'text-slate-400':idx===2?'text-orange-400':'text-slate-300'}`},"#",idx+1)),React.createElement("td",{className:"p-3"},React.createElement("div",{className:"font-bold text-white"},item.symbol),React.createElement("div",{className:"text-xs text-slate-400 truncate max-w-32"},item.stock?.companyName||item.stock?.name||'‚Äî')),React.createElement("td",{className:"p-3"},React.createElement("div",{className:"font-semibold text-white"},item.totalMessages?.toLocaleString()||0),React.createElement("div",{className:"text-xs text-slate-400"},item.stocktwitsCount||0," ST + ",item.redditCount||0," RD")),React.createElement("td",{className:"p-3"},React.createElement("div",{className:`font-semibold ${item.mentionChange>50?'text-green-400':item.mentionChange>0?'text-green-300':'text-red-400'}`},item.mentionChange>0?'+':'',item.mentionChange?.toFixed(0)||0,"%")),React.createElement("td",{className:"p-3"},React.createElement("div",{className:`font-semibold ${item.sentimentScore>50?'text-green-400':item.sentimentScore>0?'text-yellow-400':'text-red-400'}`},item.sentimentScore>0?'+':'',item.sentimentScore||0,"%"),React.createElement("div",{className:"text-xs text-slate-400"},item.bullishPercent||0,"% bullish")),React.createElement("td",{className:"p-3"},React.createElement("div",{className:`flex items-center gap-1 ${trendConfig.color}`},React.createElement("span",null,trendConfig.icon),React.createElement("span",{className:"text-sm"},trendConfig.label))),React.createElement("td",{className:"p-3"},React.createElement("button",{onClick:e=>{e.stopPropagation();if(item.stock)onStockClick(item.stock);},className:"px-3 py-1 bg-cyan-600 hover:bg-cyan-500 text-white rounded text-sm font-medium"},"View")));})))),React.createElement("div",{className:"grid grid-cols-3 gap-4 mt-6"},React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-2xl font-bold text-green-400"},leaderboard.filter(i=>i.sentimentScore>50).length),React.createElement("div",{className:"text-xs text-slate-400"},"Bullish Sentiment")),React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-2xl font-bold text-orange-400"},leaderboard.filter(i=>i.trend==='spiking').length),React.createElement("div",{className:"text-xs text-slate-400"},"Spiking Now")),React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-2xl font-bold text-cyan-400"},leaderboard.reduce((sum,i)=>sum+(i.totalMessages||0),0).toLocaleString()),React.createElement("div",{className:"text-xs text-slate-400"},"Total Mentions"))));}function WatchlistTab(_ref6){let{watchlist,stocks,onRemoveFromWatchlist,onStockClick,setShowWatchlistOnly}=_ref6;const[watchlistStocks,setWatchlistStocks]=useState([]);const[loading,setLoading]=useState(true);const[stats,setStats]=useState({totalValue:0,totalChange:0,avgChange:0});useEffect(()=>{const loadWatchlistData=async()=>{if(!watchlist||watchlist.length===0){setWatchlistStocks([]);setLoading(false);return;}setLoading(true);const loadedStocks=watchlist.map(symbol=>{const stock=stocks.find(s=>s.symbol===symbol);if(stock){return stock;}const cached=Cache.get(symbol,'stock');if(cached)return cached;return null;}).filter(Boolean);setWatchlistStocks(loadedStocks);const totalValue=loadedStocks.reduce((sum,s)=>sum+(s.marketCap||0),0);const totalChange=loadedStocks.reduce((sum,s)=>sum+(s.changePct||0),0);const avgChange=loadedStocks.length>0?totalChange/loadedStocks.length:0;setStats({totalValue,totalChange,avgChange,count:loadedStocks.length});setLoading(false);};loadWatchlistData();},[watchlist,stocks]);if(loading){return React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("i",{className:"fas fa-spinner animate-spin text-3xl text-cyan-400 mb-3"}),React.createElement("p",{className:"text-slate-400"},"Loading your watchlist..."));}if(!watchlist||watchlist.length===0){return React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("i",{className:"fas fa-star text-6xl text-slate-700 mb-4"}),React.createElement("h3",{className:"text-xl font-bold text-white mb-2"},"Your Watchlist is Empty"),React.createElement("p",{className:"text-slate-400 mb-4"},"Add stocks to watchlist from the main screener to see them here"),React.createElement("button",{onClick:()=>setShowWatchlistOnly(false),className:"px-6 py-3 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-semibold"},"Browse Stocks"));}return React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2"},React.createElement("i",{className:"fas fa-star text-yellow-400"}),"My Watchlist (",stats.count," stocks)"),React.createElement("div",{className:"grid grid-cols-3 gap-4"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-2xl font-bold text-white"},"$",formatNumber(stats.totalValue)),React.createElement("div",{className:"text-xs text-slate-400"},"Total Market Cap")),React.createElement("div",{className:"text-center"},React.createElement("div",{className:`text-2xl font-bold ${getSentimentColor(stats.avgChange)}`},formatPercent(stats.avgChange)),React.createElement("div",{className:"text-xs text-slate-400"},"Avg Change")),React.createElement("div",{className:"text-center"},React.createElement("div",{className:`text-2xl font-bold ${stats.totalChange>=0?'text-green-400':'text-red-400'}`},formatPercent(stats.totalChange)),React.createElement("div",{className:"text-xs text-slate-400"},"Combined Change")))),React.createElement("div",{className:"glass-card rounded-xl overflow-hidden"},React.createElement("table",{className:"w-full"},React.createElement("thead",{className:"bg-slate-800/50"},React.createElement("tr",{className:"text-left text-xs text-slate-400 uppercase"},React.createElement("th",{className:"p-3"},"Symbol"),React.createElement("th",{className:"p-3"},"Price"),React.createElement("th",{className:"p-3"},"Change%"),React.createElement("th",{className:"p-3"},"Volume"),React.createElement("th",{className:"p-3"},"P/E"),React.createElement("th",{className:"p-3"},"ROE%"),React.createElement("th",{className:"p-3"},"AI Score"),React.createElement("th",{className:"p-3"},"Actions"))),React.createElement("tbody",null,watchlistStocks.map(stock=>{const analysis=computeEnhancedAnalysis(stock);return React.createElement("tr",{key:stock.symbol,className:"border-b border-slate-700/30 hover:bg-slate-700/20 cursor-pointer",onClick:()=>onStockClick(stock)},React.createElement("td",{className:"p-3"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:"font-bold text-white"},stock.symbol),watchlist&&Array.isArray(watchlist)&&watchlist.some(w=>w&&w.toUpperCase()===stock.symbol.toUpperCase())&&React.createElement("span",{className:"text-yellow-400"},"\u2605")),React.createElement("div",{className:"text-xs text-slate-400 truncate max-w-32"},stock.companyName||stock.name||'‚Äî')),React.createElement("td",{className:"p-3 font-semibold text-white"},"$",stock.price?.toFixed(2)),React.createElement("td",{className:`p-3 font-semibold ${getSentimentColor(stock.changePct)}`},formatPercent(stock.changePct)),React.createElement("td",{className:"p-3 text-slate-300"},formatNumber(stock.volume)),React.createElement("td",{className:"p-3 text-slate-300"},stock.pe?.toFixed(1)||'‚Äî'),React.createElement("td",{className:"p-3 text-slate-300"},stock.roe?.toFixed(1)||'‚Äî',"%"),React.createElement("td",{className:"p-3"},React.createElement("div",{className:`font-bold ${analysis.aiScore>=80?'text-green-400':analysis.aiScore>=60?'text-yellow-400':'text-red-400'}`},analysis.aiScore,"/100"),React.createElement("div",{className:`text-xs ${analysis.verdict==='STRONG BUY'||analysis.verdict==='BUY'?'text-green-400':analysis.verdict==='SELL'?'text-red-400':'text-slate-400'}`},analysis.verdict)),React.createElement("td",{className:"p-3"},React.createElement("button",{onClick:e=>{e.stopPropagation();onRemoveFromWatchlist&&onRemoveFromWatchlist(stock.symbol);},className:"px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded text-sm font-medium",title:"Remove from watchlist"},React.createElement("i",{className:"fas fa-trash"}))));})))),React.createElement("div",{className:"flex gap-3"},React.createElement("button",{onClick:()=>{if(confirm('Are you sure you want to clear your entire watchlist?')){watchlist.forEach(symbol=>onRemoveFromWatchlist(symbol));}},className:"px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg font-medium"},React.createElement("i",{className:"fas fa-trash-alt mr-2"}),"Clear Watchlist"),React.createElement("button",{onClick:()=>{const csv=watchlistStocks.map(s=>`${s.symbol},${s.name||''},$${s.price},${s.changePct}%`).join('\n');const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`watchlist_${new Date().toISOString().split('T')[0]}.csv`;a.click();},className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium"},React.createElement("i",{className:"fas fa-download mr-2"}),"Export CSV")));}function DataFreshnessIndicator(_ref7){let{timestamp,type}=_ref7;const[display,setDisplay]=useState('');const format=()=>{if(!timestamp)return'Never updated';const minutes=Math.floor((Date.now()-timestamp)/60000);if(type==='heatmap'){const nextUpdate=60-minutes%60;return`Next update: ${nextUpdate} min`;}const interval=type==='news'||type==='sentiment'?30:60;const nextUpdate=Math.max(0,interval-minutes);if(minutes<1)return'Updated just now';if(minutes<60)return`Updated ${minutes}m ago (next: ${nextUpdate}m)`;return`Updated ${Math.floor(minutes/60)}h ago`;};useEffect(()=>{setDisplay(format());const id=setInterval(()=>setDisplay(format()),60000);return()=>clearInterval(id);},[timestamp,type]);const colorClass=timestamp&&Date.now()-timestamp<60000?'text-green-400':'text-slate-400';return React.createElement("div",{className:`flex items-center gap-2 text-xs ${colorClass}`},React.createElement("i",{className:"fas fa-clock"}),React.createElement("span",null,display));}function EducationCenterModal(_ref8){let{onClose}=_ref8;const[selectedTab,setSelectedTab]=useState('tutorials');const[selectedTutorial,setSelectedTutorial]=useState(null);const[selectedCaseStudy,setSelectedCaseStudy]=useState(null);const userId=UserManager.getCurrentUser()?.id||'guest';const progress=EDUCATION_CENTER.getProgress(userId);const completionRate=EDUCATION_CENTER.getCompletionRate(userId);const categories=[{id:'basics',name:'Basics',icon:'üìö'},{id:'metrics',name:'Metrics',icon:'üî¢'},{id:'technical',name:'Technical',icon:'üìä'},{id:'strategy',name:'Strategy',icon:'üéØ'}];if(selectedTutorial){return React.createElement("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"glass-card rounded-2xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("button",{onClick:()=>setSelectedTutorial(null),className:"text-cyan-400 hover:text-cyan-300 flex items-center gap-2"},React.createElement("i",{className:"fas fa-arrow-left"})," Back"),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white"},React.createElement("i",{className:"fas fa-times text-xl"}))),React.createElement("div",{className:"mb-6"},React.createElement("div",{className:"text-4xl mb-3"},selectedTutorial.icon),React.createElement("h2",{className:"text-2xl font-bold text-white mb-2"},selectedTutorial.title),React.createElement("div",{className:"flex items-center gap-3 text-sm text-slate-400"},React.createElement("span",null,React.createElement("i",{className:"fas fa-clock mr-1"}),selectedTutorial.duration),React.createElement("span",null,"\u2022"),React.createElement("span",{className:"px-2 py-1 bg-cyan-500/10 text-cyan-300 rounded"},selectedTutorial.category))),React.createElement("div",{className:"space-y-6"},React.createElement("div",null,React.createElement("p",{className:"text-slate-300 leading-relaxed"},selectedTutorial.content.intro)),React.createElement("div",null,React.createElement("h3",{className:"text-lg font-semibold text-white mb-3"},"Key Points"),React.createElement("ul",{className:"space-y-2"},selectedTutorial.content.keyPoints.map((point,i)=>React.createElement("li",{key:i,className:"flex items-start gap-3 text-slate-300"},React.createElement("i",{className:"fas fa-check-circle text-emerald-400 mt-1"}),React.createElement("span",null,point))))),React.createElement("div",{className:"glass p-4 rounded-lg border border-cyan-500/20"},React.createElement("h4",{className:"font-semibold text-cyan-300 mb-2"},"\uD83D\uDCA1 Example"),React.createElement("p",{className:"text-slate-300 text-sm leading-relaxed"},selectedTutorial.content.example)),selectedTutorial.content.whyItMatters&&React.createElement("div",{className:"glass p-4 rounded-lg border border-purple-500/20"},React.createElement("h4",{className:"font-semibold text-purple-300 mb-2"},"\uD83C\uDFAF Why This Matters"),React.createElement("p",{className:"text-slate-300 text-sm leading-relaxed"},selectedTutorial.content.whyItMatters)),selectedTutorial.content.practicalTip&&React.createElement("div",{className:"glass p-4 rounded-lg border border-yellow-500/20"},React.createElement("h4",{className:"font-semibold text-yellow-300 mb-2"},"\u26A1 Practical Tip"),React.createElement("p",{className:"text-slate-300 text-sm leading-relaxed"},selectedTutorial.content.practicalTip)),selectedTutorial.content.nextSteps&&React.createElement("div",null,React.createElement("h4",{className:"font-semibold text-white mb-2"},"Next Steps"),React.createElement("div",{className:"flex flex-wrap gap-2"},selectedTutorial.content.nextSteps.map((step,i)=>React.createElement("span",{key:i,className:"px-3 py-1 bg-slate-700 text-slate-300 rounded-full text-sm"},step))))),React.createElement("div",{className:"mt-6 flex gap-3"},React.createElement("button",{onClick:()=>{EDUCATION_CENTER.markComplete(userId,selectedTutorial.id);setSelectedTutorial(null);},className:"flex-1 py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg font-semibold transition"},React.createElement("i",{className:"fas fa-check mr-2"}),"Mark Complete"),React.createElement("button",{onClick:()=>setSelectedTutorial(null),className:"px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold transition"},"Close"))));}if(selectedCaseStudy){return React.createElement("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"glass-card rounded-2xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("button",{onClick:()=>setSelectedCaseStudy(null),className:"text-cyan-400 hover:text-cyan-300 flex items-center gap-2"},React.createElement("i",{className:"fas fa-arrow-left"})," Back"),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white"},React.createElement("i",{className:"fas fa-times text-xl"}))),React.createElement("div",{className:"mb-6"},React.createElement("div",{className:"text-5xl mb-3"},selectedCaseStudy.icon),React.createElement("h2",{className:"text-2xl font-bold text-white mb-2"},selectedCaseStudy.title),React.createElement("div",{className:"flex items-center gap-3 text-sm text-slate-400 mb-3"},React.createElement("span",{className:"font-semibold"},selectedCaseStudy.investor),React.createElement("span",null,"\u2022"),React.createElement("span",null,selectedCaseStudy.year)),React.createElement("p",{className:"text-cyan-300 font-medium"},selectedCaseStudy.summary)),React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"glass p-4 rounded-lg border border-slate-700"},React.createElement("h3",{className:"font-semibold text-white mb-2"},"\uD83D\uDCD6 The Story"),React.createElement("p",{className:"text-slate-300 leading-relaxed"},selectedCaseStudy.story)),React.createElement("div",null,React.createElement("h3",{className:"text-lg font-semibold text-white mb-3"},"Key Lessons"),React.createElement("ul",{className:"space-y-2"},selectedCaseStudy.keyLessons.map((lesson,i)=>React.createElement("li",{key:i,className:"flex items-start gap-3 text-slate-300"},React.createElement("span",{className:"text-yellow-400 font-bold"},i+1,"."),React.createElement("span",null,lesson))))),React.createElement("div",{className:"glass p-4 rounded-lg border border-emerald-500/20"},React.createElement("h3",{className:"font-semibold text-emerald-300 mb-3"},"\uD83D\uDCCA The Numbers"),React.createElement("div",{className:"grid grid-cols-2 gap-4"},Object.entries(selectedCaseStudy.metrics).map(_ref9=>{let[key,value]=_ref9;return React.createElement("div",{key:key},React.createElement("div",{className:"text-slate-400 text-xs uppercase tracking-wide mb-1"},key.replace(/([A-Z])/g,' $1').trim()),React.createElement("div",{className:"text-white font-semibold"},value));}))),React.createElement("div",{className:"glass p-4 rounded-lg border border-purple-500/20 bg-gradient-to-br from-purple-500/5 to-pink-500/5"},React.createElement("h4",{className:"font-semibold text-purple-300 mb-2"},"\uD83D\uDC8E Key Takeaway"),React.createElement("p",{className:"text-white leading-relaxed"},selectedCaseStudy.takeaway))),React.createElement("button",{onClick:()=>setSelectedCaseStudy(null),className:"mt-6 w-full py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold transition"},"Close")));}return React.createElement("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"},React.createElement("div",{className:"glass-card rounded-2xl p-6 w-full max-w-5xl max-h-[90vh] overflow-y-auto"},React.createElement("div",{className:"flex items-center justify-between mb-6"},React.createElement("div",null,React.createElement("h2",{className:"text-2xl font-bold text-white mb-1"},"\uD83D\uDCDA Education Center"),React.createElement("p",{className:"text-slate-400 text-sm"},"Learn investing from the ground up")),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white"},React.createElement("i",{className:"fas fa-times text-xl"}))),React.createElement("div",{className:"mb-6 glass p-4 rounded-lg"},React.createElement("div",{className:"flex items-center justify-between mb-2"},React.createElement("span",{className:"text-sm text-slate-400"},"Your Progress"),React.createElement("span",{className:"text-sm font-semibold text-cyan-300"},completionRate,"%")),React.createElement("div",{className:"w-full h-2 bg-slate-700 rounded-full overflow-hidden"},React.createElement("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-emerald-500 transition-all duration-500",style:{width:`${completionRate}%`}})),React.createElement("div",{className:"mt-2 text-xs text-slate-500"},progress.completed.length," of ",EDUCATION_CENTER.tutorials.length," tutorials completed")),React.createElement("div",{className:"flex gap-2 mb-6 border-b border-slate-700"},React.createElement("button",{onClick:()=>setSelectedTab('tutorials'),className:`px-4 py-2 font-semibold transition ${selectedTab==='tutorials'?'text-cyan-400 border-b-2 border-cyan-400':'text-slate-400 hover:text-white'}`},React.createElement("i",{className:"fas fa-book mr-2"}),"Tutorials"),React.createElement("button",{onClick:()=>setSelectedTab('case-studies'),className:`px-4 py-2 font-semibold transition ${selectedTab==='case-studies'?'text-cyan-400 border-b-2 border-cyan-400':'text-slate-400 hover:text-white'}`},React.createElement("i",{className:"fas fa-trophy mr-2"}),"Case Studies")),selectedTab==='tutorials'&&React.createElement("div",null,categories.map(category=>{const tutorials=EDUCATION_CENTER.getTutorialsByCategory(category.id);return React.createElement("div",{key:category.id,className:"mb-6"},React.createElement("h3",{className:"text-lg font-semibold text-white mb-3 flex items-center gap-2"},React.createElement("span",null,category.icon),React.createElement("span",null,category.name)),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},tutorials.map(tutorial=>{const isCompleted=progress.completed.includes(tutorial.id);const inProgress=progress.inProgress.includes(tutorial.id);return React.createElement("div",{key:tutorial.id,onClick:()=>{if(!isCompleted&&!inProgress){EDUCATION_CENTER.markInProgress(userId,tutorial.id);}setSelectedTutorial(tutorial);},className:"glass-card p-4 rounded-lg cursor-pointer hover:border-cyan-500/40 transition"},React.createElement("div",{className:"flex items-start justify-between mb-2"},React.createElement("span",{className:"text-3xl"},tutorial.icon),isCompleted&&React.createElement("span",{className:"px-2 py-1 bg-emerald-500/20 text-emerald-300 rounded text-xs font-semibold"},React.createElement("i",{className:"fas fa-check mr-1"}),"Done"),inProgress&&!isCompleted&&React.createElement("span",{className:"px-2 py-1 bg-yellow-500/20 text-yellow-300 rounded text-xs font-semibold"},React.createElement("i",{className:"fas fa-hourglass-half mr-1"}),"In Progress")),React.createElement("h4",{className:"font-semibold text-white mb-1"},tutorial.title),React.createElement("p",{className:"text-xs text-slate-400 mb-2"},React.createElement("i",{className:"fas fa-clock mr-1"}),tutorial.duration));})));})),selectedTab==='case-studies'&&React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},EDUCATION_CENTER.caseStudies.map(caseStudy=>React.createElement("div",{key:caseStudy.id,onClick:()=>setSelectedCaseStudy(caseStudy),className:"glass-card p-5 rounded-lg cursor-pointer hover:border-cyan-500/40 transition"},React.createElement("div",{className:"text-4xl mb-3"},caseStudy.icon),React.createElement("h3",{className:"font-semibold text-white mb-1"},caseStudy.title),React.createElement("div",{className:"text-xs text-slate-400 mb-2"},caseStudy.investor," \u2022 ",caseStudy.year),React.createElement("p",{className:"text-sm text-slate-300 leading-relaxed"},caseStudy.summary))))));}function AdvancedChartPanel(_ref0){let{symbol,candles,timeframe,onTimeframe,comparisonSymbol,onComparisonSymbol,comparisonCandles,comparisonLoading}=_ref0;const priceRef=useRef(null);const rsiRef=useRef(null);const macdRef=useRef(null);const chartsRef=useRef({price:null,rsi:null,macd:null});const seriesRef=useRef({candle:null,volume:null,bbUpper:null,bbMid:null,bbLower:null,compare:null,rsi:null,macd:null,macdSignal:null,macdHist:null,drawings:[]});const drawStateRef=useRef({enabled:false,firstPoint:null});const[showBollinger,setShowBollinger]=useState(true);const[showRSI,setShowRSI]=useState(true);const[showMACD,setShowMACD]=useState(true);const[showVolume,setShowVolume]=useState(true);const[drawMode,setDrawMode]=useState(false);const normalized=useMemo(()=>normalizeFmpCandles(candles),[candles]);const profile=useMemo(()=>computeVolumeProfile(normalized,24),[normalized]);const setDrawEnabled=enabled=>{setDrawMode(enabled);drawStateRef.current.enabled=enabled;drawStateRef.current.firstPoint=null;};const clearDrawings=()=>{const priceChart=chartsRef.current.price;if(!priceChart)return;for(const s of seriesRef.current.drawings){try{priceChart.removeSeries(s);}catch{}}seriesRef.current.drawings=[];drawStateRef.current.firstPoint=null;};useEffect(()=>{if(!window.LightweightCharts){console.warn('‚ö†Ô∏è LightweightCharts not available');return;}if(!priceRef.current)return;if(!normalized||normalized.length===0)return;if(!window.LightweightCharts){console.error('‚ùå Lightweight Charts library not loaded');return;}try{chartsRef.current.price?.remove();}catch{}try{chartsRef.current.rsi?.remove();}catch{}try{chartsRef.current.macd?.remove();}catch{}chartsRef.current={price:null,rsi:null,macd:null};seriesRef.current.drawings=[];drawStateRef.current.firstPoint=null;const rootStyles=getComputedStyle(document.documentElement);const textSecondary=(rootStyles.getPropertyValue('--text-secondary')||'#94a3b8').trim();const common={layout:{background:{type:'solid',color:'transparent'},textColor:textSecondary},grid:{vertLines:{color:'rgba(148, 163, 184, 0.08)'},horzLines:{color:'rgba(148, 163, 184, 0.08)'}},timeScale:{borderColor:'rgba(148, 163, 184, 0.15)'},rightPriceScale:{borderColor:'rgba(148, 163, 184, 0.15)'},crosshair:{mode:window.LightweightCharts.CrosshairMode.Normal}};const priceChart=window.LightweightCharts.createChart(priceRef.current,{...common,height:360});chartsRef.current.price=priceChart;const candleSeries=priceChart.addCandlestickSeries({upColor:'#22c55e',downColor:'#ef4444',borderUpColor:'#22c55e',borderDownColor:'#ef4444',wickUpColor:'#22c55e',wickDownColor:'#ef4444'});seriesRef.current.candle=candleSeries;candleSeries.setData(normalized);const closes=normalized.map(c=>c.close);const times=normalized.map(c=>c.time);const volumeSeries=priceChart.addHistogramSeries({priceFormat:{type:'volume'},priceScaleId:'',scaleMargins:{top:0.8,bottom:0}});seriesRef.current.volume=volumeSeries;if(showVolume){volumeSeries.setData(normalized.map(c=>({time:c.time,value:c.volume,color:c.close>=c.open?'rgba(34,197,94,0.45)':'rgba(239,68,68,0.45)'})));}else{volumeSeries.setData([]);}const bbUpper=priceChart.addLineSeries({color:'rgba(148,163,184,0.55)',lineWidth:1});const bbMid=priceChart.addLineSeries({color:'rgba(6,182,212,0.65)',lineWidth:1});const bbLower=priceChart.addLineSeries({color:'rgba(148,163,184,0.55)',lineWidth:1});seriesRef.current.bbUpper=bbUpper;seriesRef.current.bbMid=bbMid;seriesRef.current.bbLower=bbLower;if(showBollinger){const bb=computeBollinger(closes,20,2);bbUpper.setData(times.map((t,i)=>bb.upper[i]==null?null:{time:t,value:bb.upper[i]}).filter(Boolean));bbMid.setData(times.map((t,i)=>bb.mid[i]==null?null:{time:t,value:bb.mid[i]}).filter(Boolean));bbLower.setData(times.map((t,i)=>bb.lower[i]==null?null:{time:t,value:bb.lower[i]}).filter(Boolean));}else{bbUpper.setData([]);bbMid.setData([]);bbLower.setData([]);}if(comparisonCandles&&comparisonCandles.length>0){const cmp=normalizeFmpCandles(comparisonCandles);if(cmp.length>2){const base=cmp[0].close||1;const compareSeries=priceChart.addLineSeries({color:'rgba(139,92,246,0.85)',lineWidth:2,priceScaleId:'compare'});priceChart.priceScale('compare').applyOptions({scaleMargins:{top:0.1,bottom:0.1},borderVisible:false});compareSeries.setData(cmp.map(p=>({time:p.time,value:(p.close-base)/base*100})));seriesRef.current.compare=compareSeries;}}let rsiChart=null;if(showRSI&&rsiRef.current){rsiChart=window.LightweightCharts.createChart(rsiRef.current,{...common,height:140,timeScale:{visible:false}});chartsRef.current.rsi=rsiChart;const rsiSeries=rsiChart.addLineSeries({color:'rgba(6,182,212,0.85)',lineWidth:2});seriesRef.current.rsi=rsiSeries;const rsiVals=computeRSI(closes,14);rsiSeries.setData(times.map((t,i)=>rsiVals[i]==null?null:{time:t,value:rsiVals[i]}).filter(Boolean));}let macdChart=null;if(showMACD&&macdRef.current){macdChart=window.LightweightCharts.createChart(macdRef.current,{...common,height:160,timeScale:{visible:true}});chartsRef.current.macd=macdChart;const macdLine=macdChart.addLineSeries({color:'rgba(6,182,212,0.85)',lineWidth:2});const signalLine=macdChart.addLineSeries({color:'rgba(148,163,184,0.75)',lineWidth:1});const histSeries=macdChart.addHistogramSeries({priceFormat:{type:'price'}});seriesRef.current.macd=macdLine;seriesRef.current.macdSignal=signalLine;seriesRef.current.macdHist=histSeries;const macd=computeMACD(closes,12,26,9);macdLine.setData(times.map((t,i)=>macd.macd[i]==null?null:{time:t,value:macd.macd[i]}).filter(Boolean));signalLine.setData(times.map((t,i)=>macd.signal[i]==null?null:{time:t,value:macd.signal[i]}).filter(Boolean));histSeries.setData(times.map((t,i)=>{const v=macd.hist[i];if(v==null)return null;return{time:t,value:v,color:v>=0?'rgba(34,197,94,0.55)':'rgba(239,68,68,0.55)'};}).filter(Boolean));}const syncRange=(source,target)=>{if(!source||!target)return()=>{};const handler=range=>{try{target.timeScale().setVisibleRange(range);}catch{}};source.timeScale().subscribeVisibleTimeRangeChange(handler);return()=>source.timeScale().unsubscribeVisibleTimeRangeChange(handler);};const unsub1=syncRange(priceChart,rsiChart);const unsub2=syncRange(priceChart,macdChart);const clickHandler=param=>{if(!drawStateRef.current.enabled)return;if(!param||!param.time)return;const seriesData=param.seriesData;let price=null;try{if(seriesData&&seriesData.get&&seriesRef.current.candle){const p=seriesData.get(seriesRef.current.candle);price=p?.close??p?.value??p?.open??null;}}catch{}if(price==null)return;if(!drawStateRef.current.firstPoint){drawStateRef.current.firstPoint={time:param.time,value:price};return;}const p1=drawStateRef.current.firstPoint;const p2={time:param.time,value:price};drawStateRef.current.firstPoint=null;const line=priceChart.addLineSeries({color:'rgba(6,182,212,0.75)',lineWidth:2});line.setData([p1,p2].sort((a,b)=>a.time-b.time));seriesRef.current.drawings.push(line);};priceChart.subscribeClick(clickHandler);const ro=new ResizeObserver(entries=>{for(const e of entries){const w=Math.floor(e.contentRect.width);try{priceChart.applyOptions({width:w});}catch{}try{rsiChart?.applyOptions({width:w});}catch{}try{macdChart?.applyOptions({width:w});}catch{}}});ro.observe(priceRef.current);return()=>{try{priceChart.unsubscribeClick(clickHandler);}catch{}unsub1();unsub2();try{ro.disconnect();}catch{}try{priceChart.remove();}catch{}try{rsiChart?.remove();}catch{}try{macdChart?.remove();}catch{}};},[normalized,showBollinger,showRSI,showMACD,showVolume,comparisonCandles]);return React.createElement("div",{className:"space-y-4"},!window.LightweightCharts&&React.createElement("div",{className:"glass-card p-4 rounded-xl border border-yellow-500/30 bg-yellow-500/10"},React.createElement("div",{className:"text-yellow-300 font-semibold text-sm mb-1"},"Chart library failed to load"),React.createElement("div",{className:"text-xs text-slate-300"},"The Lightweight Charts script didn\u2019t load (network blocked or CDN unavailable). Refresh the page or try a different network.")),window.LightweightCharts&&(!normalized||normalized.length===0)&&React.createElement("div",{className:"glass-card p-4 rounded-xl border border-slate-700/40"},React.createElement("div",{className:"text-slate-200 font-semibold text-sm mb-1"},"No chart candles available"),React.createElement("div",{className:"text-xs text-slate-400"},"This usually means the API returned no candles for the selected timeframe, or the timestamps were not parseable.")),React.createElement("div",{className:"flex flex-wrap items-center justify-between gap-3"},React.createElement("div",{className:"flex items-center gap-2 flex-wrap"},React.createElement("div",{className:"text-xs text-slate-500"},"Timeframe"),[{id:'1hour',label:'1H'},{id:'4hour',label:'4H'},{id:'1day',label:'1D'}].map(tf=>React.createElement("button",{key:tf.id,onClick:()=>onTimeframe(tf.id),className:`px-3 py-1 rounded-lg text-xs font-semibold border transition ${timeframe===tf.id?'bg-cyan-500/20 text-cyan-300 border-cyan-500/30':'bg-slate-800/40 text-slate-300 border-slate-700/30 hover:bg-slate-700/30'}`},tf.label)),React.createElement("div",{className:"w-px h-6 bg-slate-700/40 mx-1"}),React.createElement("button",{onClick:()=>setShowBollinger(v=>!v),className:`px-3 py-1 rounded-lg text-xs font-semibold border transition ${showBollinger?'bg-slate-700/40 text-slate-100 border-slate-600/40':'bg-slate-800/40 text-slate-400 border-slate-700/30'}`},"Bollinger"),React.createElement("button",{onClick:()=>setShowRSI(v=>!v),className:`px-3 py-1 rounded-lg text-xs font-semibold border transition ${showRSI?'bg-slate-700/40 text-slate-100 border-slate-600/40':'bg-slate-800/40 text-slate-400 border-slate-700/30'}`},"RSI"),React.createElement("button",{onClick:()=>setShowMACD(v=>!v),className:`px-3 py-1 rounded-lg text-xs font-semibold border transition ${showMACD?'bg-slate-700/40 text-slate-100 border-slate-600/40':'bg-slate-800/40 text-slate-400 border-slate-700/30'}`},"MACD"),React.createElement("button",{onClick:()=>setShowVolume(v=>!v),className:`px-3 py-1 rounded-lg text-xs font-semibold border transition ${showVolume?'bg-slate-700/40 text-slate-100 border-slate-600/40':'bg-slate-800/40 text-slate-400 border-slate-700/30'}`},"Volume")),React.createElement("div",{className:"flex items-center gap-2 flex-wrap"},React.createElement("div",{className:"text-xs text-slate-500"},"Compare"),React.createElement("input",{value:comparisonSymbol,onChange:e=>onComparisonSymbol(e.target.value.toUpperCase().replace(/[^A-Z.]/g,'').slice(0,10)),placeholder:"e.g. SPY",className:"px-3 py-1 rounded-lg text-xs bg-slate-900/40 border border-slate-700/40 text-slate-200 w-28"}),comparisonLoading&&React.createElement("span",{className:"text-xs text-slate-500"},"Loading\u2026"),React.createElement("div",{className:"w-px h-6 bg-slate-700/40 mx-1"}),React.createElement("button",{onClick:()=>setDrawEnabled(!drawMode),className:`px-3 py-1 rounded-lg text-xs font-semibold border transition ${drawMode?'bg-cyan-500/20 text-cyan-300 border-cyan-500/30':'bg-slate-800/40 text-slate-300 border-slate-700/30 hover:bg-slate-700/30'}`},drawMode?'Drawing: ON':'Draw Trendline'),React.createElement("button",{onClick:clearDrawings,className:"px-3 py-1 rounded-lg text-xs font-semibold border border-slate-700/30 bg-slate-800/40 text-slate-300 hover:bg-slate-700/30"},"Clear"))),React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-4"},React.createElement("div",{className:"lg:col-span-4 space-y-3"},React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{ref:priceRef,style:{width:'100%'}})),showRSI&&React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"RSI (14)"),React.createElement("div",{ref:rsiRef,style:{width:'100%'}})),showMACD&&React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"MACD (12, 26, 9)"),React.createElement("div",{ref:macdRef,style:{width:'100%'}}))),React.createElement("div",{className:"lg:col-span-1"},React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",null,React.createElement("div",{className:"text-sm font-bold text-white"},"Volume Profile"),React.createElement("div",{className:"text-xs text-slate-500"},"Approx. by typical price"))),profile.length===0?React.createElement("div",{className:"text-sm text-slate-500"},"Not enough data"):React.createElement("div",{className:"space-y-1"},profile.slice(0,18).map((b,idx)=>React.createElement("div",{key:idx,className:"flex items-center gap-2"},React.createElement("div",{className:"text-[10px] text-slate-500 w-16 font-mono"},b.lo.toFixed(0),"-",b.hi.toFixed(0)),React.createElement("div",{className:"flex-1 h-2 bg-slate-800/40 rounded overflow-hidden"},React.createElement("div",{className:"h-full bg-slate-500/50",style:{width:`${Math.max(2,Math.min(100,b.pct))}%`}}))))),React.createElement("div",{className:"mt-3 text-[10px] text-slate-500"},comparisonSymbol?`Compare overlay: ${comparisonSymbol}`:'Add a comparison symbol to overlay % change.')))));}class UltimateAnalysisEngine{constructor(){this.cache=new Map();this.cacheDuration=300000;}calculateUltimateScore(stock){const factors={};let totalScore=0;let maxScore=0;if(stock.rsi){maxScore+=15;const rsi=parseFloat(stock.rsi);if(rsi>=40&&rsi<=60){factors.rsi=15;}else if(rsi>=30&&rsi<=70){factors.rsi=10;}else if(rsi<30){factors.rsi=12;}else{factors.rsi=5;}totalScore+=factors.rsi;}if(stock.macd||stock.macdHistogram){maxScore+=10;const macd=parseFloat(stock.macd||stock.macdHistogram||0);if(macd>0){factors.macd=10;}else if(macd>-0.5){factors.macd=7;}else{factors.macd=3;}totalScore+=factors.macd;}if(stock.sma20&&stock.sma50){maxScore+=12;const price=parseFloat(stock.price);const sma20=parseFloat(stock.sma20);const sma50=parseFloat(stock.sma50);if(price>sma20&&sma20>sma50){factors.trend=12;}else if(price>sma20||sma20>sma50){factors.trend=8;}else{factors.trend=3;}totalScore+=factors.trend;}if(stock.volume&&stock.avgVolume){maxScore+=10;const volumeRatio=parseFloat(stock.volume)/parseFloat(stock.avgVolume);if(volumeRatio>2.0){factors.volume=10;}else if(volumeRatio>1.5){factors.volume=8;}else if(volumeRatio>1.0){factors.volume=5;}else{factors.volume=2;}totalScore+=factors.volume;}if(stock.pe){maxScore+=8;const pe=parseFloat(stock.pe);if(pe>0&&pe<15){factors.valuation=8;}else if(pe>=15&&pe<25){factors.valuation=6;}else if(pe>=25&&pe<40){factors.valuation=4;}else{factors.valuation=2;}totalScore+=factors.valuation;}if(stock.roe){maxScore+=8;const roe=parseFloat(stock.roe);if(roe>20){factors.profitability=8;}else if(roe>15){factors.profitability=6;}else if(roe>10){factors.profitability=4;}else{factors.profitability=2;}totalScore+=factors.profitability;}if(stock.revenueGrowth||stock.epsGrowth){maxScore+=10;const growth=Math.max(parseFloat(stock.revenueGrowth||0),parseFloat(stock.epsGrowth||0));if(growth>20){factors.growth=10;}else if(growth>10){factors.growth=7;}else if(growth>5){factors.growth=4;}else{factors.growth=2;}totalScore+=factors.growth;}if(stock.debtToEquity!==undefined){maxScore+=8;const dte=parseFloat(stock.debtToEquity);if(dte<0.5){factors.health=8;}else if(dte<1.0){factors.health=6;}else if(dte<2.0){factors.health=4;}else{factors.health=2;}totalScore+=factors.health;}if(stock.changePct!==undefined){maxScore+=7;const change=parseFloat(stock.changePct);if(change>5){factors.momentum=7;}else if(change>2){factors.momentum=5;}else if(change>0){factors.momentum=3;}else if(change>-2){factors.momentum=2;}else{factors.momentum=1;}totalScore+=factors.momentum;}if(stock.beta){maxScore+=6;const beta=Math.abs(parseFloat(stock.beta));if(beta<0.8){factors.volatility=6;}else if(beta<1.2){factors.volatility=4;}else{factors.volatility=2;}totalScore+=factors.volatility;}if(stock.marketCap){maxScore+=6;const mcap=parseFloat(stock.marketCap);if(mcap>200e9){factors.market_pos=6;}else if(mcap>10e9){factors.market_pos=5;}else if(mcap>2e9){factors.market_pos=4;}else{factors.market_pos=3;}totalScore+=factors.market_pos;}if(stock.analystRating||stock.rating){maxScore+=5;const rating=stock.analystRating||stock.rating||'';if(rating.toLowerCase().includes('strong buy')||rating.toLowerCase().includes('buy')){factors.analyst=5;}else if(rating.toLowerCase().includes('hold')){factors.analyst=3;}else{factors.analyst=1;}totalScore+=factors.analyst;}if(stock.week52High&&stock.price){maxScore+=5;const distanceFrom52wHigh=(parseFloat(stock.price)-parseFloat(stock.week52High))/parseFloat(stock.week52High)*100;if(distanceFrom52wHigh>-5){factors.price_pos=5;}else if(distanceFrom52wHigh>-15){factors.price_pos=4;}else if(distanceFrom52wHigh>-30){factors.price_pos=3;}else{factors.price_pos=2;}totalScore+=factors.price_pos;}if(stock.dividendYield){maxScore+=4;const divYield=parseFloat(stock.dividendYield);if(divYield>3){factors.dividend=4;}else if(divYield>2){factors.dividend=3;}else if(divYield>1){factors.dividend=2;}else{factors.dividend=1;}totalScore+=factors.dividend;}if(stock.institutionalOwnership){maxScore+=6;const instOwn=parseFloat(stock.institutionalOwnership);if(instOwn>70){factors.institutional=6;}else if(instOwn>50){factors.institutional=5;}else if(instOwn>30){factors.institutional=4;}else{factors.institutional=2;}totalScore+=factors.institutional;}const normalizedScore=maxScore>0?Math.round(totalScore/maxScore*100):0;return{score:normalizedScore,factors:factors,totalPoints:totalScore,maxPoints:maxScore,confidence:maxScore>80?'High':maxScore>50?'Medium':'Low'};}generateTradingPlan(stock,scoreData){const price=parseFloat(stock.price);const atr=stock.atr?parseFloat(stock.atr):price*0.02;const signal=this.determineSignal(stock,scoreData);let plan={signal:signal,entry:price,target:0,stopLoss:0,positionSize:'2-5%',timeframe:'Medium-term (2-8 weeks)',confidence:scoreData.confidence,reasoning:[]};if(signal==='BUY'){const targetMultiplier=1+scoreData.score/1000+0.05;plan.target=price*targetMultiplier;plan.stopLoss=price-2*atr;if(stock.rsi&&parseFloat(stock.rsi)<35){plan.reasoning.push('Oversold RSI indicates potential bounce');}if(scoreData.factors.volume&&scoreData.factors.volume>=8){plan.reasoning.push('Strong volume surge suggests institutional interest');}if(scoreData.factors.trend&&scoreData.factors.trend>=10){plan.reasoning.push('Golden cross formation supports bullish trend');}if(scoreData.factors.growth&&scoreData.factors.growth>=7){plan.reasoning.push('Strong growth metrics indicate expansion');}}else if(signal==='SELL'){plan.target=price*0.95;plan.stopLoss=price*1.05;if(stock.rsi&&parseFloat(stock.rsi)>70){plan.reasoning.push('Overbought RSI suggests potential correction');}if(scoreData.score<40){plan.reasoning.push('Low overall score indicates weakness');}}else{plan.target=price*1.05;plan.stopLoss=price*0.95;plan.reasoning.push('Mixed signals - monitor for clearer direction');}plan.riskRewardRatio=plan.stopLoss!==price?((plan.target-price)/(price-plan.stopLoss)).toFixed(2):0;return plan;}determineSignal(stock,scoreData){const score=scoreData.score;const rsi=stock.rsi?parseFloat(stock.rsi):50;const macd=stock.macd?parseFloat(stock.macd):0;if(score>=75&&rsi<70&&macd>0){return'STRONG BUY';}if(score>=60||rsi<35&&score>=50){return'BUY';}if(score<35||rsi>75&&score<60){return'SELL';}return'HOLD';}detectPatterns(stock){const patterns=[];if(stock.sma20&&stock.sma50){const price=parseFloat(stock.price);const sma20=parseFloat(stock.sma20);const sma50=parseFloat(stock.sma50);if(sma20>sma50&&price>sma20){patterns.push({name:'Golden Cross',type:'bullish',confidence:0.80,description:'20-day MA crossed above 50-day MA - bullish momentum'});}else if(sma20<sma50&&price<sma20){patterns.push({name:'Death Cross',type:'bearish',confidence:0.75,description:'20-day MA crossed below 50-day MA - bearish momentum'});}}if(stock.rsi){const rsi=parseFloat(stock.rsi);if(rsi<30){patterns.push({name:'Oversold',type:'bullish',confidence:0.70,description:'RSI below 30 - potential bounce opportunity'});}else if(rsi>70){patterns.push({name:'Overbought',type:'bearish',confidence:0.70,description:'RSI above 70 - potential correction incoming'});}}if(stock.volume&&stock.avgVolume){const volumeRatio=parseFloat(stock.volume)/parseFloat(stock.avgVolume);if(volumeRatio>2.0){patterns.push({name:'Volume Surge',type:'bullish',confidence:0.65,description:'Volume 2x above average - institutional interest'});}}if(stock.bollingerUpper&&stock.bollingerLower&&stock.price){const price=parseFloat(stock.price);const upper=parseFloat(stock.bollingerUpper);const lower=parseFloat(stock.bollingerLower);if(price<=lower){patterns.push({name:'Bollinger Bounce',type:'bullish',confidence:0.68,description:'Price at lower Bollinger Band - potential bounce'});}else if(price>=upper){patterns.push({name:'Bollinger Squeeze',type:'bearish',confidence:0.68,description:'Price at upper Bollinger Band - potential pullback'});}}return patterns;}generateAIInsights(stock,scoreData,patterns,tradingPlan){const insights={summary:'',strengths:[],risks:[],opportunities:[],recommendation:''};insights.summary=`${stock.symbol} scores ${scoreData.score}/100 with a ${tradingPlan.signal} signal. `;if(scoreData.score>=70){insights.summary+='Strong fundamentals and technical setup. ';}else if(scoreData.score>=50){insights.summary+='Moderate quality with mixed signals. ';}else{insights.summary+='Weak metrics indicate caution. ';}if(scoreData.factors.trend&&scoreData.factors.trend>=10){insights.strengths.push('Bullish trend confirmed by moving averages');}if(scoreData.factors.volume&&scoreData.factors.volume>=8){insights.strengths.push('Strong volume supports price movement');}if(scoreData.factors.growth&&scoreData.factors.growth>=7){insights.strengths.push('Solid revenue and earnings growth');}if(scoreData.factors.profitability&&scoreData.factors.profitability>=6){insights.strengths.push('High return on equity indicates efficiency');}if(stock.rsi&&parseFloat(stock.rsi)>70){insights.risks.push('Overbought conditions may lead to correction');}if(stock.debtToEquity&&parseFloat(stock.debtToEquity)>2.0){insights.risks.push('High debt levels increase financial risk');}if(stock.beta&&Math.abs(parseFloat(stock.beta))>1.5){insights.risks.push('High volatility stock - expect sharp moves');}if(scoreData.factors.valuation&&scoreData.factors.valuation<=4){insights.risks.push('Expensive valuation may limit upside');}if(stock.rsi&&parseFloat(stock.rsi)<35){insights.opportunities.push('Oversold bounce play if fundamentals hold');}if(patterns.some(p=>p.type==='bullish'&&p.confidence>0.7)){insights.opportunities.push('Bullish chart patterns forming');}if(scoreData.factors.price_pos&&scoreData.factors.price_pos<=3){insights.opportunities.push('Trading well below 52-week high - recovery potential');}if(tradingPlan.signal==='STRONG BUY'||tradingPlan.signal==='BUY'){insights.recommendation=`Consider ${tradingPlan.positionSize} position. Entry: $${tradingPlan.entry.toFixed(2)}, Target: $${tradingPlan.target.toFixed(2)}, Stop: $${tradingPlan.stopLoss.toFixed(2)}. Risk/Reward: ${tradingPlan.riskRewardRatio}:1`;}else if(tradingPlan.signal==='HOLD'){insights.recommendation='Wait for clearer signals. Monitor key levels and upcoming catalysts.';}else{insights.recommendation='Avoid or exit position. Consider better opportunities.';}return insights;}}const ultimateEngine=new UltimateAnalysisEngine();window.ultimateEngine=ultimateEngine;class OracleAnalyzer{constructor(){this.baseUrl='http://localhost:3002/api/oracle';this.eventSources={};}async startAnalysis(symbol){try{const response=await fetch(`${this.baseUrl}/analyze`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({symbol})});if(!response.ok){throw new Error(`API error: ${response.status}`);}const data=await response.json();return data;}catch(error){console.error('The Oracle analysis error:',error);throw error;}}subscribeToProgress(symbol,onUpdate,onComplete,onError){const eventSource=new EventSource(`${this.baseUrl}/progress/${symbol}`);this.eventSources[symbol]=eventSource;eventSource.onmessage=event=>{try{const data=JSON.parse(event.data);if(data.type==='complete'){onComplete(data.result);eventSource.close();delete this.eventSources[symbol];}else if(data.type==='error'){onError(data.error);eventSource.close();delete this.eventSources[symbol];}else if(data.type!=='ping'&&data.type!=='connected'){onUpdate(data);}}catch(e){console.error('Error parsing SSE data:',e);}};eventSource.onerror=error=>{console.error('SSE connection error:',error);onError('Connection lost to analysis server');eventSource.close();delete this.eventSources[symbol];};return()=>{eventSource.close();delete this.eventSources[symbol];};}async getCachedResult(symbol){try{const response=await fetch(`${this.baseUrl}/result/${symbol}`);if(!response.ok)return null;const data=await response.json();return data.result;}catch(error){return null;}}async listCachedAnalyses(){try{const response=await fetch(`${this.baseUrl}/cache`);if(!response.ok)return[];const data=await response.json();return data.cached_analyses||[];}catch(error){return[];}}}const oracleAnalyzer=new OracleAnalyzer();function OracleAnalysisModal(_ref1){let{stock,onClose}=_ref1;const[analysisState,setAnalysisState]=React.useState('idle');const[progressUpdates,setProgressUpdates]=React.useState([]);const[result,setResult]=React.useState(null);const[error,setError]=React.useState(null);const[cachedResult,setCachedResult]=React.useState(null);React.useEffect(()=>{oracleAnalyzer.getCachedResult(stock.symbol).then(cached=>{if(cached){setCachedResult(cached);}});},[stock.symbol]);const startAnalysis=async()=>{try{setAnalysisState('loading');setProgressUpdates([]);setError(null);const startResponse=await oracleAnalyzer.startAnalysis(stock.symbol);if(startResponse.status==='cached'){setResult(startResponse.result);setAnalysisState('complete');return;}setAnalysisState('analyzing');oracleAnalyzer.subscribeToProgress(stock.symbol,update=>{setProgressUpdates(prev=>[...prev,update]);},finalResult=>{setResult(finalResult);setAnalysisState('complete');},errorMsg=>{setError(errorMsg);setAnalysisState('error');});}catch(err){setError(err.message);setAnalysisState('error');}};const getAgentIcon=agent=>{const icons={'financial_news_analyst':'üì∞','technical_analysis_specialist':'üìä','fundamental_analysis_expert':'üí∞','investment_opportunity_strategist':'üéØ','system':'‚öôÔ∏è'};return icons[agent]||'ü§ñ';};const getAgentName=agent=>{const names={'financial_news_analyst':'Financial News Analyst','technical_analysis_specialist':'Technical Analysis Specialist','fundamental_analysis_expert':'Fundamental Analysis Expert','investment_opportunity_strategist':'Investment Opportunity Strategist','system':'System'};return names[agent]||agent;};return React.createElement("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fadeIn"},React.createElement("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl shadow-2xl border border-cyan-500/20 max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col"},React.createElement("div",{className:"p-6 border-b border-slate-700/50 flex items-center justify-between bg-gradient-to-r from-slate-800 to-slate-900"},React.createElement("div",null,React.createElement("h2",{className:"text-2xl font-bold text-white flex items-center gap-3"},React.createElement("span",{className:"text-3xl"},"\uD83E\uDD16"),"Multi-Agent AI Analysis"),React.createElement("p",{className:"text-slate-400 mt-1"},stock.symbol," - ",stock.companyName||stock.symbol)),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white transition-colors p-2 hover:bg-slate-700/50 rounded-lg"},React.createElement("i",{className:"fas fa-times text-xl"}))),React.createElement("div",{className:"flex-1 overflow-y-auto p-6 space-y-6"},cachedResult&&analysisState==='idle'&&React.createElement("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4"},React.createElement("div",{className:"flex items-start gap-3"},React.createElement("i",{className:"fas fa-info-circle text-blue-400 text-xl mt-0.5"}),React.createElement("div",{className:"flex-1"},React.createElement("h4",{className:"text-blue-300 font-semibold mb-1"},"Cached Analysis Available"),React.createElement("p",{className:"text-slate-300 text-sm"},"An analysis from ",new Date(cachedResult.timestamp).toLocaleString()," is available. You can view it or run a fresh analysis."),React.createElement("button",{onClick:()=>{setResult(cachedResult);setAnalysisState('complete');},className:"mt-3 px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/40 rounded-lg text-blue-300 text-sm font-medium transition-colors"},"View Cached Analysis")))),analysisState==='idle'&&React.createElement("div",{className:"space-y-4"},React.createElement("p",{className:"text-slate-300 leading-relaxed"},"Launch a comprehensive multi-agent analysis powered by The Oracle. Four specialized AI agents will collaborate to analyze ",stock.symbol,":"),React.createElement("div",{className:"grid gap-3"},React.createElement("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},React.createElement("div",{className:"flex items-center gap-3 mb-2"},React.createElement("span",{className:"text-2xl"},"\uD83D\uDCF0"),React.createElement("h4",{className:"text-white font-semibold"},"Financial News Analyst")),React.createElement("p",{className:"text-slate-400 text-sm"},"Monitors real-time news, sentiment, and market-moving events")),React.createElement("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},React.createElement("div",{className:"flex items-center gap-3 mb-2"},React.createElement("span",{className:"text-2xl"},"\uD83D\uDCCA"),React.createElement("h4",{className:"text-white font-semibold"},"Technical Analysis Specialist")),React.createElement("p",{className:"text-slate-400 text-sm"},"Analyzes charts, patterns, indicators, and technical signals")),React.createElement("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},React.createElement("div",{className:"flex items-center gap-3 mb-2"},React.createElement("span",{className:"text-2xl"},"\uD83D\uDCB0"),React.createElement("h4",{className:"text-white font-semibold"},"Fundamental Analysis Expert")),React.createElement("p",{className:"text-slate-400 text-sm"},"Evaluates financials, valuation, earnings, and intrinsic value")),React.createElement("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},React.createElement("div",{className:"flex items-center gap-3 mb-2"},React.createElement("span",{className:"text-2xl"},"\uD83C\uDFAF"),React.createElement("h4",{className:"text-white font-semibold"},"Investment Opportunity Strategist")),React.createElement("p",{className:"text-slate-400 text-sm"},"Synthesizes all insights into actionable investment recommendations"))),React.createElement("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 mt-4"},React.createElement("div",{className:"flex items-start gap-3"},React.createElement("i",{className:"fas fa-clock text-amber-400 text-lg mt-0.5"}),React.createElement("div",null,React.createElement("p",{className:"text-amber-300 text-sm font-medium"},"Analysis Duration"),React.createElement("p",{className:"text-slate-400 text-sm mt-1"},"This comprehensive analysis typically takes 2-5 minutes as agents research and collaborate."))))),analysisState==='analyzing'&&React.createElement("div",{className:"space-y-3"},React.createElement("div",{className:"flex items-center gap-3 mb-4"},React.createElement("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-cyan-500"}),React.createElement("p",{className:"text-white font-medium"},"Analysis in Progress...")),React.createElement("div",{className:"space-y-2 max-h-96 overflow-y-auto"},progressUpdates.map((update,idx)=>React.createElement("div",{key:idx,className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50 animate-slideInLeft",style:{animationDelay:`${idx*0.1}s`}},React.createElement("div",{className:"flex items-start gap-3"},React.createElement("span",{className:"text-2xl"},getAgentIcon(update.agent)),React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"flex items-center justify-between mb-1"},React.createElement("h4",{className:"text-white font-medium"},getAgentName(update.agent)),React.createElement("span",{className:"text-xs text-slate-500"},new Date(update.timestamp).toLocaleTimeString())),React.createElement("p",{className:"text-slate-300 text-sm"},update.message),update.status&&React.createElement("span",{className:`inline-block mt-2 px-2 py-1 rounded text-xs font-medium ${update.status==='running'?'bg-blue-500/20 text-blue-300':update.status==='complete'?'bg-green-500/20 text-green-300':'bg-slate-500/20 text-slate-300'}`},update.status))))))),analysisState==='complete'&&result&&React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-4"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("i",{className:"fas fa-check-circle text-green-400 text-2xl"}),React.createElement("div",null,React.createElement("h4",{className:"text-green-300 font-semibold"},"Analysis Complete!"),React.createElement("p",{className:"text-slate-400 text-sm"},"Generated at ",new Date(result.timestamp).toLocaleString())))),result.agents_output&&result.agents_output.length>0&&React.createElement("div",{className:"space-y-3"},React.createElement("h3",{className:"text-white font-semibold text-lg"},"Agent Reports"),result.agents_output.map((agentOutput,idx)=>React.createElement("div",{key:idx,className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},React.createElement("div",{className:"flex items-start justify-between mb-3"},React.createElement("h4",{className:"text-cyan-400 font-medium flex items-center gap-2"},React.createElement("span",null,getAgentIcon(agentOutput.agent)),getAgentName(agentOutput.agent)),React.createElement("div",{className:"flex items-center gap-3"},React.createElement("span",{className:`px-3 py-1 rounded-lg text-xs font-bold ${agentOutput.action==='BUY'||agentOutput.action==='STRONG_BUY'?'bg-green-500/20 text-green-400':agentOutput.action==='SELL'||agentOutput.action==='STRONG_SELL'?'bg-red-500/20 text-red-400':'bg-yellow-500/20 text-yellow-400'}`},agentOutput.action),React.createElement("span",{className:"text-cyan-400 font-semibold text-sm"},agentOutput.confidence,"% confidence"))),agentOutput.target_price&&React.createElement("div",{className:"grid grid-cols-2 gap-3 mb-3"},React.createElement("div",{className:"bg-slate-900/50 rounded p-2"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Target Price"),React.createElement("div",{className:"text-green-400 font-semibold"},"$",agentOutput.target_price.toFixed(2))),agentOutput.stop_loss&&React.createElement("div",{className:"bg-slate-900/50 rounded p-2"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Stop Loss"),React.createElement("div",{className:"text-red-400 font-semibold"},"$",agentOutput.stop_loss.toFixed(2)))),agentOutput.key_factors&&agentOutput.key_factors.length>0&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Key Factors:"),React.createElement("div",{className:"flex flex-wrap gap-2"},agentOutput.key_factors.map((factor,fIdx)=>React.createElement("span",{key:fIdx,className:"px-2 py-1 bg-purple-500/20 text-purple-300 text-xs rounded"},factor)))),React.createElement("pre",{className:"text-slate-300 text-sm whitespace-pre-wrap font-mono bg-slate-900/50 p-3 rounded overflow-x-auto"},agentOutput.output)))),React.createElement("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},React.createElement("h4",{className:"text-white font-semibold mb-3"},"Complete Analysis"),React.createElement("pre",{className:"text-slate-300 text-sm whitespace-pre-wrap font-mono bg-slate-900/50 p-4 rounded max-h-96 overflow-y-auto"},result.raw_output||result.analysis))),analysisState==='error'&&React.createElement("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-4"},React.createElement("div",{className:"flex items-start gap-3"},React.createElement("i",{className:"fas fa-exclamation-circle text-red-400 text-2xl"}),React.createElement("div",{className:"flex-1"},React.createElement("h4",{className:"text-red-300 font-semibold mb-1"},"Analysis Failed"),React.createElement("p",{className:"text-slate-300 text-sm mb-3"},error),React.createElement("p",{className:"text-slate-400 text-sm"},"Make sure The Oracle backend is running."))))),React.createElement("div",{className:"p-6 border-t border-slate-700/50 bg-slate-800/50 flex items-center justify-between"},React.createElement("div",null,analysisState==='complete'&&React.createElement("button",{onClick:()=>{setAnalysisState('idle');setResult(null);setProgressUpdates([]);},className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors"},React.createElement("i",{className:"fas fa-redo mr-2"}),"Run New Analysis")),React.createElement("div",{className:"flex items-center gap-3"},React.createElement("button",{onClick:onClose,className:"px-6 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors"},"Close"),analysisState==='idle'&&React.createElement("button",{onClick:startAnalysis,className:"px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 rounded-lg text-white font-semibold transition-all transform hover:scale-105 shadow-lg shadow-cyan-500/25"},React.createElement("i",{className:"fas fa-robot mr-2"}),"Start Multi-Agent Analysis")))));}function AITournamentModal(_ref10){let{onClose,watchlist=[],stocks=[]}=_ref10;const[activeTab,setActiveTab]=useState('overview');const[tournamentStatus,setTournamentStatus]=useState('idle');const[tournamentResults,setTournamentResults]=useState(null);const[leaderboard,setLeaderboard]=useState([]);const[tournamentDays,setTournamentDays]=useState(7);const[activeTeams,setActiveTeams]=useState([1,2,3,4]);const[logs,setLogs]=useState([]);const[currentDay,setCurrentDay]=useState(0);const[experimentId,setExperimentId]=useState(null);const eventSourceRef=useRef(null);const availableStocks=useMemo(()=>{const sourceStocks=stocks.length>0?stocks:typeof DEMO_STOCKS!=='undefined'?DEMO_STOCKS:[];return sourceStocks;},[stocks]);const availableSymbols=useMemo(()=>{return availableStocks.map(stock=>stock.symbol||stock);},[availableStocks]);const addLog=function(message){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'info';const timestamp=new Date().toLocaleTimeString();setLogs(prev=>[{time:timestamp,message,type},...prev].slice(0,200));};const startTournament=async()=>{if(tournamentStatus==='running')return;setTournamentStatus('running');setLogs([]);setCurrentDay(0);setLeaderboard([]);try{const symbolsToUse=availableSymbols.length>0?availableSymbols:['AAPL','MSFT','GOOGL','AMZN','TSLA'];addLog(`üöÄ Starting tournament with ${symbolsToUse.length} stocks...`,'info');const response=await fetch('http://localhost:3002/api/tournament/start',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({days:tournamentDays,teams:activeTeams,watchlist:symbolsToUse,useAllStocks:true})});if(response.ok){const data=await response.json();setExperimentId(data.experimentId);connectToSSE(data.experimentId);addLog(`üèÜ Tournament started on backend server with ${symbolsToUse.length} stocks`,'success');}else{throw new Error('Failed to start tournament');}}catch(error){addLog(`‚ùå Failed to start: ${error.message}`,'error');setTournamentStatus('error');}};const pollTournamentStatus=async experimentId=>{if(pollIntervalRef.current){clearInterval(pollIntervalRef.current);}const statusUrl=experimentId==='current'?'${API_BASE_URL}/api/tournament/status/current':`${API_BASE_URL}/api/tournament/status/${experimentId}`;pollIntervalRef.current=setInterval(async()=>{try{const response=await fetch(statusUrl);if(response.ok){const data=await response.json();if(data.status==='running'){setCurrentDay(data.current_day||0);if(data.logs&&data.logs.length>0){data.logs.forEach(log=>{if(!logs.some(l=>l.message===log.message&&l.time===log.time)){addLog(log.message,log.type||'info');}});}}else if(data.status==='completed'){if(pollIntervalRef.current){clearInterval(pollIntervalRef.current);pollIntervalRef.current=null;}setTournamentStatus('completed');setTournamentResults(data.results);setLeaderboard(data.leaderboard||[]);addLog('üèÜ Tournament completed!','success');}else if(data.status==='error'){if(pollIntervalRef.current){clearInterval(pollIntervalRef.current);pollIntervalRef.current=null;}setTournamentStatus('error');addLog(`‚ùå Tournament error: ${data.error}`,'error');}}}catch(error){console.error('Poll error:',error);}},3000);setTimeout(()=>{if(pollIntervalRef.current){clearInterval(pollIntervalRef.current);pollIntervalRef.current=null;}},600000);};const handleClose=()=>{if(eventSourceRef.current){eventSourceRef.current.leaderboard?.close();eventSourceRef.current.logs?.close();eventSourceRef.current=null;}onClose();};const getTeamName=teamId=>{const names={1:'Team Alpha (Claude-3-Sonnet)',2:'Team Beta (GPT-4-Turbo)',3:'Team Gamma (DeepSeek-V3)',4:'Team Delta (Gemini-Pro)'};return names[teamId]||`Team ${teamId}`;};const getRankEmoji=rank=>{if(rank===1)return'ü•á';if(rank===2)return'ü•à';if(rank===3)return'ü•â';return`#${rank}`;};const loadTournamentResults=async()=>{try{const response=await fetch(`${API_BASE_URL}/api/tournament/results`);if(response.ok){const data=await response.json();if(data.results){setTournamentResults(data.results);setLeaderboard(data.leaderboard||[]);setTournamentStatus('completed');}}}catch(error){console.error('Error loading results:',error);}};useEffect(()=>{checkForRunningTournament();return()=>{if(eventSourceRef.current){eventSourceRef.current.leaderboard?.close();eventSourceRef.current.logs?.close();}};},[]);const checkForRunningTournament=async()=>{try{const response=await fetch('http://localhost:3002/api/tournament/results');if(response.ok){const data=await response.json();if(data.results&&data.results.status==='running'){setExperimentId(data.results.experimentId);setTournamentStatus('running');setCurrentDay(data.results.currentDay);setTournamentDays(data.results.config.days);connectToSSE(data.results.experimentId);addLog('üîÑ Reconnected to running tournament','success');}}}catch(error){console.log('No running tournament found');}};const connectToSSE=expId=>{if(eventSourceRef.current){eventSourceRef.current.leaderboard?.close();eventSourceRef.current.logs?.close();}const leaderboardSSE=new EventSource(`http://localhost:3002/api/tournament/sse/leaderboard/${expId}`);leaderboardSSE.onmessage=event=>{const data=JSON.parse(event.data);if(data.leaderboard){setLeaderboard(data.leaderboard);}if(data.status==='completed'){setTournamentStatus('completed');setTournamentResults(data);leaderboardSSE.close();}};leaderboardSSE.onerror=error=>{console.error('Leaderboard SSE error:',error);addLog('‚ö†Ô∏è Lost connection to leaderboard updates','warning');};const logsSSE=new EventSource(`http://localhost:3002/api/tournament/sse/logs/${expId}`);logsSSE.onmessage=event=>{const data=JSON.parse(event.data);if(data.message){addLog(data.message,data.type);}};logsSSE.onerror=error=>{console.error('Logs SSE error:',error);};eventSourceRef.current={leaderboard:leaderboardSSE,logs:logsSSE};};const checkRunningTournament=async()=>{try{const response=await fetch(`${API_BASE_URL}/api/tournament/status/current`);if(response.ok){const data=await response.json();if(data.status==='running'){console.log('üîÑ Tournament detected running on server - restoring UI state');setTournamentStatus('running');addLog('üîÑ Tournament is running in background - resuming monitoring','info');if(data.experiment_id&&data.experiment_id!=='tournament_undefined'){console.log('üìã Resuming polling for experiment:',data.experiment_id);pollTournamentStatus(data.experiment_id);}else{console.log('üìã Polling current tournament status');const pollCurrentStatus=setInterval(async()=>{try{const statusResponse=await fetch(`${API_BASE_URL}/api/tournament/status/current`);if(statusResponse.ok){const statusData=await statusResponse.json();if(statusData.status==='running'){setTournamentStatus('running');if(statusData.current_day){setCurrentDay(statusData.current_day);}}else{console.log('üìã Tournament completed or stopped');clearInterval(pollCurrentStatus);setTournamentStatus('idle');loadTournamentResults();}}}catch(err){console.error('Status poll error:',err);}},5000);pollIntervalRef.current=pollCurrentStatus;}}else{if(tournamentStatus==='running'){console.log('üìã UI shows running but server says idle - updating state');setTournamentStatus('idle');loadTournamentResults();}}}}catch(error){console.log('No running tournament found:',error);if(tournamentStatus==='running'){console.log('üìã Clearing stale running state');setTournamentStatus('idle');}}};useEffect(()=>{checkRunningTournament();return()=>{if(pollIntervalRef.current){clearInterval(pollIntervalRef.current);pollIntervalRef.current=null;}console.log('üìã Modal unmounting - tournament continues on server');};},[]);return React.createElement("div",{className:"modal-overlay",onClick:handleClose},React.createElement("div",{className:"glass-elevated rounded-2xl p-6 max-w-7xl w-full mx-4 my-8 max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"flex items-start justify-between mb-6 pb-4 border-b border-slate-700"},React.createElement("div",null,React.createElement("h2",{className:"text-3xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent"},"\uD83C\uDFC6 AI Trading Tournament"),React.createElement("p",{className:"text-slate-400 text-sm mt-1"},"Multi-AI Trading Competition")),React.createElement("button",{onClick:handleClose,className:"text-slate-400 hover:text-white text-2xl px-2"},"\u2715")),React.createElement("div",{className:"flex border-b border-slate-700 bg-slate-800/50"},['overview','leaderboard','logs','settings'].map(tab=>React.createElement("button",{key:tab,onClick:()=>setActiveTab(tab),className:`px-6 py-3 font-medium capitalize transition ${activeTab===tab?'text-purple-400 border-b-2 border-purple-400 bg-slate-700/50':'text-slate-400 hover:text-white hover:bg-slate-700/30'}`},tab))),React.createElement("div",{className:"space-y-6"},activeTab==='overview'&&React.createElement("div",null,React.createElement("div",{className:"bg-slate-800/50 rounded-lg p-6 mb-6 border border-slate-700"},React.createElement("h3",{className:"text-xl font-bold text-white mb-4"},"Tournament Configuration"),React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-4"},React.createElement("div",null,React.createElement("label",{className:"block text-sm text-slate-400 mb-2"},"Tournament Days"),React.createElement("input",{type:"number",value:tournamentDays,onChange:e=>setTournamentDays(parseInt(e.target.value)||7),min:"1",max:"30",className:"w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-white",disabled:tournamentStatus==='running'})),React.createElement("div",null,React.createElement("label",{className:"block text-sm text-slate-400 mb-2"},"Active Teams"),React.createElement("div",{className:"flex gap-2 flex-wrap"},[1,2,3,4].map(team=>React.createElement("label",{key:team,className:"flex items-center gap-2 cursor-pointer"},React.createElement("input",{type:"checkbox",checked:activeTeams.includes(team),onChange:e=>{if(e.target.checked){setActiveTeams([...activeTeams,team]);}else{setActiveTeams(activeTeams.filter(t=>t!==team));}},disabled:tournamentStatus==='running',className:"w-4 h-4"}),React.createElement("span",{className:"text-sm text-slate-300"},"Team ",team)))))),React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"block text-sm text-slate-400 mb-2"},"Available Stocks (",availableSymbols.length," total)"),React.createElement("div",{className:"bg-slate-900 rounded-lg p-3 text-sm text-slate-300 max-h-32 overflow-y-auto"},availableSymbols.length>0?availableSymbols.join(', '):'No stocks available'),React.createElement("p",{className:"text-xs text-slate-500 mt-2"},"AI teams will select from all ",availableSymbols.length," stocks in the application")),React.createElement("div",{className:"flex gap-3"},tournamentStatus==='idle'&&React.createElement("button",{onClick:startTournament,className:"px-8 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg font-bold hover:shadow-lg hover:shadow-purple-500/50 transition"},React.createElement("i",{className:"fas fa-play mr-2"}),"Start Tournament (",availableSymbols.length," Stocks)"),tournamentStatus==='running'&&React.createElement("div",{className:"flex items-center gap-3"},React.createElement("div",{className:"flex items-center gap-2 px-4 py-3 bg-cyan-500/10 border border-cyan-500/30 rounded-lg"},React.createElement("i",{className:"fas fa-spinner animate-spin text-cyan-400"}),React.createElement("span",{className:"text-cyan-400 font-semibold"},"Day ",currentDay," / ",tournamentDays)),React.createElement("div",{className:"text-xs text-slate-500"},"Tournament runs in background")),tournamentStatus==='completed'&&React.createElement("button",{onClick:loadTournamentResults,className:"px-6 py-3 bg-green-600 hover:bg-green-500 text-white rounded-lg font-semibold flex items-center gap-2"},React.createElement("i",{className:"fas fa-sync"}),"Refresh Results"))),tournamentResults&&React.createElement("div",{className:"bg-slate-800/50 rounded-lg p-6 border border-slate-700"},React.createElement("h3",{className:"text-xl font-bold text-white mb-4"},"Tournament Results"),React.createElement("div",{className:"grid grid-cols-3 gap-4"},React.createElement("div",{className:"bg-slate-900/50 rounded-lg p-4 text-center"},React.createElement("div",{className:"text-sm text-slate-400 mb-1"},"Total Days"),React.createElement("div",{className:"text-2xl font-bold text-cyan-400"},tournamentResults.total_days||tournamentDays)),React.createElement("div",{className:"bg-slate-900/50 rounded-lg p-4 text-center"},React.createElement("div",{className:"text-sm text-slate-400 mb-1"},"Total Trades"),React.createElement("div",{className:"text-2xl font-bold text-green-400"},tournamentResults.total_trades||0)),React.createElement("div",{className:"bg-slate-900/50 rounded-lg p-4 text-center"},React.createElement("div",{className:"text-sm text-slate-400 mb-1"},"Best Return"),React.createElement("div",{className:"text-2xl font-bold text-purple-400"},tournamentResults.best_return?`${tournamentResults.best_return.toFixed(2)}%`:'N/A'))))),activeTab==='leaderboard'&&React.createElement("div",null,leaderboard.length>0?React.createElement("div",{className:"space-y-3"},leaderboard.map((team,idx)=>React.createElement("div",{key:team.teamId,className:`glass-card p-6 rounded-xl border transition ${idx===0?'border-yellow-500/50 bg-yellow-500/5':idx===1?'border-slate-400/50 bg-slate-400/5':idx===2?'border-orange-500/50 bg-orange-500/5':'border-slate-700'}`},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"flex items-center gap-4"},React.createElement("div",{className:"text-3xl"},getRankEmoji(team.rank||idx+1)),React.createElement("div",null,React.createElement("h4",{className:"text-lg font-bold text-white"},team.name||getTeamName(team.teamId)),React.createElement("p",{className:"text-sm text-slate-400"},team.model||'Unknown Model'))),React.createElement("div",{className:"text-right"},React.createElement("div",{className:`text-2xl font-bold ${team.totalReturn>0?'text-green-400':'text-red-400'}`},team.totalReturn>0?'+':'',team.totalReturn?.toFixed(2),"%"),React.createElement("div",{className:"text-sm text-slate-400"},"$",team.portfolioValue?.toLocaleString()))),team.returns&&team.returns.length>0&&React.createElement("div",{className:"mt-4 flex items-end gap-1 h-12"},team.returns.map((ret,i)=>React.createElement("div",{key:i,className:`flex-1 rounded-t ${ret>0?'bg-green-500':'bg-red-500'}`,style:{height:`${Math.abs(ret)*10}px`,minHeight:'2px'},title:`Day ${i+1}: ${ret.toFixed(2)}%`})))))):React.createElement("div",{className:"text-center py-20"},React.createElement("i",{className:"fas fa-trophy text-6xl text-slate-700 mb-4"}),React.createElement("p",{className:"text-slate-400"},"No tournament results yet"),React.createElement("p",{className:"text-sm text-slate-500 mt-2"},"Start a tournament to see the leaderboard"))),activeTab==='logs'&&React.createElement("div",{className:"space-y-2"},logs.length===0?React.createElement("div",{className:"text-center py-12"},React.createElement("i",{className:"fas fa-file-alt text-6xl text-slate-600 mb-4"}),React.createElement("p",{className:"text-slate-400"},"No logs yet")):React.createElement("div",{className:"glass-card p-4 rounded-xl border border-slate-700 max-h-96 overflow-y-auto"},logs.map((log,idx)=>React.createElement("div",{key:idx,className:`py-2 px-3 rounded mb-1 font-mono text-sm ${log.type==='error'?'bg-red-500/10 text-red-400':log.type==='success'?'bg-green-500/10 text-green-400':log.type==='warning'?'bg-yellow-500/10 text-yellow-400':'bg-slate-700/30 text-slate-300'}`},React.createElement("span",{className:"text-slate-500 mr-2"},"[",log.time,"]"),log.message)))),activeTab==='settings'&&React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"glass-card p-6 rounded-xl border border-slate-700"},React.createElement("h3",{className:"text-lg font-bold text-white mb-4"},"Tournament Configuration"),React.createElement("div",{className:"space-y-4"},React.createElement("div",null,React.createElement("label",{className:"block text-slate-300 mb-2"},"Duration (days)"),React.createElement("input",{type:"number",min:"1",max:"30",value:tournamentDays,onChange:e=>setTournamentDays(parseInt(e.target.value)),disabled:tournamentStatus==='running',className:"w-full bg-slate-700 text-white px-4 py-2 rounded-lg border border-slate-600 focus:border-purple-500 focus:outline-none disabled:opacity-50"})),React.createElement("div",null,React.createElement("label",{className:"block text-slate-300 mb-2"},"Active Teams"),React.createElement("div",{className:"grid grid-cols-2 gap-2"},[1,2,3,4].map(teamId=>React.createElement("label",{key:teamId,className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition ${activeTeams.includes(teamId)?'bg-purple-500/20 border-purple-500':'bg-slate-700/30 border-slate-600'} ${tournamentStatus==='running'?'opacity-50 cursor-not-allowed':''}`},React.createElement("input",{type:"checkbox",checked:activeTeams.includes(teamId),onChange:e=>{if(e.target.checked){setActiveTeams([...activeTeams,teamId]);}else{setActiveTeams(activeTeams.filter(id=>id!==teamId));}},disabled:tournamentStatus==='running',className:"form-checkbox text-purple-500"}),React.createElement("span",{className:"text-white text-sm"},getTeamName(teamId)))))),React.createElement("div",null,React.createElement("label",{className:"block text-slate-300 mb-2"},"Available Stocks (",availableSymbols.length," symbols)"),React.createElement("div",{className:"bg-slate-700/30 p-3 rounded-lg border border-slate-600 max-h-32 overflow-y-auto"},availableSymbols.length>0?React.createElement("div",{className:"flex flex-wrap gap-2"},availableSymbols.map(symbol=>React.createElement("span",{key:symbol,className:"px-2 py-1 bg-cyan-500/20 text-cyan-300 rounded text-sm"},symbol))):React.createElement("p",{className:"text-slate-500 text-sm"},"Loading available stocks...")),React.createElement("p",{className:"text-xs text-slate-500 mt-2"},"Tournament will analyze all ",availableSymbols.length," available stocks"))))))));}function MarketCrashSimulator(_ref11){let{holdings,totalValue}=_ref11;const[selectedScenario,setSelectedScenario]=useState('2008 Financial Crisis');const[showDetails,setShowDetails]=useState(false);const crashResult=simulateMarketCrash(holdings,selectedScenario);if(!crashResult)return null;return React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("p",{className:"text-sm text-slate-400"},"See how your portfolio would handle historical market crashes"),React.createElement("select",{value:selectedScenario,onChange:e=>setSelectedScenario(e.target.value),className:"px-3 py-1.5 bg-slate-800 border border-slate-700 rounded text-white text-sm focus:outline-none focus:border-purple-500"},Object.keys(CRASH_SCENARIOS).map(scenario=>React.createElement("option",{key:scenario,value:scenario},scenario)))),React.createElement("div",{className:"grid grid-cols-3 gap-4"},React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Portfolio Loss"),React.createElement("div",{className:"text-2xl font-bold text-red-400"},"$",crashResult.lossUsd.toLocaleString('en-US',{maximumFractionDigits:0})),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},"-",crashResult.lossPct,"%")),React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Timeline"),React.createElement("div",{className:"text-2xl font-bold text-white"},crashResult.weeks," ",crashResult.weeks===1?'week':'weeks'),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},"~$",crashResult.perWeek.toLocaleString('en-US',{maximumFractionDigits:0}),"/week")),React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Value After Crash"),React.createElement("div",{className:"text-2xl font-bold text-yellow-400"},"$",crashResult.finalValue.toLocaleString('en-US',{maximumFractionDigits:0})),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},crashResult.percentRemaining.toFixed(0),"% remaining"))),React.createElement("div",{className:"glass-card p-4 rounded-lg"},React.createElement("div",{className:"flex justify-between items-center mb-2"},React.createElement("span",{className:"text-xs text-slate-400"},"Portfolio Drawdown"),React.createElement("span",{className:"text-xs font-bold text-red-400"},"-",crashResult.lossPct,"%")),React.createElement("div",{className:"w-full bg-slate-700 rounded-full h-3"},React.createElement("div",{className:"h-full bg-gradient-to-r from-green-500 to-red-500 rounded-full transition-all",style:{width:`${crashResult.percentRemaining}%`}})),React.createElement("div",{className:"flex justify-between text-xs text-slate-500 mt-1"},React.createElement("span",null,"$0"),React.createElement("span",null,"$",totalValue.toLocaleString('en-US',{maximumFractionDigits:0})))),React.createElement("div",{className:"p-3 bg-slate-800/40 border border-slate-700/50 rounded-lg"},React.createElement("div",{className:"flex items-start gap-2"},React.createElement("i",{className:"fas fa-info-circle text-blue-400 text-sm mt-0.5"}),React.createElement("div",{className:"text-xs text-slate-300 leading-relaxed"},React.createElement("strong",null,"Historical scenario")," \u2013 not a prediction. Past crashes help you understand your risk tolerance. Would you panic-sell, hold steady, or see it as a buying opportunity?"))),React.createElement("button",{onClick:()=>setShowDetails(!showDetails),className:"text-sm text-purple-400 hover:text-purple-300 font-semibold flex items-center gap-2 transition"},showDetails?'‚ñº':'‚ñ∂'," ",showDetails?'Hide':'Show'," Historical Context"),showDetails&&React.createElement("div",{className:"glass-card p-4 rounded-lg space-y-2 text-xs text-slate-300"},React.createElement("div",{className:"font-semibold text-white mb-2"},selectedScenario," Details:"),selectedScenario==='2008 Financial Crisis'&&React.createElement("p",null,"The S&P 500 fell 57% from October 2007 to March 2009 during the subprime mortgage crisis. Recovery took 4+ years."),selectedScenario==='2020 COVID Crash'&&React.createElement("p",null,"Markets dropped 34% in just 5 weeks (Feb-Mar 2020) due to pandemic fears. Recovery was V-shaped, taking only 5 months."),selectedScenario==='2000 Dot-com Bust'&&React.createElement("p",null,"The tech-heavy NASDAQ fell 78% from March 2000 to October 2002. Full recovery took 15 years."),selectedScenario==='1987 Black Monday'&&React.createElement("p",null,"Markets crashed 22.6% in a single day (Oct 19, 1987) due to program trading and panic. Recovery took 2 years.")));}function calculateStockGrade(stock){let score=0,maxScore=0;const criteria=[];if(stock.pe){maxScore+=10;if(stock.pe<15){score+=10;criteria.push({name:'P/E Ratio',grade:'A',reason:'Attractive valuation (P/E < 15)'});}else if(stock.pe<25){score+=7;criteria.push({name:'P/E Ratio',grade:'B',reason:'Fair valuation (P/E 15-25)'});}else if(stock.pe<35){score+=4;criteria.push({name:'P/E Ratio',grade:'C',reason:'Expensive (P/E 25-35)'});}else{score+=2;criteria.push({name:'P/E Ratio',grade:'D',reason:'Very expensive (P/E >35)'});}}if(stock.priceToBook){maxScore+=8;if(stock.priceToBook<1.5){score+=8;criteria.push({name:'P/B Ratio',grade:'A',reason:'Trading below book value'});}else if(stock.priceToBook<3){score+=6;criteria.push({name:'P/B Ratio',grade:'B',reason:'Reasonable P/B ratio'});}else{score+=3;criteria.push({name:'P/B Ratio',grade:'C',reason:'High P/B ratio'});}}if(stock.revenueGrowth){maxScore+=10;if(stock.revenueGrowth>20){score+=10;criteria.push({name:'Revenue Growth',grade:'A',reason:'Strong growth (>20%)'});}else if(stock.revenueGrowth>10){score+=7;criteria.push({name:'Revenue Growth',grade:'B',reason:'Solid growth (10-20%)'});}else if(stock.revenueGrowth>0){score+=4;criteria.push({name:'Revenue Growth',grade:'C',reason:'Slow growth (0-10%)'});}else{score+=1;criteria.push({name:'Revenue Growth',grade:'F',reason:'Declining revenue'});}}if(stock.epsGrowth){maxScore+=10;if(stock.epsGrowth>20){score+=10;criteria.push({name:'EPS Growth',grade:'A',reason:'Excellent earnings (>20%)'});}else if(stock.epsGrowth>10){score+=7;criteria.push({name:'EPS Growth',grade:'B',reason:'Good earnings (10-20%)'});}else if(stock.epsGrowth>0){score+=4;criteria.push({name:'EPS Growth',grade:'C',reason:'Modest growth (0-10%)'});}}if(stock.grossMargin){maxScore+=5;if(stock.grossMargin>60){score+=5;criteria.push({name:'Gross Margin',grade:'A',reason:'Exceptional margins (>60%)'});}else if(stock.grossMargin>40){score+=3;criteria.push({name:'Gross Margin',grade:'B',reason:'Strong margins (40-60%)'});}else if(stock.grossMargin>20){score+=2;criteria.push({name:'Gross Margin',grade:'C',reason:'Fair margins (20-40%)'});}}if(stock.debtToEquity!==undefined){maxScore+=10;if(stock.debtToEquity<0.5){score+=10;criteria.push({name:'Debt/Equity',grade:'A',reason:'Very low debt (<0.5)'});}else if(stock.debtToEquity<1.0){score+=7;criteria.push({name:'Debt/Equity',grade:'B',reason:'Conservative debt (0.5-1.0)'});}else if(stock.debtToEquity<2.0){score+=4;criteria.push({name:'Debt/Equity',grade:'C',reason:'Moderate debt (1.0-2.0)'});}else{score+=2;criteria.push({name:'Debt/Equity',grade:'D',reason:'High debt (>2.0)'});}}if(stock.currentRatio){maxScore+=8;if(stock.currentRatio>2.0){score+=8;criteria.push({name:'Current Ratio',grade:'A',reason:'Strong liquidity (>2.0)'});}else if(stock.currentRatio>1.5){score+=6;criteria.push({name:'Current Ratio',grade:'B',reason:'Adequate liquidity (1.5-2.0)'});}else if(stock.currentRatio>1.0){score+=3;criteria.push({name:'Current Ratio',grade:'C',reason:'Tight liquidity (1.0-1.5)'});}}if(stock.piotroskiScore){maxScore+=7;if(stock.piotroskiScore>=7){score+=7;criteria.push({name:'Piotroski Score',grade:'A',reason:'Excellent financial health (7-9)'});}else if(stock.piotroskiScore>=5){score+=5;criteria.push({name:'Piotroski Score',grade:'B',reason:'Good health (5-6)'});}else if(stock.piotroskiScore>=3){score+=3;criteria.push({name:'Piotroski Score',grade:'C',reason:'Fair health (3-4)'});}else{score+=1;criteria.push({name:'Piotroski Score',grade:'D',reason:'Weak health (<3)'});}}if(stock.roe){maxScore+=8;if(stock.roe>20){score+=8;criteria.push({name:'ROE',grade:'A',reason:'Excellent return (>20%)'});}else if(stock.roe>15){score+=6;criteria.push({name:'ROE',grade:'B',reason:'Strong return (15-20%)'});}else if(stock.roe>10){score+=4;criteria.push({name:'ROE',grade:'C',reason:'Fair return (10-15%)'});}else{score+=2;criteria.push({name:'ROE',grade:'D',reason:'Weak return (<10%)'});}}if(stock.roic){maxScore+=7;if(stock.roic>15){score+=7;criteria.push({name:'ROIC',grade:'A',reason:'Excellent capital efficiency (>15%)'});}else if(stock.roic>10){score+=5;criteria.push({name:'ROIC',grade:'B',reason:'Good efficiency (10-15%)'});}else if(stock.roic>5){score+=3;criteria.push({name:'ROIC',grade:'C',reason:'Fair efficiency (5-10%)'});}}if(stock.rsi){maxScore+=5;if(stock.rsi>=40&&stock.rsi<=60){score+=5;criteria.push({name:'RSI',grade:'A',reason:'Neutral momentum'});}else if(stock.rsi<30){score+=4;criteria.push({name:'RSI',grade:'B',reason:'Oversold - potential bounce'});}else if(stock.rsi>70){score+=2;criteria.push({name:'RSI',grade:'C',reason:'Overbought - caution'});}}if(stock.beta!==undefined){maxScore+=5;if(stock.beta>=0.8&&stock.beta<=1.2){score+=5;criteria.push({name:'Beta',grade:'A',reason:'Market-like volatility'});}else if(stock.beta<0.8){score+=4;criteria.push({name:'Beta',grade:'B',reason:'Lower volatility'});}else if(stock.beta<1.5){score+=3;criteria.push({name:'Beta',grade:'C',reason:'Moderate volatility'});}else{score+=2;criteria.push({name:'Beta',grade:'D',reason:'High volatility'});}}const percentage=maxScore>0?score/maxScore*100:0;let letterGrade='F';if(percentage>=90)letterGrade='A';else if(percentage>=80)letterGrade='B';else if(percentage>=70)letterGrade='C';else if(percentage>=60)letterGrade='D';return{letterGrade,percentage:Math.round(percentage),score,maxScore,criteria:criteria.sort((a,b)=>{const order={'A':1,'B':2,'C':3,'D':4,'F':5};return order[a.grade]-order[b.grade];})};}const FINANCIAL_EXPLANATIONS={pe:{label:'P/E Ratio',plain:'Price-to-Earnings: How much you pay for $1 of earnings. <15 = Undervalued, 15-25 = Fair, >25 = Growth priced in.',analogy:'Like paying $25 for a pizza that gives you $1 worth of satisfaction per year.'},roe:{label:'ROE (Return on Equity)',plain:'Profit generated from shareholder equity. >15% = strong, >20% = excellent.',analogy:'Like getting $1.20 back for every $1 you invest in the business.'},roic:{label:'ROIC (Return on Invested Capital)',plain:'How efficiently a company uses its capital to generate profits. >15% is strong.',analogy:'Like a vending machine that returns $1.20 for every $1 you put in.'},evToEbitda:{label:'EV/EBITDA',plain:'Enterprise Value vs. Earnings Before Interest, Taxes, Depreciation & Amortization. <10 = cheap, >15 = expensive.',analogy:'Like comparing the total price of a business to its core operating cash flow.'},piotroskiScore:{label:'Piotroski Score',plain:'A 9-point checklist for financial health (profitability, leverage, efficiency). 7-9 = strong, <4 = weak.',analogy:'Like a financial health checkup for stocks.'},debtToEquity:{label:'Debt-to-Equity',plain:'How much debt a company uses relative to shareholder equity. <0.5 = conservative, >1.5 = risky.',analogy:'Like a home: $200K house with $50K down (low risk) vs. $200K with $180K loan (high risk).'},rsi:{label:'RSI (Relative Strength Index)',plain:'Momentum indicator: <30 = oversold (potential buy), >70 = overbought (potential sell).',analogy:"Like a car's speedometer: too fast = risk of crash, too slow = opportunity to accelerate."},revenueGrowth:{label:'Revenue Growth',plain:'Year-over-year revenue change. >20% = high growth, <0% = decline.',analogy:'Like a store that sold 100 units last year and 125 this year ‚Äî business is expanding.'},grossMargin:{label:'Gross Margin',plain:'Profit after cost of goods sold. >40% = excellent, 20-40% = good.',analogy:'If you sell a $10 product for $15, your gross margin is 33% ‚Äî $5 profit before other costs.'},beta:{label:'Beta',plain:'Volatility relative to market. <1 = less volatile, >1 = more volatile than S&P 500.',analogy:'Like comparing a steady sedan (beta 0.8) vs. a sports car (beta 1.5).'},dividendYield:{label:'Dividend Yield',plain:'Annual dividend as % of stock price. >3% = income stock, 1-3% = balanced.',analogy:'Like earning $3 per year for every $100 invested in the stock.'},fcfYield:{label:'Free Cash Flow Yield',plain:'Cash generation as % of market value. >8% = excellent, 5-8% = good, 2-5% = fair.',analogy:'6% yield = $6 cash per $100 market value. Cash is harder to manipulate than earnings.'},epsGrowth:{label:'EPS Growth',plain:'Earnings per share growth rate. >20% = excellent, 10-20% = strong, 5-10% = moderate.',analogy:'$2 to $2.50 EPS = 25% growth. Indicates growing profitability per share.'},priceToBook:{label:'P/B Ratio',plain:'Price-to-Book: Stock price vs. book value per share. <1 = potentially undervalued, 1-3 = fair, >3 = premium.',analogy:'Like buying a house for $200K when its assessed value is $150K (P/B = 1.33).'},priceToSales:{label:'P/S Ratio',plain:'Price-to-Sales: Market cap vs. annual revenue. <1 = cheap, 1-3 = reasonable, >5 = expensive.',analogy:'Like valuing a store at $1M when it makes $500K in sales per year (P/S = 2).'},netIncomeGrowth:{label:'Net Income Growth',plain:'Year-over-year profit growth. >20% = excellent, 10-20% = strong, <0% = declining.',analogy:'Like a business that made $100K profit last year and $130K this year ‚Äî 30% growth.'},roa:{label:'ROA (Return on Assets)',plain:'Profit generated from total assets. >10% = excellent, 5-10% = good, <5% = weak.',analogy:'Like a factory that generates $1.10 profit for every $1 of equipment it owns.'},operatingMargin:{label:'Operating Margin',plain:'Operating profit as % of revenue. >20% = excellent, 10-20% = good, <10% = tight.',analogy:'If revenue is $100 and operating profit is $15, operating margin is 15%.'},quickRatio:{label:'Quick Ratio',plain:'Liquidity measure: (Cash + Receivables) / Current Liabilities. >1 = healthy, <1 = may struggle to pay short-term debts.',analogy:'Like having $150K in cash/receivables to cover $100K in bills due soon (ratio = 1.5).'},currentRatio:{label:'Current Ratio',plain:'Current assets / Current liabilities. >2 = very safe, 1-2 = adequate, <1 = liquidity risk.',analogy:'Like having $200K in liquid assets to cover $100K in short-term debts (ratio = 2.0).'}};function ExplainMetric(_ref12){let{metricKey,stock}=_ref12;const[isOpen,setIsOpen]=useState(false);const exp=FINANCIAL_EXPLANATIONS[metricKey];if(!exp)return null;let context="";const value=stock[metricKey];if(metricKey==='roe'&&value!=null){if(value>30)context=`${stock.symbol}'s ROE is ${value.toFixed(1)}% ‚Äî extremely high, indicating strong profitability.`;else if(value>15)context=`${stock.symbol}'s ROE is ${value.toFixed(1)}% ‚Äî solid profitability.`;else context=`${stock.symbol}'s ROE is ${value.toFixed(1)}% ‚Äî below average for its sector.`;}if(metricKey==='pe'&&value!=null){if(value<15)context=`${stock.symbol}'s P/E of ${value.toFixed(1)} suggests it may be undervalued.`;else if(value>30)context=`${stock.symbol}'s P/E of ${value.toFixed(1)} indicates premium pricing or high growth expectations.`;else context=`${stock.symbol}'s P/E of ${value.toFixed(1)} is in a reasonable range.`;}if(metricKey==='rsi'&&value!=null){if(value<30)context=`${stock.symbol}'s RSI of ${value.toFixed(0)} suggests potential buying opportunity (oversold).`;else if(value>70)context=`${stock.symbol}'s RSI of ${value.toFixed(0)} warns of potential pullback (overbought).`;else context=`${stock.symbol}'s RSI of ${value.toFixed(0)} is in neutral territory.`;}if(metricKey==='piotroskiScore'&&value!=null){if(value>=7)context=`${stock.symbol}'s Piotroski Score of ${value}/9 indicates strong financial health.`;else if(value>=4)context=`${stock.symbol}'s Piotroski Score of ${value}/9 shows moderate financial health.`;else context=`${stock.symbol}'s Piotroski Score of ${value}/9 suggests weak financial health.`;}return React.createElement("div",{className:"relative inline-block ml-1"},React.createElement("button",{onClick:()=>setIsOpen(!isOpen),className:"text-xs text-slate-400 hover:text-cyan-400 font-bold transition","aria-label":`Explain ${exp.label}`},"?"),isOpen&&React.createElement(React.Fragment,null,React.createElement("div",{className:"fixed inset-0 z-40",onClick:()=>setIsOpen(false)}),React.createElement("div",{className:"absolute z-50 w-72 p-4 bg-slate-800 border border-cyan-500/30 rounded-lg shadow-2xl text-xs",style:{top:'100%',left:'0',marginTop:'4px'}},React.createElement("div",{className:"font-semibold text-cyan-300 mb-2 flex items-center justify-between"},React.createElement("span",null,exp.label),React.createElement("button",{onClick:()=>setIsOpen(false),className:"text-slate-400 hover:text-white"},"\u2715")),React.createElement("div",{className:"text-slate-300 mb-3 leading-relaxed"},exp.plain),context&&React.createElement("div",{className:"text-white mb-3 p-2 bg-slate-700/50 rounded border border-slate-600/50 italic"},"\"",context,"\""),React.createElement("div",{className:"text-slate-400 leading-relaxed"},"\uD83D\uDCA1 ",exp.analogy))));}const getTrafficLight=(metric,value)=>{if(value===null||value===undefined)return'yellow';const rules={pe:{green:v=>v<20,yellow:v=>v<30,red:v=>v>=30},revenueGrowth:{green:v=>v>15,yellow:v=>v>5,red:v=>v<=5},debtToEquity:{green:v=>v<0.5,yellow:v=>v<1.5,red:v=>v>=1.5},roe:{green:v=>v>15,yellow:v=>v>10,red:v=>v<=10},beta:{green:v=>v<1.0,yellow:v=>v<1.5,red:v=>v>=1.5}};const rule=rules[metric];if(!rule)return'yellow';if(rule.green(value))return'green';if(rule.yellow(value))return'yellow';return'red';};const getPlainEnglishSummary=(metric,value)=>{if(value===null||value===undefined)return{text:'No data available',detail:''};const summaries={pe:[{max:15,text:'üìâ Bargain price',detail:'Trading below historical average - potentially undervalued'},{max:25,text:'‚úÖ Fair price',detail:'Reasonable valuation for current earnings'},{max:35,text:'‚ö†Ô∏è Premium price',detail:'Expensive relative to earnings - needs strong growth to justify'},{max:Infinity,text:'üî¥ Very expensive',detail:'High valuation - risky if growth slows'}],revenueGrowth:[{max:0,text:'üìâ Shrinking',detail:'Revenue declining - market share loss or industry issues'},{max:5,text:'üêå Slow growth',detail:'Minimal expansion - mature company or tough market'},{max:15,text:'‚úÖ Solid growth',detail:'Healthy expansion rate - gaining market share'},{max:Infinity,text:'üöÄ Rapid growth',detail:'Fast expansion - verify sustainable'}],debtToEquity:[{max:0.5,text:'üí™ Rock solid',detail:'Very low debt - financially conservative'},{max:1.0,text:'‚úÖ Healthy balance',detail:'Moderate debt levels - well managed'},{max:2.0,text:'‚ö†Ô∏è Elevated debt',detail:'Higher debt - monitor closely in downturns'},{max:Infinity,text:'üî¥ High risk',detail:'Heavy debt burden - vulnerable to rate changes'}],roe:[{max:10,text:'üìâ Weak returns',detail:'Not generating much profit from equity'},{max:15,text:'‚û°Ô∏è Average',detail:'Decent but not exceptional profitability'},{max:20,text:'‚úÖ Strong returns',detail:'Excellent use of shareholder capital'},{max:Infinity,text:'üèÜ Elite returns',detail:'Outstanding profitability - competitive advantage'}],beta:[{max:0.8,text:'üõ°Ô∏è Defensive',detail:'Less volatile than market - safer in downturns'},{max:1.2,text:'‚û°Ô∏è Market-like',detail:'Moves with the market - average risk'},{max:1.8,text:'‚ö° Volatile',detail:'More dramatic swings than market'},{max:Infinity,text:'üé¢ Highly volatile',detail:'Wild price swings - high risk/reward'}]};const metricSummaries=summaries[metric];if(!metricSummaries)return{text:'‚Äî',detail:''};for(const summary of metricSummaries){if(value<=summary.max)return summary;}return{text:'‚Äî',detail:''};};const calculateValuationScore=stock=>{let score=50;if(stock.pe){if(stock.pe<15)score+=15;else if(stock.pe<25)score+=5;else if(stock.pe>35)score-=15;else score-=5;}if(stock.priceToBook){if(stock.priceToBook<1.5)score+=10;else if(stock.priceToBook<3)score+=5;else score-=10;}if(stock.fcfYield){if(stock.fcfYield>8)score+=10;else if(stock.fcfYield>5)score+=5;else if(stock.fcfYield<2)score-=5;}if(stock.revenueGrowth&&stock.revenueGrowth>20)score+=10;return Math.max(0,Math.min(100,score));};const getValuationLabel=score=>{if(score<35)return{label:'Undervalued',color:'#22c55e',emoji:'üí∞'};if(score<65)return{label:'Fair Value',color:'#eab308',emoji:'‚öñÔ∏è'};return{label:'Overvalued',color:'#ef4444',emoji:'‚ö†Ô∏è'};};function LoadingProgressBar(_ref13){let{current,total}=_ref13;const percentage=total>0?current/total*100:0;return React.createElement("div",{className:"w-full h-2 bg-slate-700 rounded-full overflow-hidden mb-4"},React.createElement("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-green-500 transition-all duration-300",style:{width:`${percentage}%`}}),React.createElement("div",{className:"text-xs text-slate-400 mt-1 text-center"},current," of ",total," stocks loaded (",percentage.toFixed(1),"%)"));}function FundamentalsTab(_ref14){let{stock}=_ref14;if(!stock){return React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("i",{className:"fas fa-exclamation-triangle text-4xl text-red-400 mb-3"}),React.createElement("h3",{className:"text-xl font-bold text-white mb-2"},"Data Unavailable"),React.createElement("p",{className:"text-slate-400 mb-4"},"No stock data was provided to the Fundamentals tab."),React.createElement("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-semibold"},"Reload Application"));}const safeAccess=function(obj,path){let fallback=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;try{const parts=path.split('.');let current=obj;for(const part of parts){if(!current||current[part]===undefined)return fallback;current=current[part];}return current;}catch{return fallback;}};const symbol=stock.symbol||'Unknown';const name=stock.name||stock.companyName||symbol;const price=Number(stock.price||0);const pe=Number(stock.pe||0);const roe=Number(stock.roe||0);const marketCap=Number(stock.marketCap||0);const volume=Number(stock.volume||0);const aiScore=safeAccess(stock,'aiAnalysis.score',stock.aiScore||0);const aiVerdict=safeAccess(stock,'aiAnalysis.verdict',stock.verdict||'HOLD');const confidence=safeAccess(stock,'aiAnalysis.confidence',stock.confidence||50);const analystRating=safeAccess(stock,'aiAnalysis.analystRating.detail',stock.analystRating?.detail||stock.analystRating||'No analyst rating available');return React.createElement("div",{className:"space-y-6 animate-slideInLeft"},React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("div",null,React.createElement("h3",{className:"text-2xl font-bold text-white"},symbol),React.createElement("p",{className:"text-slate-400"},name)),React.createElement("div",{className:"text-right"},React.createElement("div",{className:"text-3xl font-bold text-white"},"$",price.toFixed(2)),React.createElement("div",{className:`text-sm ${stock.changePct>0?'text-green-400':'text-red-400'}`},stock.changePct>0?'+':'',(stock.changePct||0).toFixed(2),"%")))),React.createElement("div",{className:"glass-card p-4 rounded-xl border-2 border-cyan-500/30"},React.createElement("h4",{className:"text-lg font-semibold text-cyan-300 mb-3"},"AI Analysis"),React.createElement("div",{className:"grid grid-cols-3 gap-4 mb-3"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:`text-2xl font-bold ${aiScore>=80?'text-green-400':aiScore>=60?'text-yellow-400':'text-red-400'}`},aiScore,"/100"),React.createElement("div",{className:"text-xs text-slate-400"},"AI Score")),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-2xl font-bold text-purple-400"},confidence,"%"),React.createElement("div",{className:"text-xs text-slate-400"},"Confidence")),React.createElement("div",{className:"text-center"},React.createElement("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${aiVerdict==='STRONG BUY'?'bg-green-500/20 text-green-400':aiVerdict==='BUY'?'bg-green-500/10 text-green-300':aiVerdict==='SELL'?'bg-red-500/20 text-red-400':'bg-yellow-500/10 text-yellow-300'}`},aiVerdict)))),React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4"},React.createElement(MetricCard,{label:"P/E Ratio",value:pe>0?pe.toFixed(1):'N/A',color:pe>0&&pe<15?'text-green-400':pe>30?'text-red-400':'text-slate-300'}),React.createElement(MetricCard,{label:"ROE",value:`${roe.toFixed(1)}%`,color:roe>20?'text-green-400':roe<10?'text-red-400':'text-slate-300'}),React.createElement(MetricCard,{label:"Market Cap",value:`$${formatNumber(marketCap)}`}),React.createElement(MetricCard,{label:"Volume",value:formatNumber(volume)})),React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("h4",{className:"text-lg font-semibold text-white mb-3 flex items-center gap-2"},React.createElement("i",{className:"fas fa-chart-line text-blue-400"}),"Analyst Rating"),React.createElement("p",{className:"text-slate-300 leading-relaxed"},typeof analystRating==='string'?analystRating:JSON.stringify(analystRating))),stock.topDrivers&&React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement("div",{className:"glass-card p-4 rounded-xl border-green-500/30"},React.createElement("h4",{className:"text-md font-semibold text-green-400 mb-2 flex items-center gap-2"},React.createElement("i",{className:"fas fa-thumbs-up"}),"Bullish Factors"),React.createElement("ul",{className:"space-y-1"},(stock.topDrivers.positive||[]).slice(0,3).map((item,i)=>React.createElement("li",{key:i,className:"text-sm text-slate-300 flex items-start gap-2"},React.createElement("span",{className:"text-green-400 mt-1"},"\u2022"),React.createElement("span",null,item.factor))))),React.createElement("div",{className:"glass-card p-4 rounded-xl border-red-500/30"},React.createElement("h4",{className:"text-md font-semibold text-red-400 mb-2 flex items-center gap-2"},React.createElement("i",{className:"fas fa-thumbs-down"}),"Bearish Factors"),React.createElement("ul",{className:"space-y-1"},(stock.topDrivers.negative||[]).slice(0,3).map((item,i)=>React.createElement("li",{key:i,className:"text-sm text-slate-300 flex items-start gap-2"},React.createElement("span",{className:"text-red-400 mt-1"},"\u2022"),React.createElement("span",null,item.factor)))))),stock.watchlistGuidance&&React.createElement("div",{className:"glass-card p-4 rounded-xl border-cyan-500/30"},React.createElement("h4",{className:"text-md font-semibold text-cyan-300 mb-3 flex items-center gap-2"},React.createElement("i",{className:"fas fa-info-circle"}),"What to Watch Next"),React.createElement("div",{className:"space-y-2"},stock.watchlistGuidance.items.map((item,i)=>React.createElement("div",{key:i,className:"flex items-center justify-between text-sm"},React.createElement("span",{className:"text-slate-400"},item.label,":"),React.createElement("span",{className:"text-slate-300"},item.value))))));}function MetricCard(_ref15){let{label,value,color}=_ref15;return React.createElement("div",{className:"glass-card p-4 rounded-xl text-center hover:border-cyan-500/30 transition"},React.createElement("div",{className:"text-xs text-slate-400 mb-1"},label),React.createElement("div",{className:`text-xl font-bold ${color||'text-white'}`},value));}function StockModal(_ref16){let{stock,onClose,watchlist,toggleWatchlist,detailedDataLoading,sectorAverages,portfolio,stocks,setShowWatchlistOnly,openStockModal}=_ref16;const[activeTab,setActiveTab]=useState('overview');const[showAllFactors,setShowAllFactors]=useState(false);const[showExplainScore,setShowExplainScore]=useState(false);const[insiderData,setInsiderData]=useState(null);const[analystEstimates,setAnalystEstimates]=useState(null);const[incomeStatement,setIncomeStatement]=useState(null);const[newsData,setNewsData]=useState([]);const[newsSentiment,setNewsSentiment]=useState(null);const[newsLoading,setNewsLoading]=useState(false);const[socialSentiment,setSocialSentiment]=useState(null);const[socialLoading,setSocialLoading]=useState(false);const[historicalData,setHistoricalData]=useState(null);const[historicalMeta,setHistoricalMeta]=useState({symbol:null,timeframe:null});const[chartTimeframe,setChartTimeframe]=useState('4hour');const[comparisonSymbol,setComparisonSymbol]=useState('');const[comparisonData,setComparisonData]=useState(null);const[comparisonMeta,setComparisonMeta]=useState({symbol:null,timeframe:null});const[comparisonLoading,setComparisonLoading]=useState(false);const[loadingTabData,setLoadingTabData]=useState(false);const[technicalData,setTechnicalData]=useState(null);const[ratingsData,setRatingsData]=useState(null);const[analystRatingsData,setAnalystRatingsData]=useState(null);const[error,setError]=useState(null);const[deepseekAnalysis,setDeepseekAnalysis]=useState(null);const[aiLoading,setAiLoading]=useState(false);const[deepseekLoading,setDeepseekLoading]=useState(false);const[fundamentalsData,setFundamentalsData]=useState(null);const[livePrice,setLivePrice]=useState(stock.price);const[liveChange,setLiveChange]=useState(stock.change);const[liveChangePct,setLiveChangePct]=useState(stock.changePct);const[priceHistory,setPriceHistory]=useState([]);const[isLiveUpdating,setIsLiveUpdating]=useState(false);const isWatchlisted=watchlist&&Array.isArray(watchlist)&&watchlist.some(s=>s&&s.toUpperCase()===stock.symbol.toUpperCase());const sectorAvg=sectorAverages[stock.sector]||{};const explainNow=useMemo(()=>explainDeterministicAIScore(stock),[stock.symbol,stock.pe,stock.roe,stock.rsi,stock.changePct,stock.marketCap]);useEffect(()=>{const handleUpdate=update=>{setLivePrice(update.price);setLiveChange(update.change);setLiveChangePct(update.changesPercentage||update.change);setIsLiveUpdating(true);setPriceHistory(prev=>{const newHistory=[...prev,{time:Date.now(),price:update.price}];return newHistory.slice(-50);});setTimeout(()=>setIsLiveUpdating(false),1000);};if(realtimeData.isConnected){realtimeData.subscribe(stock.symbol,handleUpdate);}else{smartPoller.startPolling(stock.symbol,handleUpdate);}return()=>{realtimeData.unsubscribe(stock.symbol,handleUpdate);smartPoller.stopPolling(stock.symbol);};},[stock.symbol]);const explainThresholds=useMemo(()=>aiExplainThresholds(num(stock.aiScore,0)),[stock.aiScore]);const sensitivity=useMemo(()=>aiSensitivitySuggestions(stock),[stock.symbol,stock.pe,stock.roe,stock.rsi,stock.changePct,stock.marketCap]);const prevSnapshotEntry=useMemo(()=>{try{const raw=localStorage.getItem(Cache.key(stock.symbol,'stock_prev'));if(!raw)return null;const parsed=JSON.parse(raw);if(!parsed||!parsed.data)return null;return parsed;}catch{return null;}},[stock.symbol]);const prevAnalysis=useMemo(()=>{if(!prevSnapshotEntry?.data)return null;try{return generateAIAnalysis(prevSnapshotEntry.data);}catch{return null;}},[stock.symbol,prevSnapshotEntry?.timestamp]);const prevStockRef=useRef(null);useEffect(()=>{console.log(`üîç useEffect triggered - activeTab: ${activeTab}, stock: ${stock.symbol}`);const loadTabData=async()=>{const stockChanged=prevStockRef.current&&prevStockRef.current!==stock.symbol;console.log(`üìå Stock check: prevStock=${prevStockRef.current}, currentStock=${stock.symbol}, changed=${stockChanged}`);if(!prevStockRef.current){prevStockRef.current=stock.symbol;console.log(`üìù First load - set prevStockRef to ${stock.symbol}`);}if(stockChanged){console.log(`üîÑ Stock changed to ${stock.symbol} - resetting tab data`);setInsiderData(null);setAnalystEstimates(null);setRatingsData(null);setAnalystRatingsData(null);setAiAnalysis(null);setNewsData([]);setNewsSentiment(null);setHistoricalData(null);setHistoricalMeta({symbol:null,timeframe:null});setChartTimeframe('4hour');setComparisonSymbol('');setComparisonData(null);setComparisonMeta({symbol:null,timeframe:null});setComparisonLoading(false);setFundamentalsData(null);setActiveTab('overview');prevStockRef.current=stock.symbol;console.log(`‚úÖ Reset complete - activeTab now: overview`);return;}console.log(`üéØ Checking tabs - activeTab: ${activeTab}`);console.log(`   - insiderData: ${insiderData?'EXISTS':'NULL'}`);console.log(`   - analystEstimates: ${analystEstimates?'EXISTS':'NULL'}`);setLoadingTabData(true);setError(null);try{if(activeTab==='news-sentiment'&&newsData.length===0){console.log(`üì∞ Fetching news & sentiment for ${stock.symbol}...`);setNewsLoading(true);setSocialLoading(true);try{if(window.socialSentiment){window.socialSentiment.fetchSocialSentiment(stock.symbol).then(social=>{setSocialSentiment(social);setSocialLoading(false);}).catch(err=>{console.error('‚ùå Social sentiment error:',err);setSocialLoading(false);});}else{console.warn('‚ö†Ô∏è socialSentiment not yet initialized, retrying...');setTimeout(()=>{if(window.socialSentiment){window.socialSentiment.fetchSocialSentiment(stock.symbol).then(social=>{setSocialSentiment(social);setSocialLoading(false);}).catch(err=>{console.error('‚ùå Social sentiment error:',err);setSocialLoading(false);});}else{console.error('‚ùå socialSentiment still not available');setSocialLoading(false);}},500);}const newsCallback=articles=>{setNewsData(articles);const sentiment=newsManager.getAggregateSentiment(stock.symbol);setNewsSentiment(sentiment);console.log(`‚úÖ Received ${articles.length} news articles with ${sentiment.label} sentiment`);};newsManager.subscribe(stock.symbol,newsCallback);}catch(error){console.error(`‚ùå Error fetching news for ${stock.symbol}:`,error);setNewsData([]);setSocialLoading(false);}finally{setNewsLoading(false);}}if(activeTab==='analyst-ratings'&&!analystRatingsData){console.log(`üìä Fetching comprehensive analyst data for ${stock.symbol}...`);const[ratingsSnap,gradesSum,gradesHist,gradesHistorical,gradesConsensus,priceTargetSummary,priceTargetConsensus]=await Promise.all([fetch(`https://financialmodelingprep.com/stable/ratings-snapshot?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>null),fetch(`https://financialmodelingprep.com/stable/grades?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>null),fetch(`https://financialmodelingprep.com/stable/grades?symbol=${stock.symbol}&limit=20&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>[]),fetch(`https://financialmodelingprep.com/stable/grades-historical?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>[]),fetch(`https://financialmodelingprep.com/stable/grades-consensus?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>null),fetch(`https://financialmodelingprep.com/stable/price-target-summary?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>null),fetch(`https://financialmodelingprep.com/stable/price-target-consensus?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>null)]);const ratingsSnapshot=Array.isArray(ratingsSnap)?ratingsSnap[0]:ratingsSnap;const gradesSummary=Array.isArray(gradesSum)?gradesSum[0]:gradesSum;const gradesHistoricalData=Array.isArray(gradesHist)&&gradesHist.length>0?gradesHist:Array.isArray(gradesHistorical)?gradesHistorical:[];const consensusData=Array.isArray(gradesConsensus)?gradesConsensus[0]:gradesConsensus;const priceTargetSummaryData=Array.isArray(priceTargetSummary)?priceTargetSummary[0]:priceTargetSummary;const priceTargetConsensusData=Array.isArray(priceTargetConsensus)?priceTargetConsensus[0]:priceTargetConsensus;console.log(`‚úÖ Analyst data loaded:`,{ratingsSnapshot:ratingsSnapshot?'YES':'NO',gradesSummary:gradesSummary?'YES':'NO',gradesHistorical:gradesHistoricalData?.length||0,gradesConsensus:consensusData?'YES':'NO',priceTargetSummary:priceTargetSummaryData?'YES':'NO',priceTargetConsensus:priceTargetConsensusData?'YES':'NO'});if(gradesHistoricalData?.length>0){console.log(`üìã Sample grade data (first entry):`,gradesHistoricalData[0]);console.log(`üìã Available keys:`,Object.keys(gradesHistoricalData[0]));console.log(`üìã Full first 3 grades:`,gradesHistoricalData.slice(0,3));}setAnalystRatingsData({snapshot:ratingsSnapshot,consensus:consensusData||gradesSummary,recentGrades:gradesHistoricalData||[],priceTarget:priceTargetConsensusData||priceTargetSummaryData,priceTargetSummary:priceTargetSummaryData,priceTargetConsensus:priceTargetConsensusData});}if(activeTab==='insider'&&!insiderData){try{console.log(`üìä Fetching insider trading data for ${stock.symbol}...`);console.log(`üîë Using FMP API Key: ${FMP_API_KEY.substring(0,10)}...`);const[statsResponse,latestResponse]=await Promise.all([fetch(`https://financialmodelingprep.com/stable/insider-trading/statistics?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`),fetch(`https://financialmodelingprep.com/stable/insider-trading/latest?symbol=${stock.symbol}&page=0&limit=50&apikey=${FMP_API_KEY}`)]);console.log(`üì° Statistics response: ${statsResponse.status}`);console.log(`üì° Latest trades response: ${latestResponse.status}`);if((statsResponse.status===403||statsResponse.status===402)&&(latestResponse.status===403||latestResponse.status===402)){console.warn("‚ö†Ô∏è Insider trading data requires FMP Premium subscription.");setInsiderData('PREMIUM_REQUIRED');return;}let statistics=null;let latestTrades=[];if(statsResponse.ok){const statsData=await statsResponse.json();console.log(`‚úÖ Statistics data received, length: ${statsData?.length||0}`);if(Array.isArray(statsData)&&statsData.length>0){const recentData=statsData.slice(0,4);const totalBought=recentData.reduce((sum,q)=>sum+(q.totalAcquired||0),0);const totalSold=recentData.reduce((sum,q)=>sum+(q.totalDisposed||0),0);const totalAcquiredTx=recentData.reduce((sum,q)=>sum+(q.acquiredTransactions||0),0);const totalDisposedTx=recentData.reduce((sum,q)=>sum+(q.disposedTransactions||0),0);statistics={totalBought,totalSold,totalTransactions:totalAcquiredTx+totalDisposedTx,totalBoughtValue:0,totalSoldValue:0};console.log(`üìä Statistics: ${totalAcquiredTx+totalDisposedTx} trades, ${totalBought} bought, ${totalSold} sold`);}}if(latestResponse.ok){const tradesData=await latestResponse.json();console.log(`‚úÖ Latest trades received, length: ${tradesData?.length||0}`);if(Array.isArray(tradesData)&&tradesData.length>0){latestTrades=tradesData;}}if(statistics||latestTrades.length>0){setInsiderData({statistics,latestTrades,type:'combined'});}else{console.warn('No insider data available');setInsiderData([]);}}catch(error){console.error(`‚ùå Error fetching insider data for ${stock.symbol}:`,error);setInsiderData([]);}}if(activeTab==='earnings'&&!analystEstimates){try{console.log(`üìä Fetching earnings data for ${stock.symbol}...`);const earningsResp=await fetch(`https://financialmodelingprep.com/stable/earnings?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`);if(!earningsResp.ok){console.error('Failed to fetch earnings calendar');setAnalystEstimates({annual:[],quarterly:[]});return;}const earningsData=await earningsResp.json();console.log(`‚úÖ Earnings raw data:`,{total:Array.isArray(earningsData)?earningsData.length:0,sample:earningsData[0],fields:earningsData[0]?Object.keys(earningsData[0]):[]});const quarterly=Array.isArray(earningsData)?earningsData.slice(0,12):[];const annual=[];const transformedQuarterly=quarterly.map(item=>({date:item.date,estimatedEpsAvg:item.epsEstimated||0,eps:item.epsActual||null,estimatedRevenueAvg:item.revenueEstimated||0,revenue:item.revenueActual||null,numberAnalystEstimatedEps:1}));setAnalystEstimates({annual:annual,quarterly:transformedQuarterly});console.log(`‚úÖ Transformed earnings data:`,{quarterly:transformedQuarterly.length,firstItem:transformedQuarterly[0]});}catch(error){console.error(`‚ùå Error fetching earnings data for ${stock.symbol}:`,error);setAnalystEstimates({annual:[],quarterly:[]});}}if(activeTab==='fundamentals'&&!fundamentalsData){try{console.log(`üìä Fetching fundamentals data for ${stock.symbol}...`);const[ratiosRes,growthRes]=await Promise.all([fetch(`https://financialmodelingprep.com/stable/ratios?symbol=${stock.symbol}&limit=1&apikey=${FMP_API_KEY}`),fetch(`https://financialmodelingprep.com/stable/financial-growth?symbol=${stock.symbol}&limit=5&apikey=${FMP_API_KEY}`)]);const ratiosData=ratiosRes.ok?await ratiosRes.json():null;const growthData=growthRes.ok?await growthRes.json():null;const ratios=ratiosData&&ratiosData.length>0?ratiosData[0]:null;const growth=growthData&&growthData.length>0?growthData[0]:null;const revenueGrowthRaw=growth?.revenueGrowth||growth?.revenuegrowth||growth?.revenueGrowthYoY;const netIncomeGrowthRaw=growth?.netIncomeGrowth||growth?.netincomegrowth||growth?.netIncomeGrowthYoY;const epsGrowthRaw=growth?.epsGrowth||growth?.epsgrowth||growth?.epsGrowthYoY||growth?.epsgrowthYoY;const revenueGrowthPct=revenueGrowthRaw!==null&&revenueGrowthRaw!==undefined?revenueGrowthRaw*100:null;const netIncomeGrowthPct=netIncomeGrowthRaw!==null&&netIncomeGrowthRaw!==undefined?netIncomeGrowthRaw*100:null;const epsGrowthPct=epsGrowthRaw!==null&&epsGrowthRaw!==undefined?epsGrowthRaw*100:null;setFundamentalsData({ratios:ratios||{},growth:growth||{},revenueGrowth:revenueGrowthPct,netIncomeGrowth:netIncomeGrowthPct,epsGrowth:epsGrowthPct,priceToBook:ratios?.priceToBookRatio||ratios?.priceToBook,priceToSales:ratios?.priceToSalesRatio||ratios?.priceToSales,evToEbitda:ratios?.evToEbitda||ratios?.enterpriseValueMultiple,roa:ratios?.returnOnAssets||ratios?.roa,roic:ratios?.returnOnInvestedCapital||ratios?.roic,operatingMargin:ratios?.operatingProfitMargin||ratios?.operatingMargin,quickRatio:ratios?.quickRatio});console.log(`‚úÖ Fundamentals data loaded for ${stock.symbol}`);}catch(error){console.error(`‚ùå Error fetching fundamentals data for ${stock.symbol}:`,error);setFundamentalsData({});}}if(activeTab==='financials'&&!incomeStatement){try{const response=await fetch(`https://financialmodelingprep.com/stable/income-statement?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`);if(!response.ok){console.error('Failed to fetch financials:',response.status);setIncomeStatement([]);return;}setIncomeStatement(await response.json());}catch(error){console.error(`‚ùå Error fetching financials for ${stock.symbol}:`,error);setIncomeStatement([]);}}if(activeTab==='charts'){try{console.log('üìä Charts tab activated, checking historical data...');const needsPrimary=!historicalData||historicalMeta.symbol!==stock.symbol||historicalMeta.timeframe!==chartTimeframe;console.log('needsPrimary:',needsPrimary,{historicalData:!!historicalData,metaSymbol:historicalMeta.symbol,stockSymbol:stock.symbol,metaTimeframe:historicalMeta.timeframe,chartTimeframe});if(needsPrimary){console.log(`Fetching historical chart data for ${stock.symbol} (${chartTimeframe})...`);const response=await fetch(`https://financialmodelingprep.com/stable/historical-chart/${chartTimeframe}?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`);console.log('Historical chart response status:',response.status);if(!response.ok){const errorText=await response.text();console.error('Historical chart fetch failed:',response.status,errorText);setHistoricalData([]);setHistoricalMeta({symbol:stock.symbol,timeframe:chartTimeframe});return;}const data=await response.json();console.log('Historical chart data received:',data.length,'candles');const normalized=Array.isArray(data)?data.slice(0,400).reverse():[];console.log('Normalized data:',normalized.length,'candles');setHistoricalData(normalized);setHistoricalMeta({symbol:stock.symbol,timeframe:chartTimeframe});console.log('‚úÖ Historical data set successfully');}}catch(chartError){console.error('‚ùå Error loading charts:',chartError);setHistoricalData([]);}}const cmp=(comparisonSymbol||'').trim().toUpperCase();const needsCompare=cmp&&(comparisonMeta.symbol!==cmp||comparisonMeta.timeframe!==chartTimeframe);if(!cmp){if(comparisonData)setComparisonData(null);if(comparisonMeta.symbol)setComparisonMeta({symbol:null,timeframe:null});}else if(needsCompare){setComparisonLoading(true);try{const resp=await fetch(`https://financialmodelingprep.com/stable/historical-chart/${chartTimeframe}?symbol=${cmp}&apikey=${FMP_API_KEY}`);if(!resp.ok)throw new Error('Failed to fetch comparison data');const d=await resp.json();setComparisonData(Array.isArray(d)?d.slice(0,400).reverse():[]);setComparisonMeta({symbol:cmp,timeframe:chartTimeframe});}catch(e){console.warn('Comparison fetch failed:',e?.message||e);setComparisonData(null);setComparisonMeta({symbol:null,timeframe:null});}finally{setComparisonLoading(false);}}if(activeTab==='technicals'&&!technicalData){const[sma50,sma200,ema20,rsi,stdDev,adx,ratingsSnap,ratingsHist]=await Promise.all([fetch(`https://financialmodelingprep.com/stable/technical-indicators/sma?symbol=${stock.symbol}&periodLength=50&timeframe=1day&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>[]),fetch(`https://financialmodelingprep.com/stable/technical-indicators/sma?symbol=${stock.symbol}&periodLength=200&timeframe=1day&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>[]),fetch(`https://financialmodelingprep.com/stable/technical-indicators/ema?symbol=${stock.symbol}&periodLength=20&timeframe=1day&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>[]),fetch(`https://financialmodelingprep.com/stable/technical-indicators/rsi?symbol=${stock.symbol}&periodLength=14&timeframe=1day&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>[]),fetch(`https://financialmodelingprep.com/stable/technical-indicators/standarddeviation?symbol=${stock.symbol}&periodLength=20&timeframe=1day&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>[]),fetch(`https://financialmodelingprep.com/stable/technical-indicators/adx?symbol=${stock.symbol}&periodLength=14&timeframe=1day&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>[]),fetch(`https://financialmodelingprep.com/stable/ratings-snapshot?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>null),fetch(`https://financialmodelingprep.com/stable/ratings-historical?symbol=${stock.symbol}&apikey=${FMP_API_KEY}`).then(r=>r.json()).catch(()=>[])]);setTechnicalData({sma50:sma50[0]?.sma,sma200:sma200[0]?.sma,ema20:ema20[0]?.ema,rsi:rsi[0]?.rsi,stdDev:stdDev[0]?.standardDeviation,adx:adx[0]?.adx});const snapshotData=Array.isArray(ratingsSnap)?ratingsSnap[0]:ratingsSnap;console.log(`üìä Ratings data for ${stock.symbol}:`,{snapshot:snapshotData?'LOADED':'MISSING',ratingScore:snapshotData?.ratingScore||'N/A',recommendation:snapshotData?.ratingRecommendation||'N/A'});setRatingsData({snapshot:snapshotData,history:ratingsHist||[]});}if(activeTab==='ai-predictions'&&!aiAnalysis){console.log(`ü§ñ AI PREDICTIONS TAB - Starting analysis for ${stock.symbol}`);console.log('üîç Current aiAnalysis state:',aiAnalysis);console.log('üîç Current aiLoading state:',aiLoading);setLoadingTabData(false);setAiLoading(true);try{console.log('üì° Calling aiAnalyzer.analyzeStock...');const analysis=await aiAnalyzer.analyzeStock(stock);console.log('‚úÖ AI Analysis received:',analysis);console.log('‚úÖ Analysis has recommendations?',!!analysis?.recommendation);console.log('‚úÖ Analysis has predictions?',!!analysis?.predictions);setAiAnalysis(analysis);console.log('‚úÖ setAiAnalysis() called successfully');}catch(err){console.error('‚ùå AI Analysis error:',err);console.log('üîÑ Using fallback analysis...');const fallback=aiAnalyzer.getFallbackAnalysis(stock);console.log('üîÑ Fallback data:',fallback);setAiAnalysis(fallback);}finally{setAiLoading(false);console.log('‚úÖ AI loading state set to false');}}}catch(err){console.error(`Error loading ${activeTab} data:`,err);setError(err.message);}setLoadingTabData(false);};if(['insider','earnings','financials','charts','patterns','technicals','analyst-ratings','ai-predictions','news-sentiment','sentiment-leaderboard'].includes(activeTab)){loadTabData();}if(activeTab==='portfolio'&&!portfolioOptimization){runPortfolioOptimization();}if(activeTab==='similar'&&selectedStock&&!similarStocks){findSimilarStocks();}if(activeTab==='heatmap'&&!heatmapData&&stocks.length>0){setHeatmapData(stocks);}},[activeTab,stock.symbol,chartTimeframe,comparisonSymbol]);useEffect(()=>{return()=>{if(stock?.symbol){console.log(`üßπ Cleaning up news subscription for ${stock.symbol}`);newsManager.stopPolling(stock.symbol);}};},[stock?.symbol]);return React.createElement("div",{className:"modal-overlay",onClick:onClose},React.createElement("div",{id:"stock-modal-content",className:"glass-elevated rounded-2xl max-w-6xl w-full mx-auto my-8 animate-slide-up max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"flex items-start justify-between p-6 border-b border-slate-700/30 flex-shrink-0"},React.createElement("div",null,React.createElement("div",{className:"flex items-center gap-4 mb-2"},React.createElement("h2",{className:"text-3xl font-bold text-white"},stock.symbol),React.createElement(DataFreshnessIndicator,{timestamp:stock.fetchedAt||stock.timestamp,type:"stock"}),React.createElement("span",{className:"chip bg-slate-700 text-slate-300"},stock.sector||'Unknown'),React.createElement("span",{className:"chip bg-slate-700 text-slate-300"},stock.industry||'Unknown'),stock.index&&React.createElement("span",{className:"chip bg-cyan-600/20 text-cyan-400 border border-cyan-500/30"},stock.index)),React.createElement("div",{className:"flex items-center gap-4 text-sm"},React.createElement("span",{className:"text-slate-400"},stock.companyName||stock.name||'‚Äî'))),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white text-2xl leading-none"},"\xD7")),React.createElement("div",{className:"flex gap-2 px-6 pt-4 border-b border-slate-700/30 overflow-x-auto flex-shrink-0"},['overview','simplified','ai-analysis','news-sentiment','sentiment-leaderboard','fundamentals','charts','patterns','technicals','analyst-ratings','insider','earnings','financials','watchlist'].map(tab=>React.createElement("button",{key:tab,onClick:e=>{e.stopPropagation();setActiveTab(tab);},className:`tab-btn ${activeTab===tab?'active':''}`},tab==='simplified'?'üí° Simplified':tab==='ai-analysis'?'ü§ñ AI Analysis':tab==='news-sentiment'?'üì∞ News & Sentiment':tab==='sentiment-leaderboard'?'üìä Social Leaderboard':tab==='patterns'?'üìà Chart Patterns':tab==='insider'?'üîç Insider ¬∑ Advanced':tab==='analyst-ratings'?'‚≠ê Analyst Ratings':tab==='earnings'?'üìà Earnings':tab==='financials'?'üí∞ Financials ¬∑ Advanced':tab==='charts'?'üìà Charts ¬∑ Advanced':tab==='watchlist'?'‚≠ê Watchlist':tab.charAt(0).toUpperCase()+tab.slice(1)))),React.createElement("div",{className:"p-6 overflow-y-auto flex-1",onClick:e=>e.stopPropagation()},error&&React.createElement("div",{className:"mb-4 p-4 bg-red-500/10 border border-red-500/20 rounded-lg"},React.createElement("div",{className:"flex items-center gap-2 text-red-400"},React.createElement("i",{className:"fas fa-exclamation-triangle"}),React.createElement("span",{className:"font-semibold"},"Error loading data:")),React.createElement("p",{className:"text-sm text-slate-300 mt-1"},error),React.createElement("button",{onClick:()=>setError(null),className:"mt-2 text-xs text-red-400 hover:text-red-300"},"Dismiss")),loadingTabData?React.createElement("div",{className:"text-center py-12"},React.createElement("div",{className:"animate-pulse text-cyan-400 text-4xl mb-4"},React.createElement("i",{className:"fas fa-spinner animate-spin"})),React.createElement("div",{className:"text-slate-400"},"Loading ",activeTab," data...")):activeTab==='overview'?React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"grid grid-cols-4 gap-4"},React.createElement("div",{className:"glass-card p-5 rounded-xl relative"},React.createElement("div",{className:"text-xs text-slate-500 mb-1 flex items-center gap-2"},React.createElement("span",null,"Current Price"),isLiveUpdating&&React.createElement("span",{className:"flex items-center gap-1 text-green-400 animate-pulse"},React.createElement("div",{className:"w-1.5 h-1.5 bg-green-400 rounded-full"}),"LIVE")),React.createElement("div",{className:`text-3xl font-bold text-white transition-all ${isLiveUpdating?'scale-105':''}`},"$",livePrice?.toFixed(2)||stock.price?.toFixed(2)||'‚Äî'),React.createElement("div",{className:`text-sm font-semibold mt-1 ${getSentimentColor(liveChangePct||stock.changePct)}`},formatPercent(liveChangePct||stock.changePct,2)),priceHistory.length>5&&React.createElement("div",{className:"mt-2 h-8 flex items-end gap-0.5"},priceHistory.slice(-20).map((point,i)=>{const min=Math.min(...priceHistory.slice(-20).map(p=>p.price));const max=Math.max(...priceHistory.slice(-20).map(p=>p.price));const range=max-min;const height=range>0?(point.price-min)/range*100:50;const color=i>0&&point.price>=priceHistory[priceHistory.length-20+i-1]?.price?'bg-green-500':'bg-red-500';return React.createElement("div",{key:i,className:`flex-1 ${color} opacity-50 rounded-t`,style:{height:`${height}%`,minHeight:'2px'}});}))),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Market Cap"),React.createElement("div",{className:"text-2xl font-bold text-white"},formatNumber(stock.marketCap))),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1 flex items-center gap-1"},"\uD83D\uDE34 Sleep-Well Score",React.createElement("span",{className:"text-slate-600 cursor-help",title:"How comfortable you can sleep owning this stock - based on volatility, debt, and technical signals"},"?")),React.createElement("div",{className:`text-3xl font-bold ${calcSleepWellScore(stock)>=80?'text-green-400':calcSleepWellScore(stock)>=60?'text-yellow-400':'text-red-400'}`},calcSleepWellScore(stock),"/100"),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},calcSleepWellScore(stock)>=80?'Rest easy':calcSleepWellScore(stock)>=60?'Fair volatility':'Higher risk')),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1 flex items-center gap-1"},"\uD83D\uDCCA Stock Grade",React.createElement("span",{className:"text-slate-600 cursor-help",title:"Overall grade based on valuation, growth, financial health, and profitability"},"?")),React.createElement("div",{className:`text-3xl font-bold ${calculateStockGrade(stock).letterGrade==='A'?'text-green-400':calculateStockGrade(stock).letterGrade==='B'?'text-blue-400':calculateStockGrade(stock).letterGrade==='C'?'text-yellow-400':calculateStockGrade(stock).letterGrade==='D'?'text-orange-400':'text-red-400'}`},calculateStockGrade(stock).letterGrade),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},calculateStockGrade(stock).percentage,"% score")),React.createElement("div",{className:"glass-card p-5 rounded-xl flex items-center justify-center"},React.createElement("button",{onClick:()=>toggleWatchlist(stock.symbol),className:`px-6 py-3 rounded-lg font-semibold text-sm transition ${isWatchlisted?'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30':'bg-slate-700 text-slate-300 hover:bg-slate-600'}`},isWatchlisted?'‚òÖ Watchlisted':'‚òÜ Add to Watchlist'))),stock.mlPrediction&&stock.mlPrediction.predPct!=null&&React.createElement("div",{className:"glass-card p-6 rounded-xl border border-purple-500/20"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-robot text-purple-400 text-xl"}),React.createElement("h3",{className:"text-lg font-bold text-white"},"ML 30-Day Forecast"),React.createElement("span",{className:"chip bg-purple-500/20 text-purple-400 text-xs"},React.createElement("i",{className:"fas fa-brain mr-1"}),"TensorFlow.js"))),React.createElement("div",{className:"grid grid-cols-3 gap-4"},React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Predicted Change"),React.createElement("div",{className:`text-3xl font-bold ${stock.mlPrediction.predPct>0?'text-green-400':stock.mlPrediction.predPct<0?'text-red-400':'text-slate-400'}`},formatMLPrediction(stock.mlPrediction.predPct)),stock.mlPrediction.predictedPrice&&React.createElement("div",{className:"text-xs text-slate-500 mt-2"},"Target: $",stock.mlPrediction.predictedPrice)),React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Confidence"),React.createElement("div",{className:"text-3xl font-bold text-white"},stock.mlPrediction.conf,"%"),React.createElement("div",{className:"text-xs text-slate-500 mt-2"},stock.mlPrediction.conf>=70?'High':stock.mlPrediction.conf>=50?'Medium':'Low')),React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Trend Signal"),React.createElement("div",{className:"text-2xl font-bold"},stock.mlPrediction.trend==='bullish'?'üîº':stock.mlPrediction.trend==='bearish'?'üîΩ':'‚û°Ô∏è'),React.createElement("div",{className:`text-sm font-semibold mt-2 ${stock.mlPrediction.trend==='bullish'?'text-green-400':stock.mlPrediction.trend==='bearish'?'text-red-400':'text-slate-400'}`},stock.mlPrediction.trend.charAt(0).toUpperCase()+stock.mlPrediction.trend.slice(1)))),stock.mlPrediction.interpretation&&React.createElement("div",{className:"mt-3 p-3 bg-gradient-to-r from-purple-900/30 to-blue-900/30 border border-purple-700/50 rounded-lg"},React.createElement("div",{className:"flex items-start gap-2"},React.createElement("i",{className:"fas fa-chart-line text-purple-400 text-sm mt-0.5"}),React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"text-xs font-semibold text-purple-300 mb-1"},"Model Interpretation"),React.createElement("div",{className:"text-xs text-slate-300 leading-relaxed"},stock.mlPrediction.interpretation)))),React.createElement("div",{className:"mt-4 p-3 bg-slate-800/40 border border-slate-700/50 rounded-lg"},React.createElement("div",{className:"flex items-start gap-2"},React.createElement("i",{className:"fas fa-info-circle text-purple-400 text-sm mt-0.5"}),React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"text-xs font-semibold text-purple-300 mb-1"},"How it works"),React.createElement("div",{className:"text-xs text-slate-400 leading-relaxed"},"This prediction uses TensorFlow.js to analyze the last 60 days of price history with linear regression. It forecasts short-term price movement based on recent trends. Remember: ML predictions are estimates, not guarantees. Always combine with fundamental analysis."))))),(()=>{const ultimateScore=ultimateEngine.calculateUltimateScore(stock);const patterns=ultimateEngine.detectPatterns(stock);const tradingPlan=ultimateEngine.generateTradingPlan(stock,ultimateScore);const insights=ultimateEngine.generateAIInsights(stock,ultimateScore,patterns,tradingPlan);return React.createElement("div",{className:"glass-card p-6 rounded-xl border border-indigo-500/20 bg-gradient-to-br from-indigo-500/5 to-purple-500/5"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("i",{className:"fas fa-brain text-indigo-400 text-xl"}),React.createElement("h3",{className:"text-lg font-bold text-white"},"Ultimate Analysis"),React.createElement("span",{className:"chip bg-indigo-500/20 text-indigo-400 text-xs"},React.createElement("i",{className:"fas fa-star mr-1"}),"15-Factor Scoring")),React.createElement("span",{className:`px-4 py-2 rounded-lg font-bold text-lg ${tradingPlan.signal==='STRONG BUY'?'bg-emerald-500 text-white':tradingPlan.signal==='BUY'?'bg-green-500 text-white':tradingPlan.signal==='SELL'?'bg-red-500 text-white':'bg-amber-500 text-white'}`},tradingPlan.signal)),React.createElement("div",{className:"grid grid-cols-4 gap-4 mb-4"},React.createElement("div",{className:"col-span-1 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-xl p-6 text-center"},React.createElement("div",{className:"text-sm text-indigo-200 mb-2"},"Ultimate Score"),React.createElement("div",{className:"text-5xl font-bold text-white mb-1"},ultimateScore.score),React.createElement("div",{className:"text-xs text-indigo-200"},"out of 100"),React.createElement("div",{className:"mt-3 text-xs text-white bg-white/20 rounded px-2 py-1"},ultimateScore.confidence," Confidence")),React.createElement("div",{className:"col-span-3 space-y-2"},React.createElement("div",{className:"grid grid-cols-2 gap-2"},Object.entries(ultimateScore.factors).slice(0,8).map(_ref17=>{let[factor,points]=_ref17;return React.createElement("div",{key:factor,className:"glass-card p-3 rounded-lg flex items-center justify-between"},React.createElement("span",{className:"text-sm text-slate-300 capitalize"},factor.replace(/_/g,' ')),React.createElement("span",{className:"text-sm font-bold text-indigo-400"},points," pts"));})))),React.createElement("div",{className:"bg-slate-900/50 rounded-xl p-4 mb-4 border border-indigo-500/20"},React.createElement("div",{className:"text-sm text-slate-300 leading-relaxed mb-3"},insights.summary),insights.strengths.length>0&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"text-xs font-semibold text-green-400 mb-2 flex items-center gap-2"},React.createElement("i",{className:"fas fa-check-circle"}),"Strengths"),React.createElement("div",{className:"space-y-1"},insights.strengths.map((strength,idx)=>React.createElement("div",{key:idx,className:"text-xs text-slate-400 flex items-start gap-2"},React.createElement("span",{className:"text-green-400"},"\u2022"),React.createElement("span",null,strength))))),insights.risks.length>0&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"text-xs font-semibold text-red-400 mb-2 flex items-center gap-2"},React.createElement("i",{className:"fas fa-exclamation-triangle"}),"Risks"),React.createElement("div",{className:"space-y-1"},insights.risks.map((risk,idx)=>React.createElement("div",{key:idx,className:"text-xs text-slate-400 flex items-start gap-2"},React.createElement("span",{className:"text-red-400"},"\u2022"),React.createElement("span",null,risk))))),insights.opportunities.length>0&&React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"text-xs font-semibold text-blue-400 mb-2 flex items-center gap-2"},React.createElement("i",{className:"fas fa-lightbulb"}),"Opportunities"),React.createElement("div",{className:"space-y-1"},insights.opportunities.map((opp,idx)=>React.createElement("div",{key:idx,className:"text-xs text-slate-400 flex items-start gap-2"},React.createElement("span",{className:"text-blue-400"},"\u2022"),React.createElement("span",null,opp)))))),React.createElement("div",{className:"bg-gradient-to-r from-indigo-900/30 to-purple-900/30 rounded-xl p-4 border border-indigo-500/30"},React.createElement("div",{className:"flex items-center gap-2 mb-3"},React.createElement("i",{className:"fas fa-chart-line text-indigo-400"}),React.createElement("h4",{className:"text-sm font-bold text-white"},"Trading Plan")),React.createElement("div",{className:"grid grid-cols-4 gap-3 mb-3"},React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Entry Price"),React.createElement("div",{className:"text-lg font-bold text-white"},"$",tradingPlan.entry.toFixed(2))),React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Target Price"),React.createElement("div",{className:"text-lg font-bold text-green-400"},"$",tradingPlan.target.toFixed(2)),React.createElement("div",{className:"text-xs text-green-300"},"+",((tradingPlan.target-tradingPlan.entry)/tradingPlan.entry*100).toFixed(1),"%")),React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Stop Loss"),React.createElement("div",{className:"text-lg font-bold text-red-400"},"$",tradingPlan.stopLoss.toFixed(2)),React.createElement("div",{className:"text-xs text-red-300"},"-",((tradingPlan.entry-tradingPlan.stopLoss)/tradingPlan.entry*100).toFixed(1),"%")),React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"R:R Ratio"),React.createElement("div",{className:"text-lg font-bold text-indigo-400"},tradingPlan.riskRewardRatio,":1"))),React.createElement("div",{className:"grid grid-cols-2 gap-3 mb-3"},React.createElement("div",{className:"bg-slate-900/50 rounded p-2"},React.createElement("div",{className:"text-xs text-slate-500"},"Position Size"),React.createElement("div",{className:"text-sm font-bold text-white"},tradingPlan.positionSize)),React.createElement("div",{className:"bg-slate-900/50 rounded p-2"},React.createElement("div",{className:"text-xs text-slate-500"},"Time Horizon"),React.createElement("div",{className:"text-sm font-bold text-white"},tradingPlan.timeframe))),tradingPlan.reasoning.length>0&&React.createElement("div",{className:"bg-slate-900/50 rounded p-3"},React.createElement("div",{className:"text-xs font-semibold text-indigo-300 mb-2"},"Analysis Reasoning:"),React.createElement("div",{className:"space-y-1"},tradingPlan.reasoning.map((reason,idx)=>React.createElement("div",{key:idx,className:"text-xs text-slate-400 flex items-start gap-2"},React.createElement("span",{className:"text-indigo-400"},"\u2192"),React.createElement("span",null,reason))))),React.createElement("div",{className:"mt-3 p-3 bg-indigo-500/10 border border-indigo-500/30 rounded"},React.createElement("div",{className:"text-xs font-semibold text-indigo-300 mb-1"},React.createElement("i",{className:"fas fa-star mr-1"}),"Recommendation"),React.createElement("div",{className:"text-xs text-slate-300 leading-relaxed"},insights.recommendation))),patterns.length>0&&React.createElement("div",{className:"mt-4 bg-slate-900/50 rounded-xl p-4 border border-slate-700/50"},React.createElement("div",{className:"flex items-center gap-2 mb-3"},React.createElement("i",{className:"fas fa-shapes text-purple-400"}),React.createElement("h4",{className:"text-sm font-bold text-white"},"Detected Patterns")),React.createElement("div",{className:"grid grid-cols-2 gap-2"},patterns.map((pattern,idx)=>React.createElement("div",{key:idx,className:`p-3 rounded-lg border ${pattern.type==='bullish'?'bg-green-500/5 border-green-500/30':'bg-red-500/5 border-red-500/30'}`},React.createElement("div",{className:"flex items-center justify-between mb-1"},React.createElement("span",{className:`text-sm font-semibold ${pattern.type==='bullish'?'text-green-400':'text-red-400'}`},pattern.name),React.createElement("span",{className:"text-xs text-slate-500"},(pattern.confidence*100).toFixed(0),"% conf.")),React.createElement("div",{className:"text-xs text-slate-400"},pattern.description))))));})(),stock.verdict&&React.createElement("div",{className:`p-6 rounded-xl ${stock.verdict==='STRONG BUY'||stock.verdict==='BUY'?'verdict-bullish':stock.verdict==='SELL'||stock.verdict==='REDUCE'?'verdict-bearish':'verdict-neutral'}`},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("span",{className:"text-2xl font-bold text-white"},stock.verdict),React.createElement("span",{className:"badge bg-slate-800/50 text-slate-300"},"Score: ",stock.aiScore||0,"/100"),React.createElement("span",{className:"badge bg-slate-800/50 text-slate-300"},"Confidence: ",stock.confidence||0,"%"))),React.createElement("div",{className:"text-sm text-slate-300 leading-relaxed mb-4"},stock.execSummary||'AI analysis unavailable'),stock.subscores&&React.createElement("div",{className:"grid grid-cols-3 gap-3 mb-4"},React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Fundamentals"),React.createElement("div",{className:"text-lg font-bold text-white"},Math.round(stock.subscores.fundamental),"/100")),React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Technicals"),React.createElement("div",{className:"text-lg font-bold text-white"},Math.round(stock.subscores.technical),"/100")),React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Risk Level"),React.createElement("div",{className:"text-lg font-bold text-white"},Math.round(stock.subscores.risk),"/100"))),React.createElement("div",{className:"mb-4"},React.createElement("button",{onClick:()=>setShowExplainScore(v=>!v),className:"px-3 py-1.5 rounded-lg text-xs font-semibold bg-slate-800/60 hover:bg-slate-700/60 border border-slate-700/60 text-slate-200"},showExplainScore?'Hide explanation':'Explain this rating')),showExplainScore&&React.createElement("div",{className:"space-y-4 mb-4"},React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"flex items-center justify-between mb-2"},React.createElement("div",{className:"text-xs font-bold text-slate-300 uppercase"},"How the score is computed"),React.createElement("div",{className:"text-xs text-slate-400"},"Weights: 55% Fundamentals \xB7 35% Technicals \xB7 10% Risk")),React.createElement("div",{className:"text-xs text-slate-300 leading-relaxed"},"Deterministic rules adjust the subscores, then the final score is computed as",' ',React.createElement("span",{className:"font-mono"},"0.55\xD7Fundamentals + 0.35\xD7Technicals + 0.10\xD7(100\u2212Risk)"),".")),React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",{className:"text-xs font-bold text-slate-300 uppercase"},"Top drivers (impact on score)"),React.createElement("div",{className:"text-xs text-slate-400"},"Current: ",explainNow.score,"/100",explainThresholds?.nextUpScore!=null?` ¬∑ Next upgrade: ${explainThresholds.nextUpScore} (+${explainThresholds.toNextUp})`:'')),React.createElement("div",{className:"space-y-2"},(explainNow.topImpacts||[]).length===0?React.createElement("div",{className:"text-xs text-slate-500"},"No rule-level drivers available."):(explainNow.topImpacts||[]).map((d,i)=>React.createElement("div",{key:i,className:"flex items-start justify-between gap-3 text-xs"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"font-semibold text-slate-200"},d.label),React.createElement("div",{className:"text-slate-400 mt-0.5"},d.detail)),React.createElement("div",{className:`font-mono font-bold ${d.impact>=0?'text-green-300':'text-red-300'}`},d.impact>=0?'+':'',d.impact.toFixed(1)))))),React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs font-bold text-slate-300 uppercase mb-2"},"What changed since last snapshot"),!prevAnalysis?React.createElement("div",{className:"text-xs text-slate-500"},"No previous snapshot found yet (refresh once to start tracking changes)."):React.createElement("div",{className:"space-y-2 text-xs"},React.createElement("div",{className:"text-slate-400"},"Previous saved: ",prevSnapshotEntry?.timestamp?`${Math.max(1,Math.round((Date.now()-prevSnapshotEntry.timestamp)/60000))} min ago`:'‚Äî'),React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"text-slate-300"},"AI Score"),React.createElement("div",{className:"font-mono font-bold text-white"},num(prevAnalysis.aiScore,0)," \u2192 ",num(stock.aiScore,0),React.createElement("span",{className:`ml-2 ${num(stock.aiScore,0)-num(prevAnalysis.aiScore,0)>=0?'text-green-300':'text-red-300'}`},"(",num(stock.aiScore,0)-num(prevAnalysis.aiScore,0)>=0?'+':'',num(stock.aiScore,0)-num(prevAnalysis.aiScore,0),")"))),React.createElement("div",{className:"grid grid-cols-3 gap-2"},React.createElement("div",{className:"bg-slate-800/40 border border-slate-700/40 rounded-lg p-2"},React.createElement("div",{className:"text-slate-500"},"Fundamentals"),React.createElement("div",{className:"font-mono text-slate-200"},Math.round(num(prevAnalysis.subscores?.fundamental,0))," \u2192 ",Math.round(num(stock.subscores?.fundamental,0)))),React.createElement("div",{className:"bg-slate-800/40 border border-slate-700/40 rounded-lg p-2"},React.createElement("div",{className:"text-slate-500"},"Technicals"),React.createElement("div",{className:"font-mono text-slate-200"},Math.round(num(prevAnalysis.subscores?.technical,0))," \u2192 ",Math.round(num(stock.subscores?.technical,0)))),React.createElement("div",{className:"bg-slate-800/40 border border-slate-700/40 rounded-lg p-2"},React.createElement("div",{className:"text-slate-500"},"Risk"),React.createElement("div",{className:"font-mono text-slate-200"},Math.round(num(prevAnalysis.subscores?.risk,0))," \u2192 ",Math.round(num(stock.subscores?.risk,0))))))),React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs font-bold text-slate-300 uppercase mb-2"},"Sensitivity (what would move the rating)"),(sensitivity||[]).length===0?React.createElement("div",{className:"text-xs text-slate-500"},"No high-impact single-factor sensitivities detected."):React.createElement("div",{className:"space-y-2"},(sensitivity||[]).map((s,i)=>React.createElement("div",{key:i,className:"flex items-start justify-between gap-3 text-xs"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"font-semibold text-slate-200"},s.title),React.createElement("div",{className:"text-slate-400 mt-0.5"},s.note)),React.createElement("div",{className:`font-mono font-bold ${s.delta>=0?'text-green-300':'text-red-300'}`},s.delta>=0?'+':'',s.delta," \u2192 ",s.newScore)))),React.createElement("div",{className:"mt-3 text-xs text-slate-500"},"Sensitivities change one input at a time to the nearest model threshold (not a forecast)."))),stock.reassurance&&React.createElement("div",{className:"mb-4 p-3 bg-slate-800/40 border border-slate-700/50 rounded-lg text-xs text-slate-300"},React.createElement("span",{className:"font-semibold text-slate-200"},"Note:")," ",stock.reassurance),stock.topDrivers&&React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-4"},React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs font-bold text-green-400 mb-2 uppercase"},"What's helping"),React.createElement("div",{className:"space-y-2"},(stock.topDrivers.positive||[]).length===0?React.createElement("div",{className:"text-xs text-slate-500"},"No strong positive drivers detected."):(stock.topDrivers.positive||[]).map((d,i)=>React.createElement("div",{key:i,className:"text-xs"},React.createElement("div",{className:"font-semibold text-green-300"},d.factor),React.createElement("div",{className:"text-slate-400 mt-0.5"},d.detail))))),React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs font-bold text-red-400 mb-2 uppercase"},"What's hurting"),React.createElement("div",{className:"space-y-2"},(stock.topDrivers.negative||[]).length===0?React.createElement("div",{className:"text-xs text-slate-500"},"No strong negative drivers detected."):(stock.topDrivers.negative||[]).map((d,i)=>React.createElement("div",{key:i,className:"text-xs"},React.createElement("div",{className:"font-semibold text-red-300"},d.factor),React.createElement("div",{className:"text-slate-400 mt-0.5"},d.detail)))))),stock.takeaway&&React.createElement("div",{className:"mb-4 p-4 bg-cyan-500/10 border border-cyan-500/20 rounded-xl"},React.createElement("div",{className:"text-xs font-bold text-cyan-300 uppercase mb-2"},"AI Takeaway"),React.createElement("div",{className:"text-sm text-slate-200 leading-relaxed"},stock.takeaway)),(stock.bullFactors||stock.bearFactors)&&React.createElement("div",{className:"grid grid-cols-2 gap-4"},React.createElement("div",null,React.createElement("div",{className:"text-xs font-bold text-green-400 mb-2 uppercase"},"Bullish Factors"),React.createElement("div",{className:"space-y-2"},(showAllFactors?stock.bullFactors||[]:(stock.bullFactors||[]).slice(0,3)).map((f,i)=>React.createElement("div",{key:i,className:"text-xs bg-green-500/10 border border-green-500/20 rounded-lg p-2"},React.createElement("div",{className:"font-semibold text-green-300"},f.factor),React.createElement("div",{className:"text-slate-400 mt-1"},f.detail))))),React.createElement("div",null,React.createElement("div",{className:"text-xs font-bold text-red-400 mb-2 uppercase"},"Bearish Factors"),React.createElement("div",{className:"space-y-2"},(showAllFactors?stock.bearFactors||[]:(stock.bearFactors||[]).slice(0,3)).map((f,i)=>React.createElement("div",{key:i,className:"text-xs bg-red-500/10 border border-red-500/20 rounded-lg p-2"},React.createElement("div",{className:"font-semibold text-red-300"},f.factor),React.createElement("div",{className:"text-slate-400 mt-1"},f.detail)))))),((stock.bullFactors||[]).length>3||(stock.bearFactors||[]).length>3)&&React.createElement("div",{className:"mt-3 flex justify-center"},React.createElement("button",{onClick:()=>setShowAllFactors(v=>!v),className:"px-3 py-1.5 rounded-lg text-xs font-semibold bg-slate-800/60 hover:bg-slate-700/60 border border-slate-700/60 text-slate-200"},showAllFactors?'Show fewer factors':'Show all factors'))),stock.watchlistGuidance&&React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},stock.watchlistGuidance.headline||'What to watch next'),React.createElement("div",{className:"grid grid-cols-3 gap-3"},(stock.watchlistGuidance.items||[]).map((it,idx)=>React.createElement("div",{key:idx,className:"bg-slate-800/40 border border-slate-700/40 rounded-lg p-3"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},it.label),React.createElement("div",{className:"text-xs text-slate-200 leading-relaxed"},it.value))))),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-white mb-1"},"Export Analysis"),React.createElement("p",{className:"text-xs text-slate-400"},"Download this stock analysis as a professional PDF tear sheet")),React.createElement("button",{onClick:()=>exportStockTearSheet(stock),className:"px-6 py-3 bg-gradient-to-r from-red-600 to-red-500 hover:from-red-500 hover:to-red-400 text-white rounded-lg font-bold flex items-center gap-2 shadow-lg shadow-red-500/20 transition-all"},React.createElement("i",{className:"fas fa-file-pdf text-lg"}),React.createElement("span",null,"Download PDF")))),(stock.description||stock.ceo||stock.website)&&React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Company Info"),stock.description&&React.createElement("div",{className:"mb-4"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Description"),React.createElement("div",{className:"text-sm text-slate-300 leading-relaxed"},stock.description)),React.createElement("div",{className:"grid grid-cols-2 gap-4 text-sm"},stock.ceo&&React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"CEO"),React.createElement("div",{className:"text-white"},stock.ceo)),stock.website&&React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Website"),React.createElement("a",{href:stock.website.startsWith('http')?stock.website:`https://${stock.website}`,target:"_blank",rel:"noopener noreferrer",className:"text-cyan-400 hover:underline"},stock.website.replace(/^https?:\/\//,'')))))):activeTab==='ai-analysis'?React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"glass-card p-6 rounded-xl border border-blue-500/20"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("i",{className:"fas fa-robot text-blue-400 text-2xl"}),React.createElement("div",null,React.createElement("h3",{className:"text-xl font-bold text-white"},"AI Stock Analysis"),React.createElement("p",{className:"text-sm text-slate-400"},"Professional analysis powered by DeepSeek AI"))),React.createElement("button",{onClick:async()=>{setAiLoading(true);setDeepseekLoading(true);try{const analysis=await getDeepSeekAnalysis(stock);setDeepseekAnalysis(analysis);}catch(error){setDeepseekAnalysis(`Error: ${error.message}`);}finally{setDeepseekLoading(false);setAiLoading(false);}},disabled:aiLoading,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},aiLoading?React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-spinner animate-spin"}),"Analyzing..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-brain"}),deepseekAnalysis?'Refresh Analysis':'Generate AI Analysis'))),React.createElement("div",{className:"flex items-center gap-3 pt-4 border-t border-slate-700/30"},React.createElement("i",{className:"fas fa-info-circle text-blue-400"}),React.createElement("span",{className:"text-sm text-slate-400"},"Get comprehensive analysis from ",React.createElement("strong",{className:"text-blue-400"},"DeepSeek AI")))),aiLoading&&!deepseekAnalysis?React.createElement("div",{className:"glass-card p-12 rounded-xl text-center"},React.createElement("i",{className:"fas fa-robot text-blue-400 text-5xl mb-4 animate-pulse"}),React.createElement("div",{className:"text-xl font-bold text-white mb-2"},"Analyzing ",stock.symbol,"..."),React.createElement("div",{className:"text-slate-400"},"DeepSeek AI is processing comprehensive stock data")):deepseekAnalysis?React.createElement("div",{className:"max-w-4xl mx-auto"},React.createElement("div",{className:"glass-card p-8 rounded-xl border-2 border-blue-500/30"},React.createElement("div",{className:"flex items-center gap-2 mb-6"},React.createElement("span",{className:"px-4 py-2 rounded-full font-semibold text-sm bg-blue-500/20 text-blue-400"},React.createElement("i",{className:"fas fa-rocket mr-2"}),"DeepSeek AI Analysis"),deepseekLoading&&React.createElement("i",{className:"fas fa-spinner animate-spin text-blue-400 ml-2"})),React.createElement("div",{className:"prose prose-invert prose-slate max-w-none"},React.createElement("div",{className:"text-slate-200 leading-relaxed whitespace-pre-wrap",style:{fontFamily:'system-ui, -apple-system, sans-serif',fontSize:'0.95rem',lineHeight:'1.7'},dangerouslySetInnerHTML:{__html:deepseekAnalysis.replace(/^# (.*?)$/gm,'<h1 class="text-2xl font-bold text-white mt-6 mb-3">$1</h1>').replace(/^## (.*?)$/gm,'<h2 class="text-xl font-bold text-white mt-5 mb-2">$1</h2>').replace(/^### (.*?)$/gm,'<h3 class="text-lg font-semibold text-white mt-4 mb-2">$1</h3>').replace(/^\* (.*?)$/gm,'<li class="ml-4 mb-1">‚Ä¢ $1</li>').replace(/^\d+\. (.*?)$/gm,'<li class="ml-4 mb-1">$1</li>').replace(/\*\*(.*?)\*\*/g,'<strong class="text-white font-semibold">$1</strong>').replace(/\n\n/g,'<br/><br/>')}})))):React.createElement("div",{className:"glass-card p-12 rounded-xl text-center border-2 border-dashed border-slate-700"},React.createElement("i",{className:"fas fa-magic text-blue-400 text-5xl mb-4 opacity-50"}),React.createElement("div",{className:"text-xl font-bold text-white mb-2"},"Ready for AI Analysis"),React.createElement("div",{className:"text-slate-400 mb-4"},"Click \"Generate AI Analysis\" to get insights from DeepSeek AI"),React.createElement("div",{className:"text-sm text-slate-500"},"DeepSeek will analyze ",stock.symbol,"'s fundamentals, technicals, and market position"))):activeTab==='news-sentiment'?React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6"},newsSentiment&&React.createElement("div",{className:`glass-card p-6 rounded-xl border-2 ${newsSentiment.label==='bullish'?'border-green-500/30 bg-green-500/5':newsSentiment.label==='bearish'?'border-red-500/30 bg-red-500/5':'border-slate-500/30 bg-slate-500/5'}`},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("div",null,React.createElement("h3",{className:"text-xl font-bold text-white mb-1"},"\uD83D\uDCF0 News Sentiment"),React.createElement("p",{className:"text-sm text-slate-400"},"Based on ",newsSentiment.count," articles")),React.createElement("div",{className:"text-right"},React.createElement("div",{className:`text-4xl font-bold ${newsSentiment.label==='bullish'?'text-green-400':newsSentiment.label==='bearish'?'text-red-400':'text-slate-400'}`},newsSentiment.label==='bullish'?'üìà':newsSentiment.label==='bearish'?'üìâ':'‚û°Ô∏è'),React.createElement("div",{className:`text-xl font-bold mt-2 ${newsSentiment.label==='bullish'?'text-green-400':newsSentiment.label==='bearish'?'text-red-400':'text-slate-400'}`},newsSentiment.label.toUpperCase()))),React.createElement("div",{className:"grid grid-cols-3 gap-3"},React.createElement("div",{className:"text-center p-2 bg-green-500/10 rounded-lg"},React.createElement("div",{className:"text-xl font-bold text-green-400"},newsSentiment.bullishCount),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"Bullish")),React.createElement("div",{className:"text-center p-2 bg-slate-700/30 rounded-lg"},React.createElement("div",{className:"text-xl font-bold text-slate-400"},newsSentiment.neutralCount),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"Neutral")),React.createElement("div",{className:"text-center p-2 bg-red-500/10 rounded-lg"},React.createElement("div",{className:"text-xl font-bold text-red-400"},newsSentiment.bearishCount),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"Bearish"))),React.createElement("div",{className:"mt-3 p-2 bg-slate-800/50 rounded-lg text-center"},React.createElement("span",{className:"text-xs text-slate-400"},"Score: "),React.createElement("span",{className:`font-bold text-sm ${newsSentiment.score>0?'text-green-400':newsSentiment.score<0?'text-red-400':'text-slate-400'}`},newsSentiment.score>0?'+':'',newsSentiment.score,"/100"))),socialLoading?React.createElement("div",{className:"glass-card p-6 rounded-xl border-2 border-slate-500/30"},React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fas fa-spinner animate-spin text-cyan-400 text-3xl mb-3"}),React.createElement("p",{className:"text-slate-400"},"Loading social sentiment..."))):socialSentiment&&socialSentiment.totalMessages>0?React.createElement("div",{className:`glass-card p-6 rounded-xl border-2 ${socialSentiment.overallSentiment==='bullish'?'border-green-500/30 bg-green-500/5':socialSentiment.overallSentiment==='bearish'?'border-red-500/30 bg-red-500/5':'border-slate-500/30 bg-slate-500/5'}`},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("div",null,React.createElement("h3",{className:"text-xl font-bold text-white mb-1"},"\uD83D\uDCAC Social Sentiment",socialSentiment.trending&&React.createElement("span",{className:"ml-2 text-xs bg-orange-500/20 text-orange-400 px-2 py-1 rounded"},"\uD83D\uDD25 TRENDING")),React.createElement("p",{className:"text-sm text-slate-400"},"StockTwits: ",socialSentiment.stockTwitsCount||0," | Reddit: ",socialSentiment.redditCount||0," posts")),React.createElement("div",{className:"text-right"},React.createElement("div",{className:`text-4xl font-bold ${socialSentiment.overallSentiment==='bullish'?'text-green-400':socialSentiment.overallSentiment==='bearish'?'text-red-400':'text-slate-400'}`},socialSentiment.overallSentiment==='bullish'?'üöÄ':socialSentiment.overallSentiment==='bearish'?'üêª':'üòê'),React.createElement("div",{className:`text-xl font-bold mt-2 ${socialSentiment.overallSentiment==='bullish'?'text-green-400':socialSentiment.overallSentiment==='bearish'?'text-red-400':'text-slate-400'}`},socialSentiment.overallSentiment.toUpperCase()))),React.createElement("div",{className:"grid grid-cols-3 gap-3"},React.createElement("div",{className:"text-center p-2 bg-green-500/10 rounded-lg"},React.createElement("div",{className:"text-xl font-bold text-green-400"},socialSentiment.bullishPercent,"%"),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"Bullish")),React.createElement("div",{className:"text-center p-2 bg-slate-700/30 rounded-lg"},React.createElement("div",{className:"text-xl font-bold text-slate-400"},socialSentiment.neutralPercent,"%"),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"Neutral")),React.createElement("div",{className:"text-center p-2 bg-red-500/10 rounded-lg"},React.createElement("div",{className:"text-xl font-bold text-red-400"},socialSentiment.bearishPercent,"%"),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"Bearish"))),React.createElement("div",{className:"mt-3 p-2 bg-slate-800/50 rounded-lg text-center"},React.createElement("span",{className:"text-xs text-slate-400"},"Combined Score: "),React.createElement("span",{className:`font-bold text-sm ${socialSentiment.sentimentScore>0?'text-green-400':socialSentiment.sentimentScore<0?'text-red-400':'text-slate-400'}`},socialSentiment.sentimentScore>0?'+':'',socialSentiment.sentimentScore,"%")),socialSentiment.redditPosts&&socialSentiment.redditPosts.length>0&&React.createElement("div",{className:"mt-4 pt-4 border-t border-slate-700/50"},React.createElement("h4",{className:"text-sm font-bold text-white mb-3 flex items-center gap-2"},React.createElement("span",null,"\uD83E\uDD16 Top Reddit Discussions")),React.createElement("div",{className:"space-y-2"},socialSentiment.redditPosts.slice(0,3).map((post,idx)=>React.createElement("div",{key:idx,className:"bg-slate-800/50 rounded-lg p-3 hover:bg-slate-800/70 transition cursor-pointer",onClick:()=>window.open(post.url,'_blank')},React.createElement("div",{className:"flex items-start justify-between gap-2 mb-1"},React.createElement("div",{className:"flex-1 min-w-0"},React.createElement("div",{className:"text-xs font-semibold text-white truncate"},post.title),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"r/",post.subreddit," \u2022 u/",post.author," \u2022 \u2B06\uFE0F ",post.score," \u2022 \uD83D\uDCAC ",post.comments)),React.createElement("div",{className:`chip text-xs flex-shrink-0 ${post.sentiment==='bullish'?'bg-green-500/20 text-green-400':post.sentiment==='bearish'?'bg-red-500/20 text-red-400':'bg-slate-500/20 text-slate-400'}`},post.sentiment==='bullish'?'üìà':post.sentiment==='bearish'?'üìâ':'‚û°Ô∏è'))))))):React.createElement("div",{className:"glass-card p-6 rounded-xl border-2 border-slate-500/30"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-4xl mb-3"},"\uD83D\uDCAC"),React.createElement("p",{className:"text-slate-400"},"No social sentiment data available")))),newsSentiment&&React.createElement("div",{className:`glass-card p-6 rounded-xl border-2 ${newsSentiment.label==='bullish'?'border-green-500/30 bg-green-500/5':newsSentiment.label==='bearish'?'border-red-500/30 bg-red-500/5':'border-slate-500/30 bg-slate-500/5'}`,style:{display:'none'}},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("div",null,React.createElement("h3",{className:"text-xl font-bold text-white mb-1"},"Market Sentiment"),React.createElement("p",{className:"text-sm text-slate-400"},"Based on ",newsSentiment.count," recent articles")),React.createElement("div",{className:"text-right"},React.createElement("div",{className:`text-5xl font-bold ${newsSentiment.label==='bullish'?'text-green-400':newsSentiment.label==='bearish'?'text-red-400':'text-slate-400'}`},newsSentiment.label==='bullish'?'üìà':newsSentiment.label==='bearish'?'üìâ':'‚û°Ô∏è'),React.createElement("div",{className:`text-2xl font-bold mt-2 ${newsSentiment.label==='bullish'?'text-green-400':newsSentiment.label==='bearish'?'text-red-400':'text-slate-400'}`},newsSentiment.label.toUpperCase()))),React.createElement("div",{className:"grid grid-cols-3 gap-4"},React.createElement("div",{className:"text-center p-3 bg-green-500/10 rounded-lg"},React.createElement("div",{className:"text-2xl font-bold text-green-400"},newsSentiment.bullishCount),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"Bullish Articles")),React.createElement("div",{className:"text-center p-3 bg-slate-700/30 rounded-lg"},React.createElement("div",{className:"text-2xl font-bold text-slate-400"},newsSentiment.neutralCount),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"Neutral Articles")),React.createElement("div",{className:"text-center p-3 bg-red-500/10 rounded-lg"},React.createElement("div",{className:"text-2xl font-bold text-red-400"},newsSentiment.bearishCount),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"Bearish Articles"))),React.createElement("div",{className:"mt-4 p-3 bg-slate-800/50 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-400"},"Sentiment Score:",React.createElement("span",{className:`font-bold ml-2 ${newsSentiment.score>0?'text-green-400':newsSentiment.score<0?'text-red-400':'text-slate-400'}`},newsSentiment.score>0?'+':'',newsSentiment.score,"/100")))),React.createElement("div",null,React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("h3",{className:"text-xl font-bold text-white"},"\uD83D\uDCF0 News & Sentiment"),React.createElement("div",{className:"flex items-center gap-3"},newsLoading&&React.createElement("div",{className:"text-sm text-cyan-400"},React.createElement("i",{className:"fas fa-spinner animate-spin mr-2"}),"Loading news..."),newsData.length>0&&React.createElement(DataFreshnessIndicator,{timestamp:newsData[0]?.timestamp,type:"news"}))),newsData.length===0&&!newsLoading?React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("div",{className:"text-4xl mb-3"},"\uD83D\uDCF0"),React.createElement("div",{className:"text-slate-400"},"No recent news available")):React.createElement("div",{className:"space-y-4"},newsData.map((article,index)=>React.createElement("div",{key:index,className:"glass-card p-4 rounded-xl hover:border-cyan-500/30 transition cursor-pointer",onClick:()=>window.open(article.url,'_blank')},React.createElement("div",{className:"flex gap-4"},article.image&&React.createElement("img",{src:article.image,alt:"",className:"w-24 h-24 object-cover rounded-lg flex-shrink-0",onError:e=>e.target.style.display='none'}),React.createElement("div",{className:"flex-1 min-w-0"},React.createElement("div",{className:"flex items-start justify-between gap-3 mb-2"},React.createElement("h4",{className:"font-semibold text-white leading-tight hover:text-cyan-400 transition"},article.title),React.createElement("div",{className:`chip flex-shrink-0 ${article.sentiment.label==='bullish'?'bg-green-500/20 text-green-400 border-green-500/30':article.sentiment.label==='bearish'?'bg-red-500/20 text-red-400 border-red-500/30':'bg-slate-500/20 text-slate-400 border-slate-500/30'}`},article.sentiment.label==='bullish'?'üìà Bullish':article.sentiment.label==='bearish'?'üìâ Bearish':'‚û°Ô∏è Neutral')),article.description&&React.createElement("p",{className:"text-sm text-slate-400 mb-2 line-clamp-2"},article.description),React.createElement("div",{className:"flex items-center gap-3 text-xs text-slate-500"},React.createElement("span",{className:"font-medium text-cyan-400"},article.source),React.createElement("span",null,"\u2022"),React.createElement("span",null,formatDateSafe(article.publishedAt)),React.createElement("span",null,(()=>{const t=new Date(article.publishedAt).getTime();return Number.isFinite(t)?new Date(t).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}):'‚Äî';})()),article.sentiment.confidence>0&&React.createElement(React.Fragment,null,React.createElement("span",null,"\u2022"),React.createElement("span",{className:"text-slate-400"},"Confidence: ",article.sentiment.confidence,"%"))))))))),React.createElement("div",{className:"glass-card p-4 rounded-xl bg-slate-800/50"},React.createElement("div",{className:"flex items-start gap-2"},React.createElement("i",{className:"fas fa-info-circle text-cyan-400 text-sm mt-0.5"}),React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"text-xs font-semibold text-cyan-300 mb-1"},"About Sentiment Analysis"),React.createElement("div",{className:"text-xs text-slate-400 leading-relaxed"},"News sentiment is analyzed using natural language processing to identify bullish, bearish, or neutral tones. This helps gauge market perception and potential price movements. Sentiment updates automatically every 5 minutes."))))):activeTab==='simplified'?React.createElement("div",null,React.createElement("div",{className:"glass-card p-6 mb-6 rounded-xl border border-cyan-500/20"},React.createElement("div",{className:"flex items-center gap-3 mb-3"},React.createElement("i",{className:"fas fa-lightbulb text-cyan-400 text-2xl"}),React.createElement("h3",{className:"text-xl font-bold text-white"},"Simplified Analysis")),React.createElement("div",{className:"text-sm text-slate-400 leading-relaxed"},"We've translated complex financial metrics into plain English so you can understand what really matters.")),React.createElement("div",{className:"glass-card p-6 mb-6 rounded-xl"},React.createElement("h4",{className:"text-lg font-bold text-white mb-4 text-center flex items-center justify-center gap-2"},React.createElement("i",{className:"fas fa-gauge"}),"Overall Valuation"),(()=>{const score=calculateValuationScore(stock);const valuation=getValuationLabel(score);return React.createElement("div",null,React.createElement("div",{className:"flex items-center justify-center gap-3 mb-4"},React.createElement("span",{className:"text-4xl"},valuation.emoji),React.createElement("div",null,React.createElement("div",{className:"text-3xl font-bold",style:{color:valuation.color}},valuation.label),React.createElement("div",{className:"text-sm text-slate-400"},"Valuation Score: ",score,"/100"))),React.createElement("div",{className:"relative h-24 mb-4"},React.createElement("div",{className:"absolute w-full h-3 top-10 rounded-full",style:{background:'linear-gradient(to right, #22c55e 0%, #eab308 50%, #ef4444 100%)'}}),React.createElement("div",{className:"absolute w-1 h-10 bg-white shadow-lg top-4 transition-all duration-500",style:{left:`${score}%`,transform:'translateX(-50%)'}},React.createElement("div",{className:"absolute -top-2 left-1/2 -translate-x-1/2 w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-white"})),React.createElement("div",{className:"absolute w-full top-16 flex justify-between text-xs font-bold"},React.createElement("span",{className:"text-green-400"},"Undervalued"),React.createElement("span",{className:"text-yellow-400"},"Fair"),React.createElement("span",{className:"text-red-400"},"Overvalued"))),React.createElement("div",{className:"text-xs text-slate-500 text-center"},"Based on P/E ratio, price/book, free cash flow, and growth rate"));})()),React.createElement("div",{className:"glass-card p-6 mb-6 rounded-xl"},React.createElement("h4",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2"},React.createElement("i",{className:"fas fa-traffic-light"}),"Quick Health Check"),React.createElement("div",{className:"space-y-4"},stock.pe&&(()=>{const color=getTrafficLight('pe',stock.pe);const summary=getPlainEnglishSummary('pe',stock.pe);const dotColor=color==='green'?'#22c55e':color==='yellow'?'#eab308':'#ef4444';return React.createElement("div",{className:"p-4 bg-slate-800/50 rounded-lg"},React.createElement("div",{className:"flex justify-between items-center mb-3"},React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Price vs Earnings"),React.createElement("div",{className:"text-2xl font-bold text-white font-mono"},stock.pe.toFixed(1),"x")),React.createElement("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg",style:{background:color==='green'?'rgba(34,197,94,0.15)':color==='yellow'?'rgba(234,179,8,0.15)':'rgba(239,68,68,0.15)',border:`1px solid ${color==='green'?'rgba(34,197,94,0.3)':color==='yellow'?'rgba(234,179,8,0.3)':'rgba(239,68,68,0.3)'}`,color:dotColor}},React.createElement("div",{className:"w-2 h-2 rounded-full",style:{background:dotColor}}),React.createElement("span",{className:"text-xs font-bold"},color==='green'?'Good':color==='yellow'?'OK':'Concern'))),React.createElement("div",{className:"text-sm font-semibold text-white mb-1"},summary.text),React.createElement("div",{className:"text-xs text-slate-400 leading-relaxed"},summary.detail));})(),stock.revenueGrowth!=null&&(()=>{const color=getTrafficLight('revenueGrowth',stock.revenueGrowth);const summary=getPlainEnglishSummary('revenueGrowth',stock.revenueGrowth);const dotColor=color==='green'?'#22c55e':color==='yellow'?'#eab308':'#ef4444';return React.createElement("div",{className:"p-4 bg-slate-800/50 rounded-lg"},React.createElement("div",{className:"flex justify-between items-center mb-3"},React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Revenue Growth"),React.createElement("div",{className:"text-2xl font-bold text-white font-mono"},stock.revenueGrowth>0?'+':'',stock.revenueGrowth.toFixed(1),"%")),React.createElement("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg",style:{background:color==='green'?'rgba(34,197,94,0.15)':color==='yellow'?'rgba(234,179,8,0.15)':'rgba(239,68,68,0.15)',border:`1px solid ${color==='green'?'rgba(34,197,94,0.3)':color==='yellow'?'rgba(234,179,8,0.3)':'rgba(239,68,68,0.3)'}`,color:dotColor}},React.createElement("div",{className:"w-2 h-2 rounded-full",style:{background:dotColor}}),React.createElement("span",{className:"text-xs font-bold"},color==='green'?'Good':color==='yellow'?'OK':'Concern'))),React.createElement("div",{className:"text-sm font-semibold text-white mb-1"},summary.text),React.createElement("div",{className:"text-xs text-slate-400 leading-relaxed"},summary.detail));})(),stock.debtToEquity!=null&&(()=>{const color=getTrafficLight('debtToEquity',stock.debtToEquity);const summary=getPlainEnglishSummary('debtToEquity',stock.debtToEquity);const dotColor=color==='green'?'#22c55e':color==='yellow'?'#eab308':'#ef4444';return React.createElement("div",{className:"p-4 bg-slate-800/50 rounded-lg"},React.createElement("div",{className:"flex justify-between items-center mb-3"},React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Debt Level"),React.createElement("div",{className:"text-2xl font-bold text-white font-mono"},stock.debtToEquity.toFixed(2))),React.createElement("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg",style:{background:color==='green'?'rgba(34,197,94,0.15)':color==='yellow'?'rgba(234,179,8,0.15)':'rgba(239,68,68,0.15)',border:`1px solid ${color==='green'?'rgba(34,197,94,0.3)':color==='yellow'?'rgba(234,179,8,0.3)':'rgba(239,68,68,0.3)'}`,color:dotColor}},React.createElement("div",{className:"w-2 h-2 rounded-full",style:{background:dotColor}}),React.createElement("span",{className:"text-xs font-bold"},color==='green'?'Good':color==='yellow'?'OK':'Concern'))),React.createElement("div",{className:"text-sm font-semibold text-white mb-1"},summary.text),React.createElement("div",{className:"text-xs text-slate-400 leading-relaxed"},summary.detail));})(),stock.roe!=null&&(()=>{const color=getTrafficLight('roe',stock.roe);const summary=getPlainEnglishSummary('roe',stock.roe);const dotColor=color==='green'?'#22c55e':color==='yellow'?'#eab308':'#ef4444';return React.createElement("div",{className:"p-4 bg-slate-800/50 rounded-lg"},React.createElement("div",{className:"flex justify-between items-center mb-3"},React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Return on Equity"),React.createElement("div",{className:"text-2xl font-bold text-white font-mono"},stock.roe.toFixed(1),"%")),React.createElement("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg",style:{background:color==='green'?'rgba(34,197,94,0.15)':color==='yellow'?'rgba(234,179,8,0.15)':'rgba(239,68,68,0.15)',border:`1px solid ${color==='green'?'rgba(34,197,94,0.3)':color==='yellow'?'rgba(234,179,8,0.3)':'rgba(239,68,68,0.3)'}`,color:dotColor}},React.createElement("div",{className:"w-2 h-2 rounded-full",style:{background:dotColor}}),React.createElement("span",{className:"text-xs font-bold"},color==='green'?'Good':color==='yellow'?'OK':'Concern'))),React.createElement("div",{className:"text-sm font-semibold text-white mb-1"},summary.text),React.createElement("div",{className:"text-xs text-slate-400 leading-relaxed"},summary.detail));})())),React.createElement("div",{className:"p-4 bg-yellow-500/5 border border-yellow-500/20 rounded-lg"},React.createElement("div",{className:"flex items-start gap-2 text-sm"},React.createElement("i",{className:"fas fa-info-circle text-yellow-400 mt-0.5"}),React.createElement("div",{className:"text-slate-400 leading-relaxed"},React.createElement("strong",{className:"text-yellow-400"},"Remember:")," These simplified metrics are a starting point. Always review the full financials and do your own research before investing.")))):activeTab==='fundamentals'?React.createElement(ErrorBoundary,null,loadingTabData&&!fundamentalsData?React.createElement("div",{className:"text-center py-12"},React.createElement("i",{className:"fas fa-spinner animate-spin text-4xl text-cyan-400 mb-4"}),React.createElement("p",{className:"text-slate-400"},"Loading fundamentals data...")):React.createElement(FundamentalsTab,{stock:{...stock,...fundamentalsData}})):activeTab==='technicals'?React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"p-4 bg-slate-800/40 border border-slate-700/50 rounded-xl text-sm text-slate-200"},React.createElement("span",{className:"font-semibold text-slate-100"},"Quick read:")," ",(()=>{const rsi=Number.isFinite(stock.rsi)?stock.rsi:technicalData?.rsi??50;const sma50=technicalData?.sma50;const sma200=technicalData?.sma200;const above50=sma50?stock.price>sma50:null;const above200=sma200?stock.price>sma200:null;const rsiMsg=rsi>72?"Momentum looks stretched (overbought).":rsi<35?"Momentum looks washed out (oversold).":"Momentum looks neutral.";const trendMsg=above50==null||above200==null?"Trend signals are limited.":above50&&above200?"Trend looks constructive (above key averages).":!above50&&!above200?"Trend looks weak (below key averages).":"Trend is mixed (one average above, one below).";return`${trendMsg} ${rsiMsg}`;})()),React.createElement("div",{className:"grid grid-cols-4 gap-4"},React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"RSI (14)"),React.createElement("div",{className:`text-2xl font-bold ${(technicalData?.rsi||stock.rsi)<30?'text-green-400':(technicalData?.rsi||stock.rsi)>70?'text-red-400':'text-cyan-400'}`},(technicalData?.rsi||stock.rsi)?.toFixed(0)||'‚Äî'),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},(technicalData?.rsi||stock.rsi)<30?'üü¢ Oversold':(technicalData?.rsi||stock.rsi)>70?'üî¥ Overbought':'üü° Neutral')),React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"ADX (14)"),React.createElement("div",{className:`text-2xl font-bold ${technicalData?.adx>25?'text-green-400':technicalData?.adx>20?'text-yellow-400':'text-slate-400'}`},technicalData?.adx?.toFixed(0)||'‚Äî'),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},technicalData?.adx>25?'üí™ Strong Trend':technicalData?.adx>20?'üìä Moderate':'üò¥ Weak Trend')),React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Volatility (20d)"),React.createElement("div",{className:`text-2xl font-bold ${technicalData?.stdDev>5?'text-red-400':technicalData?.stdDev>2?'text-yellow-400':'text-green-400'}`},technicalData?.stdDev?.toFixed(2)||'‚Äî'),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},technicalData?.stdDev>5?'‚ö†Ô∏è High':technicalData?.stdDev>2?'‚ö° Medium':'‚úÖ Low')),React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Today's Change"),React.createElement("div",{className:`text-2xl font-bold ${getSentimentColor(stock.changePct)}`},formatPercent(stock.changePct,2)),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},"$",stock.change?.toFixed(2)||'‚Äî'))),React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Moving Averages"),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"grid grid-cols-4 gap-4"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Current Price"),React.createElement("div",{className:"text-xl font-bold text-white"},"$",stock.price?.toFixed(2))),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"EMA (20)"),React.createElement("div",{className:`text-xl font-bold ${technicalData?.ema20&&stock.price>technicalData.ema20?'text-green-400':'text-red-400'}`},"$",technicalData?.ema20?.toFixed(2)||'‚Äî'),React.createElement("div",{className:"text-xs mt-1"},technicalData?.ema20&&stock.price>technicalData.ema20?React.createElement("span",{className:"text-green-400"},"\u2191 Above"):React.createElement("span",{className:"text-red-400"},"\u2193 Below"))),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"SMA (50)"),React.createElement("div",{className:`text-xl font-bold ${technicalData?.sma50&&stock.price>technicalData.sma50?'text-green-400':'text-red-400'}`},"$",technicalData?.sma50?.toFixed(2)||'‚Äî'),React.createElement("div",{className:"text-xs mt-1"},technicalData?.sma50&&stock.price>technicalData.sma50?React.createElement("span",{className:"text-green-400"},"\u2191 Above"):React.createElement("span",{className:"text-red-400"},"\u2193 Below"))),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"SMA (200)"),React.createElement("div",{className:`text-xl font-bold ${technicalData?.sma200&&stock.price>technicalData.sma200?'text-green-400':'text-red-400'}`},"$",technicalData?.sma200?.toFixed(2)||'‚Äî'),React.createElement("div",{className:"text-xs mt-1"},technicalData?.sma200&&stock.price>technicalData.sma200?React.createElement("span",{className:"text-green-400"},"\u2191 Above"):React.createElement("span",{className:"text-red-400"},"\u2193 Below")))),technicalData?.sma50&&technicalData?.sma200&&React.createElement("div",{className:"pt-4 border-t border-slate-700/30"},React.createElement("div",{className:`p-3 rounded-lg ${technicalData.sma50>technicalData.sma200?'bg-green-500/10 border border-green-500/30':'bg-red-500/10 border border-red-500/30'}`},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("div",{className:`text-sm font-bold ${technicalData.sma50>technicalData.sma200?'text-green-400':'text-red-400'}`},technicalData.sma50>technicalData.sma200?'‚ú® Golden Cross Pattern':'üíÄ Death Cross Pattern'),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},technicalData.sma50>technicalData.sma200?'SMA(50) above SMA(200) - Bullish long-term trend':'SMA(50) below SMA(200) - Bearish long-term trend')),React.createElement("div",{className:`text-3xl ${technicalData.sma50>technicalData.sma200?'text-green-400':'text-red-400'}`},technicalData.sma50>technicalData.sma200?'üìà':'üìâ'))))))),React.createElement("div",{className:"grid grid-cols-2 gap-4"},React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"52-Week Range"),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"space-y-3"},React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-xs text-slate-400"},"High"),React.createElement("span",{className:"font-mono text-green-400 font-bold text-lg"},"$",stock.yearHigh?.toFixed(2)||'‚Äî')),React.createElement("div",{className:"relative h-3 bg-slate-700 rounded-full overflow-hidden"},React.createElement("div",{className:"absolute h-full w-full bg-gradient-to-r from-red-500/30 via-yellow-500/30 to-green-500/30"}),stock.yearLow&&stock.yearHigh&&stock.price&&React.createElement("div",{className:"absolute w-1.5 h-full bg-cyan-400 border-2 border-white shadow-lg",style:{left:`${(stock.price-stock.yearLow)/(stock.yearHigh-stock.yearLow)*100}%`}})),React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-xs text-slate-400"},"Low"),React.createElement("span",{className:"font-mono text-red-400 font-bold text-lg"},"$",stock.yearLow?.toFixed(2)||'‚Äî')),React.createElement("div",{className:"pt-3 border-t border-slate-700/30 text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Current Position"),React.createElement("div",{className:"text-cyan-400 font-bold text-xl"},"$",stock.price?.toFixed(2)),stock.yearLow&&stock.yearHigh&&stock.price&&React.createElement("div",{className:"text-xs text-slate-500 mt-1"},((stock.price-stock.yearLow)/(stock.yearHigh-stock.yearLow)*100).toFixed(0),"% from low to high"))))),React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Today's Range"),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"space-y-3"},React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-xs text-slate-400"},"Day High"),React.createElement("span",{className:"font-mono text-white font-bold text-lg"},"$",stock.dayHigh?.toFixed(2)||stock.price?.toFixed(2)||'‚Äî')),React.createElement("div",{className:"relative h-3 bg-slate-700 rounded-full overflow-hidden"},React.createElement("div",{className:"absolute h-full w-full bg-cyan-500/20"}),stock.dayLow&&stock.dayHigh&&stock.price&&React.createElement("div",{className:"absolute w-1.5 h-full bg-cyan-400 shadow-lg",style:{left:`${(stock.price-stock.dayLow)/(stock.dayHigh-stock.dayLow)*100}%`}})),React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-xs text-slate-400"},"Day Low"),React.createElement("span",{className:"font-mono text-white font-bold text-lg"},"$",stock.dayLow?.toFixed(2)||stock.price?.toFixed(2)||'‚Äî')),React.createElement("div",{className:"pt-3 border-t border-slate-700/30"},React.createElement("div",{className:"grid grid-cols-2 gap-3 text-center"},React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500"},"Open"),React.createElement("div",{className:"text-white font-semibold"},"$",stock.open?.toFixed(2)||'‚Äî')),React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500"},"Previous Close"),React.createElement("div",{className:"text-white font-semibold"},"$",stock.previousClose?.toFixed(2)||'‚Äî')))))))),React.createElement("div",{className:"grid grid-cols-2 gap-4"},React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Momentum Analysis"),React.createElement("div",{className:"glass-card p-4 rounded-xl space-y-3"},React.createElement("div",null,React.createElement("div",{className:"flex justify-between items-center mb-2"},React.createElement("span",{className:"text-xs text-slate-400"},"RSI (14)"),React.createElement("span",{className:`font-mono text-sm font-bold ${(technicalData?.rsi||stock.rsi)<30?'text-green-400':(technicalData?.rsi||stock.rsi)>70?'text-red-400':'text-cyan-400'}`},(technicalData?.rsi||stock.rsi)?.toFixed(0)||'‚Äî')),React.createElement("div",{className:"relative h-2 bg-slate-700 rounded-full overflow-hidden"},React.createElement("div",{className:"absolute h-full w-[30%] bg-green-500/20"}),React.createElement("div",{className:"absolute h-full w-[40%] left-[30%] bg-slate-600/30"}),React.createElement("div",{className:"absolute h-full w-[30%] left-[70%] bg-red-500/20"}),(technicalData?.rsi||stock.rsi)&&React.createElement("div",{className:"absolute w-1 h-full bg-white shadow-lg",style:{left:`${technicalData?.rsi||stock.rsi}%`}})),React.createElement("div",{className:"flex justify-between text-[10px] text-slate-500 mt-1"},React.createElement("span",null,"Oversold"),React.createElement("span",null,"Neutral"),React.createElement("span",null,"Overbought"))),technicalData?.adx&&React.createElement("div",{className:"pt-3 border-t border-slate-700/30"},React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-xs text-slate-400"},"ADX Trend Strength"),React.createElement("span",{className:`font-mono text-sm font-bold ${technicalData.adx>25?'text-green-400':technicalData.adx>20?'text-yellow-400':'text-slate-400'}`},technicalData.adx.toFixed(0))),React.createElement("div",{className:"mt-2 h-2 bg-slate-700 rounded-full overflow-hidden"},React.createElement("div",{className:`h-full rounded-full ${technicalData.adx>25?'bg-green-500':technicalData.adx>20?'bg-yellow-500':'bg-slate-500'}`,style:{width:`${Math.min(100,technicalData.adx/50*100)}%`}})),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},technicalData.adx>25?'Strong directional movement':technicalData.adx>20?'Moderate trend forming':'Weak trend, ranging market')),React.createElement("div",{className:"pt-3 border-t border-slate-700/30"},React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-xs text-slate-400"},"Price Momentum"),React.createElement("span",{className:`font-mono text-sm font-bold ${getSentimentColor(stock.changePct)}`},formatPercent(stock.changePct,2)))),technicalData?.stdDev&&React.createElement("div",{className:"pt-3 border-t border-slate-700/30"},React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-xs text-slate-400"},"Volatility (\u03C3)"),React.createElement("span",{className:`text-sm font-bold ${technicalData.stdDev>5?'text-red-400':technicalData.stdDev>2?'text-yellow-400':'text-green-400'}`},technicalData.stdDev.toFixed(2)))))),React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Volume"),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Average Volume Traded"),React.createElement("div",{className:"text-3xl font-bold text-white font-mono"},formatNumber(stock.avgVolume||0,0)),React.createElement("div",{className:"text-xs text-slate-400 mt-2"},"shares per day")))))):activeTab==='analyst-ratings'&&analystRatingsData?React.createElement("div",{className:"space-y-6"},React.createElement("h3",{className:"text-xl font-bold text-white"},"Comprehensive Analyst Ratings"),analystRatingsData.snapshot&&React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"FMP Overall Rating"),React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("div",{className:"grid grid-cols-3 gap-6 mb-6 pb-6 border-b border-slate-700/30"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Rating"),React.createElement("div",{className:`text-6xl font-bold mb-2 ${analystRatingsData.snapshot.rating?.startsWith('A')?'text-green-400':analystRatingsData.snapshot.rating?.startsWith('B')?'text-blue-400':analystRatingsData.snapshot.rating?.startsWith('C')?'text-yellow-400':analystRatingsData.snapshot.rating?.startsWith('D')?'text-orange-400':'text-red-400'}`},analystRatingsData.snapshot.rating||'N/A'),React.createElement("div",{className:"text-sm text-slate-400"},analystRatingsData.snapshot.ratingRecommendation||'N/A')),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Overall Score"),React.createElement("div",{className:"text-5xl font-bold text-cyan-400"},analystRatingsData.snapshot.ratingScore?.toFixed(1)||analystRatingsData.snapshot.overallScore||'‚Äî'),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"out of 5.0")),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Price Target (Last Quarter)"),React.createElement("div",{className:"text-3xl font-bold text-purple-400"},"$",(analystRatingsData.priceTargetSummary?.lastQuarterAvgPriceTarget||analystRatingsData.priceTargetConsensus?.targetConsensus||analystRatingsData.priceTarget?.lastQuarterAvgPriceTarget)?.toFixed(2)||'‚Äî'),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTargetSummary?.lastQuarterCount||analystRatingsData.priceTarget?.lastQuarterCount?`${analystRatingsData.priceTargetSummary?.lastQuarterCount||analystRatingsData.priceTarget?.lastQuarterCount} analysts`:'Consensus'),stock.price&&(analystRatingsData.priceTargetSummary?.lastQuarterAvgPriceTarget||analystRatingsData.priceTarget?.lastQuarterAvgPriceTarget)&&React.createElement("div",{className:`text-sm font-bold mt-1 ${((analystRatingsData.priceTargetSummary?.lastQuarterAvgPriceTarget||analystRatingsData.priceTarget?.lastQuarterAvgPriceTarget)/stock.price-1)*100>0?'text-green-400':'text-red-400'}`},(((analystRatingsData.priceTargetSummary?.lastQuarterAvgPriceTarget||analystRatingsData.priceTarget?.lastQuarterAvgPriceTarget)/stock.price-1)*100).toFixed(1),"% upside"))),(analystRatingsData.priceTargetSummary||analystRatingsData.priceTarget)&&React.createElement("div",{className:"mt-6 pt-6 border-t border-slate-700/30"},React.createElement("h5",{className:"text-xs font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Price Target Timeline"),React.createElement("div",{className:"grid grid-cols-4 gap-4"},(analystRatingsData.priceTargetSummary?.lastMonthAvgPriceTarget||analystRatingsData.priceTarget?.lastMonthAvgPriceTarget)&&React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Last Month"),React.createElement("div",{className:"text-2xl font-bold text-green-400"},"$",(analystRatingsData.priceTargetSummary?.lastMonthAvgPriceTarget||analystRatingsData.priceTarget?.lastMonthAvgPriceTarget).toFixed(2)),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTargetSummary?.lastMonthCount||analystRatingsData.priceTarget?.lastMonthCount||0," analysts")),(analystRatingsData.priceTargetSummary?.lastQuarterAvgPriceTarget||analystRatingsData.priceTarget?.lastQuarterAvgPriceTarget)&&React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Last Quarter"),React.createElement("div",{className:"text-2xl font-bold text-cyan-400"},"$",(analystRatingsData.priceTargetSummary?.lastQuarterAvgPriceTarget||analystRatingsData.priceTarget?.lastQuarterAvgPriceTarget).toFixed(2)),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTargetSummary?.lastQuarterCount||analystRatingsData.priceTarget?.lastQuarterCount||0," analysts")),(analystRatingsData.priceTargetSummary?.lastYearAvgPriceTarget||analystRatingsData.priceTarget?.lastYearAvgPriceTarget)&&React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Last Year"),React.createElement("div",{className:"text-2xl font-bold text-blue-400"},"$",(analystRatingsData.priceTargetSummary?.lastYearAvgPriceTarget||analystRatingsData.priceTarget?.lastYearAvgPriceTarget).toFixed(2)),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTargetSummary?.lastYearCount||analystRatingsData.priceTarget?.lastYearCount||0," analysts")),(analystRatingsData.priceTargetSummary?.allTimeAvgPriceTarget||analystRatingsData.priceTarget?.allTimeAvgPriceTarget)&&React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"All Time"),React.createElement("div",{className:"text-2xl font-bold text-purple-400"},"$",(analystRatingsData.priceTargetSummary?.allTimeAvgPriceTarget||analystRatingsData.priceTarget?.allTimeAvgPriceTarget).toFixed(2)),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTargetSummary?.allTimeCount||analystRatingsData.priceTarget?.allTimeCount||0," analysts"))),analystRatingsData.priceTargetSummary?.lastMonthAvgPriceTarget&&analystRatingsData.priceTargetSummary?.lastQuarterAvgPriceTarget&&analystRatingsData.priceTargetSummary?.lastYearAvgPriceTarget&&React.createElement("div",{className:"mt-4 text-center text-sm"},React.createElement("span",{className:"text-slate-400"},"Trend: "),analystRatingsData.priceTargetSummary.lastMonthAvgPriceTarget>analystRatingsData.priceTargetSummary.lastQuarterAvgPriceTarget?React.createElement("span",{className:"text-green-400 font-bold"},"\uD83D\uDCC8 Increasing (Recent upgrades)"):analystRatingsData.priceTargetSummary.lastMonthAvgPriceTarget<analystRatingsData.priceTargetSummary.lastQuarterAvgPriceTarget?React.createElement("span",{className:"text-red-400 font-bold"},"\uD83D\uDCC9 Decreasing (Recent downgrades)"):React.createElement("span",{className:"text-yellow-400 font-bold"},"\u27A1\uFE0F Stable"))),analystRatingsData.priceTargetConsensus&&React.createElement("div",{className:"mt-6 pt-6 border-t border-slate-700/30"},React.createElement("h5",{className:"text-xs font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Consensus Range"),React.createElement("div",{className:"grid grid-cols-3 gap-4 text-center"},analystRatingsData.priceTargetConsensus.targetLow&&React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Low"),React.createElement("div",{className:"text-xl font-bold text-red-400"},"$",analystRatingsData.priceTargetConsensus.targetLow.toFixed(2))),analystRatingsData.priceTargetConsensus.targetMedian&&React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Median"),React.createElement("div",{className:"text-xl font-bold text-cyan-400"},"$",analystRatingsData.priceTargetConsensus.targetMedian.toFixed(2))),analystRatingsData.priceTargetConsensus.targetHigh&&React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"High"),React.createElement("div",{className:"text-xl font-bold text-green-400"},"$",analystRatingsData.priceTargetConsensus.targetHigh.toFixed(2))))))),(analystRatingsData.priceTargetSummary||analystRatingsData.priceTargetConsensus)&&React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Analyst Price Targets"),React.createElement("div",{className:"glass-card p-6 rounded-xl"},analystRatingsData.priceTargetSummary&&React.createElement("div",null,React.createElement("h5",{className:"text-xs font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Price Target Timeline"),React.createElement("div",{className:"grid grid-cols-4 gap-4"},analystRatingsData.priceTargetSummary.lastMonthAvgPriceTarget&&React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Last Month"),React.createElement("div",{className:"text-2xl font-bold text-green-400"},"$",analystRatingsData.priceTargetSummary.lastMonthAvgPriceTarget.toFixed(2)),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTargetSummary.lastMonthCount||0," analysts"),stock.price&&React.createElement("div",{className:`text-xs font-bold mt-1 ${(analystRatingsData.priceTargetSummary.lastMonthAvgPriceTarget/stock.price-1)*100>0?'text-green-400':'text-red-400'}`},((analystRatingsData.priceTargetSummary.lastMonthAvgPriceTarget/stock.price-1)*100).toFixed(1),"%")),analystRatingsData.priceTargetSummary.lastQuarterAvgPriceTarget&&React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Last Quarter"),React.createElement("div",{className:"text-2xl font-bold text-cyan-400"},"$",analystRatingsData.priceTargetSummary.lastQuarterAvgPriceTarget.toFixed(2)),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTargetSummary.lastQuarterCount||0," analysts"),stock.price&&React.createElement("div",{className:`text-xs font-bold mt-1 ${(analystRatingsData.priceTargetSummary.lastQuarterAvgPriceTarget/stock.price-1)*100>0?'text-green-400':'text-red-400'}`},((analystRatingsData.priceTargetSummary.lastQuarterAvgPriceTarget/stock.price-1)*100).toFixed(1),"%")),analystRatingsData.priceTargetSummary.lastYearAvgPriceTarget&&React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Last Year"),React.createElement("div",{className:"text-2xl font-bold text-blue-400"},"$",analystRatingsData.priceTargetSummary.lastYearAvgPriceTarget.toFixed(2)),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTargetSummary.lastYearCount||0," analysts"),stock.price&&React.createElement("div",{className:`text-xs font-bold mt-1 ${(analystRatingsData.priceTargetSummary.lastYearAvgPriceTarget/stock.price-1)*100>0?'text-green-400':'text-red-400'}`},((analystRatingsData.priceTargetSummary.lastYearAvgPriceTarget/stock.price-1)*100).toFixed(1),"%")),analystRatingsData.priceTargetSummary.allTimeAvgPriceTarget&&React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"All Time"),React.createElement("div",{className:"text-2xl font-bold text-purple-400"},"$",analystRatingsData.priceTargetSummary.allTimeAvgPriceTarget.toFixed(2)),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTargetSummary.allTimeCount||0," analysts"),stock.price&&React.createElement("div",{className:`text-xs font-bold mt-1 ${(analystRatingsData.priceTargetSummary.allTimeAvgPriceTarget/stock.price-1)*100>0?'text-green-400':'text-red-400'}`},((analystRatingsData.priceTargetSummary.allTimeAvgPriceTarget/stock.price-1)*100).toFixed(1),"%"))),analystRatingsData.priceTargetSummary.lastMonthAvgPriceTarget&&analystRatingsData.priceTargetSummary.lastQuarterAvgPriceTarget&&analystRatingsData.priceTargetSummary.lastYearAvgPriceTarget&&React.createElement("div",{className:"mt-4 text-center text-sm"},React.createElement("span",{className:"text-slate-400"},"Trend: "),analystRatingsData.priceTargetSummary.lastMonthAvgPriceTarget>analystRatingsData.priceTargetSummary.lastQuarterAvgPriceTarget?React.createElement("span",{className:"text-green-400 font-bold"},"\uD83D\uDCC8 Increasing (Recent upgrades)"):analystRatingsData.priceTargetSummary.lastMonthAvgPriceTarget<analystRatingsData.priceTargetSummary.lastQuarterAvgPriceTarget?React.createElement("span",{className:"text-red-400 font-bold"},"\uD83D\uDCC9 Decreasing (Recent downgrades)"):React.createElement("span",{className:"text-yellow-400 font-bold"},"\u27A1\uFE0F Stable"))),analystRatingsData.priceTargetConsensus&&React.createElement("div",{className:analystRatingsData.priceTargetSummary?"mt-6 pt-6 border-t border-slate-700/30":""},React.createElement("h5",{className:"text-xs font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Consensus Range"),React.createElement("div",{className:"grid grid-cols-3 gap-4 text-center"},analystRatingsData.priceTargetConsensus.targetLow&&React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Low"),React.createElement("div",{className:"text-xl font-bold text-red-400"},"$",analystRatingsData.priceTargetConsensus.targetLow.toFixed(2))),analystRatingsData.priceTargetConsensus.targetMedian&&React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Median"),React.createElement("div",{className:"text-xl font-bold text-cyan-400"},"$",analystRatingsData.priceTargetConsensus.targetMedian.toFixed(2))),analystRatingsData.priceTargetConsensus.targetHigh&&React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"High"),React.createElement("div",{className:"text-xl font-bold text-green-400"},"$",analystRatingsData.priceTargetConsensus.targetHigh.toFixed(2))))))),analystRatingsData.snapshot&&React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Component Scores"),React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("div",{className:"grid grid-cols-6 gap-4"},React.createElement("div",{className:"text-center glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"DCF"),React.createElement("div",{className:"text-2xl font-bold text-cyan-400"},analystRatingsData.snapshot.discountedCashFlowScore||'‚Äî')),React.createElement("div",{className:"text-center glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"ROE"),React.createElement("div",{className:"text-2xl font-bold text-green-400"},analystRatingsData.snapshot.returnOnEquityScore||'‚Äî')),React.createElement("div",{className:"text-center glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"ROA"),React.createElement("div",{className:"text-2xl font-bold text-blue-400"},analystRatingsData.snapshot.returnOnAssetsScore||'‚Äî')),React.createElement("div",{className:"text-center glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"D/E"),React.createElement("div",{className:"text-2xl font-bold text-purple-400"},analystRatingsData.snapshot.debtToEquityScore||'‚Äî')),React.createElement("div",{className:"text-center glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"P/E"),React.createElement("div",{className:"text-2xl font-bold text-yellow-400"},analystRatingsData.snapshot.priceToEarningsScore||'‚Äî')),React.createElement("div",{className:"text-center glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"P/B"),React.createElement("div",{className:"text-2xl font-bold text-orange-400"},analystRatingsData.snapshot.priceToBookScore||'‚Äî'))),React.createElement("div",{className:"mt-4 pt-4 border-t border-slate-700/30 text-center text-xs text-slate-500"},"Component Scores: DCF (Discounted Cash Flow) \u2022 ROE (Return on Equity) \u2022 ROA (Return on Assets) \u2022 D/E (Debt to Equity) \u2022 P/E (Price to Earnings) \u2022 P/B (Price to Book)"))),analystRatingsData.consensus&&React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Analyst Consensus"),React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("div",{className:"grid grid-cols-2 gap-6"},React.createElement("div",null,React.createElement("div",{className:"text-center mb-4"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Consensus"),React.createElement("div",{className:`text-4xl font-bold ${analystRatingsData.consensus.consensus==='Strong Buy'||analystRatingsData.consensus.consensus==='Buy'?'text-green-400':analystRatingsData.consensus.consensus==='Hold'?'text-yellow-400':'text-red-400'}`},analystRatingsData.consensus.consensus||'N/A')),React.createElement("div",{className:"grid grid-cols-3 gap-3 text-center text-xs"},React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-green-400 font-bold text-2xl"},(analystRatingsData.consensus.strongBuy||0)+(analystRatingsData.consensus.buy||0)),React.createElement("div",{className:"text-slate-500 mt-1"},"Buy")),React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-yellow-400 font-bold text-2xl"},analystRatingsData.consensus.hold||0),React.createElement("div",{className:"text-slate-500 mt-1"},"Hold")),React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-red-400 font-bold text-2xl"},(analystRatingsData.consensus.sell||0)+(analystRatingsData.consensus.strongSell||0)),React.createElement("div",{className:"text-slate-500 mt-1"},"Sell")))),React.createElement("div",{className:"space-y-3"},React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-sm text-slate-400"},"Strong Buy"),React.createElement("span",{className:"text-green-400 font-bold"},analystRatingsData.consensus.strongBuy||0)),React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-sm text-slate-400"},"Buy"),React.createElement("span",{className:"text-green-300 font-bold"},analystRatingsData.consensus.buy||0)),React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-sm text-slate-400"},"Hold"),React.createElement("span",{className:"text-yellow-400 font-bold"},analystRatingsData.consensus.hold||0)),React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-sm text-slate-400"},"Sell"),React.createElement("span",{className:"text-red-300 font-bold"},analystRatingsData.consensus.sell||0)),React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-sm text-slate-400"},"Strong Sell"),React.createElement("span",{className:"text-red-400 font-bold"},analystRatingsData.consensus.strongSell||0)))))),analystRatingsData.priceTarget&&React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Price Target Details"),React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("div",{className:"grid grid-cols-3 gap-6"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Last Month Average"),React.createElement("div",{className:"text-2xl font-bold text-blue-400"},"$",analystRatingsData.priceTarget.lastMonthAvgPriceTarget?.toFixed(2)||'‚Äî'),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTarget.lastMonthCount||0," analysts")),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Last Quarter Average"),React.createElement("div",{className:"text-2xl font-bold text-cyan-400"},"$",analystRatingsData.priceTarget.lastQuarterAvgPriceTarget?.toFixed(2)||'‚Äî'),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTarget.lastQuarterCount||0," analysts")),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Last Year Average"),React.createElement("div",{className:"text-2xl font-bold text-purple-400"},"$",analystRatingsData.priceTarget.lastYearAvgPriceTarget?.toFixed(2)||'‚Äî'),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},analystRatingsData.priceTarget.lastYearCount||0," analysts"))),React.createElement("div",{className:"mt-6 pt-6 border-t border-slate-700/30"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-sm text-slate-400 mb-2"},"Current Price: ",React.createElement("span",{className:"text-white font-semibold"},"$",stock.price?.toFixed(2))),React.createElement("div",{className:"text-xs text-slate-500"},"Potential Upside:",React.createElement("span",{className:`ml-2 text-lg font-bold ${stock.upside>0?'text-green-400':'text-red-400'}`},stock.upside?.toFixed(1)||((analystRatingsData.priceTarget.lastQuarterAvgPriceTarget-stock.price)/stock.price*100).toFixed(1),"%"),stock.upside>0?' üìà':' üìâ'))))),analystRatingsData.recentGrades&&analystRatingsData.recentGrades.length>0&&React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Recent Analyst Activity"),React.createElement("div",{className:"space-y-2"},analystRatingsData.recentGrades.slice(0,10).map((grade,i)=>React.createElement("div",{key:i,className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"flex items-start justify-between"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"flex items-center gap-3 mb-2"},React.createElement("span",{className:"font-semibold text-white"},grade.gradingCompany||grade.firm||grade.analystFirm||grade.analystName||grade.company||'Unknown Analyst'),React.createElement("span",{className:`chip text-xs px-3 py-1 rounded-full ${grade.newGrade?.toLowerCase().includes('buy')||grade.newGrade?.toLowerCase().includes('outperform')||grade.newGrade?.toLowerCase().includes('overweight')?'bg-green-500/20 text-green-400 border border-green-500/30':grade.newGrade?.toLowerCase().includes('sell')||grade.newGrade?.toLowerCase().includes('underperform')||grade.newGrade?.toLowerCase().includes('underweight')?'bg-red-500/20 text-red-400 border border-red-500/30':'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30'}`},grade.newGrade||grade.grade||'N/A'),grade.previousGrade&&grade.previousGrade!==grade.newGrade&&React.createElement("span",{className:"text-xs text-slate-500"},"from ",grade.previousGrade)),React.createElement("div",{className:"text-sm text-slate-400"},grade.action==='up'||grade.action==='upgrade'?'üìà Upgrade':grade.action==='down'||grade.action==='downgrade'?'üìâ Downgrade':grade.action==='init'||grade.action==='initiated'?'üÜï Initiated':grade.action==='main'||grade.action==='maintained'?'üîÑ Maintained':'üîÑ '+(grade.action||'Update'))),React.createElement("div",{className:"text-xs text-slate-500 text-right"},grade.date||grade.publishedDate?new Date(grade.date||grade.publishedDate).toLocaleDateString():'N/A')))))),!analystRatingsData.snapshot&&!analystRatingsData.consensus&&!analystRatingsData.priceTarget&&(!analystRatingsData.recentGrades||analystRatingsData.recentGrades.length===0)&&React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("div",{className:"text-slate-400 text-lg mb-2"},"\uD83D\uDCCA No Analyst Data Available"),React.createElement("div",{className:"text-slate-500 text-sm"},"Analyst ratings data is not available for this stock."))):activeTab==='insider'&&insiderData!==null&&insiderData!==undefined?React.createElement("div",{className:"space-y-4"},React.createElement("h3",{className:"text-lg font-bold text-white"},"Insider Trading Activity"),insiderData==='PREMIUM_REQUIRED'?React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("div",{className:"text-6xl mb-4"},"\uD83D\uDD12"),React.createElement("div",{className:"text-xl font-bold text-white mb-2"},"Premium Feature"),React.createElement("div",{className:"text-slate-400 mb-4"},"Insider trading data requires a paid Financial Modeling Prep subscription."),React.createElement("div",{className:"text-sm text-slate-500"},"Available endpoints: Stock quotes, fundamentals, technical indicators")):insiderData?.type==='combined'?React.createElement("div",{className:"space-y-4"},insiderData.statistics&&React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-4"},"Last 4 Quarters Summary"),React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Total Trades"),React.createElement("div",{className:"text-3xl font-bold text-cyan-400"},insiderData.statistics.totalTransactions||0)),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Shares Purchased"),React.createElement("div",{className:"text-3xl font-bold text-green-400"},formatNumber(insiderData.statistics.totalBought||0,0))),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Shares Sold"),React.createElement("div",{className:"text-3xl font-bold text-red-400"},formatNumber(insiderData.statistics.totalSold||0,0))),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Net Position"),React.createElement("div",{className:`text-3xl font-bold ${insiderData.statistics.totalBought-insiderData.statistics.totalSold>0?'text-green-400':'text-red-400'}`},insiderData.statistics.totalBought-insiderData.statistics.totalSold>0?'+':'',formatNumber(insiderData.statistics.totalBought-insiderData.statistics.totalSold||0,0)))),React.createElement("div",{className:"mt-4 pt-4 border-t border-slate-700"},React.createElement("div",{className:"flex justify-between items-center"},React.createElement("span",{className:"text-sm text-slate-400"},"Buy/Sell Ratio"),React.createElement("span",{className:"text-white font-bold"},insiderData.statistics.totalSold>0?(insiderData.statistics.totalBought/insiderData.statistics.totalSold).toFixed(2):'N/A')))),insiderData.latestTrades&&insiderData.latestTrades.length>0&&React.createElement(React.Fragment,null,React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h4",{className:"text-sm font-bold text-slate-400"},"Latest Transactions"),React.createElement("span",{className:"text-xs text-slate-500"},"Showing ",insiderData.latestTrades.length," recent ",insiderData.latestTrades.length===1?'trade':'trades')),React.createElement("div",{className:"space-y-2 max-h-[500px] overflow-y-auto"},insiderData.latestTrades.map((trade,i)=>React.createElement("div",{key:i,className:"glass-card p-4 rounded-xl hover:bg-slate-800/50 transition-all"},React.createElement("div",{className:"flex items-start justify-between"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"flex items-center gap-2 mb-1"},React.createElement("span",{className:"font-semibold text-white"},trade.reportingName||'Unknown'),React.createElement("span",{className:`chip text-xs px-2 py-1 rounded ${trade.acquisitionOrDisposition==='A'?'bg-green-500/20 text-green-400 border border-green-500/30':'bg-red-500/20 text-red-400 border border-red-500/30'}`},trade.acquisitionOrDisposition==='A'?'üìà Buy':'üìâ Sell'),React.createElement("span",{className:"text-xs text-slate-500 border border-slate-700 px-2 py-1 rounded"},trade.transactionType||'N/A')),React.createElement("div",{className:"text-xs text-slate-400 mb-2"},trade.typeOfOwner||'N/A'),React.createElement("div",{className:"text-sm text-slate-300 flex items-center gap-3"},React.createElement("span",{className:"font-mono"},formatNumber(trade.securitiesTransacted||0,0)," shares"),trade.price>0&&React.createElement(React.Fragment,null,React.createElement("span",{className:"text-slate-600"},"@"),React.createElement("span",{className:"font-mono"},"$",(trade.price||0).toFixed(2)),React.createElement("span",{className:"text-slate-600"},"\u2022"),React.createElement("span",{className:"text-slate-500"},"Total: ",formatNumber((trade.securitiesTransacted||0)*(trade.price||0))))),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},"Holdings after: ",formatNumber(trade.securitiesOwned||0,0)," shares")),React.createElement("div",{className:"text-xs text-slate-500 text-right"},React.createElement("div",null,trade.filingDate?new Date(trade.filingDate).toLocaleDateString():'N/A'),trade.transactionDate&&trade.transactionDate!==trade.filingDate&&React.createElement("div",{className:"text-slate-600 text-xs"},"Trade: ",new Date(trade.transactionDate).toLocaleDateString())))))),React.createElement("div",{className:"text-sm text-slate-500 bg-slate-800/50 p-3 rounded-lg text-center"},"\uD83D\uDCA1 Insider buying can signal confidence, while selling may be routine diversification. Look for unusual patterns or clusters of activity.")),(!insiderData.latestTrades||insiderData.latestTrades.length===0)&&insiderData.statistics&&React.createElement("div",{className:"glass-card p-6 rounded-xl text-center"},React.createElement("div",{className:"text-slate-400"},"No recent individual transactions available"))):insiderData?.type==='statistics'&&insiderData?.statistics?React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Total Trades"),React.createElement("div",{className:"text-3xl font-bold text-cyan-400"},insiderData.statistics.totalTransactions||0)),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Purchases"),React.createElement("div",{className:"text-3xl font-bold text-green-400"},insiderData.statistics.totalBought||0),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"$",((insiderData.statistics.totalBoughtValue||0)/1000000).toFixed(1),"M")),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Sales"),React.createElement("div",{className:"text-3xl font-bold text-red-400"},insiderData.statistics.totalSold||0),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"$",((insiderData.statistics.totalSoldValue||0)/1000000).toFixed(1),"M")),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Net Position"),React.createElement("div",{className:`text-3xl font-bold ${insiderData.statistics.totalBought-insiderData.statistics.totalSold>0?'text-green-400':'text-red-400'}`},insiderData.statistics.totalBought-insiderData.statistics.totalSold>0?'+':'',insiderData.statistics.totalBought-insiderData.statistics.totalSold),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"$",(((insiderData.statistics.totalBoughtValue||0)-(insiderData.statistics.totalSoldValue||0))/1000000).toFixed(1),"M")))),React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("div",{className:"text-sm font-bold text-slate-400 mb-4"},"Insider Sentiment"),React.createElement("div",{className:"space-y-4"},React.createElement("div",null,React.createElement("div",{className:"flex justify-between text-sm mb-2"},React.createElement("span",{className:"text-slate-400"},"Buy/Sell Ratio"),React.createElement("span",{className:"text-white font-bold"},insiderData.statistics.totalSold>0?(insiderData.statistics.totalBought/insiderData.statistics.totalSold).toFixed(2):'N/A')),React.createElement("div",{className:"flex justify-between text-sm"},React.createElement("span",{className:"text-slate-400"},"Period"),React.createElement("span",{className:"text-white font-bold"},"Last 6 Months"))),React.createElement("div",{className:"text-sm text-slate-500 bg-slate-800/50 p-3 rounded-lg"},"\uD83D\uDCA1 Insider buying can signal confidence, while selling may be routine diversification. Look for unusual patterns or clusters of activity.")))):Array.isArray(insiderData)&&insiderData.length===0?React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("div",{className:"text-6xl mb-4"},"\uD83D\uDCCA"),React.createElement("div",{className:"text-xl font-bold text-white mb-2"},"No Insider Trades Found"),React.createElement("div",{className:"text-slate-400 mb-4"},"No insider trading activity found for ",stock.symbol,"."),React.createElement("div",{className:"text-sm text-slate-500"},"This stock may have very low insider activity.")):React.createElement(React.Fragment,null,Array.isArray(insiderData)&&insiderData.length>0&&React.createElement("div",{className:"glass-card p-3 rounded-lg mb-4 text-center"},React.createElement("div",{className:"text-sm text-slate-400"},"Showing ",insiderData.length," insider ",insiderData.length===1?'trade':'trades',insiderData[0]?.filingDate&&insiderData[insiderData.length-1]?.filingDate&&React.createElement("span",{className:"ml-2"},"(",new Date(insiderData[insiderData.length-1].filingDate).toLocaleDateString()," - ",new Date(insiderData[0].filingDate).toLocaleDateString(),")"))),React.createElement("div",{className:"space-y-2 max-h-[600px] overflow-y-auto"},(insiderData||[]).map((trade,i)=>React.createElement("div",{key:i,className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"flex items-start justify-between"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"flex items-center gap-2 mb-1"},React.createElement("span",{className:"font-semibold text-white"},trade.reportingName||'Unknown'),React.createElement("span",{className:`chip text-xs ${trade.transactionType?.toLowerCase().includes('purchase')||trade.transactionType?.toLowerCase().includes('buy')?'bg-green-500/20 text-green-400 border border-green-500/30':'bg-red-500/20 text-red-400 border border-red-500/30'}`},trade.transactionType||'N/A')),React.createElement("div",{className:"text-xs text-slate-400"},trade.typeOfOwner||'N/A'),React.createElement("div",{className:"text-sm text-slate-300 mt-2"},React.createElement("span",{className:"font-mono"},formatNumber(trade.securitiesTransacted||0,0)," shares")," @",React.createElement("span",{className:"font-mono ml-1"},"$",(trade.price||0).toFixed(2)),React.createElement("span",{className:"ml-2 text-slate-500"},"Total: ",formatNumber((trade.securitiesTransacted||0)*(trade.price||0))))),React.createElement("div",{className:"text-xs text-slate-500 text-right"},trade.filingDate?new Date(trade.filingDate).toLocaleDateString():'N/A'))))))):activeTab==='earnings'&&analystEstimates?React.createElement("div",{className:"space-y-6"},React.createElement("h3",{className:"text-xl font-bold text-white"},"Earnings Performance vs Estimates"),!analystEstimates.quarterly||analystEstimates.quarterly.length===0?React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("div",{className:"text-6xl mb-4"},"\uD83D\uDCCA"),React.createElement("div",{className:"text-xl font-bold text-white mb-2"},"Earnings Data Not Available"),React.createElement("div",{className:"text-slate-400 mb-4"},"Historical earnings data may require a premium Financial Modeling Prep subscription or may not be available for this stock."),React.createElement("div",{className:"text-sm text-slate-500"},"Try viewing the Fundamentals or Financial tabs for other company data.")):React.createElement(React.Fragment,null,analystEstimates?.quarterly&&analystEstimates.quarterly.length>0&&React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Quarterly Earnings"),React.createElement("div",{className:"space-y-3"},(analystEstimates?.quarterly||[]).slice(0,8).map((est,i)=>{const epsEstimate=est.estimatedEpsAvg||0;const epsActual=est.eps||null;const hasBeat=epsActual!==null;const beat=hasBeat?epsActual>epsEstimate:null;const surprise=hasBeat?(epsActual-epsEstimate)/Math.abs(epsEstimate)*100:null;const revenueEstimate=est.estimatedRevenueAvg||0;const revenueActual=est.revenue||null;const hasRevenueBeat=revenueActual!==null;const revenueBeat=hasRevenueBeat?revenueActual>revenueEstimate:null;const revenueSurprise=hasRevenueBeat?(revenueActual-revenueEstimate)/revenueEstimate*100:null;return React.createElement("div",{key:i,className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("div",null,React.createElement("div",{className:"text-lg font-bold text-white"},est.date||'N/A'),React.createElement("div",{className:"text-xs text-slate-500"},est.numberAnalystEstimatedEps||0," analysts")),hasBeat&&React.createElement("div",{className:`px-4 py-2 rounded-lg font-bold text-lg ${beat?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},beat?'‚úì BEAT':'‚úó MISS')),React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-3"},React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"EPS Estimate"),React.createElement("div",{className:"text-xl font-bold text-cyan-400"},"$",epsEstimate.toFixed(2))),React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"EPS Actual"),React.createElement("div",{className:`text-xl font-bold ${hasBeat?beat?'text-green-400':'text-red-400':'text-slate-400'}`},hasBeat?`$${epsActual.toFixed(2)}`:'‚Äî'))),React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-3"},React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Revenue Estimate"),React.createElement("div",{className:"text-sm font-bold text-purple-400"},formatNumber(revenueEstimate))),React.createElement("div",{className:"glass-card p-3 rounded-lg"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Revenue Actual"),React.createElement("div",{className:`text-sm font-bold ${hasRevenueBeat?revenueBeat?'text-green-400':'text-red-400':'text-slate-400'}`},hasRevenueBeat?formatNumber(revenueActual):'‚Äî'))),hasBeat&&surprise!==null&&React.createElement("div",{className:"pt-3 border-t border-slate-700/30"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("span",{className:"text-xs text-slate-400"},"EPS Surprise"),React.createElement("span",{className:`text-sm font-bold ${surprise>0?'text-green-400':'text-red-400'}`},surprise>0?'+':'',surprise.toFixed(1),"%")),hasRevenueBeat&&revenueSurprise!==null&&React.createElement("div",{className:"flex items-center justify-between mt-1"},React.createElement("span",{className:"text-xs text-slate-400"},"Revenue Surprise"),React.createElement("span",{className:`text-sm font-bold ${revenueSurprise>0?'text-green-400':'text-red-400'}`},revenueSurprise>0?'+':'',revenueSurprise.toFixed(1),"%"))),!hasBeat&&React.createElement("div",{className:"pt-3 border-t border-slate-700/30 text-center text-sm text-slate-500"},"Earnings not yet reported"));}))),analystEstimates?.annual&&analystEstimates.annual.length>0&&React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Annual Earnings Estimates"),React.createElement("div",{className:"glass-card p-4 rounded-xl overflow-x-auto"},React.createElement("table",{className:"w-full text-sm"},React.createElement("thead",null,React.createElement("tr",{className:"text-slate-500 text-xs border-b border-slate-700/30"},React.createElement("th",{className:"text-left pb-3 px-2"},"Year"),React.createElement("th",{className:"text-right pb-3 px-2"},"Est. Revenue"),React.createElement("th",{className:"text-right pb-3 px-2"},"Est. EPS"),React.createElement("th",{className:"text-right pb-3 px-2"},"Est. EBITDA"),React.createElement("th",{className:"text-right pb-3 px-2"},"Analysts"))),React.createElement("tbody",null,(analystEstimates?.annual||[]).slice(0,4).map((est,i)=>React.createElement("tr",{key:i,className:"border-b border-slate-700/20"},React.createElement("td",{className:"py-3 px-2 text-cyan-300 font-semibold"},est.date||'N/A'),React.createElement("td",{className:"py-3 px-2 text-right font-mono"},formatNumber(est.estimatedRevenueAvg||0)),React.createElement("td",{className:"py-3 px-2 text-right font-mono text-green-400"},"$",(est.estimatedEpsAvg||0).toFixed(2)),React.createElement("td",{className:"py-3 px-2 text-right font-mono"},formatNumber(est.estimatedEbitdaAvg||0)),React.createElement("td",{className:"py-3 px-2 text-right text-slate-400"},est.numberAnalystEstimatedRevenue||0))))))),analystEstimates?.quarterly&&analystEstimates.quarterly.length>0&&React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Performance Summary"),React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("div",{className:"grid grid-cols-3 gap-6"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Total Quarters"),React.createElement("div",{className:"text-3xl font-bold text-white"},(analystEstimates?.quarterly||[]).filter(q=>q.eps!==null).length)),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Earnings Beats"),React.createElement("div",{className:"text-3xl font-bold text-green-400"},(analystEstimates?.quarterly||[]).filter(q=>q.eps!==null&&q.eps>(q.estimatedEpsAvg||0)).length)),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Earnings Misses"),React.createElement("div",{className:"text-3xl font-bold text-red-400"},(analystEstimates?.quarterly||[]).filter(q=>q.eps!==null&&q.eps<=(q.estimatedEpsAvg||0)).length))))))):activeTab==='financials'&&incomeStatement?React.createElement("div",{className:"space-y-4"},React.createElement("h3",{className:"text-lg font-bold text-white"},"Income Statement (Last 5 Years)"),React.createElement("div",{className:"glass-card p-4 rounded-xl overflow-x-auto"},React.createElement("table",{className:"w-full text-sm"},React.createElement("thead",null,React.createElement("tr",{className:"text-slate-500 text-xs border-b border-slate-700/30"},React.createElement("th",{className:"text-left pb-3"},"Period"),React.createElement("th",{className:"text-right pb-3"},"Revenue"),React.createElement("th",{className:"text-right pb-3"},"Gross Profit"),React.createElement("th",{className:"text-right pb-3"},"Operating Income"),React.createElement("th",{className:"text-right pb-3"},"Net Income"),React.createElement("th",{className:"text-right pb-3"},"EPS"))),React.createElement("tbody",null,incomeStatement.slice(0,5).map((stmt,i)=>React.createElement("tr",{key:i,className:"border-b border-slate-700/20"},React.createElement("td",{className:"py-3 text-cyan-300 font-semibold"},stmt.calendarYear||stmt.date||'N/A'),React.createElement("td",{className:"py-3 text-right font-mono"},formatNumber(stmt.revenue||0)),React.createElement("td",{className:"py-3 text-right font-mono"},formatNumber(stmt.grossProfit||0)),React.createElement("td",{className:"py-3 text-right font-mono"},formatNumber(stmt.operatingIncome||0)),React.createElement("td",{className:"py-3 text-right font-mono"},formatNumber(stmt.netIncome||0)),React.createElement("td",{className:"py-3 text-right font-mono"},"$",(stmt.eps||0).toFixed(2)))))))):activeTab==='charts'&&historicalData?React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("h3",{className:"text-lg font-bold text-white"},"Advanced Charts (TradingView Lightweight Charts)"),(()=>{const normalizedCandles=historicalData.map(c=>({close:c.close||c,high:c.high||c.close||c,low:c.low||c.close||c,open:c.open||c.close||c}));const patterns=window.patternEngine?.detectPatterns(normalizedCandles)||[];if(patterns.length>0){return React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:"text-xs text-slate-400"},patterns.length," pattern",patterns.length!==1?'s':''," detected"),React.createElement("button",{onClick:()=>setActiveTab('patterns'),className:"px-3 py-1 bg-cyan-600 hover:bg-cyan-500 text-white rounded text-sm font-medium"},"View Patterns"));}return null;})()),React.createElement(AdvancedChartPanel,{symbol:stock.symbol,candles:historicalData,timeframe:chartTimeframe,onTimeframe:tf=>{setChartTimeframe(tf);setHistoricalData(null);},comparisonSymbol:comparisonSymbol,onComparisonSymbol:s=>{setComparisonSymbol(s);if(!s){setComparisonData(null);setComparisonMeta({symbol:null,timeframe:null});}},comparisonCandles:comparisonData,comparisonLoading:comparisonLoading})):activeTab==='ai-predictions'?React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h3",{className:"text-xl font-bold text-white flex items-center gap-2"},React.createElement("span",null,"\uD83E\uDD16"),"AI-Powered Stock Analysis"),React.createElement("button",{onClick:async()=>{console.log('üîÑ Manual refresh clicked');setAiAnalysis(null);setAiLoading(true);try{const analysis=await aiAnalyzer.analyzeStock(stock);setAiAnalysis(analysis);}catch(err){console.error('‚ùå Refresh error:',err);setAiAnalysis(aiAnalyzer.getFallbackAnalysis(stock));}finally{setAiLoading(false);}},className:"px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-lg transition-colors"},"\uD83D\uDD04 Refresh Analysis")),(()=>{console.log('üé® RENDER CHECK - aiLoading:',aiLoading,'aiAnalysis:',!!aiAnalysis);return null;})(),aiLoading?React.createElement("div",{className:"glass-card p-12 rounded-xl text-center"},React.createElement("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-4 border-purple-500 border-t-transparent mb-4"}),React.createElement("div",{className:"text-white font-semibold"},"Claude AI is analyzing ",stock.symbol,"..."),React.createElement("div",{className:"text-slate-400 text-sm mt-2"},"Considering fundamentals, technicals, and market sentiment")):!aiAnalysis?React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("div",{className:"text-6xl mb-4"},"\uD83E\uDD16"),React.createElement("div",{className:"text-xl font-bold text-white mb-2"},"Loading AI Analysis..."),React.createElement("div",{className:"text-slate-400 mb-4"},"Preparing stock analysis for ",stock.symbol),React.createElement("button",{onClick:async()=>{console.log('üîÑ Trigger analysis from empty state');setAiLoading(true);try{const analysis=await aiAnalyzer.analyzeStock(stock);setAiAnalysis(analysis);}catch(err){console.error('‚ùå Analysis error:',err);setAiAnalysis(aiAnalyzer.getFallbackAnalysis(stock));}finally{setAiLoading(false);}},className:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold"},"Generate AI Analysis")):React.createElement(React.Fragment,null,aiAnalysis.aiModel==='fallback'&&React.createElement("div",{className:"glass-card p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30 mb-6"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("span",{className:"text-2xl"},"\u26A0\uFE0F"),React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"text-yellow-400 font-bold text-sm mb-1"},"Limited Analysis Mode"),React.createElement("div",{className:"text-slate-300 text-xs"},"Claude AI is temporarily unavailable. Showing basic rule-based analysis. Click \"Refresh Analysis\" to try again.")))),React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("div",{className:"grid grid-cols-3 gap-6"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"AI Recommendation"),React.createElement("div",{className:`text-5xl font-bold mb-2 ${aiAnalysis.recommendation==='BUY'?'text-green-400':aiAnalysis.recommendation==='SELL'?'text-red-400':'text-yellow-400'}`},aiAnalysis.recommendation),React.createElement("div",{className:"flex items-center justify-center gap-1 mt-2"},[...Array(10)].map((_,i)=>React.createElement("div",{key:i,className:`w-2 h-6 rounded ${i<aiAnalysis.recommendationStrength?aiAnalysis.recommendation==='BUY'?'bg-green-500':aiAnalysis.recommendation==='SELL'?'bg-red-500':'bg-yellow-500':'bg-slate-700'}`}))),React.createElement("div",{className:"text-xs text-slate-400 mt-2"},"Strength: ",aiAnalysis.recommendationStrength,"/10")),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"AI Price Target"),React.createElement("div",{className:"text-4xl font-bold text-purple-400"},"$",aiAnalysis.targetPrice?.toFixed(2)),React.createElement("div",{className:`text-lg font-bold mt-2 ${aiAnalysis.targetPrice>aiAnalysis.currentPrice?'text-green-400':'text-red-400'}`},((aiAnalysis.targetPrice/aiAnalysis.currentPrice-1)*100).toFixed(1),"% upside")),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Suggested Stop Loss"),React.createElement("div",{className:"text-4xl font-bold text-red-400"},"$",aiAnalysis.stopLoss?.toFixed(2)),React.createElement("div",{className:"text-sm text-slate-400 mt-2"},((1-aiAnalysis.stopLoss/aiAnalysis.currentPrice)*100).toFixed(1),"% downside protection")))),React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Price Predictions"),React.createElement("div",{className:"grid grid-cols-3 gap-4"},React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",{className:"text-xs text-slate-500"},"1-Day Forecast"),React.createElement("div",{className:"text-xs text-cyan-400 font-semibold"},aiAnalysis.predictions.oneDay.confidence,"% confidence")),React.createElement("div",{className:"text-3xl font-bold text-white mb-2"},"$",aiAnalysis.predictions.oneDay.price?.toFixed(2)),React.createElement("div",{className:`text-lg font-bold ${aiAnalysis.predictions.oneDay.change>=0?'text-green-400':'text-red-400'}`},aiAnalysis.predictions.oneDay.change>=0?'+':'',aiAnalysis.predictions.oneDay.change?.toFixed(2),"%"),React.createElement("div",{className:"mt-3 h-2 bg-slate-700 rounded-full overflow-hidden"},React.createElement("div",{className:"h-full bg-cyan-500",style:{width:`${aiAnalysis.predictions.oneDay.confidence}%`}}))),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",{className:"text-xs text-slate-500"},"7-Day Forecast"),React.createElement("div",{className:"text-xs text-blue-400 font-semibold"},aiAnalysis.predictions.sevenDay.confidence,"% confidence")),React.createElement("div",{className:"text-3xl font-bold text-white mb-2"},"$",aiAnalysis.predictions.sevenDay.price?.toFixed(2)),React.createElement("div",{className:`text-lg font-bold ${aiAnalysis.predictions.sevenDay.change>=0?'text-green-400':'text-red-400'}`},aiAnalysis.predictions.sevenDay.change>=0?'+':'',aiAnalysis.predictions.sevenDay.change?.toFixed(2),"%"),React.createElement("div",{className:"mt-3 h-2 bg-slate-700 rounded-full overflow-hidden"},React.createElement("div",{className:"h-full bg-blue-500",style:{width:`${aiAnalysis.predictions.sevenDay.confidence}%`}}))),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",{className:"text-xs text-slate-500"},"30-Day Forecast"),React.createElement("div",{className:"text-xs text-purple-400 font-semibold"},aiAnalysis.predictions.thirtyDay.confidence,"% confidence")),React.createElement("div",{className:"text-3xl font-bold text-white mb-2"},"$",aiAnalysis.predictions.thirtyDay.price?.toFixed(2)),React.createElement("div",{className:`text-lg font-bold ${aiAnalysis.predictions.thirtyDay.change>=0?'text-green-400':'text-red-400'}`},aiAnalysis.predictions.thirtyDay.change>=0?'+':'',aiAnalysis.predictions.thirtyDay.change?.toFixed(2),"%"),React.createElement("div",{className:"mt-3 h-2 bg-slate-700 rounded-full overflow-hidden"},React.createElement("div",{className:"h-full bg-purple-500",style:{width:`${aiAnalysis.predictions.thirtyDay.confidence}%`}}))))),React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"AI Analysis Scores"),React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("div",{className:"grid grid-cols-3 gap-6"},React.createElement("div",null,React.createElement("div",{className:"flex items-center justify-between mb-2"},React.createElement("span",{className:"text-sm text-slate-400"},"Technical Analysis"),React.createElement("span",{className:"text-lg font-bold text-cyan-400"},aiAnalysis.technicalScore,"/100")),React.createElement("div",{className:"h-3 bg-slate-700 rounded-full overflow-hidden"},React.createElement("div",{className:`h-full ${aiAnalysis.technicalScore>=70?'bg-green-500':aiAnalysis.technicalScore>=40?'bg-yellow-500':'bg-red-500'}`,style:{width:`${aiAnalysis.technicalScore}%`}}))),React.createElement("div",null,React.createElement("div",{className:"flex items-center justify-between mb-2"},React.createElement("span",{className:"text-sm text-slate-400"},"Fundamental Strength"),React.createElement("span",{className:"text-lg font-bold text-blue-400"},aiAnalysis.fundamentalScore,"/100")),React.createElement("div",{className:"h-3 bg-slate-700 rounded-full overflow-hidden"},React.createElement("div",{className:`h-full ${aiAnalysis.fundamentalScore>=70?'bg-green-500':aiAnalysis.fundamentalScore>=40?'bg-yellow-500':'bg-red-500'}`,style:{width:`${aiAnalysis.fundamentalScore}%`}}))),React.createElement("div",null,React.createElement("div",{className:"flex items-center justify-between mb-2"},React.createElement("span",{className:"text-sm text-slate-400"},"Market Sentiment"),React.createElement("span",{className:"text-lg font-bold text-purple-400"},aiAnalysis.sentimentScore,"/100")),React.createElement("div",{className:"h-3 bg-slate-700 rounded-full overflow-hidden"},React.createElement("div",{className:`h-full ${aiAnalysis.sentimentScore>=70?'bg-green-500':aiAnalysis.sentimentScore>=40?'bg-yellow-500':'bg-red-500'}`,style:{width:`${aiAnalysis.sentimentScore}%`}})))))),React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Key Insights"),React.createElement("div",{className:"space-y-2"},aiAnalysis.keyInsights?.map((insight,i)=>React.createElement("div",{key:i,className:"glass-card p-4 rounded-lg flex items-start gap-3"},React.createElement("span",{className:"text-2xl"},"\uD83D\uDCA1"),React.createElement("span",{className:"text-slate-300 flex-1"},insight))))),React.createElement("div",{className:"grid grid-cols-2 gap-4"},React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide flex items-center gap-2"},React.createElement("span",null,"\uD83D\uDCC8")," Opportunities"),React.createElement("div",{className:"space-y-2"},aiAnalysis.opportunities?.map((opp,i)=>React.createElement("div",{key:i,className:"glass-card p-4 rounded-lg bg-green-500/10 border border-green-500/20"},React.createElement("div",{className:"text-green-400 text-sm"},opp))))),React.createElement("div",null,React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide flex items-center gap-2"},React.createElement("span",null,"\u26A0\uFE0F")," Risks"),React.createElement("div",{className:"space-y-2"},aiAnalysis.risks?.map((risk,i)=>React.createElement("div",{key:i,className:"glass-card p-4 rounded-lg bg-red-500/10 border border-red-500/20"},React.createElement("div",{className:"text-red-400 text-sm"},risk)))))),React.createElement("div",{className:"glass-card p-6 rounded-xl bg-purple-500/10 border border-purple-500/20"},React.createElement("div",{className:"flex items-start gap-4"},React.createElement("div",{className:"text-4xl"},"\uD83E\uDD16"),React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"text-sm font-bold text-purple-400 mb-2"},"AI Summary"),React.createElement("div",{className:"text-slate-300 leading-relaxed"},aiAnalysis.summary),React.createElement("div",{className:"mt-4 pt-4 border-t border-slate-700/30 flex items-center justify-between text-xs text-slate-500"},React.createElement("span",null,"Powered by ",aiAnalysis.aiModel||'Claude Sonnet 4'),React.createElement("span",null,"Generated: ",new Date(aiAnalysis.timestamp).toLocaleString()))))),React.createElement("div",{className:"glass-card p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/20 text-center"},React.createElement("div",{className:"text-yellow-400 text-sm font-semibold mb-1"},"\u26A0\uFE0F AI Prediction Disclaimer"),React.createElement("div",{className:"text-slate-400 text-xs"},"AI predictions are educational estimates and should not be considered financial advice. Past performance does not guarantee future results. Always conduct your own research and consult with a financial advisor before making investment decisions.")))):activeTab==='portfolio'?React.createElement("div",{className:"space-y-6"},React.createElement("h3",{className:"text-xl font-bold text-white"},"\uD83D\uDCCA Portfolio Optimization"),portfolio.length<2?React.createElement("div",{className:"glass-card p-8 text-center"},React.createElement("i",{className:"fas fa-chart-pie text-4xl text-purple-400 mb-4"}),React.createElement("div",{className:"text-lg font-semibold text-white mb-2"},"Add stocks to analyze your portfolio"),React.createElement("div",{className:"text-slate-400 text-sm"},"You need at least 2 stocks in your portfolio to run optimization")):!portfolioOptimization?React.createElement("div",{className:"glass-card p-8 text-center"},React.createElement("i",{className:"fas fa-spinner fa-spin text-4xl text-purple-400 mb-4"}),React.createElement("div",{className:"text-slate-400"},"Running portfolio optimization...")):React.createElement(React.Fragment,null,React.createElement("div",{className:"grid grid-cols-2 gap-6"},React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"flex items-center gap-2 mb-3"},React.createElement("div",{className:"w-3 h-3 rounded-full bg-green-500"}),React.createElement("h4",{className:"text-sm font-bold text-white uppercase tracking-wide"},"Max Sharpe Ratio")),React.createElement("div",{className:"grid grid-cols-2 gap-3 text-sm mb-4"},React.createElement("div",{className:"text-slate-400"},"Return"),React.createElement("div",{className:"text-right font-semibold text-green-400"},(portfolioOptimization.maxSharpePortfolio.return*100).toFixed(1),"%"),React.createElement("div",{className:"text-slate-400"},"Risk"),React.createElement("div",{className:"text-right font-semibold text-white"},(portfolioOptimization.maxSharpePortfolio.volatility*100).toFixed(1),"%"),React.createElement("div",{className:"text-slate-400"},"Sharpe"),React.createElement("div",{className:"text-right font-semibold text-cyan-400"},portfolioOptimization.maxSharpePortfolio.sharpeRatio.toFixed(2))),React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Allocation:"),React.createElement("div",{className:"space-y-2"},portfolioOptimization.maxSharpePortfolio.weights.sort((a,b)=>b.weight-a.weight).map((pos,i)=>React.createElement("div",{key:i,className:"flex justify-between p-2 bg-slate-800/40 rounded"},React.createElement("span",{className:"font-semibold text-cyan-300"},pos.symbol),React.createElement("span",{className:"text-white font-mono"},pos.weight.toFixed(1),"%"))))),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"flex items-center gap-2 mb-3"},React.createElement("div",{className:"w-3 h-3 rounded-full bg-red-500"}),React.createElement("h4",{className:"text-sm font-bold text-white uppercase tracking-wide"},"Min Risk")),React.createElement("div",{className:"grid grid-cols-2 gap-3 text-sm mb-4"},React.createElement("div",{className:"text-slate-400"},"Return"),React.createElement("div",{className:"text-right font-semibold text-yellow-400"},(portfolioOptimization.minVolatilityPortfolio.return*100).toFixed(1),"%"),React.createElement("div",{className:"text-slate-400"},"Risk"),React.createElement("div",{className:"text-right font-semibold text-white"},(portfolioOptimization.minVolatilityPortfolio.volatility*100).toFixed(1),"%"),React.createElement("div",{className:"text-slate-400"},"Sharpe"),React.createElement("div",{className:"text-right font-semibold text-cyan-400"},portfolioOptimization.minVolatilityPortfolio.sharpeRatio.toFixed(2))),React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Allocation:"),React.createElement("div",{className:"space-y-2"},portfolioOptimization.minVolatilityPortfolio.weights.sort((a,b)=>b.weight-a.weight).map((pos,i)=>React.createElement("div",{key:i,className:"flex justify-between p-2 bg-slate-800/40 rounded"},React.createElement("span",{className:"font-semibold text-cyan-300"},pos.symbol),React.createElement("span",{className:"text-white font-mono"},pos.weight.toFixed(1),"%")))))),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Individual Metrics"),React.createElement("div",{className:"space-y-2"},portfolioOptimization.individualMetrics.map((asset,i)=>React.createElement("div",{key:i,className:"flex items-center justify-between p-3 bg-slate-800/40 rounded-lg"},React.createElement("div",{className:"font-semibold text-cyan-300"},asset.symbol),React.createElement("div",{className:"flex gap-4 text-sm"},React.createElement("div",null,React.createElement("span",{className:"text-slate-500"},"Return: "),React.createElement("span",{className:"text-green-400"},(asset.expectedReturn*100).toFixed(1),"%")),React.createElement("div",null,React.createElement("span",{className:"text-slate-500"},"Risk: "),React.createElement("span",{className:"text-white"},(asset.volatility*100).toFixed(1),"%")),React.createElement("div",null,React.createElement("span",{className:"text-slate-500"},"Sharpe: "),React.createElement("span",{className:"text-cyan-400"},asset.sharpeRatio.toFixed(2)))))))),React.createElement("div",{className:"text-xs text-slate-500 text-center"},React.createElement("i",{className:"fas fa-info-circle mr-1"}),"Portfolio optimization based on Modern Portfolio Theory. Sharpe Ratio measures risk-adjusted returns."))):activeTab==='similar'?React.createElement("div",{className:"space-y-6"},React.createElement("h3",{className:"text-xl font-bold text-white"},"\uD83C\uDFAF Stocks Similar to ",selectedStock?.symbol),!similarStocks||similarStocks.length===0?React.createElement("div",{className:"glass-card p-8 text-center"},React.createElement("i",{className:"fas fa-search text-4xl text-cyan-400 mb-4"}),React.createElement("div",{className:"text-slate-400"},"Finding similar stocks...")):React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Top Matches"),React.createElement("div",{className:"space-y-3"},similarStocks.map((stock,i)=>React.createElement("div",{key:i,className:"flex items-center justify-between p-3 bg-slate-800/40 rounded-lg hover:bg-slate-800/60 transition-colors cursor-pointer",onClick:()=>{const fullStock=stocks.find(s=>s.symbol===stock.symbol);if(fullStock)setSelectedStock(fullStock);}},React.createElement("div",{className:"flex items-center gap-4"},React.createElement("div",{className:"relative"},React.createElement("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-cyan-500 to-purple-500 flex items-center justify-center"},React.createElement("span",{className:"font-bold text-white"},stock.symbol.substring(0,3))),React.createElement("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-slate-800 rounded-full border-2 border-slate-900 flex items-center justify-center"},React.createElement("span",{className:"text-xs font-bold text-white"},i+1))),React.createElement("div",null,React.createElement("div",{className:"font-semibold text-cyan-300"},stock.symbol),React.createElement("div",{className:"text-xs text-slate-400"},stock.companyName),React.createElement("div",{className:"text-xs text-slate-500"},stock.sector))),React.createElement("div",{className:"flex items-center gap-6"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Similarity"),React.createElement("div",{className:`text-lg font-bold ${stock.similarity>80?'text-green-400':stock.similarity>60?'text-yellow-400':'text-red-400'}`},stock.similarity.toFixed(1),"%")),React.createElement("div",{className:"text-xs"},React.createElement("div",null,React.createElement("span",{className:"text-slate-500"},"P/E:")," ",React.createElement("span",{className:"text-white"},stock.pe?.toFixed(1)||'N/A')),React.createElement("div",null,React.createElement("span",{className:"text-slate-500"},"ROE:")," ",React.createElement("span",{className:"text-white"},stock.roe?.toFixed(1)||'N/A',"%")),React.createElement("div",null,React.createElement("span",{className:"text-slate-500"},"Score:")," ",React.createElement("span",{className:"text-cyan-400"},stock.aiScore||'N/A'))))))),React.createElement("div",{className:"mt-4 text-xs text-slate-500 text-center"},React.createElement("i",{className:"fas fa-info-circle mr-1"}),"Similarity based on sector, financial metrics, and market cap"))):activeTab==='heatmap'?React.createElement("div",{className:"animate-fade-in"},React.createElement(APIStatusBanner,{realtimeData:realtimeData}),React.createElement(RealtimeHeatmap,{stocks:stocks,onStockClick:stock=>{setSelectedStock(stock);openStockModal(stock);}})):activeTab==='sentiment-leaderboard'?React.createElement("div",{className:"space-y-6"},React.createElement(SocialSentimentLeaderboard,{onStockClick:openStockModal})):activeTab==='patterns'?React.createElement("div",{className:"space-y-6"},historicalData&&historicalData.length>0?React.createElement(React.Fragment,null,React.createElement("h3",{className:"text-xl font-bold text-white mb-4"},"\uD83D\uDCC8 Chart Pattern Recognition"),(()=>{const normalizedCandles=historicalData.map(c=>({close:c.close||c,high:c.high||c.close||c,low:c.low||c.close||c,open:c.open||c.close||c}));const patterns=window.patternEngine?.detectPatterns(normalizedCandles)||[];if(patterns.length===0){return React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("i",{className:"fas fa-chart-line text-4xl text-slate-500 mb-4"}),React.createElement("p",{className:"text-slate-400"},"No chart patterns detected"),React.createElement("p",{className:"text-xs text-slate-500 mt-2"},"Patterns require at least 20 candles of historical data"));}return React.createElement("div",{className:"space-y-4"},patterns.map((pattern,idx)=>{const[showAIAnalysis,setShowAIAnalysis]=React.useState(false);const[aiAnalysis,setAiAnalysis]=React.useState(null);const[analyzing,setAnalyzing]=React.useState(false);const analyzePattern=async()=>{setAnalyzing(true);try{const analysis=await generatePatternAnalysis(pattern,stock,historicalData);setAiAnalysis(analysis);setShowAIAnalysis(true);}catch(err){console.error('Pattern analysis error:',err);setAiAnalysis(generateFallbackAnalysis(pattern));setShowAIAnalysis(true);}finally{setAnalyzing(false);}};return React.createElement("div",{key:idx,className:"glass-card p-5 rounded-xl border border-cyan-500/20"},React.createElement("div",{className:"flex items-start justify-between mb-3"},React.createElement("div",null,React.createElement("h4",{className:"text-lg font-bold text-white"},pattern.pattern.name),React.createElement("p",{className:"text-sm text-slate-400 mt-1"},pattern.pattern.description)),React.createElement("div",{className:"text-right"},React.createElement("div",{className:`text-2xl font-bold ${pattern.confidence>0.75?'text-green-400':pattern.confidence>0.65?'text-yellow-400':'text-orange-400'}`},(pattern.confidence*100).toFixed(0),"%"),React.createElement("div",{className:"text-xs text-slate-500"},"Confidence"))),React.createElement("div",{className:"grid grid-cols-2 gap-4 mt-4"},React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Type"),React.createElement("div",{className:`text-sm font-semibold ${pattern.pattern.type==='reversal'?'text-red-400':'text-green-400'}`},pattern.pattern.type==='reversal'?'Reversal':'Continuation')),React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Reliability"),React.createElement("div",{className:"text-sm font-semibold text-cyan-400"},(pattern.pattern.reliability*100).toFixed(0),"%")),pattern.targetPrice&&React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Target Price"),React.createElement("div",{className:"text-sm font-semibold text-white"},"$",pattern.targetPrice.toFixed(2))),React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Implications"),React.createElement("div",{className:`text-sm font-semibold ${pattern.implications?.includes('Bullish')?'text-green-400':pattern.implications?.includes('Bearish')?'text-red-400':'text-slate-400'}`},pattern.implications||'Neutral'))),React.createElement("div",{className:"mt-4 pt-4 border-t border-slate-700/30"},!showAIAnalysis?React.createElement("button",{onClick:analyzePattern,disabled:analyzing,className:"w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded-lg font-semibold text-sm flex items-center justify-center gap-2"},analyzing?React.createElement(React.Fragment,null,React.createElement("div",{className:"inline-block animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),React.createElement("span",null,"AI Analyzing Pattern...")):React.createElement(React.Fragment,null,React.createElement("span",null,"\uD83E\uDD16"),React.createElement("span",null,"Get AI Analysis"))):React.createElement("div",{className:"space-y-3"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("span",{className:"text-sm font-bold text-purple-400"},"\uD83E\uDD16 AI Analysis"),React.createElement("button",{onClick:()=>setShowAIAnalysis(false),className:"text-xs text-slate-500 hover:text-slate-400"},"Hide")),React.createElement("div",{className:"bg-slate-800/50 rounded-lg p-3"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Trading Signal"),React.createElement("div",{className:`text-lg font-bold ${aiAnalysis.signal==='BUY'?'text-green-400':aiAnalysis.signal==='SELL'?'text-red-400':'text-yellow-400'}`},aiAnalysis.signal)),React.createElement("div",{className:"bg-slate-800/50 rounded-lg p-3"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Recommended Strategy"),React.createElement("div",{className:"text-sm text-slate-300"},aiAnalysis.strategy)),React.createElement("div",{className:"grid grid-cols-2 gap-2"},React.createElement("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-2"},React.createElement("div",{className:"text-xs text-green-400 mb-1"},"Entry Point"),React.createElement("div",{className:"text-sm font-bold text-white"},"$",aiAnalysis.entryPoint?.toFixed(2))),React.createElement("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-2"},React.createElement("div",{className:"text-xs text-red-400 mb-1"},"Stop Loss"),React.createElement("div",{className:"text-sm font-bold text-white"},"$",aiAnalysis.stopLoss?.toFixed(2)))),React.createElement("div",{className:"bg-slate-800/50 rounded-lg p-3"},React.createElement("div",{className:"flex items-center justify-between mb-2"},React.createElement("span",{className:"text-xs text-slate-500"},"Risk Level"),React.createElement("span",{className:`text-sm font-bold ${aiAnalysis.riskLevel==='Low'?'text-green-400':aiAnalysis.riskLevel==='Medium'?'text-yellow-400':'text-red-400'}`},aiAnalysis.riskLevel)),React.createElement("div",{className:"text-xs text-slate-400"},aiAnalysis.riskNote)),React.createElement("div",{className:"bg-slate-800/50 rounded-lg p-3"},React.createElement("div",{className:"text-xs text-slate-500 mb-2"},"Key Factors"),React.createElement("ul",{className:"space-y-1"},aiAnalysis.keyFactors?.map((factor,i)=>React.createElement("li",{key:i,className:"text-xs text-slate-300 flex items-start gap-2"},React.createElement("span",{className:"text-purple-400"},"\u2022"),React.createElement("span",null,factor))))),React.createElement("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded-lg p-3"},React.createElement("div",{className:"text-xs text-slate-400 leading-relaxed"},aiAnalysis.summary)))));}));})()):React.createElement("div",{className:"glass-card p-8 rounded-xl text-center"},React.createElement("i",{className:"fas fa-chart-line text-4xl text-slate-500 mb-4"}),React.createElement("p",{className:"text-slate-400"},"Load chart data to detect patterns"),React.createElement("p",{className:"text-xs text-slate-500 mt-2"},"Switch to the Charts tab and load historical data first"))):activeTab==='watchlist'?React.createElement(WatchlistTab,{watchlist:watchlist,stocks:stocks,onRemoveFromWatchlist:toggleWatchlist,onStockClick:openStockModal,setShowWatchlistOnly:setShowWatchlistOnly}):React.createElement("div",{className:"text-center py-12 text-slate-400"},activeTab==='insider'||activeTab==='earnings'||activeTab==='financials'||activeTab==='charts'||activeTab==='ai-predictions'?'No data available for this stock':'Select a tab to view data')),React.createElement("div",{className:"flex justify-end gap-3 p-6 border-t border-slate-700/30 flex-shrink-0"},React.createElement("button",{onClick:onClose,className:"px-6 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm"},"Close"))));}function PortfolioModal(_ref18){let{onClose,stocks}=_ref18;const[activeTab,setActiveTab]=useState('holdings');const[newPosition,setNewPosition]=useState({symbol:'',quantity:'',buyPrice:'',buyDate:''});const[editingId,setEditingId]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[refreshKey,setRefreshKey]=useState(0);const metrics=window.portfolioManager?window.portfolioManager.calculatePortfolioMetrics(stocks):{holdings:[],totalValue:0,totalCost:0,totalGainLoss:0,totalGainLossPercent:0};const calculateHealth=()=>{if(metrics.holdings.length===0)return null;let weightedBeta=0;const sectorWeights={};metrics.holdings.forEach(h=>{const stock=stocks.find(s=>s.symbol===h.symbol);const weight=metrics.totalValue>0?h.currentValue/metrics.totalValue:0;const beta=stock?.beta||1.0;weightedBeta+=beta*weight;const sector=stock?.sector||'Unknown';sectorWeights[sector]=(sectorWeights[sector]||0)+weight;});const maxSector=Object.entries(sectorWeights).sort((a,b)=>b[1]-a[1])[0];const insights=[];if(weightedBeta>1.3)insights.push({type:'warning',text:'High Portfolio Volatility (Beta > 1.3). Consider adding defensive stocks.'});if(weightedBeta<0.8)insights.push({type:'info',text:'Low Portfolio Volatility (Beta < 0.8). Good for capital preservation.'});if(maxSector&&maxSector[1]>0.30)insights.push({type:'warning',text:`High concentration in ${maxSector[0]} (${(maxSector[1]*100).toFixed(0)}%). Diversify!`});if(metrics.holdings.length<5)insights.push({type:'warning',text:'Portfolio is under-diversified (< 5 stocks).'});return{weightedBeta,maxSector,insights};};const health=calculateHealth();const addPosition=async()=>{const{symbol,quantity,buyPrice,buyDate}=newPosition;if(!symbol||!quantity||!buyPrice){setError('Please fill Symbol, Quantity, and Buy Price fields');return;}const symbolUpper=symbol.toUpperCase();const quantityNum=parseFloat(quantity);const priceNum=parseFloat(buyPrice);if(quantityNum<=0||priceNum<=0){setError('Quantity and buy price must be positive numbers');return;}setLoading(true);setError(null);try{window.portfolioManager.addHolding(symbolUpper,quantityNum,priceNum,buyDate||new Date().toISOString().split('T')[0]);setNewPosition({symbol:'',quantity:'',buyPrice:'',buyDate:''});setRefreshKey(k=>k+1);setError(null);}catch(err){setError(err.message);}finally{setLoading(false);}};const removePosition=id=>{window.portfolioManager.removeHolding(id);setRefreshKey(k=>k+1);};const exportPortfolioCSV=()=>{const csvContent=window.portfolioManager.exportToCSV();const blob=new Blob([csvContent],{type:'text/csv'});const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`portfolio-${new Date().toISOString().split('T')[0]}.csv`;document.body.appendChild(a);a.click();document.body.removeChild(a);window.URL.revokeObjectURL(url);};const topPerformers=window.portfolioManager.getTopPerformers(metrics,3);const worstPerformers=window.portfolioManager.getWorstPerformers(metrics,3);return React.createElement("div",{className:"modal-overlay",onClick:onClose},React.createElement("div",{className:"glass-elevated rounded-2xl max-w-6xl w-full mx-auto my-8 animate-slide-up max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"flex items-start justify-between p-6 border-b border-slate-700/30 flex-shrink-0"},React.createElement("div",null,React.createElement("h2",{className:"text-3xl font-bold text-white mb-1"},"\uD83D\uDCCA Portfolio Tracker"),React.createElement("div",{className:"text-sm text-slate-400"},"Track your investments with real-time P&L calculations")),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white text-2xl leading-none"},"\xD7")),React.createElement("div",{className:"flex gap-2 px-6 pt-4 border-b border-slate-700/30"},React.createElement("button",{onClick:()=>setActiveTab('holdings'),className:`px-4 py-2 text-sm font-semibold border-b-2 transition-colors ${activeTab==='holdings'?'border-cyan-400 text-cyan-400':'border-transparent text-slate-400 hover:text-slate-200'}`},"Holdings & Performance"),React.createElement("button",{onClick:()=>setActiveTab('health'),className:`px-4 py-2 text-sm font-semibold border-b-2 transition-colors ${activeTab==='health'?'border-cyan-400 text-cyan-400':'border-transparent text-slate-400 hover:text-slate-200'}`},"\u2764\uFE0F Health Check")),activeTab==='holdings'?React.createElement(React.Fragment,null,React.createElement("div",{className:"p-6 border-b border-slate-700/30"},React.createElement("div",{className:"grid grid-cols-4 gap-4"},React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1 uppercase tracking-wide"},"Total Value"),React.createElement("div",{className:"text-3xl font-bold text-white"},"$",metrics.totalValue.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}))),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1 uppercase tracking-wide"},"Total Cost"),React.createElement("div",{className:"text-2xl font-bold text-slate-300"},"$",metrics.totalCost.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}))),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1 uppercase tracking-wide"},"Total Gain/Loss"),React.createElement("div",{className:`text-3xl font-bold ${metrics.totalGainLoss>=0?'text-green-400':'text-red-400'}`},metrics.totalGainLoss>=0?'+':'',"$",metrics.totalGainLoss.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})),React.createElement("div",{className:`text-sm mt-1 font-semibold ${metrics.totalGainLossPercent>=0?'text-green-400':'text-red-400'}`},metrics.totalGainLossPercent>=0?'+':'',metrics.totalGainLossPercent.toFixed(2),"%")),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1 uppercase tracking-wide"},"Positions"),React.createElement("div",{className:"text-3xl font-bold text-white"},metrics.holdings.length),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},topPerformers.length>0&&`Top: ${topPerformers[0].symbol} +${topPerformers[0].gainLossPercent.toFixed(1)}%`)))),React.createElement("div",{className:"p-6 border-b border-slate-700/30"},React.createElement("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2"},React.createElement("i",{className:"fas fa-plus-circle text-cyan-400"}),"Add New Position"),error&&React.createElement("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg flex items-center gap-2"},React.createElement("i",{className:"fas fa-exclamation-triangle text-red-400"}),React.createElement("div",{className:"text-red-400 text-sm"},error)),React.createElement("div",{className:"grid grid-cols-5 gap-4"},React.createElement("div",null,React.createElement("label",{className:"text-xs text-slate-500 mb-1 block uppercase tracking-wide"},"Symbol *"),React.createElement("input",{type:"text",id:"position-symbol",name:"position-symbol",value:newPosition.symbol,onChange:e=>setNewPosition({...newPosition,symbol:e.target.value.toUpperCase()}),className:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-white focus:outline-none focus:border-cyan-500 font-mono",placeholder:"AAPL"})),React.createElement("div",null,React.createElement("label",{className:"text-xs text-slate-500 mb-1 block uppercase tracking-wide"},"Quantity *"),React.createElement("input",{type:"number",id:"position-quantity",name:"position-quantity",value:newPosition.quantity,onChange:e=>setNewPosition({...newPosition,quantity:e.target.value}),className:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-white focus:outline-none focus:border-cyan-500",placeholder:"10",step:"0.01"})),React.createElement("div",null,React.createElement("label",{className:"text-xs text-slate-500 mb-1 block uppercase tracking-wide"},"Buy Price ($) *"),React.createElement("input",{type:"number",id:"position-buy-price",name:"position-buy-price",value:newPosition.buyPrice,onChange:e=>setNewPosition({...newPosition,buyPrice:e.target.value}),className:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-white focus:outline-none focus:border-cyan-500",placeholder:"150.00",step:"0.01"})),React.createElement("div",null,React.createElement("label",{className:"text-xs text-slate-500 mb-1 block uppercase tracking-wide"},"Buy Date"),React.createElement("input",{type:"date",id:"position-buy-date",name:"position-buy-date",value:newPosition.buyDate,onChange:e=>setNewPosition({...newPosition,buyDate:e.target.value}),className:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-white focus:outline-none focus:border-cyan-500"})),React.createElement("div",{className:"flex items-end"},React.createElement("button",{onClick:addPosition,disabled:loading,className:"w-full px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 disabled:from-slate-700 disabled:to-slate-700 text-white rounded-lg font-semibold flex items-center justify-center gap-2 transition"},loading?React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-spinner animate-spin"}),"Adding..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-plus"}),"Add"))))),React.createElement("div",{className:"p-6 overflow-y-auto flex-1"},React.createElement("div",{className:"flex justify-between items-center mb-4"},React.createElement("h3",{className:"text-lg font-bold text-white flex items-center gap-2"},React.createElement("i",{className:"fas fa-list text-cyan-400"}),"Your Holdings"),React.createElement("button",{onClick:exportPortfolioCSV,disabled:metrics.holdings.length===0,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-800 disabled:cursor-not-allowed text-white rounded-lg font-semibold text-sm flex items-center gap-2 transition"},React.createElement("i",{className:"fas fa-file-export"}),"Export CSV")),metrics.holdings.length===0?React.createElement("div",{className:"text-center py-16 text-slate-400"},React.createElement("i",{className:"fas fa-chart-line text-6xl mb-4 text-slate-700"}),React.createElement("div",{className:"text-xl font-semibold mb-2"},"No positions in your portfolio yet"),React.createElement("div",{className:"text-sm"},"Add your first position above to start tracking your investments")):React.createElement("div",{className:"space-y-4"},(topPerformers.length>0||worstPerformers.length>0)&&React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-6"},topPerformers.length>0&&React.createElement("div",{className:"glass-card p-4 rounded-xl border border-green-500/20"},React.createElement("div",{className:"text-xs text-slate-500 mb-2 uppercase tracking-wide flex items-center gap-2"},React.createElement("i",{className:"fas fa-trophy text-green-400"}),"Top Performers"),topPerformers.map((holding,idx)=>React.createElement("div",{key:holding.id,className:"flex justify-between items-center mb-1"},React.createElement("span",{className:"text-sm font-mono text-cyan-300"},holding.symbol),React.createElement("span",{className:"text-sm font-semibold text-green-400"},"+",holding.gainLossPercent.toFixed(2),"%")))),worstPerformers.length>0&&React.createElement("div",{className:"glass-card p-4 rounded-xl border border-red-500/20"},React.createElement("div",{className:"text-xs text-slate-500 mb-2 uppercase tracking-wide flex items-center gap-2"},React.createElement("i",{className:"fas fa-arrow-down text-red-400"}),"Needs Attention"),worstPerformers.map((holding,idx)=>React.createElement("div",{key:holding.id,className:"flex justify-between items-center mb-1"},React.createElement("span",{className:"text-sm font-mono text-cyan-300"},holding.symbol),React.createElement("span",{className:"text-sm font-semibold text-red-400"},holding.gainLossPercent.toFixed(2),"%"))))),React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-6"},React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-4 uppercase tracking-wide flex items-center gap-2"},React.createElement("i",{className:"fas fa-chart-pie text-cyan-400"}),"Allocation by Value"),React.createElement("div",{className:"flex items-center justify-center mb-4"},React.createElement("div",{className:"relative w-48 h-48"},React.createElement("svg",{viewBox:"0 0 100 100",className:"transform -rotate-90"},(()=>{let cumulativePercent=0;const colors=['#06b6d4','#8b5cf6','#10b981','#f59e0b','#ef4444','#ec4899','#6366f1','#14b8a6'];return metrics.holdings.map((holding,idx)=>{const percent=holding.currentValue/metrics.totalValue*100;const strokeDasharray=`${percent} ${100-percent}`;const strokeDashoffset=-cumulativePercent;cumulativePercent+=percent;return React.createElement("circle",{key:holding.id,cx:"50",cy:"50",r:"15.915",fill:"transparent",stroke:colors[idx%colors.length],strokeWidth:"12",strokeDasharray:strokeDasharray,strokeDashoffset:strokeDashoffset,style:{transition:'all 0.3s ease'}});});})()),React.createElement("div",{className:"absolute inset-0 flex flex-col items-center justify-center"},React.createElement("div",{className:"text-xs text-slate-500"},"Total"),React.createElement("div",{className:"text-lg font-bold text-white"},"$",(metrics.totalValue/1000).toFixed(1),"K")))),React.createElement("div",{className:"space-y-1"},metrics.holdings.sort((a,b)=>b.currentValue-a.currentValue).slice(0,5).map((holding,idx)=>{const colors=['#06b6d4','#8b5cf6','#10b981','#f59e0b','#ef4444'];const percent=holding.currentValue/metrics.totalValue*100;return React.createElement("div",{key:holding.id,className:"flex items-center justify-between text-xs"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:colors[idx%colors.length]}}),React.createElement("span",{className:"font-mono text-slate-300"},holding.symbol)),React.createElement("span",{className:"font-semibold text-white"},percent.toFixed(1),"%"));}),metrics.holdings.length>5&&React.createElement("div",{className:"text-xs text-slate-500 pt-1"},"+",metrics.holdings.length-5," more"))),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-4 uppercase tracking-wide flex items-center gap-2"},React.createElement("i",{className:"fas fa-layer-group text-purple-400"}),"Allocation by Sector"),(()=>{const sectorAllocation={};metrics.holdings.forEach(holding=>{const stock=stocks.find(s=>s.symbol===holding.symbol);const sector=stock?.sector||'Unknown';if(!sectorAllocation[sector]){sectorAllocation[sector]=0;}sectorAllocation[sector]+=holding.currentValue;});const sectors=Object.entries(sectorAllocation).map(_ref19=>{let[sector,value]=_ref19;return{sector,value,percent:value/metrics.totalValue*100};}).sort((a,b)=>b.value-a.value);return React.createElement("div",{className:"space-y-3"},sectors.map((item,idx)=>React.createElement("div",{key:item.sector},React.createElement("div",{className:"flex items-center justify-between text-xs mb-1"},React.createElement("span",{className:"font-semibold text-slate-300"},item.sector),React.createElement("span",{className:"text-white font-mono"},item.percent.toFixed(1),"%")),React.createElement("div",{className:"w-full bg-slate-700/50 rounded-full h-2 overflow-hidden"},React.createElement("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${item.percent}%`,background:`linear-gradient(90deg, ${idx===0?'#06b6d4, #3b82f6':idx===1?'#8b5cf6, #a855f7':idx===2?'#10b981, #34d399':idx===3?'#f59e0b, #fbbf24':'#ef4444, #f87171'})`}})))),sectors.length===0&&React.createElement("div",{className:"text-center py-8 text-slate-500 text-sm"},"Sector data not available"));})())),React.createElement("div",{className:"glass-card p-5 rounded-xl mb-6"},React.createElement("h4",{className:"text-sm font-bold text-slate-400 mb-4 uppercase tracking-wide flex items-center gap-2"},React.createElement("i",{className:"fas fa-chart-bar text-green-400"}),"Gain/Loss Distribution"),React.createElement("div",{className:"space-y-3"},metrics.holdings.sort((a,b)=>b.gainLossPercent-a.gainLossPercent).map(holding=>{const maxPercent=Math.max(...metrics.holdings.map(h=>Math.abs(h.gainLossPercent)));const barWidth=Math.min(Math.abs(holding.gainLossPercent)/maxPercent*100,100);const isPositive=holding.gainLossPercent>=0;return React.createElement("div",{key:holding.id,className:"flex items-center gap-3"},React.createElement("div",{className:"w-16 text-right"},React.createElement("span",{className:"font-mono text-xs text-cyan-300 font-semibold"},holding.symbol)),React.createElement("div",{className:"flex-1 flex items-center"},React.createElement("div",{className:"relative w-full h-8 bg-slate-700/30 rounded"},React.createElement("div",{className:`absolute top-0 left-1/2 h-full rounded transition-all duration-500 ${isPositive?'bg-gradient-to-r from-green-500/80 to-green-400':'bg-gradient-to-l from-red-500/80 to-red-400'}`,style:{width:`${barWidth/2}%`,[isPositive?'left':'right']:'50%',transform:isPositive?'none':'scaleX(-1)'}}),React.createElement("div",{className:"absolute inset-0 flex items-center justify-center"},React.createElement("span",{className:`text-xs font-bold font-mono ${Math.abs(holding.gainLossPercent)>5?'text-white':isPositive?'text-green-400':'text-red-400'}`},isPositive?'+':'',holding.gainLossPercent.toFixed(2),"%")))),React.createElement("div",{className:"w-24 text-right"},React.createElement("span",{className:`text-xs font-mono font-bold ${isPositive?'text-green-400':'text-red-400'}`},isPositive?'+':'',"$",holding.gainLoss.toFixed(2))));}))),React.createElement("div",{className:"glass rounded-xl overflow-hidden"},React.createElement("table",{className:"w-full text-sm"},React.createElement("thead",null,React.createElement("tr",{className:"bg-slate-800/50 text-slate-400 text-xs uppercase tracking-wide"},React.createElement("th",{className:"text-left p-4"},"Symbol"),React.createElement("th",{className:"text-right p-4"},"Qty"),React.createElement("th",{className:"text-right p-4"},"Buy Price"),React.createElement("th",{className:"text-right p-4"},"Current"),React.createElement("th",{className:"text-right p-4"},"Cost Basis"),React.createElement("th",{className:"text-right p-4"},"Current Value"),React.createElement("th",{className:"text-right p-4"},"Gain/Loss ($)"),React.createElement("th",{className:"text-right p-4"},"Gain/Loss (%)"),React.createElement("th",{className:"text-right p-4"},"Day Change"),React.createElement("th",{className:"text-center p-4"},"Actions"))),React.createElement("tbody",null,metrics.holdings.map((holding,index)=>React.createElement("tr",{key:holding.id,className:"border-t border-slate-700/20 hover:bg-slate-800/30 transition"},React.createElement("td",{className:"p-4"},React.createElement("div",{className:"font-semibold text-cyan-300 font-mono"},holding.symbol),React.createElement("div",{className:"text-xs text-slate-500"},holding.buyDate)),React.createElement("td",{className:"p-4 text-right font-mono text-white"},holding.quantity),React.createElement("td",{className:"p-4 text-right font-mono text-slate-300"},"$",holding.buyPrice.toFixed(2)),React.createElement("td",{className:"p-4 text-right font-mono text-white font-semibold"},"$",holding.currentPrice?.toFixed(2)||'‚Äî'),React.createElement("td",{className:"p-4 text-right font-mono text-slate-300"},"$",holding.costBasis?.toFixed(2)||'‚Äî'),React.createElement("td",{className:"p-4 text-right font-mono text-white font-semibold"},"$",holding.currentValue?.toFixed(2)||'‚Äî'),React.createElement("td",{className:"p-4 text-right"},React.createElement("span",{className:`font-mono font-bold ${holding.gainLoss>=0?'text-green-400':'text-red-400'}`},holding.gainLoss>=0?'+':'',"$",holding.gainLoss?.toFixed(2)||'‚Äî')),React.createElement("td",{className:"p-4 text-right"},React.createElement("span",{className:`px-2 py-1 rounded font-mono font-bold text-sm ${holding.gainLossPercent>=10?'bg-green-500/20 text-green-400':holding.gainLossPercent>=0?'bg-green-500/10 text-green-400':holding.gainLossPercent<=-10?'bg-red-500/20 text-red-400':'bg-red-500/10 text-red-400'}`},holding.gainLossPercent>=0?'+':'',holding.gainLossPercent?.toFixed(2)||'‚Äî',"%")),React.createElement("td",{className:"p-4 text-right"},React.createElement("span",{className:`font-mono text-sm ${holding.dayChange>=0?'text-green-400':'text-red-400'}`},holding.dayChange>=0?'+':'',holding.dayChange?.toFixed(2)||'0.00',"%")),React.createElement("td",{className:"p-4 text-center"},React.createElement("button",{onClick:()=>removePosition(holding.id),className:"px-3 py-1 bg-red-600/20 hover:bg-red-600 text-red-400 hover:text-white rounded text-xs transition font-semibold",title:"Remove position"},React.createElement("i",{className:"fas fa-trash"})))))),React.createElement("tfoot",null,React.createElement("tr",{className:"bg-slate-800/70 font-bold border-t-2 border-slate-600"},React.createElement("td",{colSpan:"4",className:"p-4 text-right text-slate-300 uppercase tracking-wide"},"Portfolio Total:"),React.createElement("td",{className:"p-4 text-right font-mono text-white"},"$",metrics.totalCost.toFixed(2)),React.createElement("td",{className:"p-4 text-right font-mono text-white text-lg"},"$",metrics.totalValue.toFixed(2)),React.createElement("td",{className:"p-4 text-right"},React.createElement("span",{className:`font-mono text-lg ${metrics.totalGainLoss>=0?'text-green-400':'text-red-400'}`},metrics.totalGainLoss>=0?'+':'',"$",metrics.totalGainLoss.toFixed(2))),React.createElement("td",{className:"p-4 text-right"},React.createElement("span",{className:`px-3 py-1 rounded font-mono text-lg ${metrics.totalGainLossPercent>=0?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},metrics.totalGainLossPercent>=0?'+':'',metrics.totalGainLossPercent.toFixed(2),"%")),React.createElement("td",{colSpan:"2"})))))))):React.createElement("div",{className:"p-6 overflow-y-auto flex-1 space-y-6"},!health?React.createElement("div",{className:"text-center py-12 text-slate-400"},React.createElement("i",{className:"fas fa-heartbeat text-6xl mb-4 text-slate-700"}),React.createElement("div",{className:"text-xl font-semibold mb-2"},"No Data for Health Check"),React.createElement("div",{className:"text-sm"},"Add positions to your portfolio to see health metrics.")):React.createElement(React.Fragment,null,React.createElement("div",{className:"grid grid-cols-3 gap-4"},React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1 uppercase tracking-wide"},"Portfolio Beta"),React.createElement("div",{className:`text-3xl font-bold ${health.weightedBeta>1.2?'text-red-400':health.weightedBeta<0.8?'text-blue-400':'text-green-400'}`},health.weightedBeta.toFixed(2)),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},health.weightedBeta>1.2?'High Volatility':health.weightedBeta<0.8?'Low Volatility':'Moderate Volatility')),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1 uppercase tracking-wide"},"Top Sector"),React.createElement("div",{className:"text-2xl font-bold text-white truncate"},health.maxSector?health.maxSector[0]:'‚Äî'),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},health.maxSector?`${(health.maxSector[1]*100).toFixed(1)}% Allocation`:'‚Äî')),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1 uppercase tracking-wide"},"Diversification Score"),React.createElement("div",{className:"text-3xl font-bold text-cyan-400"},Math.min(100,Math.max(0,100-(health.maxSector?health.maxSector[1]*100:0))).toFixed(0),"/100"),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},"Based on concentration"))),React.createElement("div",{className:"glass-card p-6 rounded-xl border border-cyan-500/20"},React.createElement("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2"},React.createElement("i",{className:"fas fa-robot text-cyan-400"}),"AI Portfolio Insights"),React.createElement("div",{className:"space-y-3"},health.insights.length===0?React.createElement("div",{className:"text-slate-400 text-sm"},React.createElement("i",{className:"fas fa-check-circle text-green-400 mr-2"}),"Your portfolio looks healthy! No critical warnings."):health.insights.map((insight,idx)=>React.createElement("div",{key:idx,className:`p-3 rounded-lg flex items-start gap-3 ${insight.type==='warning'?'bg-red-500/10 border border-red-500/20':'bg-blue-500/10 border border-blue-500/20'}`},React.createElement("i",{className:`fas ${insight.type==='warning'?'fa-exclamation-triangle text-red-400':'fa-info-circle text-blue-400'} mt-1`}),React.createElement("div",{className:"text-sm text-slate-200"},insight.text))))),React.createElement("div",{className:"glass-card p-6 rounded-xl"},React.createElement("h3",{className:"text-lg font-bold text-white mb-4"},"Risk Analysis"),React.createElement("div",{className:"space-y-4"},React.createElement("div",null,React.createElement("div",{className:"flex justify-between text-sm mb-1"},React.createElement("span",{className:"text-slate-400"},"Market Correlation (Beta)"),React.createElement("span",{className:"text-white font-bold"},health.weightedBeta.toFixed(2))),React.createElement("div",{className:"w-full bg-slate-700 rounded-full h-2"},React.createElement("div",{className:`h-full rounded-full ${health.weightedBeta>1?'bg-red-400':'bg-green-400'}`,style:{width:`${Math.min(100,health.weightedBeta*50)}%`}})),React.createElement("div",{className:"flex justify-between text-xs text-slate-500 mt-1"},React.createElement("span",null,"Low Risk"),React.createElement("span",null,"Market Risk (1.0)"),React.createElement("span",null,"High Risk"))))),metrics.holdings.length>0&&React.createElement("div",{className:"glass-card p-6 rounded-xl border border-purple-500/20"},React.createElement("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2"},React.createElement("i",{className:"fas fa-chart-line text-purple-400"}),"Market Crash Simulator"),React.createElement(MarketCrashSimulator,{holdings:metrics.holdings,totalValue:metrics.totalValue})))),React.createElement("div",{className:"flex justify-between items-center gap-3 p-6 border-t border-slate-700/30 flex-shrink-0"},React.createElement("div",{className:"text-xs text-slate-500"},React.createElement("i",{className:"fas fa-info-circle mr-1"}),"Portfolio data is stored locally in your browser"),React.createElement("button",{onClick:onClose,className:"px-6 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm transition"},"Close"))));}function HeatmapModal(_ref20){let{onClose,stocks}=_ref20;const[timeframe,setTimeframe]=useState('1D');const sectors=useMemo(()=>{const groups={};stocks.forEach(stock=>{const sector=stock.sector||'Unknown';if(!groups[sector])groups[sector]=[];groups[sector].push(stock);});return Object.entries(groups).map(_ref21=>{let[name,items]=_ref21;const totalMarketCap=items.reduce((sum,s)=>sum+(s.marketCap||0),0);const avgChange=items.reduce((sum,s)=>sum+(s.changePct||0),0)/items.length;items.sort((a,b)=>(b.marketCap||0)-(a.marketCap||0));return{name,items,totalMarketCap,avgChange,weight:items.length};}).sort((a,b)=>b.totalMarketCap-a.totalMarketCap);},[stocks]);return React.createElement("div",{className:"modal-overlay",onClick:onClose},React.createElement("div",{className:"glass-elevated rounded-2xl max-w-7xl w-full mx-auto my-8 animate-slide-up max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"flex items-center justify-between p-6 border-b border-slate-700/30 flex-shrink-0"},React.createElement("div",null,React.createElement("h2",{className:"text-2xl font-bold text-white mb-1"},"\uD83D\uDDFA\uFE0F Sector Rotation Heatmap"),React.createElement("p",{className:"text-sm text-slate-400"},"Visualizing ",stocks.length," stocks across ",sectors.length," sectors")),React.createElement("div",{className:"flex items-center gap-3"},React.createElement("div",{className:"bg-slate-800 rounded-lg p-1 flex text-xs font-semibold"},['1D'].map(t=>React.createElement("button",{key:t,onClick:()=>setTimeframe(t),className:`px-3 py-1.5 rounded-md transition ${timeframe===t?'bg-slate-600 text-white shadow':'text-slate-400 hover:text-slate-200'}`},t))),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white text-2xl leading-none"},"\xD7"))),React.createElement("div",{className:"p-6 overflow-y-auto flex-1 bg-slate-900/50"},React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},sectors.map(sector=>React.createElement("div",{key:sector.name,className:"glass-card flex flex-col overflow-hidden h-[300px]"},React.createElement("div",{className:"p-3 border-b border-slate-700/30 flex justify-between items-center bg-slate-800/40"},React.createElement("span",{className:"font-bold text-sm text-slate-200 truncate",title:sector.name},sector.name),React.createElement("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${sector.avgChange>=0?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},sector.avgChange>0?'+':'',sector.avgChange.toFixed(2),"%")),React.createElement("div",{className:"flex-1 p-2 flex flex-wrap content-start gap-1 overflow-y-auto"},sector.items.map(stock=>{const change=stock.changePct||0;const colorClass=change>=3?'bg-green-500':change>=1?'bg-green-600':change>=0?'bg-green-700':change<=-3?'bg-red-500':change<=-1?'bg-red-600':'bg-red-700';const isLarge=stock.marketCap>sector.totalMarketCap*0.2;return React.createElement("div",{key:stock.symbol,className:`${colorClass} ${isLarge?'w-full h-16':'flex-1 min-w-[60px] h-12'} rounded p-2 flex flex-col justify-center items-center cursor-pointer hover:brightness-110 transition relative group overflow-hidden`,onClick:()=>window.open(`https://financialmodelingprep.com/financial-summary/${stock.symbol}`,'_blank'),title:`${stock.companyName}: ${change.toFixed(2)}%`},React.createElement("span",{className:"font-bold text-white text-xs shadow-black drop-shadow-md"},stock.symbol),React.createElement("span",{className:"text-[10px] text-white/90 font-semibold drop-shadow-md"},change>0?'+':'',change.toFixed(1),"%"));})))))),React.createElement("div",{className:"p-4 border-t border-slate-700/30 bg-slate-800/30 flex justify-center gap-6 text-xs"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-4 h-4 bg-red-600 rounded"}),React.createElement("span",{className:"text-slate-400"},"-1% to -3%")),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-4 h-4 bg-red-500 rounded"}),React.createElement("span",{className:"text-slate-400"},"< -3%")),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-4 h-4 bg-green-700 rounded"}),React.createElement("span",{className:"text-slate-400"},"0% to +1%")),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-4 h-4 bg-green-600 rounded"}),React.createElement("span",{className:"text-slate-400"},"+1% to +3%")),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-4 h-4 bg-green-500 rounded"}),React.createElement("span",{className:"text-slate-400"},"> +3%")))));}function PortfolioAllocationModal(_ref22){let{onClose,stocks,watchlist}=_ref22;const portfolioData=computePortfolioAllocation(stocks,watchlist);return React.createElement("div",{className:"modal-overlay",onClick:onClose},React.createElement("div",{className:"glass-elevated rounded-2xl max-w-4xl w-full mx-auto my-8 animate-slide-up max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"flex items-center justify-between p-6 border-b border-slate-700/30 flex-shrink-0"},React.createElement("div",null,React.createElement("h2",{className:"text-2xl font-bold text-white mb-1"},"Portfolio Allocation"),React.createElement("p",{className:"text-sm text-slate-400"},portfolioData.isEmpty?'Add stocks to your watchlist to see allocation breakdown':`${portfolioData.totalStocks} stocks across ${portfolioData.sectorCount} sectors`)),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white text-2xl leading-none"},"\xD7")),React.createElement("div",{className:"p-6 overflow-y-auto flex-1"},portfolioData.isEmpty?React.createElement("div",{className:"text-center py-12"},React.createElement("div",{className:"text-6xl mb-4"},"\uD83D\uDCCA"),React.createElement("h3",{className:"text-xl font-bold text-white mb-2"},"No Stocks in Watchlist"),React.createElement("p",{className:"text-slate-400 mb-6"},"Add stocks to your watchlist to see your portfolio allocation breakdown by sector."),React.createElement("button",{onClick:onClose,className:"px-6 py-3 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-semibold transition"},"Browse Stocks")):React.createElement("div",{className:"space-y-6"},React.createElement("div",null,React.createElement("h3",{className:"text-sm font-bold text-slate-400 mb-4 uppercase tracking-wide"},"Sector Allocation"),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Object.entries(portfolioData.sectorWeights).sort((a,b)=>b[1]-a[1]).map(_ref23=>{let[sector,weight]=_ref23;return React.createElement("div",{key:sector,className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"flex items-center justify-between mb-2"},React.createElement("span",{className:"font-semibold text-white"},sector),React.createElement("span",{className:"text-cyan-400 font-mono font-bold"},weight.toFixed(1),"%")),React.createElement("div",{className:"w-full bg-slate-700/50 rounded-full h-3 overflow-hidden"},React.createElement("div",{className:`h-full rounded-full bg-gradient-to-r ${getSectorColor(sector)} transition-all duration-500`,style:{width:`${weight}%`}})),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},portfolioData.stocks.filter(s=>s.sector===sector).length," stock",portfolioData.stocks.filter(s=>s.sector===sector).length!==1?'s':''));}))),React.createElement("div",{className:"glass-card p-5 rounded-xl"},React.createElement("h3",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Diversification Analysis"),React.createElement("div",{className:"grid grid-cols-3 gap-4"},React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Total Stocks"),React.createElement("div",{className:"text-2xl font-bold text-white"},portfolioData.totalStocks)),React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Sectors"),React.createElement("div",{className:"text-2xl font-bold text-white"},portfolioData.sectorCount)),React.createElement("div",null,React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Avg per Stock"),React.createElement("div",{className:"text-2xl font-bold text-white"},(100/portfolioData.totalStocks).toFixed(1),"%"))),(()=>{const maxWeight=Math.max(...Object.values(portfolioData.sectorWeights));const isConcentrated=maxWeight>50;const isDiversified=portfolioData.sectorCount>=3&&maxWeight<40;return React.createElement("div",{className:`mt-4 p-3 rounded-lg ${isConcentrated?'bg-yellow-500/10 border border-yellow-500/20':isDiversified?'bg-green-500/10 border border-green-500/20':'bg-slate-700/30 border border-slate-600/30'}`},React.createElement("div",{className:"flex items-start gap-2"},React.createElement("span",{className:"text-lg"},isConcentrated?'‚ö†Ô∏è':isDiversified?'‚úÖ':'‚ÑπÔ∏è'),React.createElement("div",{className:"flex-1"},React.createElement("div",{className:`text-xs font-bold uppercase mb-1 ${isConcentrated?'text-yellow-400':isDiversified?'text-green-400':'text-slate-400'}`},isConcentrated?'Concentration Risk':isDiversified?'Well Diversified':'Moderate Diversification'),React.createElement("div",{className:"text-xs text-slate-300 leading-relaxed"},isConcentrated?`Over ${maxWeight.toFixed(0)}% allocated to one sector. Consider diversifying to reduce risk.`:isDiversified?`Good sector diversification with no single sector exceeding ${maxWeight.toFixed(0)}%.`:`Consider adding stocks from other sectors to improve diversification.`))));})()),React.createElement("div",null,React.createElement("h3",{className:"text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide"},"Holdings Breakdown"),React.createElement("div",{className:"glass-card rounded-xl overflow-hidden"},React.createElement("table",{className:"w-full text-sm"},React.createElement("thead",null,React.createElement("tr",{className:"bg-slate-800/50 text-slate-400 text-xs"},React.createElement("th",{className:"text-left p-3"},"Symbol"),React.createElement("th",{className:"text-left p-3"},"Name"),React.createElement("th",{className:"text-left p-3"},"Sector"),React.createElement("th",{className:"text-right p-3"},"Weight"),React.createElement("th",{className:"text-right p-3"},"Price"),React.createElement("th",{className:"text-center p-3"},"AI Score"))),React.createElement("tbody",null,portfolioData.stocks.sort((a,b)=>b.weight-a.weight).map(stock=>React.createElement("tr",{key:stock.symbol,className:"border-t border-slate-700/20 hover:bg-slate-700/20 transition"},React.createElement("td",{className:"p-3 font-semibold text-cyan-300"},stock.symbol),React.createElement("td",{className:"p-3 text-slate-300"},stock.name),React.createElement("td",{className:"p-3"},React.createElement("span",{className:"chip bg-slate-700/50 text-slate-300 text-xs"},stock.sector)),React.createElement("td",{className:"p-3 text-right font-mono text-white font-semibold"},stock.weight.toFixed(1),"%"),React.createElement("td",{className:"p-3 text-right font-mono text-white"},"$",stock.price?.toFixed(2)||'‚Äî'),React.createElement("td",{className:"p-3 text-center"},React.createElement("span",{className:`chip ${stock.aiScore>=80?'bg-green-500/20 text-green-400':stock.aiScore>=65?'bg-cyan-500/20 text-cyan-400':stock.aiScore>=45?'bg-yellow-500/20 text-yellow-400':'bg-red-500/20 text-red-400'}`},stock.aiScore||'‚Äî')))))))))),React.createElement("div",{className:"p-6 border-t border-slate-700/30 flex justify-between items-center flex-shrink-0"},React.createElement("div",{className:"text-xs text-slate-500"},"Equal-weight allocation assumed. Actual portfolio allocation may vary."),React.createElement("button",{onClick:onClose,className:"px-6 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold transition"},"Close"))));}function AlertsModal(_ref24){let{onClose,alerts,setAlerts,stocks}=_ref24;const[newAlert,setNewAlert]=useState({symbol:'',condition:'price_above',value:'',frequency:'once',email:''});const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const conditionOptions=[{value:'price_above',label:'Price Above'},{value:'price_below',label:'Price Below'},{value:'price_change_up',label:'Price Up %'},{value:'price_change_down',label:'Price Down %'},{value:'rsi_above',label:'RSI Above'},{value:'rsi_below',label:'RSI Below'},{value:'pe_above',label:'P/E Above'},{value:'pe_below',label:'P/E Below'}];const frequencyOptions=[{value:'once',label:'Once'},{value:'daily',label:'Daily'},{value:'weekly',label:'Weekly'}];const addAlert=()=>{const{symbol,condition,value,frequency,email}=newAlert;if(!symbol||!value){setError('Please fill all required fields');return;}const symbolUpper=symbol.toUpperCase();const valueNum=parseFloat(value);if(isNaN(valueNum)){setError('Value must be a number');return;}if(email&&!/\S+@\S+\.\S+/.test(email)){setError('Please enter a valid email address');return;}const alertObj={id:Date.now().toString(),symbol:symbolUpper,condition,value:valueNum,frequency,email:email||null,created:new Date().toISOString(),lastTriggered:null,active:true};const updated=[...alerts,alertObj];setAlerts(updated);localStorage.setItem('alerts',JSON.stringify(updated));setNewAlert({symbol:'',condition:'price_above',value:'',frequency:'once',email:''});setError(null);};const toggleAlert=id=>{const updated=alerts.map(alert=>alert.id===id?{...alert,active:!alert.active}:alert);setAlerts(updated);localStorage.setItem('alerts',JSON.stringify(updated));};const removeAlert=id=>{const updated=alerts.filter(alert=>alert.id!==id);setAlerts(updated);localStorage.setItem('alerts',JSON.stringify(updated));};const testAlert=alert=>{const stock=stocks.find(s=>s.symbol===alert.symbol);if(!stock){alert(`Stock ${alert.symbol} not found in current data`);return;}let triggered=false;let message='';switch(alert.condition){case'price_above':triggered=stock.price>alert.value;message=`${alert.symbol} price $${stock.price.toFixed(2)} is ${triggered?'above':'below'} $${alert.value}`;break;case'price_below':triggered=stock.price<alert.value;message=`${alert.symbol} price $${stock.price.toFixed(2)} is ${triggered?'below':'above'} $${alert.value}`;break;case'price_change_up':triggered=stock.changePct>alert.value;message=`${alert.symbol} change ${stock.changePct.toFixed(2)}% is ${triggered?'above':'below'} ${alert.value}%`;break;case'price_change_down':triggered=stock.changePct<-alert.value;message=`${alert.symbol} change ${stock.changePct.toFixed(2)}% is ${triggered?'below':'above'} -${alert.value}%`;break;case'rsi_above':triggered=stock.rsi>alert.value;message=`${alert.symbol} RSI ${stock.rsi?.toFixed(0)||'N/A'} is ${triggered?'above':'below'} ${alert.value}`;break;case'rsi_below':triggered=stock.rsi<alert.value;message=`${alert.symbol} RSI ${stock.rsi?.toFixed(0)||'N/A'} is ${triggered?'below':'above'} ${alert.value}`;break;case'pe_above':triggered=stock.pe>alert.value;message=`${alert.symbol} P/E ${stock.pe?.toFixed(1)||'N/A'} is ${triggered?'above':'below'} ${alert.value}`;break;case'pe_below':triggered=stock.pe<alert.value;message=`${alert.symbol} P/E ${stock.pe?.toFixed(1)||'N/A'} is ${triggered?'below':'above'} ${alert.value}`;break;}if(triggered){alert(`‚úÖ Alert would trigger: ${message}`);}else{alert(`‚ùå Alert would not trigger: ${message}`);}};const exportAlertsCSV=()=>{const data=alerts.map(a=>({Symbol:a.symbol,Condition:conditionOptions.find(c=>c.value===a.condition)?.label||a.condition,Value:a.value,Frequency:frequencyOptions.find(f=>f.value===a.frequency)?.label||a.frequency,Email:a.email||'No email',Active:a.active?'Yes':'No',Created:new Date(a.created).toLocaleDateString(),'Last Triggered':a.lastTriggered?new Date(a.lastTriggered).toLocaleDateString():'Never'}));exportToCSV(data,'alerts.csv');};return React.createElement("div",{className:"modal-overlay",onClick:onClose},React.createElement("div",{className:"glass-elevated rounded-2xl max-w-4xl w-full mx-auto my-8 animate-slide-up max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"flex items-start justify-between p-6 border-b border-slate-700/30 flex-shrink-0"},React.createElement("div",null,React.createElement("h2",{className:"text-3xl font-bold text-white"},"Alerts & Notifications"),React.createElement("div",{className:"text-sm text-slate-400 mt-2"},"Set up price and metric alerts")),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white text-2xl leading-none"},"\xD7")),React.createElement("div",{className:"p-6 border-b border-slate-700/30"},React.createElement("h3",{className:"text-lg font-bold text-white mb-4"},"Create New Alert"),error&&React.createElement("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg"},React.createElement("div",{className:"text-red-400 text-sm"},error)),React.createElement("div",{className:"grid grid-cols-5 gap-4"},React.createElement("div",null,React.createElement("label",{className:"text-xs text-slate-500 mb-1 block"},"Symbol"),React.createElement("input",{type:"text",id:"alert-symbol",name:"alert-symbol",value:newAlert.symbol,onChange:e=>setNewAlert({...newAlert,symbol:e.target.value}),className:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-white focus:outline-none focus:border-cyan-500",placeholder:"AAPL"})),React.createElement("div",null,React.createElement("label",{className:"text-xs text-slate-500 mb-1 block"},"Condition"),React.createElement("select",{value:newAlert.condition,onChange:e=>setNewAlert({...newAlert,condition:e.target.value}),className:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-white focus:outline-none focus:border-cyan-500"},conditionOptions.map(opt=>React.createElement("option",{key:opt.value,value:opt.value},opt.label)))),React.createElement("div",null,React.createElement("label",{className:"text-xs text-slate-500 mb-1 block"},"Value"),React.createElement("input",{type:"number",id:"alert-value",name:"alert-value",value:newAlert.value,onChange:e=>setNewAlert({...newAlert,value:e.target.value}),className:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-white focus:outline-none focus:border-cyan-500",placeholder:"100",step:"0.01"})),React.createElement("div",null,React.createElement("label",{className:"text-xs text-slate-500 mb-1 block"},"Frequency"),React.createElement("select",{value:newAlert.frequency,onChange:e=>setNewAlert({...newAlert,frequency:e.target.value}),className:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-white focus:outline-none focus:border-cyan-500"},frequencyOptions.map(opt=>React.createElement("option",{key:opt.value,value:opt.value},opt.label)))),React.createElement("div",null,React.createElement("label",{className:"text-xs text-slate-500 mb-1 block"},"Email (optional)"),React.createElement("input",{type:"email",id:"alert-email",name:"alert-email",value:newAlert.email,onChange:e=>setNewAlert({...newAlert,email:e.target.value}),className:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-white focus:outline-none focus:border-cyan-500",placeholder:"you@example.com"}))),React.createElement("div",{className:"mt-4"},React.createElement("button",{onClick:addAlert,className:"px-6 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-semibold"},"Add Alert"))),React.createElement("div",{className:"p-6 overflow-y-auto flex-1"},React.createElement("div",{className:"flex justify-between items-center mb-4"},React.createElement("h3",{className:"text-lg font-bold text-white"},"Active Alerts (",alerts.filter(a=>a.active).length,")"),React.createElement("button",{onClick:exportAlertsCSV,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-file-export"}),"Export CSV")),alerts.length===0?React.createElement("div",{className:"text-center py-12 text-slate-400"},React.createElement("i",{className:"fas fa-bell-slash text-4xl mb-4"}),React.createElement("div",null,"No alerts set up yet"),React.createElement("div",{className:"text-sm mt-2"},"Create your first alert above")):React.createElement("div",{className:"space-y-3"},alerts.map((alert,index)=>React.createElement("div",{key:alert.id,className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"flex items-center gap-4"},React.createElement("div",{className:`w-3 h-3 rounded-full ${alert.active?'bg-green-500':'bg-slate-600'}`}),React.createElement("div",null,React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:"font-semibold text-cyan-300"},alert.symbol),React.createElement("span",{className:"text-xs text-slate-500"},conditionOptions.find(c=>c.value===alert.condition)?.label||alert.condition,": ",alert.value)),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},frequencyOptions.find(f=>f.value===alert.frequency)?.label||alert.frequency," \u2022",alert.email?` Email: ${alert.email}`:' Browser notification only'," \u2022 Created: ",new Date(alert.created).toLocaleDateString()))),React.createElement("div",{className:"flex gap-2"},React.createElement("button",{onClick:()=>testAlert(alert),className:"px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded text-xs",title:"Test alert with current data"},"Test"),React.createElement("button",{onClick:()=>toggleAlert(alert.id),className:`px-3 py-1 rounded text-xs ${alert.active?'bg-yellow-600 hover:bg-yellow-500':'bg-green-600 hover:bg-green-500'} text-white`},alert.active?'Disable':'Enable'),React.createElement("button",{onClick:()=>removeAlert(alert.id),className:"px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded text-xs"},"Remove"))))))),React.createElement("div",{className:"flex justify-between items-center p-6 border-t border-slate-700/30 flex-shrink-0"},React.createElement("div",{className:"text-xs text-slate-500"},"Note: Email alerts require a backend service. Browser alerts will work immediately."),React.createElement("div",{className:"flex gap-3"},React.createElement("button",{onClick:onClose,className:"px-6 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm"},"Close")))));}function ComparativeAnalysisModal(_ref25){let{onClose,stocks,selectedSymbols}=_ref25;const[selectedStocks,setSelectedStocks]=useState(selectedSymbols||[]);const[comparisonData,setComparisonData]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);useEffect(()=>{if(selectedStocks.length>0){loadComparisonData();}},[selectedStocks]);const loadComparisonData=()=>{setLoading(true);setError(null);try{const data=selectedStocks.map(symbol=>{const stock=stocks.find(s=>s.symbol===symbol);if(!stock)return null;return{symbol:stock.symbol,companyName:stock.companyName,sector:stock.sector,price:stock.price,changePct:stock.changePct,marketCap:stock.marketCap,pe:stock.pe,roe:stock.roe,revenueGrowth:stock.revenueGrowth,grossMargin:stock.grossMargin,rsi:stock.rsi,aiScore:stock.aiScore,verdict:stock.verdict,confidence:stock.confidence};}).filter(Boolean);setComparisonData(data);}catch(err){setError(err.message);}finally{setLoading(false);}};const addStockToComparison=symbol=>{if(!selectedStocks.includes(symbol)&&selectedStocks.length<5){setSelectedStocks([...selectedStocks,symbol]);}};const removeStockFromComparison=symbol=>{setSelectedStocks(selectedStocks.filter(s=>s!==symbol));};const exportComparisonCSV=()=>{const data=comparisonData.map(stock=>({Symbol:stock.symbol,Company:stock.companyName,Sector:stock.sector,Price:stock.price,'Change %':stock.changePct,'Market Cap':stock.marketCap,'P/E Ratio':stock.pe,'ROE %':stock.roe,'Revenue Growth %':stock.revenueGrowth,'Gross Margin %':stock.grossMargin,RSI:stock.rsi,'AI Score':stock.aiScore,Verdict:stock.verdict,'Confidence %':stock.confidence}));exportToCSV(data,'comparison.csv');};const getBestValue=function(metric){let higherIsBetter=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(comparisonData.length===0)return null;return comparisonData.reduce((best,current)=>{const currentVal=current[metric];const bestVal=best[metric];if(currentVal==null||isNaN(currentVal))return best;if(bestVal==null||isNaN(bestVal))return current;return higherIsBetter?currentVal>bestVal?current:best:currentVal<bestVal?current:best;});};return React.createElement("div",{className:"modal-overlay",onClick:onClose},React.createElement("div",{id:"stock-modal-content",className:"glass-elevated rounded-2xl max-w-6xl w-full mx-auto my-8 animate-slide-up max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"flex items-start justify-between p-6 border-b border-slate-700/30 flex-shrink-0"},React.createElement("div",null,React.createElement("h2",{className:"text-3xl font-bold text-white"},"Comparative Analysis"),React.createElement("div",{className:"text-sm text-slate-400 mt-2"},"Compare up to 5 stocks side by side")),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white text-2xl leading-none"},"\xD7")),React.createElement("div",{className:"p-6 border-b border-slate-700/30"},React.createElement("div",{className:"flex justify-between items-center mb-4"},React.createElement("h3",{className:"text-lg font-bold text-white"},"Select Stocks to Compare"),React.createElement("div",{className:"text-sm text-slate-400"},selectedStocks.length,"/5 stocks selected")),React.createElement("div",{className:"flex flex-wrap gap-2 mb-4"},selectedStocks.map(symbol=>React.createElement("div",{key:symbol,className:"flex items-center gap-2 px-3 py-2 bg-cyan-600/20 border border-cyan-500/30 rounded-lg"},React.createElement("span",{className:"text-cyan-300 font-semibold"},symbol),React.createElement("button",{onClick:()=>removeStockFromComparison(symbol),className:"text-cyan-400 hover:text-cyan-300 text-sm"},"\u2715")))),React.createElement("div",{className:"grid grid-cols-5 gap-2"},stocks.filter(stock=>!selectedStocks.includes(stock.symbol)).slice(0,15).map(stock=>React.createElement("button",{key:stock.symbol,onClick:()=>addStockToComparison(stock.symbol),disabled:selectedStocks.length>=5,className:`px-3 py-2 rounded-lg text-sm font-semibold transition ${selectedStocks.length>=5?'bg-slate-800/50 text-slate-500 cursor-not-allowed':'bg-slate-700 hover:bg-slate-600 text-white'}`},stock.symbol)))),React.createElement("div",{className:"p-6 overflow-y-auto flex-1"},loading?React.createElement("div",{className:"text-center py-12"},React.createElement("i",{className:"fas fa-spinner animate-spin text-4xl text-cyan-400 mb-4"}),React.createElement("div",{className:"text-slate-400"},"Loading comparison data...")):error?React.createElement("div",{className:"text-center py-12"},React.createElement("div",{className:"text-red-400 mb-4"},"Error: ",error),React.createElement("button",{onClick:loadComparisonData,className:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg"},"Retry")):comparisonData.length===0?React.createElement("div",{className:"text-center py-12 text-slate-400"},React.createElement("i",{className:"fas fa-balance-scale text-4xl mb-4"}),React.createElement("div",null,"Select stocks to compare from the list above")):React.createElement(React.Fragment,null,React.createElement("div",{className:"mb-6"},React.createElement("h3",{className:"text-lg font-bold text-white mb-4"},"Best Values"),React.createElement("div",{className:"grid grid-cols-4 gap-4"},React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Best Value (P/E)"),React.createElement("div",{className:"text-lg font-bold text-cyan-300"},getBestValue('pe',false)?.symbol||'‚Äî'),React.createElement("div",{className:"text-sm text-slate-400"},getBestValue('pe',false)?.pe?.toFixed(1)||'‚Äî'," P/E")),React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Best Quality (ROE)"),React.createElement("div",{className:"text-lg font-bold text-cyan-300"},getBestValue('roe',true)?.symbol||'‚Äî'),React.createElement("div",{className:"text-sm text-slate-400"},getBestValue('roe',true)?.roe?.toFixed(1)||'‚Äî',"%")),React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Best Growth"),React.createElement("div",{className:"text-lg font-bold text-cyan-300"},getBestValue('revenueGrowth',true)?.symbol||'‚Äî'),React.createElement("div",{className:"text-sm text-slate-400"},getBestValue('revenueGrowth',true)?.revenueGrowth?.toFixed(1)||'‚Äî',"%")),React.createElement("div",{className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Best AI Score"),React.createElement("div",{className:"text-lg font-bold text-cyan-300"},getBestValue('aiScore',true)?.symbol||'‚Äî'),React.createElement("div",{className:"text-sm text-slate-400"},getBestValue('aiScore',true)?.aiScore||'‚Äî',"/100")))),React.createElement("div",{className:"glass rounded-xl overflow-hidden"},React.createElement("div",{className:"overflow-x-auto"},React.createElement("table",{className:"w-full text-sm"},React.createElement("thead",null,React.createElement("tr",{className:"bg-slate-800/50 text-slate-400"},React.createElement("th",{className:"text-left p-4"},"Metric"),comparisonData.map(stock=>React.createElement("th",{key:stock.symbol,className:"text-center p-4"},React.createElement("div",{className:"font-semibold text-cyan-300"},stock.symbol),React.createElement("div",{className:"text-xs text-slate-500"},stock.companyName))))),React.createElement("tbody",null,[{label:'Price',key:'price',format:v=>`$${v?.toFixed(2)||'‚Äî'}`},{label:'Change %',key:'changePct',format:v=>formatPercent(v)},{label:'Market Cap',key:'marketCap',format:v=>formatNumber(v)},{label:'P/E Ratio',key:'pe',format:v=>v?.toFixed(1)||'‚Äî'},{label:'ROE %',key:'roe',format:v=>v?.toFixed(1)+'%'||'‚Äî'},{label:'Revenue Growth %',key:'revenueGrowth',format:v=>v?.toFixed(1)+'%'||'‚Äî'},{label:'Gross Margin %',key:'grossMargin',format:v=>v?.toFixed(1)+'%'||'‚Äî'},{label:'RSI',key:'rsi',format:v=>v?.toFixed(0)||'‚Äî'},{label:'AI Score',key:'aiScore',format:v=>v?.toFixed(0)+'/100'||'‚Äî'},{label:'Verdict',key:'verdict',format:v=>v||'‚Äî'},{label:'Confidence %',key:'confidence',format:v=>v?.toFixed(0)+'%'||'‚Äî'}].map((row,rowIndex)=>React.createElement("tr",{key:row.key,className:"border-t border-slate-700/20"},React.createElement("td",{className:"p-4 text-slate-400 font-medium"},row.label),comparisonData.map((stock,colIndex)=>{const value=stock[row.key];let cellClass='text-center p-4 font-mono';if(row.key==='changePct'){cellClass+=` ${getSentimentColor(value)}`;}else if(row.key==='rsi'){if(value<30)cellClass+=' text-green-400';else if(value>70)cellClass+=' text-red-400';else cellClass+=' text-white';}else if(row.key==='aiScore'){if(value>=70)cellClass+=' text-green-400';else if(value>=55)cellClass+=' text-yellow-400';else cellClass+=' text-red-400';}else{cellClass+=' text-white';}return React.createElement("td",{key:`${row.key}-${colIndex}`,className:cellClass},row.format(value));}))))))),React.createElement("div",{className:"mt-6"},React.createElement("h3",{className:"text-lg font-bold text-white mb-4"},"Sector Distribution"),React.createElement("div",{className:"grid grid-cols-3 gap-4"},Array.from(new Set(comparisonData.map(s=>s.sector))).map(sector=>{const sectorStocks=comparisonData.filter(s=>s.sector===sector);const avgPE=sectorStocks.reduce((sum,s)=>sum+(s.pe||0),0)/sectorStocks.length;const avgROE=sectorStocks.reduce((sum,s)=>sum+(s.roe||0),0)/sectorStocks.length;return React.createElement("div",{key:sector,className:"glass-card p-4 rounded-xl"},React.createElement("div",{className:"text-sm font-semibold text-white mb-2"},sector),React.createElement("div",{className:"text-xs text-slate-500 mb-1"},"Stocks: ",sectorStocks.length),React.createElement("div",{className:"text-xs text-slate-400"},"Avg P/E: ",avgPE.toFixed(1)),React.createElement("div",{className:"text-xs text-slate-400"},"Avg ROE: ",avgROE.toFixed(1),"%"));}))))),React.createElement("div",{className:"flex justify-between items-center p-6 border-t border-slate-700/30 flex-shrink-0"},React.createElement("div",{className:"text-sm text-slate-400"},comparisonData.length," stocks compared"),React.createElement("div",{className:"flex gap-3"},React.createElement("button",{onClick:exportComparisonCSV,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-file-export"}),"Export CSV"),React.createElement("button",{onClick:onClose,className:"px-6 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm"},"Close")))));}class AlertManager{constructor(){this.alerts=this.loadAlerts();this.subscribers=[];}loadAlerts(){try{const stored=localStorage.getItem('re_alerts');return stored?JSON.parse(stored):[];}catch(e){return[];}}saveAlerts(){try{localStorage.setItem('re_alerts',JSON.stringify(this.alerts));}catch(e){console.error('Failed to save alerts:',e);}}addAlert(alert){const newAlert={id:Date.now().toString(),timestamp:new Date().toISOString(),read:false,...alert};this.alerts.unshift(newAlert);if(this.alerts.length>100){this.alerts=this.alerts.slice(0,100);}this.saveAlerts();return newAlert;}removeAlert(id){this.alerts=this.alerts.filter(a=>a.id!==id);this.saveAlerts();}markAsRead(alertId){const alert=this.alerts.find(a=>a.id===alertId);if(alert){alert.read=true;this.saveAlerts();}}markAllAsRead(){this.alerts.forEach(a=>a.read=true);this.saveAlerts();}getUnreadCount(){return this.alerts.filter(a=>!a.read).length;}subscribe(callback){this.subscribers.push(callback);return()=>{this.subscribers=this.subscribers.filter(cb=>cb!==callback);};}notifySubscribers(){this.subscribers.forEach(cb=>cb(this.alerts));}}if(!window.alertManager){window.alertManager=new AlertManager();}const checkPortfolioAlerts=function(portfolio){let prevPrices=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!portfolio||portfolio.length===0)return;portfolio.forEach(position=>{const currentPrice=position.currentPrice;const prevPrice=prevPrices[position.symbol];if(prevPrice&&currentPrice){const changePercent=(currentPrice-prevPrice)/prevPrice*100;if(Math.abs(changePercent)>=5){window.alertManager.addAlert({type:'price',symbol:position.symbol,title:`${position.symbol} ${changePercent>0?'Up':'Down'} ${Math.abs(changePercent).toFixed(1)}%`,message:`Price moved from $${prevPrice.toFixed(2)} to $${currentPrice.toFixed(2)}`,priority:Math.abs(changePercent)>=10?'high':'medium',data:{price:currentPrice,change:changePercent}});}const costBasis=position.costBasis||position.currentPrice;const gainPercent=(currentPrice-costBasis)/costBasis*100;if(gainPercent>=20&&!prevPrices[`alerted_gain_${position.symbol}`]){window.alertManager.addAlert({type:'profit',symbol:position.symbol,title:`${position.symbol} Up 20%+ from Cost Basis`,message:`Consider taking profits. Current gain: ${gainPercent.toFixed(1)}%`,priority:'medium',data:{gain:gainPercent}});prevPrices[`alerted_gain_${position.symbol}`]=true;}if(gainPercent<=-15&&!prevPrices[`alerted_loss_${position.symbol}`]){window.alertManager.addAlert({type:'loss',symbol:position.symbol,title:`${position.symbol} Down 15%+ from Cost Basis`,message:`Consider tax-loss harvesting or reassessing position. Current loss: ${Math.abs(gainPercent).toFixed(1)}%`,priority:'high',data:{loss:Math.abs(gainPercent)}});prevPrices[`alerted_loss_${position.symbol}`]=true;}}});};async function getPriceOnDate(symbol,date){try{const response=await fetch(`https://financialmodelingprep.com/api/v3/historical-price-full/${symbol}?from=${date}&to=${date}&apikey=${FMP_API_KEY}`);const data=await response.json();return data?.historical?.[0]?.close||null;}catch(error){console.error('Error fetching historical price:',error);return null;}}async function getHistoricalDataForDCA(symbol){let months=arguments.length>1&&arguments[1]!==undefined?arguments[1]:12;try{const endDate=new Date();const startDate=new Date();startDate.setMonth(startDate.getMonth()-months);const response=await fetch(`https://financialmodelingprep.com/api/v3/historical-price-full/${symbol}?from=${startDate.toISOString().split('T')[0]}&to=${endDate.toISOString().split('T')[0]}&apikey=${FMP_API_KEY}`);const data=await response.json();return data?.historical||[];}catch(error){console.error('Error fetching historical data:',error);return[];}}function calculateSavingsRate(income,expenses){let investments=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;const savings=income-expenses;const totalSavings=savings+investments;return totalSavings/income*100;}function calculateFIProgress(currentAssets,annualExpenses){const fiTarget=annualExpenses*25;const progress=currentAssets/fiTarget*100;const yearsToFI=currentAssets>0?Math.log(fiTarget/currentAssets)/Math.log(1.07):Infinity;return{progress:Math.min(100,Math.max(0,progress)),yearsToFI:Math.max(0,yearsToFI),fiTarget,monthlySavingsNeeded:yearsToFI<Infinity?(fiTarget-currentAssets)/(yearsToFI*12):0};}class FilterManager{constructor(){this.STORAGE_KEY='retailedge_filters';}saveFilters(filters){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(filters));}catch(e){console.warn('Failed to save filters:',e);}}loadFilters(){try{const saved=localStorage.getItem(this.STORAGE_KEY);return saved?JSON.parse(saved):null;}catch(e){console.warn('Failed to load filters:',e);return null;}}clearFilters(){localStorage.removeItem(this.STORAGE_KEY);}}const ExportManager={exportToCSV(stocks){let filename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'stocks.csv';const headers=['Symbol','Name','Price','Change%','P/E','ROE%','Market Cap','Sector'];const csvRows=[headers.join(','),...stocks.map(stock=>[stock.symbol,`"${stock.companyName?.replace(/"/g,'""')||stock.name||''}"`,stock.price||stock.currentPrice||0,stock.changePct||0,stock.pe||0,stock.roe||0,stock.marketCap||0,stock.sector||''].join(','))];const csv=csvRows.join('\\n');const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;a.click();URL.revokeObjectURL(url);},exportToJSON(stocks){let filename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'stocks.json';const data={exportDate:new Date().toISOString(),count:stocks.length,stocks:stocks};const json=JSON.stringify(data,null,2);const blob=new Blob([json],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;a.click();URL.revokeObjectURL(url);}};function cleanSymbol(symbol){if(!symbol||typeof symbol!=='string')return symbol;return symbol.toUpperCase().replace(/\.(O|K|US|NS|PK|F|DE|TO|L|HK|T|SS|SZ|AX|NZ|MI|PA|AS|BR|MC|SW|CO|ST|HE|OL|LS|IC|V|WA|PR|MX|BA|SA|SN|CA|CN|JK|BK|KL|TW|KS|KQ|BO|NE)$/i,'').trim();}class WatchlistManager{constructor(){this.STORAGE_KEY='retailedge_watchlist_groups';this.groups=this.loadGroups();}loadGroups(){try{const saved=localStorage.getItem(this.STORAGE_KEY);return saved?JSON.parse(saved):{'My Watchlist':[],'Tech Stocks':[],'Dividend Stocks':[],'Growth Stocks':[]};}catch(e){console.warn('Failed to load watchlist groups:',e);return{};}}saveGroups(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.groups));}catch(e){console.warn('Failed to save watchlist groups:',e);}}addGroup(name){let symbols=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];this.groups[name]=symbols;this.saveGroups();}removeGroup(name){delete this.groups[name];this.saveGroups();}addToGroup(groupName,symbol){if(!this.groups[groupName]){this.groups[groupName]=[];}if(!this.groups[groupName].includes(symbol)){this.groups[groupName].push(symbol);this.saveGroups();}}removeFromGroup(groupName,symbol){if(this.groups[groupName]){this.groups[groupName]=this.groups[groupName].filter(s=>s!==symbol);this.saveGroups();}}getGroupsForSymbol(symbol){return Object.entries(this.groups).filter(_ref26=>{let[_,symbols]=_ref26;return symbols.includes(symbol);}).map(_ref27=>{let[name]=_ref27;return name;});}getAllGroups(){return this.groups;}importFromText(text){let groupName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'Imported Watchlist';try{const headerWords=new Set(['SYMBOL','NAME','LAST','OPEN','HIGH','LOW','CHG','VOL','VOLUME','TIME','DATE','CLOSE','CHANGE','PRICE','CHANGE%','CHG.','VOL.','BUY','SELL','HOLD','RSI','MACD','EPS','REVENUE','DAILY','HOURLY','YTD','BETA','NEUTRAL','INC.','MONGODB','REVENUE','EARNINGS','PE','MARKET','CAP','SECTOR','INDUSTRY','DIVIDEND','YIELD']);const symbols=text.replace(/[,;\s\n\r\t]+/g,',').split(',').map(s=>cleanSymbol(s.trim())).filter(s=>s&&s.length>0&&s.length<=10&&/^[A-Z]+$/.test(s)&&!headerWords.has(s));if(symbols.length===0){throw new Error('No valid symbols found');}this.addGroup(groupName,symbols);return{success:true,count:symbols.length,symbols};}catch(error){return{success:false,error:error.message};}}async importFromCSV(file){let groupName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'CSV Import';try{const text=await file.text();const lines=text.split('\n').filter(l=>l.trim());const symbols=[];const headerWords=new Set(['SYMBOL','NAME','LAST','OPEN','HIGH','LOW','CHG','VOL','VOLUME','TIME','DATE','CLOSE','CHANGE','PRICE','CHANGE%','CHG.','VOL.','BUY','SELL','HOLD','RSI','MACD','EPS','REVENUE','DAILY','HOURLY','YTD','BETA','NEUTRAL','INC.','MONGODB','REVENUE','EARNINGS','PE','MARKET','CAP','SECTOR','INDUSTRY','DIVIDEND','YIELD']);let startIndex=0;if(lines.length>0){const firstLine=lines[0].toUpperCase();const firstParts=firstLine.split(',').map(p=>p.trim().replace(/"/g,''));if(firstParts.some(part=>headerWords.has(part))){startIndex=1;}}for(let i=startIndex;i<lines.length;i++){const line=lines[i];const parts=line.split(',').map(p=>p.trim().replace(/"/g,''));for(const part of parts){const cleaned=cleanSymbol(part);if(cleaned&&cleaned.length>0&&cleaned.length<=10&&/^[A-Z]+$/.test(cleaned)&&!headerWords.has(cleaned)){if(!symbols.includes(cleaned)){symbols.push(cleaned);}}}}if(symbols.length===0){throw new Error('No valid symbols found in CSV');}this.addGroup(groupName,symbols);return{success:true,count:symbols.length,symbols};}catch(error){return{success:false,error:error.message};}}async importFromJSON(file){let groupName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'JSON Import';try{const text=await file.text();const data=JSON.parse(text);let symbols=[];if(Array.isArray(data)){symbols=data.map(item=>typeof item==='string'?item:item.symbol||item.Symbol).filter(s=>s).map(s=>cleanSymbol(s.trim()));}else if(data.symbols&&Array.isArray(data.symbols)){symbols=data.symbols.map(s=>cleanSymbol(s.trim()));}else if(data.watchlist&&Array.isArray(data.watchlist)){symbols=data.watchlist.map(s=>cleanSymbol(s.trim()));}if(symbols.length===0){throw new Error('No valid symbols found in JSON');}this.addGroup(groupName,symbols);return{success:true,count:symbols.length,symbols};}catch(error){return{success:false,error:error.message};}}exportToText(groupName){const symbols=this.groups[groupName]||[];return symbols.join('\n');}exportToCSV(groupName){const symbols=this.groups[groupName]||[];return'Symbol\n'+symbols.join('\n');}exportToJSON(groupName){const symbols=this.groups[groupName]||[];return JSON.stringify({name:groupName,exportDate:new Date().toISOString(),count:symbols.length,symbols:symbols},null,2);}}class DataValidator{static validateStock(stock){const warnings=[];if(!stock.symbol)warnings.push('Missing symbol');if(stock.price<=0)warnings.push('Invalid price');if(Math.abs(stock.changePct)>100)warnings.push('Suspicious price change');if(stock.pe&&stock.pe>1000)warnings.push('Extreme P/E ratio');if(stock.roe&&Math.abs(stock.roe)>1000)warnings.push('Extreme ROE');return{isValid:warnings.length===0,warnings,score:this.calculateDataQualityScore(stock)};}static calculateDataQualityScore(stock){let score=0;const fields=['symbol','price','changePct','marketCap','pe','roe','revenueGrowth','grossMargin','debtToEquity','rsi'];fields.forEach(field=>{if(stock[field]!==undefined&&stock[field]!==null){score+=10;}});return Math.min(100,score);}}class KeyboardShortcuts{constructor(){this.shortcuts=new Map();this.enabled=true;}init(){document.addEventListener('keydown',this.handleKeyDown.bind(this));console.log('‚å®Ô∏è Keyboard shortcuts enabled');}register(shortcut,callback,description){this.shortcuts.set(shortcut,{callback,description});}handleKeyDown(e){if(!this.enabled||e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA'){return;}const key=e.key.toLowerCase();const ctrl=e.ctrlKey||e.metaKey;const shift=e.shiftKey;const alt=e.altKey;let shortcut='';if(ctrl)shortcut+='ctrl+';if(shift)shortcut+='shift+';if(alt)shortcut+='alt+';shortcut+=key;const handler=this.shortcuts.get(shortcut);if(handler){e.preventDefault();handler.callback();}}getHelp(){return Array.from(this.shortcuts.entries()).map(_ref28=>{let[key,{description}]=_ref28;return{key,description};});}}function EnhancedTooltip(_ref29){let{content,children,position='top',width=280,delay=300}=_ref29;const[visible,setVisible]=useState(false);const[coords,setCoords]=useState({x:0,y:0});const timeoutRef=useRef(null);const tooltipRef=useRef(null);const showTooltip=e=>{const rect=e.currentTarget.getBoundingClientRect();setCoords({x:rect.left+rect.width/2,y:rect.top});clearTimeout(timeoutRef.current);timeoutRef.current=setTimeout(()=>setVisible(true),delay);};const hideTooltip=()=>{clearTimeout(timeoutRef.current);setVisible(false);};useEffect(()=>{return()=>clearTimeout(timeoutRef.current);},[]);useEffect(()=>{if(visible&&tooltipRef.current){const tooltip=tooltipRef.current;let left=coords.x-width/2;let top=coords.y-tooltip.offsetHeight-10;if(left<10)left=10;if(left+width>window.innerWidth-10){left=window.innerWidth-width-10;}if(top<10){top=coords.y+30;}tooltip.style.left=`${left}px`;tooltip.style.top=`${top}px`;}},[visible,coords,width]);return React.createElement('div',{className:'relative inline-block',onMouseEnter:showTooltip,onMouseLeave:hideTooltip,onFocus:showTooltip,onBlur:hideTooltip},children,visible&&React.createElement('div',{ref:tooltipRef,className:'fixed z-[9999] glass-card p-3 rounded-lg border border-slate-700 shadow-xl animate-fade-in',style:{width:`${width}px`}},React.createElement('div',{className:'text-xs text-slate-200 leading-relaxed'},content),React.createElement('div',{className:'absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 rotate-45 w-3 h-3 bg-slate-800 border-r border-b border-slate-700'})));}function DataQualityIndicator(_ref30){let{stock}=_ref30;if(!stock||!stock.symbol)return null;const validation=DataValidator.validateStock(stock);const score=validation.score;const getColor=score=>{if(score>=80)return'text-green-400 bg-green-400';if(score>=60)return'text-yellow-400 bg-yellow-400';return'text-red-400 bg-red-400';};const colors=getColor(score);return React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"text-xs text-slate-500"},"Data Quality:"),React.createElement("div",{className:`text-xs font-bold ${colors.split(' ')[0]}`},score,"%"),React.createElement("div",{className:"w-16 bg-slate-700 rounded-full h-1.5 overflow-hidden"},React.createElement("div",{className:`h-full ${colors.split(' ')[1]}`,style:{width:`${score}%`}})));}if(!window.filterManager){window.filterManager=new FilterManager();}if(!window.watchlistManager){window.watchlistManager=new WatchlistManager();}if(!window.keyboardShortcuts){window.keyboardShortcuts=new KeyboardShortcuts();window.keyboardShortcuts.init();}function WatchlistImporter(_ref31){let{onClose,onImportSuccess}=_ref31;const[importMethod,setImportMethod]=useState('text');const[textInput,setTextInput]=useState('');const[groupName,setGroupName]=useState('Imported Watchlist');const[loading,setLoading]=useState(false);const[result,setResult]=useState(null);const fileInputRef=useRef(null);const handleTextImport=async()=>{setLoading(true);setResult(null);const importResult=window.watchlistManager.importFromText(textInput,groupName);setResult(importResult);setLoading(false);if(importResult.success&&onImportSuccess){setTimeout(()=>{onImportSuccess(importResult);onClose();},1500);}};const handleFileImport=async e=>{const file=e.target.files[0];if(!file)return;setLoading(true);setResult(null);let importResult;if(importMethod==='csv'){importResult=await window.watchlistManager.importFromCSV(file,groupName);}else if(importMethod==='json'){importResult=await window.watchlistManager.importFromJSON(file,groupName);}setResult(importResult);setLoading(false);if(importResult.success&&onImportSuccess){setTimeout(()=>{onImportSuccess(importResult);onClose();},1500);}};return React.createElement("div",{className:"modal-overlay",onClick:onClose},React.createElement("div",{className:"glass-elevated rounded-2xl max-w-2xl w-full mx-auto my-8 animate-slide-up",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"flex items-center justify-between p-6 border-b border-slate-700/30"},React.createElement("div",null,React.createElement("h2",{className:"text-2xl font-bold text-white mb-1 flex items-center gap-2"},React.createElement("i",{className:"fas fa-file-import text-cyan-400"}),"Import Watchlist"),React.createElement("p",{className:"text-sm text-slate-400"},"Add stocks from text, CSV, or JSON file")),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white text-2xl leading-none"},"\xD7")),React.createElement("div",{className:"p-6 space-y-6"},React.createElement("div",null,React.createElement("label",{className:"text-sm text-slate-400 mb-2 block"},"Import Method"),React.createElement("div",{className:"flex gap-2"},[{id:'text',label:'Paste Text',icon:'fa-keyboard'},{id:'csv',label:'CSV File',icon:'fa-file-csv'},{id:'json',label:'JSON File',icon:'fa-file-code'}].map(method=>React.createElement("button",{key:method.id,onClick:()=>setImportMethod(method.id),className:`flex-1 py-3 px-4 rounded-lg font-semibold text-sm transition flex items-center justify-center gap-2 ${importMethod===method.id?'bg-cyan-500/20 border-2 border-cyan-500/50 text-cyan-300':'bg-slate-800/50 border-2 border-slate-700/50 text-slate-400 hover:bg-slate-700/50'}`},React.createElement("i",{className:`fas ${method.icon}`}),method.label)))),React.createElement("div",null,React.createElement("label",{className:"text-sm text-slate-400 mb-2 block"},"Watchlist Group Name"),React.createElement("input",{type:"text",value:groupName,onChange:e=>setGroupName(e.target.value),className:"w-full px-4 py-2.5 bg-slate-900/50 border border-slate-700/50 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50",placeholder:"Enter group name..."})),importMethod==='text'&&React.createElement("div",null,React.createElement("label",{className:"text-sm text-slate-400 mb-2 block"},"Paste Stock Symbols (comma, space, or newline separated)"),React.createElement("textarea",{value:textInput,onChange:e=>setTextInput(e.target.value),className:"w-full h-40 px-4 py-3 bg-slate-900/50 border border-slate-700/50 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 font-mono text-sm",placeholder:"AAPL, MSFT, GOOGL\nTSLA NVDA AMD\nMETA AMZN"}),React.createElement("div",{className:"text-xs text-slate-500 mt-2"},React.createElement("i",{className:"fas fa-info-circle"})," Supports: AAPL, MSFT GOOGL or AAPL\\nMSFT\\nGOOGL formats")),(importMethod==='csv'||importMethod==='json')&&React.createElement("div",null,React.createElement("label",{className:"text-sm text-slate-400 mb-2 block"},"Select ",importMethod.toUpperCase()," File"),React.createElement("input",{ref:fileInputRef,type:"file",accept:importMethod==='csv'?'.csv':'.json',onChange:handleFileImport,className:"hidden"}),React.createElement("button",{onClick:()=>fileInputRef.current?.click(),className:"w-full py-12 border-2 border-dashed border-slate-700/50 rounded-lg hover:border-cyan-500/50 hover:bg-slate-800/30 transition flex flex-col items-center justify-center gap-3 text-slate-400 hover:text-cyan-400"},React.createElement("i",{className:`fas fa-cloud-upload-alt text-4xl`}),React.createElement("div",{className:"font-semibold"},"Click to upload ",importMethod.toUpperCase()," file"),React.createElement("div",{className:"text-xs text-slate-500"},"or drag and drop"))),result&&React.createElement("div",{className:`p-4 rounded-lg border ${result.success?'bg-green-500/10 border-green-500/30 text-green-400':'bg-red-500/10 border-red-500/30 text-red-400'}`},React.createElement("div",{className:"flex items-center gap-2 font-semibold mb-1"},React.createElement("i",{className:`fas ${result.success?'fa-check-circle':'fa-exclamation-circle'}`}),result.success?'Import Successful!':'Import Failed'),React.createElement("div",{className:"text-sm"},result.success?`Imported ${result.count} symbol${result.count!==1?'s':''} to "${groupName}"`:result.error),result.success&&result.symbols&&React.createElement("div",{className:"mt-2 text-xs opacity-75"},result.symbols.slice(0,10).join(', '),result.symbols.length>10&&` ... +${result.symbols.length-10} more`))),React.createElement("div",{className:"flex justify-between items-center p-6 border-t border-slate-700/30"},React.createElement("button",{onClick:onClose,className:"px-6 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm transition"},"Cancel"),importMethod==='text'&&React.createElement("button",{onClick:handleTextImport,disabled:loading||!textInput.trim(),className:`px-6 py-2.5 rounded-lg font-semibold text-sm transition flex items-center gap-2 ${loading||!textInput.trim()?'bg-slate-700/50 text-slate-500 cursor-not-allowed':'bg-cyan-600 hover:bg-cyan-500 text-white'}`},loading?React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-spinner animate-spin"}),"Importing..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-file-import"}),"Import Watchlist")))));}function NotificationBell(_ref32){let{onClose}=_ref32;const[alerts,setAlerts]=useState(window.alertManager.alerts);useEffect(()=>{const unsubscribe=window.alertManager.subscribe(setAlerts);return unsubscribe;},[]);const unreadCount=window.alertManager.getUnreadCount();const getPriorityColor=priority=>{switch(priority){case'high':return'#ef4444';case'medium':return'#f59e0b';case'low':return'#06b6d4';default:return'#64748b';}};const getAlertIcon=type=>{switch(type){case'price':return'fa-chart-line';case'earnings':return'fa-calendar-alt';case'dividend':return'fa-money-bill-wave';case'news':return'fa-newspaper';case'analyst':return'fa-user-tie';default:return'fa-bell';}};return React.createElement("div",{className:"modal-overlay",onClick:onClose},React.createElement("div",{className:"glass-elevated rounded-2xl max-w-2xl w-full mx-auto my-8 animate-slide-up max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"flex items-center justify-between p-6 border-b border-slate-700/30 flex-shrink-0"},React.createElement("div",null,React.createElement("h2",{className:"text-2xl font-bold text-white mb-1 flex items-center gap-2"},React.createElement("i",{className:"fas fa-bell text-cyan-400"}),"Notifications",unreadCount>0&&React.createElement("span",{className:"px-3 py-1 bg-red-500 text-white text-xs font-bold rounded-full"},unreadCount)),React.createElement("p",{className:"text-sm text-slate-400"},"Stay updated with important portfolio alerts")),React.createElement("button",{onClick:onClose,className:"text-slate-400 hover:text-white text-2xl leading-none"},"\xD7")),React.createElement("div",{className:"flex items-center justify-between px-6 py-3 border-b border-slate-700/30 bg-slate-800/30"},React.createElement("div",{className:"text-sm text-slate-400"},alerts.length," notification",alerts.length!==1?'s':''),React.createElement("div",{className:"flex gap-2"},unreadCount>0&&React.createElement("button",{onClick:()=>window.alertManager.markAllAsRead(),className:"px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg text-xs font-semibold transition"},"Mark All Read"),alerts.length>0&&React.createElement("button",{onClick:()=>{if(confirm('Clear all notifications?')){window.alertManager.clearAll();}},className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 text-white rounded-lg text-xs font-semibold transition"},"Clear All"))),React.createElement("div",{className:"overflow-y-auto flex-1 p-4"},alerts.length===0?React.createElement("div",{className:"text-center py-20"},React.createElement("i",{className:"far fa-bell text-6xl text-slate-700 mb-4"}),React.createElement("div",{className:"text-lg font-semibold text-white mb-2"},"No Notifications"),React.createElement("div",{className:"text-sm text-slate-400"},"You're all caught up!")):React.createElement("div",{className:"space-y-2"},alerts.map(alert=>React.createElement("div",{key:alert.id,className:`p-4 rounded-lg border cursor-pointer transition ${alert.read?'bg-slate-800/30 border-slate-700/50':'bg-cyan-500/10 border-cyan-500/30'}`,onClick:()=>window.alertManager.markAsRead(alert.id)},React.createElement("div",{className:"flex items-start gap-3"},React.createElement("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`${getPriorityColor(alert.priority)}20`}},React.createElement("i",{className:`fas ${getAlertIcon(alert.type)}`,style:{color:getPriorityColor(alert.priority)}})),React.createElement("div",{className:"flex-1 min-w-0"},React.createElement("div",{className:"flex items-start justify-between gap-2 mb-1"},React.createElement("div",{className:"text-white font-bold"},alert.title),!alert.read&&React.createElement("div",{className:"w-2 h-2 bg-cyan-400 rounded-full flex-shrink-0 mt-2"})),React.createElement("div",{className:"text-sm text-slate-300 mb-2"},alert.message),React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"text-xs text-slate-500"},new Date(alert.timestamp).toLocaleString()),alert.symbol&&React.createElement("div",{className:"px-2 py-0.5 bg-slate-700 text-white text-xs font-bold rounded"},alert.symbol)))))))),React.createElement("div",{className:"flex justify-end items-center p-4 border-t border-slate-700/30 flex-shrink-0"},React.createElement("button",{onClick:onClose,className:"px-6 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm transition"},"Close"))));}function LivePriceTicker(_ref33){let{stocks,watchlist,isConnected}=_ref33;const[tickerStocks,setTickerStocks]=useState([]);const[currentIndex,setCurrentIndex]=useState(0);useEffect(()=>{const watchlistStocks=stocks.filter(s=>watchlist&&Array.isArray(watchlist)&&watchlist.some(w=>w&&w.toUpperCase()===s.symbol.toUpperCase()));setTickerStocks(watchlistStocks);},[stocks,watchlist]);useEffect(()=>{if(tickerStocks.length===0)return;const interval=setInterval(()=>{setCurrentIndex(prev=>(prev+1)%tickerStocks.length);},3000);return()=>clearInterval(interval);},[tickerStocks.length]);if(tickerStocks.length===0)return null;const visibleStocks=tickerStocks.slice(0,5);return React.createElement("div",{className:"bg-slate-900/50 border-b border-slate-700/30 py-2 overflow-hidden"},React.createElement("div",{className:"max-w-7xl mx-auto px-4"},React.createElement("div",{className:"flex items-center gap-6 overflow-x-auto"},React.createElement("div",{className:"flex items-center gap-2 flex-shrink-0"},React.createElement("div",{className:`w-2 h-2 rounded-full ${isConnected?'bg-green-500 animate-pulse':'bg-yellow-500'}`}),React.createElement("span",{className:"text-xs text-slate-400 font-semibold uppercase tracking-wide"},isConnected?'Live':'Delayed')),visibleStocks.map(stock=>{const changePct=stock.changePct||stock.changesPercentage||0;const isPositive=changePct>=0;return React.createElement("div",{key:stock.symbol,className:"flex items-center gap-3 flex-shrink-0 animate-fade-in"},React.createElement("span",{className:"text-white font-bold text-sm"},stock.symbol),React.createElement("span",{className:"text-white text-sm"},"$",stock.price?.toFixed(2)||'‚Äî'),React.createElement("span",{className:`text-sm font-semibold ${isPositive?'text-green-400':'text-red-400'}`},isPositive?'‚ñ≤':'‚ñº'," ",Math.abs(changePct).toFixed(2),"%"));}),tickerStocks.length>5&&React.createElement("span",{className:"text-slate-500 text-xs"},"+",tickerStocks.length-5," more"))));}function LiveIndicator(_ref34){let{active}=_ref34;return React.createElement("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${active?'bg-green-500/20 text-green-400':'bg-slate-700 text-slate-400'}`},React.createElement("div",{className:`w-1.5 h-1.5 rounded-full ${active?'bg-green-400 animate-pulse':'bg-slate-500'}`}),active?'LIVE':'DELAYED');}function APIStatusBanner(_ref35){let{realtimeData}=_ref35;const{connected}=realtimeData.getStatus();return React.createElement("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg text-xs ${connected?'bg-green-500/10 border border-green-500/30 text-green-400':'bg-yellow-500/10 border border-yellow-500/30 text-yellow-400'} mb-4`},React.createElement("i",{className:`fas ${connected?'fa-check-circle':'fa-exclamation-triangle'}`}),React.createElement("span",null,connected?`Real-time updates active (${realtimeData.getStatus().subscribedSymbols.length} symbols)`:'Using 5-second polling (Finnhub WebSocket unavailable)'));}function RealtimeHeatmap(_ref36){let{stocks,onStockClick}=_ref36;const[heatmapData,setHeatmapData]=useState([]);const[lastManualRefresh,setLastManualRefresh]=useState(Date.now());const[isRefreshing,setIsRefreshing]=useState(false);const REFRESH_INTERVAL=3600000;useEffect(()=>{const initialData=stocks.map(stock=>({symbol:stock.symbol,name:stock.name||stock.symbol,price:stock.price,changePct:stock.changePct,volume:stock.volume,marketCap:stock.marketCap,sector:stock.sector||'Other',lastUpdate:Date.now(),isStale:false}));setHeatmapData(initialData);},[stocks]);const processUpdate=stockData=>{const{symbol,price,changesPercentage,volume}=stockData;setHeatmapData(prev=>{const idx=prev.findIndex(s=>s.symbol===symbol);if(idx===-1)return prev;const updated=[...prev];const stock={...updated[idx]};if(price)stock.price=price;if(changesPercentage!==undefined)stock.changePct=changesPercentage;if(volume)stock.volume=volume;stock.lastUpdate=Date.now();stock.isStale=false;updated[idx]=stock;return updated;});};useEffect(()=>{if(!stocks.length)return;const isBrowser=typeof window!=='undefined';stocks.forEach(stock=>{if(isBrowser&&typeof smartPoller!=='undefined'){smartPoller.startPolling(stock.symbol,processUpdate,REFRESH_INTERVAL);}else if(typeof realtimeData!=='undefined'){realtimeData.subscribe(stock.symbol,processUpdate);}});return()=>{stocks.forEach(stock=>{if(isBrowser&&typeof smartPoller!=='undefined'){smartPoller.stopPolling(stock.symbol);}else if(typeof realtimeData!=='undefined'){realtimeData.unsubscribe(stock.symbol,processUpdate);}});};},[stocks]);useEffect(()=>{const interval=setInterval(()=>{const staleThreshold=Date.now()-65*60*1000;setHeatmapData(prev=>prev.map(stock=>({...stock,isStale:stock.lastUpdate<staleThreshold})));},60000);return()=>clearInterval(interval);},[]);const handleManualRefresh=async()=>{if(typeof smartFetch==='undefined'){console.error('smartFetch is not available');return;}setIsRefreshing(true);setLastManualRefresh(Date.now());const refreshPromises=stocks.map(stock=>smartFetch('quote',stock.symbol).then(result=>{if(result?.data?.[0]){processUpdate({symbol:stock.symbol,price:result.data[0].price,changesPercentage:result.data[0].changesPercentage,volume:result.data[0].volume});}}).catch(err=>console.warn(`Refresh failed for ${stock.symbol}:`,err)));await Promise.allSettled(refreshPromises);setIsRefreshing(false);};const getHeatColor=changePct=>{if(changePct>5)return'bg-green-600';if(changePct>2)return'bg-green-500';if(changePct>0)return'bg-green-400';if(changePct>-2)return'bg-yellow-500';if(changePct>-5)return'bg-orange-500';return'bg-red-600';};const getSizeClass=marketCap=>{if(!marketCap)return'w-24 h-16';if(marketCap>100e9)return'w-32 h-20';if(marketCap>10e9)return'w-28 h-18';if(marketCap>2e9)return'w-24 h-16';return'w-20 h-14';};return React.createElement("div",{className:"glass-card p-6 rounded-xl mb-6 border border-slate-700/50"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("h3",{className:"text-xl font-bold text-white flex items-center gap-2"},React.createElement("i",{className:"fas fa-fire text-orange-400"}),"Market Heatmap"),React.createElement("span",{className:`text-xs px-2 py-1 rounded-full ${typeof realtimeData!=='undefined'&&realtimeData?.isConnected?'bg-green-500/20 text-green-300':'bg-orange-500/20 text-orange-300'}`},typeof realtimeData!=='undefined'&&realtimeData?.isConnected?'Live':'60-min Updates')),React.createElement("div",{className:"flex items-center gap-3"},React.createElement(DataFreshnessIndicator,{timestamp:lastManualRefresh,type:"heatmap"}),React.createElement("button",{onClick:handleManualRefresh,disabled:isRefreshing,className:"px-3 py-1.5 bg-slate-700 hover:bg-slate-600 disabled:opacity-50 text-white rounded-lg text-sm flex items-center gap-2"},isRefreshing?React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-spinner animate-spin"})," Refreshing..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sync"})," Refresh Now")))),React.createElement("div",{className:"grid grid-cols-6 md:grid-cols-8 lg:grid-cols-10 xl:grid-cols-12 gap-2 max-h-96 overflow-y-auto p-2"},heatmapData.map(stock=>React.createElement("div",{key:stock.symbol,onClick:()=>onStockClick(stock),className:`${getHeatColor(stock.changePct)} ${getSizeClass(stock.marketCap)} 
                  rounded-lg p-2 cursor-pointer transition transform hover:scale-105 
                  flex flex-col justify-between relative group border border-transparent hover:border-white/20`},!stock.isStale&&React.createElement("div",{className:"absolute top-1 right-1 w-2 h-2 bg-green-400 rounded-full"}),stock.isStale&&React.createElement("div",{className:"absolute top-1 right-1 w-2 h-2 bg-yellow-400 rounded-full",title:"Data may be stale"}),React.createElement("div",null,React.createElement("div",{className:"text-white font-bold text-xs"},stock.symbol),React.createElement("div",{className:"text-white/90 text-xs font-mono"},"$",stock.price?.toFixed(2))),React.createElement("div",null,React.createElement("div",{className:`text-xs font-bold ${stock.changePct>0?'text-white':'text-red-100'}`},stock.changePct>0?'+':'',stock.changePct?.toFixed(1),"%"),stock.volume&&React.createElement("div",{className:"text-white/70 text-[10px]"},formatNumber(stock.volume)))))),React.createElement("div",{className:"mt-4 flex items-center justify-between text-xs text-slate-400"},React.createElement("div",null,React.createElement("span",{className:"mr-4"},"Click stock for details"),React.createElement("span",null,"Updates every 60 minutes during market hours")),React.createElement("div",null,"Last refresh: ",new Date(lastManualRefresh).toLocaleTimeString())));}const LiveHeatmap=RealtimeHeatmap;function TournamentLeaderboardTab(_ref37){let{leaderboard,isLoading,error,onRunTournament}=_ref37;if(isLoading){return React.createElement("div",{className:"glass-card p-12 rounded-xl text-center"},React.createElement("i",{className:"fas fa-spinner animate-spin text-4xl text-purple-400 mb-4"}),React.createElement("p",{className:"text-slate-400"},"Loading tournament leaderboard..."));}if(error){return React.createElement("div",{className:"glass-card p-8 rounded-xl text-center border-red-500/30"},React.createElement("i",{className:"fas fa-exclamation-triangle text-4xl text-red-400 mb-4"}),React.createElement("p",{className:"text-red-300 mb-4"},error),React.createElement("button",{onClick:onRunTournament,className:"px-6 py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-semibold"},"Try Again"));}if(!leaderboard||leaderboard.length===0){return React.createElement("div",{className:"glass-card p-12 rounded-xl text-center"},React.createElement("i",{className:"fas fa-trophy text-6xl text-slate-700 mb-4"}),React.createElement("h3",{className:"text-xl font-bold text-white mb-2"},"No Tournament Data"),React.createElement("p",{className:"text-slate-400 mb-4"},"Run an AI Tournament to see the leaderboard"),React.createElement("button",{onClick:onRunTournament,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white rounded-lg font-semibold flex items-center gap-2 mx-auto"},React.createElement("i",{className:"fas fa-play"}),"Start AI Tournament"));}return React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"glass-card p-6 rounded-xl border border-purple-500/30 bg-gradient-to-br from-purple-500/5 to-pink-500/5"},React.createElement("div",{className:"flex items-center justify-between mb-6"},React.createElement("h3",{className:"text-xl font-bold text-white flex items-center gap-2"},React.createElement("i",{className:"fas fa-trophy text-yellow-400"}),"AI Tournament Leaderboard"),React.createElement("button",{onClick:onRunTournament,className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-semibold text-sm flex items-center gap-2 transition"},React.createElement("i",{className:"fas fa-redo"}),"Refresh Data")),React.createElement("div",{className:"space-y-3"},leaderboard.map((team,idx)=>{const isTop3=idx<3;return React.createElement("div",{key:team.team_id||idx,className:`rounded-lg p-4 border transition hover:scale-[1.02] cursor-pointer ${isTop3?'bg-slate-800/70 border-purple-500/50 shadow-purple-500/10 shadow-lg':'bg-slate-800/50 border-slate-700/50 hover:border-purple-500/30'}`},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("div",{className:`w-12 h-12 rounded-full flex items-center justify-center font-bold text-xl transition ${idx===0?'bg-yellow-500/20 text-yellow-400 ring-2 ring-yellow-500/40':idx===1?'bg-slate-500/20 text-slate-400 ring-2 ring-slate-500/40':idx===2?'bg-orange-500/20 text-orange-400 ring-2 ring-orange-500/40':'bg-slate-700/20 text-slate-500'}`},idx+1),React.createElement("div",null,React.createElement("div",{className:"font-bold text-white text-lg"},team.name||`AI Team ${team.team_id}`),React.createElement("div",{className:"text-sm text-slate-400 flex items-center gap-2"},React.createElement("i",{className:"fas fa-robot"}),team.model||'Custom Strategy',team.status==='running'&&React.createElement("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-300 rounded text-xs"},React.createElement("i",{className:"fas fa-spinner animate-spin mr-1"}),"Active")))),React.createElement("div",{className:"text-right"},React.createElement("div",{className:`text-3xl font-bold mb-1 ${team.return>=0?'text-green-400':'text-red-400'}`},team.return?`${team.return.toFixed(2)}%`:'0.00%'),React.createElement("div",{className:"text-sm text-slate-400"},React.createElement("div",null,"ROI: $",team.roi?.toFixed(2)||'0.00'),React.createElement("div",null,"Trades: ",team.trades||0),React.createElement("div",null,"Win Rate: ",team.win_rate?`${team.win_rate}%`:'0%')))),team.current_day&&team.total_days&&React.createElement("div",{className:"mt-3"},React.createElement("div",{className:"w-full bg-slate-700 rounded-full h-2"},React.createElement("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full",style:{width:`${team.current_day/team.total_days*100}%`}})),React.createElement("div",{className:"text-xs text-slate-500 mt-1"},"Day ",team.current_day," of ",team.total_days)));}))),React.createElement("div",{className:"grid grid-cols-3 gap-4"},React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-2xl font-bold text-green-400"},leaderboard[0]?.return?`${leaderboard[0].return.toFixed(2)}%`:'0%'),React.createElement("div",{className:"text-xs text-slate-400"},"Best Performance")),React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-2xl font-bold text-purple-400"},leaderboard.reduce((sum,t)=>sum+(t.trades||0),0)),React.createElement("div",{className:"text-xs text-slate-400"},"Total Trades")),React.createElement("div",{className:"glass-card p-4 rounded-lg text-center"},React.createElement("div",{className:"text-2xl font-bold text-cyan-400"},leaderboard.filter(t=>(t.win_rate||0)>50).length),React.createElement("div",{className:"text-xs text-slate-400"},"Profitable Teams"))));}function App(){const[stocks,setStocks]=useState([]);const[isDarkMode,setIsDarkMode]=useState(()=>{const saved=localStorage.getItem('darkMode');return saved!==null?saved==='true':true;});const toggleTheme=()=>{const newMode=!isDarkMode;setIsDarkMode(newMode);localStorage.setItem('darkMode',newMode);document.body.classList.toggle('light-mode',!newMode);};useEffect(()=>{if(!isDarkMode){document.body.classList.add('light-mode');}else{document.body.classList.remove('light-mode');}},[isDarkMode]);const[loading,setLoading]=useState(true);const[loadingProgress,setLoadingProgress]=useState({current:0,total:0});const[search,setSearch]=useState('');const[selectedSector,setSelectedSector]=useState('');const[selectedPreset,setSelectedPreset]=useState('');const[sortBy,setSortBy]=useState({key:'marketCap',dir:'desc'});const[visibleColumns,setVisibleColumns]=useState(DEFAULT_VISIBLE);const[selectedStock,setSelectedStock]=useState(null);const[portfolioOptimization,setPortfolioOptimization]=useState(null);const[portfolioMetrics,setPortfolioMetrics]=useState(null);const[heatmapData,setHeatmapData]=useState([]);const[heatmapSubscriptions,setHeatmapSubscriptions]=useState(new Set());useEffect(()=>{if(!stocks||stocks.length===0)return;const symbols=stocks.map(s=>s.symbol).slice(0,50);symbols.forEach(symbol=>{if(heatmapSubscriptions.has(symbol))return;const handleUpdate=update=>{setHeatmapData(prev=>{const index=prev.findIndex(s=>s.symbol===update.symbol);if(index===-1)return prev;const newData=[...prev];newData[index]={...newData[index],price:update.price,changePct:update.changesPercentage||update.change/update.price*100,volume:update.volume,lastUpdate:Date.now()};return newData;});};if(realtimeData.isConnected){realtimeData.subscribe(symbol,handleUpdate);}else{smartPoller.startPolling(symbol,handleUpdate);}setHeatmapSubscriptions(prev=>new Set(prev).add(symbol));});return()=>{heatmapSubscriptions.forEach(symbol=>{realtimeData.unsubscribe(symbol,()=>{});smartPoller.stopPolling(symbol);});};},[stocks,realtimeData.isConnected]);const[similarStocks,setSimilarStocks]=useState(null);const[partialResults,setPartialResults]=useState([]);const[completedSymbols,setCompletedSymbols]=useState(new Set());const[isIncrementalLoading,setIsIncrementalLoading]=useState(false);const[apiProgress,setApiProgress]=useState({current:0,total:0});const[showStuckWarning,setShowStuckWarning]=useState(false);const cleanWatchlist=symbols=>{const headerWords=new Set(['SYMBOL','NAME','LAST','OPEN','HIGH','LOW','CHG','VOL','VOLUME','TIME','DATE','CLOSE','CHANGE','PRICE','CHANGE%','CHG.','VOL.','BUY','SELL','HOLD','RSI','MACD','EPS','REVENUE','DAILY','HOURLY','YTD','BETA','NEUTRAL','INC.','MONGODB','EARNINGS','PE','MARKET','CAP','SECTOR','INDUSTRY','DIVIDEND','YIELD','IEX']);return symbols.map(s=>cleanSymbol(String(s).trim())).filter(s=>s&&s.length>0&&s.length<=10&&/^[A-Z]+$/.test(s)&&!headerWords.has(s));};const[watchlist,setWatchlist]=useState(()=>{const saved=JSON.parse(localStorage.getItem('watchlist')||'[]');const cleaned=cleanWatchlist(saved);if(cleaned.length!==saved.length){console.log(`üßπ Cleaned watchlist: removed ${saved.length-cleaned.length} invalid symbols`);localStorage.setItem('watchlist',JSON.stringify(cleaned));}return cleaned;});const[showWatchlistOnly,setShowWatchlistOnly]=useState(false);const findSimilarStocks=()=>{if(!selectedStock||stocks.length<2){setSimilarStocks([]);return;}const similarities=stocks.filter(s=>s.symbol!==selectedStock.symbol).map(stock=>{let score=0;let factors=0;if(stock.sector===selectedStock.sector)score+=30;factors++;if(selectedStock.pe&&stock.pe){const peDiff=Math.abs(selectedStock.pe-stock.pe);score+=Math.max(0,20-peDiff);factors++;}if(selectedStock.roe&&stock.roe){const roeDiff=Math.abs(selectedStock.roe-stock.roe);score+=Math.max(0,20-roeDiff/5);factors++;}if(selectedStock.marketCap&&stock.marketCap){const ratio=selectedStock.marketCap/stock.marketCap;if(ratio>=0.5&&ratio<=2)score+=15;factors++;}const similarity=score/(factors*20)*100;return{symbol:stock.symbol,companyName:stock.companyName,sector:stock.sector,similarity:similarity,pe:stock.pe,roe:stock.roe,aiScore:stock.aiScore};}).sort((a,b)=>b.similarity-a.similarity).slice(0,10);setSimilarStocks(similarities);};const runPortfolioOptimization=async()=>{setLoadingTabData(true);try{if(portfolio.length<2){setPortfolioOptimization(null);return;}const positions=portfolio.map(pos=>{const stock=stocks.find(s=>s.symbol===pos.symbol);return{symbol:pos.symbol,expectedReturn:(stock?.aiScore||50)/1000+0.05,volatility:(100-(stock?.confidence||50))/100};});const optimization=MLModels.optimizePortfolio(positions);setPortfolioOptimization(optimization);}catch(err){console.error('Portfolio error:',err);setPortfolioOptimization(null);}finally{setLoadingTabData(false);}};const[showHeatmap,setShowHeatmap]=useState(false);const[showSettings,setShowSettings]=useState(false);const[showAlerts,setShowAlerts]=useState(false);const[showPortfolio,setShowPortfolio]=useState(false);const[showPortfolioAllocation,setShowPortfolioAllocation]=useState(false);const[showStockManager,setShowStockManager]=useState(false);const[showComparison,setShowComparison]=useState(false);const[showEducation,setShowEducation]=useState(false);const[showNotifications,setShowNotifications]=useState(false);const[showWatchlistImporter,setShowWatchlistImporter]=useState(false);const[showAITournament,setShowAITournament]=useState(false);const[notificationCount,setNotificationCount]=useState(0);const[tournamentRunning,setTournamentRunning]=useState(false);useEffect(()=>{const checkTournamentStatus=async()=>{try{const response=await fetch(`${API_BASE_URL}/api/tournament/status/current`);if(response.ok){const data=await response.json();const isRunning=data.status==='running';setTournamentRunning(isRunning);if(isRunning&&!tournamentRunning){console.log('üìã Tournament detected running - showing indicator');}}}catch(error){console.log('Could not check tournament status:',error);}};checkTournamentStatus();const interval=setInterval(checkTournamentStatus,30000);return()=>clearInterval(interval);},[tournamentRunning]);const[activeMainTab,setActiveMainTab]=useState('screener');const[tournamentLeaderboardData,setTournamentLeaderboardData]=useState([]);const[tournamentLoading,setTournamentLoading]=useState(false);const[tournamentError,setTournamentError]=useState(null);const loadTournamentLeaderboard=useCallback(async()=>{setTournamentLoading(true);setTournamentError(null);try{const response=await fetch(`${API_BASE_URL}/api/tournament/results`);if(!response.ok){throw new Error(`Failed to load: ${response.status}`);}const data=await response.json();setTournamentLeaderboardData(data.leaderboard||[]);if(data.status==='running'){console.log('üèÅ Tournament in progress');}}catch(err){console.error('Leaderboard load error:',err);setTournamentError(err.message);}finally{setTournamentLoading(false);}},[]);useEffect(()=>{if(activeMainTab==='leaderboard'){loadTournamentLeaderboard();const interval=setInterval(loadTournamentLeaderboard,30000);return()=>clearInterval(interval);}},[activeMainTab,loadTournamentLeaderboard]);useEffect(()=>{const updateCount=()=>{setNotificationCount(window.alertManager.getUnreadCount());};updateCount();const unsubscribe=window.alertManager.subscribe(updateCount);return unsubscribe;},[]);useEffect(()=>{if(!window.keyboardShortcuts)return;window.keyboardShortcuts.register('/',()=>{document.querySelector('input[type="text"]')?.focus();},'Focus search input');window.keyboardShortcuts.register('ctrl+r',()=>{manualRefresh();},'Refresh stock data');window.keyboardShortcuts.register('ctrl+i',()=>{setShowWatchlistImporter(true);},'Open import dialog');window.keyboardShortcuts.register('ctrl+p',()=>{setShowPortfolio(true);},'Open portfolio');window.keyboardShortcuts.register('ctrl+h',()=>{const shortcuts=window.keyboardShortcuts.getHelp();alert('‚å®Ô∏è KEYBOARD SHORTCUTS:\n\n'+shortcuts.map(s=>`${s.key.padEnd(15)} ${s.description}`).join('\n'));},'Show this help');window.keyboardShortcuts.register('esc',()=>{setShowPortfolio(false);setShowAlerts(false);setShowSettings(false);setShowEducation(false);setShowStockManager(false);setShowWatchlistImporter(false);},'Close modals');console.log('‚å®Ô∏è Keyboard shortcuts registered');},[]);const[comparisonSymbols,setComparisonSymbols]=useState([]);const[isWebSocketConnected,setIsWebSocketConnected]=useState(false);const[curatedStocks,setCuratedStocks]=useState(()=>{const saved=localStorage.getItem('curatedStocks');const defaultList=["AAPL","MSFT","GOOGL","GOOG","AMZN","NVDA","TSLA","META","BRK.B","UNH","XOM","JNJ","JPM","V","PG","MA","HD","CVX","LLY","ABBV","MRK","AVGO","COST","PEP","KO","ADBE","TMO","WMT","MCD","CSCO","ACN","ABT","CRM","NFLX","DHR","LIN","NKE","VZ","CMCSA","TXN","DIS","PM","NEE","BMY","ORCL","AMD","INTC","QCOM","RTX","UPS","T","HON","UNP","BA","SPGI","COP","SBUX","LOW","INTU","AMGN","GE","DE","CAT","PLD","ISRG","MS","BLK","GS","AXP","NOW","AMAT","TJX","ELV","ADI","SYK","BKNG","MDLZ","LMT","VRTX","GILD","CI","ADP","REGN","ZTS","PGR","CVS","MMC","TGT","SLB","LRCX","CB","ETN","C","MO","SO","BDX","DUK","SCHW","BSX","PNC","PYPL","EQIX","FISV","ITW","MMM","FCX","AON","CL","APD","USB","CME","ICE","GM","WM","F","NOC","MCO","NSC","PSX","CCI","MPC","SHW","MCK","EMR","ROP","EOG","KLAC","HCA","ECL","MSI","GD","PSA","APH","PH","ADSK","SNPS","SRE","AJG","ATVI","TEL","TFC","AIG","COF","MAR","AFL","TT","MET","NXPI","FIS","PCAR","CARR","TRV","SYY","ALL","AEP","AZO","PAYX","PRU","ORLY","FTNT","HUM","DHI","D","DD","KMB","MNST","RSG","CMG","IDXX","WELL","GPN","CTVA","O","MSCI","ROST","MCHP","SPG","EA","JCI","EW","IQV","CTAS","KMI","KDP","BIIB","ROK","WMB","A","XEL","PPG","CTSH","WBD","CPRT","BK","OTIS","ODFL","FAST","HSY","AMT","CHTR","DVN","CMI","EXC","VRSK","YUM","GIS","DLR","STZ","CBRE","EXR","DOW","AMP","DXCM","AWK","ILMN","GLW","KEYS","STE","MTD","EBAY","ANSS","IFF","LHX","KHC","LH","ACGL","LYB","VMC","ADM","WY","ED","PCG","FTV","LVS","TROW","CDNS","DTE","RMD","HPQ","WST","TSCO","ALGN","MTB","VICI","EFX","WAB","WTW","AEE","IT","CNC","ETR","FRC","GWW","AVB","ALB","DAL","APTV","BAX","PFG","SBAC","EQR","CSGP","ES","TDY","PPL","STT","HPE","DOV","DLTR","WEC","FITB","DFS","EIX","TSN","TYL","SIVB","FE","ZBH","TDG","HBAN","MPWR","PWR","MLM","RF","NTRS","IEX","CLX","ARE","HAL","HOLX","EQT","CZR","INVH","LUV","CFG","OMC","URI","XYL","DPZ","K","VTR","FLT","CAH","TTWO","EXPE","BALL","FDS","SYF","BBY","COO","NVR","DRI","MKC","WAT","ZBRA","WDC","PKI","J","CNP","IP","NTAP","KIM","AES","LKQ","CINF","CE","POOL","EXPD","LNT","TER","SWK","JBHT","AMCR","APA","PTC","JKHY","BXP","HRL","NDAQ","EPAM","BF.B","UDR","TRMB","KMX","TAP","SWKS","CPT","MAA","AOS","HST","PNW","AIZ","LYV","MOS","CHRW","MGM","ULTA","AKAM","TECH","GL","ALLE","HSIC","SNA","FFIV","GNRC","LW","RE","EMN","CTLT","REG","PAYC","AAL","SEE","HII","CMA","BRO","CPB","IPG","NI","CRL","PEAK","BBWI","WYNN","WHR","NCLH","ALK","IVZ","HAS","RL","ZION","BEN","PNR","MKTX","BWA","VNO","NWS","NWSA","LUMN","FOX","FOXA","DXC","DISH","UBER","LYFT","ABNB","COIN","SHOP","SQ","ROKU","SNAP","PINS","TWLO","ZM","DOCU","DDOG","SNOW","NET","CRWD","ZS","OKTA","PANW","MDB","TEAM","WDAY","VEEV","DKNG","RBLX","U","PATH","RIVN","LCID","PLTR","SOFI","HOOD","AFRM","UPST","PTON","BYND","PLUG","ENPH","SEDG","FSLR","RUN","SPWR","MAXN","BE","BLNK","CHPT","QS","LAZR","VLDR","LIDR","OUST","MVIS","INVZ","SPCE","ASTR","RDW","PL","ASTS","SATS","LUNR","MNTS","IRDM","GSAT","AST","GILT","VORB","ACHR","JOBY","LILM","EVTL","BIRD","WKHS","GOEV","RIDE","FSR","LEV","ARVL","PTRA","HYLN","NKLA","GP","HYZN","XL","FUV","SOLO","AYRO","ELMS","GEV","MULN","WKSP","FFIE","PSNY","AMC","GME","BB","BBBY","NOK","SNDL","NAKD","EXPR","KOSS","CLOV","WISH","CLNE","RKT","UWMC","SENS","OCGN","PROG","ATER","BBIG","SPRT","GREE","IRNT","OPAD","SDC","ABML","ALPP","OZSC","AITX","TSNP","TLSS","BBRW","VPER","SRMX","INKW","IDGC","FOMO","BOTY","POTN","MINE","SIRC","IGEX","NIO","XPEV","LI","BYDDY","BABA","JD","PDD","BIDU","TCEHY","NTES","TME","IQ","BILI","VIPS","ATHM","ZTO","YMM","HTHT","DIDI","EDU","TAL","GOTU","RLX","YY","MOMO","HUYA","DOYU","TIGR","FUTU","UP","LX","QTT","DUO","MOGU","TUYA","API","LAIX","BEST","YJ","CANG","PETZ","MOXC","QH","LMNR","LITB","AIHS","TANH","CBAT","KNDI","POLA","IDEX","WIMI","MRIN","CARV","EAST","JAGX","SXTC","CJJD","DOGZ","GLG","REED","SGMD","TSM","ASML","MU","MRVL","MCHP","ON","QRVO","STM","GFS","ENTG","CRUS","COHU","AOSL","MTSI","FORM","UCTT","PLAB","ACLS","INDI","ICHR","NVMI","ONTO","ACMR","CAMT","POWI","MKSI","AEIS","RMBS","AMBA","ALGM","LSCC","DIOD","WOLF","SLAB","SMTC","VECO","TRMR","AAOI","REFR","IPGP","LITE","OESX","EMKR","VIAV","INFN","OCLR","FNSR","AAON","ATKR","BDC","BELFB","CTS","TAIT","TTMI","SANM","ENS","TRS","VSEC","MWA","BC","TILE","HXL","SHLS","DBD","PRLB","DDD","SSYS","NNDM","XONE","VJET","MTLS","LOGI","CRSR","IRBT","WBX","SEIC","SSNC","BR","GDDY","LDOS","SAIC","CACI","KTOS","AVAV","TDY","FROG","SPLK","ZI","COUP","ESTC","BILL","S","CFLT","GTLB","IOT","APPN","SUMO","EVBG","PD","AI","NCNO","FIVN","BRZE","DT","SNOW","DDOG","NET","CRWD","ZS","OKTA","PANW","TENB","VRNS","QLYS","RPD","SAIL","RSKD","FSLY","CLOUDFLARE","PING","NEWR","ESTC","SPLK","WORK","TWLO","BAND","BOX","DBX","DOCN","LINODE","MDB","SNOW","ELASTIC"];const stocks=saved?JSON.parse(saved):defaultList;const uniqueStocks=[...new Set(stocks.map(s=>String(s).toUpperCase().trim()).filter(s=>s))];if(uniqueStocks.length!==stocks.length){localStorage.setItem('curatedStocks',JSON.stringify(uniqueStocks));}return uniqueStocks;});const[newStockSymbol,setNewStockSymbol]=useState('');const[toasts,setToasts]=useState([]);const[portfolio,setPortfolio]=useState(()=>JSON.parse(localStorage.getItem('portfolio')||'[]'));const[alerts,setAlerts]=useState(()=>JSON.parse(localStorage.getItem('alerts')||'[]'));const[goals,setGoals]=useState(()=>{const saved=localStorage.getItem('re_financial_goals');return saved?JSON.parse(saved):[];});const[portfolioRecs,setPortfolioRecs]=useState([]);const[detailedDataLoading,setDetailedDataLoading]=useState(false);const[lastUpdateTime,setLastUpdateTime]=useState(null);const[nextUpdateTime,setNextUpdateTime]=useState(null);const[errors,setErrors]=useState([]);useEffect(()=>{if(!portfolio||portfolio.length===0)return;const prevPrices={};portfolio.forEach(pos=>{prevPrices[pos.symbol]=pos.currentPrice;});const interval=setInterval(()=>{const now=new Date();const hours=now.getHours();const day=now.getDay();if(day===0||day===6||hours<9||hours>=16)return;checkPortfolioAlerts(portfolio,prevPrices);portfolio.forEach(pos=>{prevPrices[pos.symbol]=pos.currentPrice;});},60*60*1000);return()=>clearInterval(interval);},[portfolio]);const[filters,setFilters]=useState({pe_min:'',pe_max:'',roe_min:'',roe_max:'',marketCap_min:'',marketCap_max:'',changePct_min:'',changePct_max:'',rsi_min:'',rsi_max:''});const[firebaseUser,setFirebaseUser]=useState(null);const[authLoading,setAuthLoading]=useState(true);useEffect(()=>{if(window.firebaseUtils){const{auth,onAuthStateChanged}=window.firebaseUtils;const unsubscribe=onAuthStateChanged(auth,user=>{setFirebaseUser(user);setAuthLoading(false);if(user){console.log('‚úÖ User signed in:',user.email);loadUserDataFromFirebase(user.uid);}});return()=>unsubscribe();}else{setAuthLoading(false);}},[]);const signInWithGoogle=async()=>{if(!window.firebaseUtils){alert('Firebase not configured. Running in guest mode.');return;}const{auth,provider,signInWithPopup}=window.firebaseUtils;try{await signInWithPopup(auth,provider);}catch(error){console.error('Auth error:',error);alert('Sign-in failed. Continue in guest mode.');}};const signOutUser=async()=>{if(window.firebaseUtils?.auth){await window.firebaseUtils.auth.signOut();}setFirebaseUser(null);console.log('‚úÖ User signed out');};useEffect(()=>{const cleaned=cleanWatchlist(watchlist);if(cleaned.length!==watchlist.length){console.log(`üßπ Auto-cleaning watchlist: removing ${watchlist.length-cleaned.length} invalid symbols (${watchlist.filter(s=>!cleaned.includes(s)).join(', ')})`);setWatchlist(cleaned);localStorage.setItem('watchlist',JSON.stringify(cleaned));}},[]);const loadUserDataFromFirebase=async uid=>{if(!window.firebaseUtils?.db)return;try{const{db,doc,getDoc}=window.firebaseUtils;const userDoc=await getDoc(doc(db,'users',uid));if(userDoc.exists()){const data=userDoc.data();if(data.watchlist){const cleaned=cleanWatchlist(data.watchlist);setWatchlist(cleaned);if(cleaned.length!==data.watchlist.length){console.log(`üßπ Cleaned watchlist from Firebase: removed ${data.watchlist.length-cleaned.length} invalid symbols`);}console.log('‚úÖ Loaded watchlist from Firebase');}if(data.portfolio){setPortfolio(data.portfolio);console.log('‚úÖ Loaded portfolio from Firebase');}}}catch(error){console.warn('Failed to load user data:',error);}};const saveUserDataToFirebase=async uid=>{if(!window.firebaseUtils?.db)return;try{const{db,doc,setDoc}=window.firebaseUtils;const data={watchlist,portfolio,lastUpdated:new Date().toISOString()};await setDoc(doc(db,'users',uid),data,{merge:true});console.log('‚úÖ Saved to Firebase');}catch(error){console.warn('Failed to save user data:',error);}};useEffect(()=>{if(firebaseUser){saveUserDataToFirebase(firebaseUser.uid);}},[watchlist,portfolio,firebaseUser]);useEffect(()=>{const newBadges=checkAndUnlockBadges(portfolio,watchlist,goals,{});if(newBadges.length>0){newBadges.forEach(badgeId=>{const badge=BADGES[badgeId];if(badge){addToast(`üèÜ Badge Unlocked: ${badge.title}!`,'success');}});}},[portfolio,watchlist,goals]);useEffect(()=>{const urlParams=new URLSearchParams(window.location.search);const shared=urlParams.get('watchlist');if(shared){const symbols=shared.split(',').map(s=>cleanSymbol(s.trim()));const cleaned=cleanWatchlist(symbols);setWatchlist(cleaned);if(cleaned.length!==symbols.length){console.log(`üßπ Cleaned shared watchlist: removed ${symbols.length-cleaned.length} invalid symbols`);}addToast('üìã Imported shared watchlist','success');console.log('‚úÖ Loaded shared watchlist:',cleaned);}},[]);const openStockModal=stock=>{setSelectedStock(stock);const viewedStocks=JSON.parse(localStorage.getItem('viewedStocks')||'[]');if(!viewedStocks.includes(stock.symbol)){viewedStocks.push(stock.symbol);localStorage.setItem('viewedStocks',JSON.stringify(viewedStocks));}};useEffect(()=>{fetchStocks();const refreshInterval=setInterval(()=>{console.log('‚è∞ Hourly auto-refresh triggered');fetchStocks();},60*60*1000);return()=>clearInterval(refreshInterval);},[]);useEffect(()=>{if(lastUpdateTime){const nextUpdate=new Date(lastUpdateTime.getTime()+60*60*1000);setNextUpdateTime(nextUpdate);}},[lastUpdateTime]);const addError=function(message){let details=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';const id=Date.now().toString();setErrors(prev=>[...prev,{id,message,details,timestamp:new Date()}]);setTimeout(()=>{setErrors(prev=>prev.filter(e=>e.id!==id));},10000);};const fetchSingleStockData=async symbol=>{symbol=cleanSymbol(symbol);const cached=Cache.get(symbol,'stock');if(cached){console.log(`‚ö° Using cached data for ${symbol}`);return cached;}try{console.log(`üì° Fetching comprehensive data for ${symbol}... (Paid FMP API)`);const delay=ms=>new Promise(resolve=>setTimeout(resolve,ms));const fetchFMPWithRetry=async function(url){let retries=arguments.length>1&&arguments[1]!==undefined?arguments[1]:3;for(let i=0;i<retries;i++){const response=await fetch(url);if(response.status===429){const retryAfter=response.headers.get('Retry-After');const waitTime=retryAfter?parseInt(retryAfter)*1000:(i+1)*2000;console.warn(`‚è≥ FMP rate limited. Waiting ${waitTime/1000}s before retry ${i+1}/${retries}...`);await delay(waitTime);continue;}if(!response.ok&&response.status!==404){if(i<retries-1){await delay(1000*(i+1));continue;}}return response;}return null;};const quoteRes=await fetchFMPWithRetry(`https://financialmodelingprep.com/stable/quote?symbol=${symbol}&apikey=${FMP_API_KEY}`);if(!quoteRes||!quoteRes.ok){const status=quoteRes?.status||'No response';const statusText=quoteRes?.statusText||'Network error or timeout';console.warn(`‚ö†Ô∏è Quote API failed for ${symbol}: ${status} (${statusText})`);if(quoteRes?.status===429){throw new Error(`Rate limited by FMP API. Please wait and try again.`);}if(!quoteRes){throw new Error(`Stock data not available for ${symbol} (no response from API - may be invalid symbol or network issue)`);}throw new Error(`Stock data not available for ${symbol} (status ${status})`);}const quoteData=await quoteRes.json();await delay(200);const metricsRes=await fetchFMPWithRetry(`https://financialmodelingprep.com/stable/key-metrics-ttm?symbol=${symbol}&apikey=${FMP_API_KEY}`);const metricsData=metricsRes?.ok?await metricsRes.json():null;await delay(200);const scoresRes=await fetchFMPWithRetry(`https://financialmodelingprep.com/stable/financial-scores?symbol=${symbol}&apikey=${FMP_API_KEY}`);const scoresData=scoresRes?.ok?await scoresRes.json():null;await delay(200);const ratingsRes=await fetchFMPWithRetry(`https://financialmodelingprep.com/stable/ratings-snapshot?symbol=${symbol}&apikey=${FMP_API_KEY}`);const ratingsData=ratingsRes?.ok?await ratingsRes.json():null;await delay(200);const targetRes=await fetchFMPWithRetry(`https://financialmodelingprep.com/stable/price-target-consensus?symbol=${symbol}&apikey=${FMP_API_KEY}`);const targetData=targetRes?.ok?await targetRes.json():null;await delay(200);const profileRes=await fetchFMPWithRetry(`https://financialmodelingprep.com/stable/profile?symbol=${symbol}&apikey=${FMP_API_KEY}`);const profileData=profileRes?.ok?await profileRes.json():null;await delay(200);const gradesRes=await fetchFMPWithRetry(`https://financialmodelingprep.com/stable/grades?symbol=${symbol}&limit=10&apikey=${FMP_API_KEY}`);const grades=gradesRes?.ok?await gradesRes.json():[];await delay(200);const ratiosRes=await fetchFMPWithRetry(`https://financialmodelingprep.com/stable/ratios?symbol=${symbol}&limit=1&apikey=${FMP_API_KEY}`);const ratiosData=ratiosRes?.ok?await ratiosRes.json():null;await delay(200);const growthRes=await fetchFMPWithRetry(`https://financialmodelingprep.com/stable/financial-growth?symbol=${symbol}&limit=5&apikey=${FMP_API_KEY}`);const growthData=growthRes?.ok?await growthRes.json():null;if(!quoteData||quoteData.length===0){throw new Error('Stock not found - empty response');}const quote=quoteData[0];const quoteFetchedAt=Date.now();const metrics=metricsData&&metricsData.length>0?metricsData[0]:null;const scores=scoresData&&scoresData.length>0?scoresData[0]:null;const ratings=ratingsData&&ratingsData.length>0?ratingsData[0]:null;const target=targetData&&targetData.length>0?targetData[0]:null;const profile=profileData&&profileData.length>0?profileData[0]:null;const ratios=ratiosData&&ratiosData.length>0?ratiosData[0]:null;const toFiniteNumberOrNull=v=>{if(v===''||v===undefined||v===null)return null;const n=Number(v);return Number.isFinite(n)?n:null;};const pickFirstField=(obj,keys)=>{for(const key of keys){const n=toFiniteNumberOrNull(obj?.[key]);if(n!==null)return n;}return null;};const pickGrowthRecord=arr=>{if(!Array.isArray(arr)||arr.length===0)return null;const keys={revenue:['revenueGrowth','revenuegrowth','revenueGrowthYoY'],income:['netIncomeGrowth','netincomegrowth','netIncomeGrowthYoY'],eps:['epsGrowth','epsgrowth','epsGrowthYoY','epsgrowthYoY']};return arr.find(g=>pickFirstField(g,keys.revenue)!==null||pickFirstField(g,keys.income)!==null||pickFirstField(g,keys.eps)!==null)||arr[0];};const growth=pickGrowthRecord(growthData);const revenueGrowthRaw=pickFirstField(growth,['revenueGrowth','revenuegrowth','revenueGrowthYoY']);const netIncomeGrowthRaw=pickFirstField(growth,['netIncomeGrowth','netincomegrowth','netIncomeGrowthYoY']);const epsGrowthRaw=pickFirstField(growth,['epsGrowth','epsgrowth','epsGrowthYoY','epsgrowthYoY']);const revenueGrowthPct=revenueGrowthRaw!==null?revenueGrowthRaw*100:null;const netIncomeGrowthPct=netIncomeGrowthRaw!==null?netIncomeGrowthRaw*100:null;const epsGrowthPct=epsGrowthRaw!==null?epsGrowthRaw*100:null;await delay(50);const earningsRes=await fetch(`https://financialmodelingprep.com/api/v3/historical/earning_calendar/${symbol}?apikey=${FMP_API_KEY}`);const earnings=earningsRes.ok?await earningsRes.json():[];await delay(50);const peersRes=await fetch(`https://financialmodelingprep.com/api/v4/stock_peers?symbol=${symbol}&apikey=${FMP_API_KEY}`);const peersData=peersRes.ok?await peersRes.json():null;const peers=peersData&&peersData.length>0?peersData[0]?.peersList:[];await delay(50);let news=[];try{if(window.newsManager&&typeof window.newsManager.fetchNews==='function'){const nmArticles=await window.newsManager.fetchNews(symbol,10);news=(nmArticles||[]).map(a=>({title:a.title,url:a.url,site:a.source||a.site||'News',publishedDate:a.publishedAt||a.publishedDate||a.date,image:a.image}));}else{const newsRes=await fetch(`https://financialmodelingprep.com/api/v3/stock_news?tickers=${symbol}&limit=20&apikey=${FMP_API_KEY}`);if(newsRes.ok){let articles=await newsRes.json();const companyName=profile?.companyName?.toLowerCase()||'';news=articles.filter(article=>{if(!article.title)return false;const text=(article.title+' '+(article.text||'')).toLowerCase();const sym=symbol.toLowerCase();return text.includes(sym)||companyName&&text.includes(companyName);});const cutoff=Date.now()-30*24*60*60*1000;news=(news||[]).filter(a=>{const dt=new Date(a.publishedDate||a.date||0).getTime();return Number.isFinite(dt)&&dt>=cutoff;});if(news.length===0&&articles.length>0){console.warn(`No recent filtered news (30d) for ${symbol}, using general recent results`);news=(articles||[]).filter(a=>{const dt=new Date(a.publishedDate||a.date||0).getTime();return Number.isFinite(dt)&&dt>=cutoff;}).slice(0,10);}else{if(window.newsManager&&typeof window.newsManager.getAnalystUpdateScore==='function'){news.sort((a,b)=>{const scoreB=window.newsManager.getAnalystUpdateScore({title:b.title,description:b.text||b.content||''},symbol);const scoreA=window.newsManager.getAnalystUpdateScore({title:a.title,description:a.text||a.content||''},symbol);if(scoreB!==scoreA)return scoreB-scoreA;return new Date(b.publishedDate||b.date||0)-new Date(a.publishedDate||a.date||0);});}news=news.slice(0,10);}}}}catch(err){console.warn(`News fetch failed for ${symbol}:`,err);news=[];}console.log(`‚úÖ ${symbol}: Fetched 12 endpoints (${news.length} news articles)`);console.log(`   üìä Price Data for ${symbol}:`);console.log(`      Current: $${quote.price}`);console.log(`      Day High: $${quote.dayHigh||'MISSING'}`);console.log(`      Day Low: $${quote.dayLow||'MISSING'}`);console.log(`      Year High: $${quote.yearHigh||'MISSING'}`);console.log(`      Year Low: $${quote.yearLow||'MISSING'}`);console.log(`      Open: $${quote.open||'MISSING'}`);console.log(`      Prev Close: $${quote.previousClose||'MISSING'}`);console.log(`      Avg Volume: ${profile?.averageVolume||'MISSING'}`);const stockData={symbol:quote.symbol,companyName:profile?.companyName||quote.name||symbol,sector:profile?.sector||quote.sector||'Unknown',industry:profile?.industry||quote.industry||'Unknown',description:profile?.description||'',website:profile?.website||'',ceo:profile?.ceo||'',quoteFetchedAt,fetchedAt:Date.now(),price:quote.price,changePct:quote.changesPercentage||0,volume:quote.volume,avgVolume:profile?.averageVolume||0,marketCap:quote.marketCap,beta:profile?.beta||1.0,dayHigh:quote.dayHigh||0,dayLow:quote.dayLow||0,open:quote.open||0,previousClose:quote.previousClose||0,yearHigh:quote.yearHigh||0,yearLow:quote.yearLow||0,pe:metrics?.earningsYieldTTM?1/metrics.earningsYieldTTM:quote.pe||0,priceToBook:ratios?.priceToBookRatio||0,priceToSales:ratios?.priceToSalesRatio||0,enterpriseValue:metrics?.enterpriseValueTTM||0,evToEbitda:metrics?.evToEBITDATTM||0,roe:metrics?.returnOnEquityTTM?metrics.returnOnEquityTTM*100:0,roa:metrics?.returnOnAssetsTTM?metrics.returnOnAssetsTTM*100:0,roic:metrics?.returnOnInvestedCapitalTTM?metrics.returnOnInvestedCapitalTTM*100:0,grossMargin:ratios?.grossProfitMargin?ratios.grossProfitMargin*100:0,operatingMargin:ratios?.operatingProfitMargin?ratios.operatingProfitMargin*100:0,netMargin:ratios?.netProfitMargin?ratios.netProfitMargin*100:0,currentRatio:metrics?.currentRatioTTM||ratios?.currentRatio||0,quickRatio:metrics?.quickRatioTTM||ratios?.quickRatio||0,debtToEquity:ratios?.debtEquityRatio||metrics?.netDebtToEBITDATTM||0,debtToAssets:ratios?.debtRatio||0,cashRatio:ratios?.cashRatio||0,revenueGrowth:revenueGrowthPct,netIncomeGrowth:netIncomeGrowthPct,epsGrowth:epsGrowthPct,piotroskiScore:scores?.piotroskiScore||0,altmanZScore:scores?.altmanZScore||0,analystRating:ratings?.rating||'N/A',overallScore:ratings?.overallScore||0,priceTarget:target?.lastQuarterAvgPriceTarget||0,priceTargetLow:target?.lastMonthAvgPriceTarget||0,priceTargetAvg:target?.lastQuarterAvgPriceTarget||0,analystCount:target?.lastQuarterCount||0,upside:target?.lastQuarterAvgPriceTarget&&quote.price?(target.lastQuarterAvgPriceTarget-quote.price)/quote.price*100:0,latestGrade:grades&&grades.length>0?grades[0]:null,analystGradeHistory:grades.slice(0,10),lastEarnings:earnings&&earnings.length>0?earnings[0]:null,earningsHistory:earnings.slice(0,4),peers:peers||[],latestNews:news.slice(0,10),exchange:quote.exchange,index:'Search Result',rsi:50,sparkline:Array.from({length:20},()=>quote.price*(0.98+Math.random()*0.04))};try{const currentKey=Cache.key(symbol,'stock');const prevKey=Cache.key(symbol,'stock_prev');const existing=localStorage.getItem(currentKey);if(existing)localStorage.setItem(prevKey,existing);}catch(e){}Cache.set(symbol,stockData,'stock');return stockData;}catch(error){console.error(`Error fetching ${symbol}:`,error);throw error;}};const addToCurated=()=>{const symbol=newStockSymbol.trim().toUpperCase();if(!symbol)return;if(curatedStocks.includes(symbol)){addError('Stock already in list',`${symbol} is already in your curated list`);return;}const updated=[...new Set([...curatedStocks,symbol])];setCuratedStocks(updated);localStorage.setItem('curatedStocks',JSON.stringify(updated));setNewStockSymbol('');fetchStocks();};const removeFromCurated=symbol=>{const updated=curatedStocks.filter(s=>s!==symbol);setCuratedStocks(updated);localStorage.setItem('curatedStocks',JSON.stringify(updated));fetchStocks();};const fetchStocks=async()=>{if(window.isFetchingStocks){console.log('‚è≥ Fetch already in progress, skipping...');return;}window.isFetchingStocks=true;setLoading(true);setStocks([]);setLoadingProgress({current:0,total:curatedStocks.length});setErrors([]);const startTime=new Date();let forceComplete=false;let allStocksCollected=[];let finalCompletedCount=0;let stocksDisplayed=false;let progressCheckInterval=null;const globalTimeout=setTimeout(()=>{console.warn('‚è±Ô∏è Global timeout reached (3 minutes), forcing completion with available stocks...');forceComplete=true;},180000);try{console.log('üîÑ Loading',curatedStocks.length,'stocks with full data...');const cachedStocks=[];const uncachedSymbols=[];const uniqueCuratedStocks=[...new Set(curatedStocks.map(s=>String(s).toUpperCase().trim()).filter(s=>s))];uniqueCuratedStocks.forEach(symbol=>{const cached=Cache.get(symbol,'stock');if(cached){cachedStocks.push({symbol,data:cached});}else{uncachedSymbols.push(symbol);}});if(uniqueCuratedStocks.length!==curatedStocks.length){console.log(`üßπ Removed ${curatedStocks.length-uniqueCuratedStocks.length} duplicate symbols from curated list`);setCuratedStocks(uniqueCuratedStocks);localStorage.setItem('curatedStocks',JSON.stringify(uniqueCuratedStocks));}console.log(`‚ö° Found ${cachedStocks.length} cached stocks, ${uncachedSymbols.length} need fetching`);const allStocks=[];let completedCount=0;const updateStocksIncrementally=newStock=>{if(!newStock||!newStock.symbol)return;setStocks(prevStocks=>{const symbolUpper=(newStock.symbol||'').toUpperCase().trim();const existingIndex=prevStocks.findIndex(s=>(s.symbol||'').toUpperCase().trim()===symbolUpper);let updatedStocks;if(existingIndex>=0){updatedStocks=[...prevStocks];updatedStocks[existingIndex]=newStock;}else{updatedStocks=[...prevStocks,newStock];}updatedStocks.sort((a,b)=>(b.marketCap||0)-(a.marketCap||0));if(updatedStocks.length>=10){setTimeout(()=>{setLoading(prevLoading=>{if(prevLoading){console.log(`‚úÖ ${updatedStocks.length} stocks loaded - hiding loading spinner`);return false;}return prevLoading;});},0);}return updatedStocks;});};cachedStocks.forEach(_ref38=>{let{symbol,data:stockData}=_ref38;try{stockData.index='Curated';const ai=generateAIAnalysis(stockData);computeMLPrediction(symbol).then(mlPrediction=>{const stockIndex=allStocks.findIndex(s=>s.symbol===symbol);if(stockIndex>=0){allStocks[stockIndex].mlPrediction=mlPrediction;}}).catch(()=>{});const stockWithAnalysis={...stockData,...ai,aiScore:ai.aiScore,mlPrediction:{predPct:null,conf:null,trend:null},subscores:ai.subscores?{...ai.subscores}:null,topDrivers:ai.topDrivers?{positive:ai.topDrivers.positive?[...ai.topDrivers.positive]:[],negative:ai.topDrivers.negative?[...ai.topDrivers.negative]:[]}:null,bullFactors:ai.bullFactors?[...ai.bullFactors]:[],bearFactors:ai.bearFactors?[...ai.bearFactors]:[],latestNews:stockData.latestNews?[...stockData.latestNews]:[],peers:stockData.peers?[...stockData.peers]:[],earningsHistory:stockData.earningsHistory?[...stockData.earningsHistory]:[],analystGradeHistory:stockData.analystGradeHistory?[...stockData.analystGradeHistory]:[]};allStocks.push(stockWithAnalysis);updateStocksIncrementally(stockWithAnalysis);completedCount++;setLoadingProgress({current:completedCount,total:uniqueCuratedStocks.length});console.log(`‚ö° ${symbol} (cached): $${stockData.price} | P/E: ${stockData.pe.toFixed(1)} | ROE: ${stockData.roe.toFixed(1)}%`);}catch(err){console.error(`‚ùå ${symbol} (cached) processing failed:`,err);completedCount++;setLoadingProgress({current:completedCount,total:curatedStocks.length});}});if(uncachedSymbols.length>0){const withTimeout=(promise,timeoutMs,symbol)=>{let timeoutId;const timeoutPromise=new Promise((_,reject)=>{timeoutId=setTimeout(()=>{reject(new Error(`Timeout after ${timeoutMs}ms`));},timeoutMs);});return Promise.race([promise.finally(()=>{if(timeoutId)clearTimeout(timeoutId);}),timeoutPromise]).catch(err=>{if(timeoutId)clearTimeout(timeoutId);if(err.message.includes('Timeout')){console.warn(`‚è±Ô∏è ${symbol} timed out after ${timeoutMs}ms, skipping...`);}throw err;});};const fetchStock=async(symbol,index)=>{console.log(`üì° [${index+1}/${uncachedSymbols.length}] Fetching ${symbol}...`);try{const stockData=await withTimeout(fetchSingleStockData(symbol),30000,symbol);stockData.index='Curated';const ai=generateAIAnalysis(stockData);let mlPrediction={predPct:null,conf:null,trend:null};try{mlPrediction=await withTimeout(computeMLPrediction(symbol),10000,symbol);}catch(e){console.warn(`ML prediction failed for ${symbol}:`,e.message||e);}const stockWithAnalysis={...stockData,...ai,aiScore:ai.aiScore,mlPrediction,subscores:ai.subscores?{...ai.subscores}:null,topDrivers:ai.topDrivers?{positive:ai.topDrivers.positive?[...ai.topDrivers.positive]:[],negative:ai.topDrivers.negative?[...ai.topDrivers.negative]:[]}:null,bullFactors:ai.bullFactors?[...ai.bullFactors]:[],bearFactors:ai.bearFactors?[...ai.bearFactors]:[],latestNews:stockData.latestNews?[...stockData.latestNews]:[],peers:stockData.peers?[...stockData.peers]:[],earningsHistory:stockData.earningsHistory?[...stockData.earningsHistory]:[],analystGradeHistory:stockData.analystGradeHistory?[...stockData.analystGradeHistory]:[]};allStocks.push(stockWithAnalysis);updateStocksIncrementally(stockWithAnalysis);completedCount++;setLoadingProgress({current:completedCount,total:uniqueCuratedStocks.length});console.log(`‚úÖ ${symbol}: $${stockData.price} | P/E: ${stockData.pe.toFixed(1)} | ROE: ${stockData.roe.toFixed(1)}% | Rating: ${stockData.analystRating}`);return{success:true,symbol};}catch(err){const isExpectedFailure=err.message?.includes('not available')||err.message?.includes('No response')||err.message?.includes('invalid symbol');if(isExpectedFailure){console.warn(`‚ö†Ô∏è ${symbol}: ${err.message}`);}else{console.error(`‚ùå ${symbol} failed:`,err);}if(!isExpectedFailure){addError(`Failed to fetch ${symbol}`,err.message);}completedCount++;setLoadingProgress({current:completedCount,total:uniqueCuratedStocks.length});return{success:false,symbol,error:err.message};}};const BATCH_SIZE=5;const BATCH_DELAY=500;const MAX_BATCH_TIME=60000;for(let i=0;i<uncachedSymbols.length;i+=BATCH_SIZE){const batchSymbols=uncachedSymbols.slice(i,i+BATCH_SIZE);const batchNum=Math.floor(i/BATCH_SIZE)+1;const totalBatches=Math.ceil(uncachedSymbols.length/BATCH_SIZE);console.log(`‚ö° Processing batch ${batchNum}/${totalBatches} (${batchSymbols.length} stocks)...`);const batchPromises=batchSymbols.map((symbol,batchIdx)=>fetchStock(symbol,i+batchIdx+1));try{if(forceComplete){console.warn(`‚è±Ô∏è Force completion triggered, skipping remaining batches`);for(let j=0;j<batchSymbols.length&&completedCount<uniqueCuratedStocks.length;j++){completedCount++;setLoadingProgress({current:completedCount,total:uniqueCuratedStocks.length});}break;}const batchPromise=Promise.allSettled(batchPromises);const timeoutPromise=new Promise(resolve=>{setTimeout(()=>{console.warn(`‚è±Ô∏è Batch ${batchNum} exceeded maximum time (${MAX_BATCH_TIME}ms), forcing completion...`);resolve('timeout');},MAX_BATCH_TIME);});const raceResult=await Promise.race([batchPromise,timeoutPromise]);let results;if(raceResult==='timeout'){console.warn(`‚ö†Ô∏è Batch ${batchNum} timed out, marking remaining items as failed`);results=batchPromises.map((promise,idx)=>{return{status:'rejected',reason:new Error('Batch timeout'),symbol:batchSymbols[idx]};});for(let j=0;j<batchSymbols.length&&completedCount<uniqueCuratedStocks.length;j++){completedCount++;setLoadingProgress({current:completedCount,total:uniqueCuratedStocks.length});}}else{results=raceResult;}if(Array.isArray(results)){results.forEach((result,idx)=>{const symbol=batchSymbols[idx];if(result.status==='rejected'){console.warn(`‚ö†Ô∏è ${symbol} failed:`,result.reason?.message||result.reason);if(completedCount<uniqueCuratedStocks.length){completedCount++;setLoadingProgress({current:completedCount,total:uniqueCuratedStocks.length});}}else if(result.value&&!result.value.success){if(completedCount<uniqueCuratedStocks.length){completedCount++;setLoadingProgress({current:completedCount,total:uniqueCuratedStocks.length});}}});}}catch(batchError){console.error(`‚ùå Batch ${batchNum} error:`,batchError);for(let j=0;j<batchSymbols.length&&completedCount<uniqueCuratedStocks.length;j++){completedCount++;setLoadingProgress({current:completedCount,total:uniqueCuratedStocks.length});}}if(i+BATCH_SIZE<uncachedSymbols.length){await new Promise(r=>setTimeout(r,BATCH_DELAY));}}}allStocksCollected=allStocks;finalCompletedCount=completedCount;console.log('‚úÖ Total loaded:',allStocks.length,'of',curatedStocks.length,'stocks with full data');console.log('üìä Progress: completedCount =',completedCount,', curatedStocks.length =',curatedStocks.length);const seenSymbols=new Set();const uniqueStocks=allStocks.filter(stock=>{const symbol=(stock.symbol||'').toUpperCase().trim();if(!symbol||seenSymbols.has(symbol)){return false;}seenSymbols.add(symbol);return true;});if(uniqueStocks.length!==allStocks.length){console.log(`üßπ Removed ${allStocks.length-uniqueStocks.length} duplicate stocks`);}const remaining=uniqueCuratedStocks.length-completedCount;if(remaining>0){console.warn(`‚ö†Ô∏è ${remaining} stocks not completed, but proceeding with ${uniqueStocks.length} loaded stocks`);setLoadingProgress({current:uniqueCuratedStocks.length,total:uniqueCuratedStocks.length});}if(uniqueStocks.length>0){uniqueStocks.sort((a,b)=>(b.marketCap||0)-(a.marketCap||0));setStocks(uniqueStocks);setLastUpdateTime(startTime);console.log('‚úÖ Final sync: Stocks set:',uniqueStocks.length,'unique stocks displayed');console.log('üìä Sample stocks:',uniqueStocks.slice(0,5).map(s=>s.symbol).join(', '));if(uniqueStocks.length>0){setLoading(false);console.log('‚úÖ Loading stopped - stocks are now visible');}if(uniqueStocks.length<uniqueCuratedStocks.length){const missing=uniqueCuratedStocks.length-uniqueStocks.length;console.warn(`‚ö†Ô∏è Only ${uniqueStocks.length} of ${uniqueCuratedStocks.length} stocks loaded (${missing} failed or timed out)`);}}else{console.warn('‚ö†Ô∏è No stocks loaded, but completedCount =',completedCount);console.warn('‚ö†Ô∏è allStocks array length:',allStocks.length);if(completedCount>=uniqueCuratedStocks.length*0.9){console.error('‚ùå Most stocks processed but none added to allStocks array');console.error('‚ùå This suggests stocks are being fetched but not added to allStocks');}addError('No stocks loaded','Check your API key and curated stocks list');setStocks([]);}console.log('‚úÖ COMPLETE! Loading will be set to false in finally block');}catch(err){console.error('‚ùå Error:',err);addError('Failed to fetch stocks',err.message);if(allStocksCollected&&allStocksCollected.length>0){const seenSymbols=new Set();const uniqueStocks=allStocksCollected.filter(stock=>{const symbol=(stock.symbol||'').toUpperCase().trim();if(!symbol||seenSymbols.has(symbol))return false;seenSymbols.add(symbol);return true;});if(uniqueStocks.length>0){uniqueStocks.sort((a,b)=>(b.marketCap||0)-(a.marketCap||0));setStocks(uniqueStocks);console.log('‚úÖ Displayed',uniqueStocks.length,'stocks despite error');}}else{setStocks([]);}}finally{window.isFetchingStocks=false;clearTimeout(globalTimeout);if(progressCheckInterval)clearInterval(progressCheckInterval);setLoading(false);setLoadingProgress({current:uniqueCuratedStocks.length,total:uniqueCuratedStocks.length});setStocks(currentStocks=>{if(currentStocks.length===0&&allStocks.length>0){const seen=new Set();const unique=allStocks.filter(s=>{const sym=(s.symbol||'').toUpperCase();if(!sym||seen.has(sym))return false;seen.add(sym);return true;});unique.sort((a,b)=>(b.marketCap||0)-(a.marketCap||0));return unique;}return currentStocks;});console.log('üîÑ Loading complete - stocks should be visible');}};const manualRefresh=()=>{console.log('üîÑ Manual refresh triggered');fetchStocks();};const addLog=function(message){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'info';console.log(`[${type.toUpperCase()}] ${message}`);};const fetchScreenerResults=async()=>{setIsIncrementalLoading(true);setLoading(true);setShowStuckWarning(false);setErrors([]);const startTime=Date.now();const allSymbols=DEMO_STOCKS.map(stock=>stock.symbol).slice(0,300);const batchSize=3;const total=allSymbols.length;setPartialResults([]);setCompletedSymbols(new Set());setApiProgress({current:0,total});addLog(`üîÑ Starting incremental load of ${total} stocks...`,'info');for(let i=0;i<total;i+=batchSize){const batch=allSymbols.slice(i,i+batchSize);const batchResults=[];await Promise.all(batch.map(async symbol=>{try{await new Promise(r=>setTimeout(r,Math.random()*800));const data=await fetchSingleStockData(symbol);if(data){const ai=generateAIAnalysis(data);let mlPrediction={predPct:null,conf:null,trend:null};try{mlPrediction=await computeMLPrediction(symbol);}catch(e){console.warn(`ML prediction failed for ${symbol}:`,e);}const stockWithAnalysis={...data,...ai,aiScore:ai.aiScore,mlPrediction,index:'Screener'};batchResults.push(stockWithAnalysis);setCompletedSymbols(prev=>new Set(prev).add(symbol));}}catch(error){console.warn(`‚ö†Ô∏è Skipped ${symbol}: ${error.message}`);}finally{setApiProgress(prev=>({current:Math.min(prev.current+1,total),total}));}}));if(batchResults.length>0){setPartialResults(prev=>{const updated=[...prev];batchResults.forEach(newStock=>{const idx=updated.findIndex(s=>s.symbol===newStock.symbol);if(idx>=0){updated[idx]=newStock;}else{updated.push(newStock);}});updated.sort((a,b)=>(b.marketCap||0)-(a.marketCap||0));return updated;});setStocks(prev=>{const updated=[...prev];batchResults.forEach(newStock=>{const idx=updated.findIndex(s=>s.symbol===newStock.symbol);if(idx>=0){updated[idx]=newStock;}else{updated.push(newStock);}});updated.sort((a,b)=>(b.marketCap||0)-(a.marketCap||0));return updated;});addLog(`‚úÖ Batch ${Math.ceil(i/batchSize)+1}: ${batchResults.length} stocks loaded`,'success');}if(Date.now()-startTime>300000){addLog('‚è∞ Loading timeout reached - showing partial results','warning');setShowStuckWarning(true);break;}if(i+batchSize<total){await new Promise(resolve=>setTimeout(resolve,500));}}setIsIncrementalLoading(false);setLoading(false);setApiProgress({current:0,total:0});addLog(`‚úÖ Loading complete: ${partialResults.length} stocks displayed`,'success');};const resetAndLoad=()=>{setPartialResults([]);setCompletedSymbols(new Set());fetchScreenerResults();};const filtered=useMemo(()=>{let result=stocks;if(showWatchlistOnly){result=result.filter(s=>watchlist&&Array.isArray(watchlist)&&watchlist.some(w=>w&&w.toUpperCase()===s.symbol.toUpperCase()));}if(search){const lower=search.toLowerCase();result=result.filter(s=>s.symbol.toLowerCase().includes(lower)||(s.companyName||'').toLowerCase().includes(lower));}if(selectedSector){result=result.filter(s=>s.sector===selectedSector);}if(selectedPreset){const preset=PRESET_SCREENS[selectedPreset];if(preset){Object.entries(preset.filters).forEach(_ref39=>{let[key,val]=_ref39;if(key.endsWith('_min')){const field=key.replace('_min','');result=result.filter(s=>{const fieldValue=s[field];if(fieldValue===null||fieldValue===undefined)return false;return fieldValue>=val;});}else if(key.endsWith('_max')){const field=key.replace('_max','');result=result.filter(s=>{const fieldValue=s[field];if(fieldValue===null||fieldValue===undefined)return false;return fieldValue<=val;});}});}}Object.entries(filters).forEach(_ref40=>{let[key,val]=_ref40;if(val==='')return;const numVal=parseFloat(val);if(isNaN(numVal))return;if(key.endsWith('_min')){const field=key.replace('_min','');result=result.filter(s=>(s[field]||0)>=numVal);}else if(key.endsWith('_max')){const field=key.replace('_max','');result=result.filter(s=>(s[field]||0)<=numVal);}});result.sort((a,b)=>{const aVal=a[sortBy.key]||0;const bVal=b[sortBy.key]||0;return sortBy.dir==='asc'?aVal-bVal:bVal-aVal;});return result;},[stocks,search,selectedSector,selectedPreset,filters,sortBy,showWatchlistOnly,watchlist]);const sectorAverages=useMemo(()=>{const byS={};stocks.forEach(s=>{if(!s.sector)return;if(!byS[s.sector])byS[s.sector]={pe:[],roe:[]};if(s.pe)byS[s.sector].pe.push(s.pe);if(s.roe)byS[s.sector].roe.push(s.roe);});Object.keys(byS).forEach(sec=>{byS[sec]={pe:byS[sec].pe.reduce((a,b)=>a+b,0)/(byS[sec].pe.length||1),roe:byS[sec].roe.reduce((a,b)=>a+b,0)/(byS[sec].roe.length||1)};});return byS;},[stocks]);const toggleWatchlist=symbol=>{setWatchlist(prev=>{const cleaned=cleanSymbol(symbol);const headerWords=new Set(['SYMBOL','NAME','LAST','OPEN','HIGH','LOW','CHG','VOL','VOLUME','TIME','DATE','CLOSE','CHANGE','PRICE','CHANGE%','CHG.','VOL.','BUY','SELL','HOLD','RSI','MACD','EPS','REVENUE','DAILY','HOURLY','YTD','BETA','NEUTRAL','INC.','MONGODB','EARNINGS','PE','MARKET','CAP','SECTOR','INDUSTRY','DIVIDEND','YIELD','IEX']);if(!cleaned||cleaned.length===0||cleaned.length>10||!/^[A-Z]+$/.test(cleaned)||headerWords.has(cleaned)){console.warn(`‚ö†Ô∏è Invalid symbol ignored: ${symbol}`);return prev;}const isInWatchlist=prev.some(s=>s.toUpperCase()===cleaned.toUpperCase());const updated=isInWatchlist?prev.filter(s=>s.toUpperCase()!==cleaned.toUpperCase()):[...prev,cleaned];console.log(`üìã Watchlist ${isInWatchlist?'removed':'added'}: ${cleaned}. Current watchlist:`,updated);localStorage.setItem('watchlist',JSON.stringify(updated));return updated;});};const applyPreset=presetId=>{setSelectedPreset(presetId);const preset=PRESET_SCREENS[presetId];if(preset){setFilters(prev=>({...prev,...preset.filters}));}};const clearFilters=()=>{setFilters({pe_min:'',pe_max:'',roe_min:'',roe_max:'',marketCap_min:'',marketCap_max:'',changePct_min:'',changePct_max:'',rsi_min:'',rsi_max:''});setSelectedPreset('');setSelectedSector('');};const dismissToast=id=>{setToasts(prev=>prev.filter(t=>t.id!==id));};const dismissError=id=>{setErrors(prev=>prev.filter(e=>e.id!==id));};const computePortfolioRecs=()=>{const watchlistedStocks=stocks.filter(s=>watchlist&&Array.isArray(watchlist)&&watchlist.some(w=>w&&w.toUpperCase()===s.symbol.toUpperCase()));if(!watchlistedStocks.length)return[];const recs=watchlistedStocks.map(s=>({symbol:s.symbol,sector:s.sector,edgeScore:(s.aiScore||50)/100,riskScore:(s.subscores?.risk||50)/100}));const totalEdge=recs.reduce((sum,r)=>sum+r.edgeScore,0)||1;recs.forEach(r=>{r.suggestedWeight=r.edgeScore/totalEdge*100;});return recs.sort((a,b)=>b.suggestedWeight-a.suggestedWeight);};useEffect(()=>{if(showPortfolio){setPortfolioRecs(computePortfolioRecs());}},[showPortfolio]);useEffect(()=>{const handleConnectionChange=connected=>{console.log(`üì° WebSocket connection status: ${connected?'CONNECTED':'DISCONNECTED'}`);setIsWebSocketConnected(connected);};realtimeData.onConnectionChange(handleConnectionChange);realtimeData.connect();setIsWebSocketConnected(realtimeData.isConnected);return()=>{console.log('üßπ Cleaning up real-time data subscriptions...');realtimeData.disconnect();smartPoller.stopAll();};},[]);useEffect(()=>{if(watchlist.length===0)return;const updateCallbacks=new Map();watchlist.forEach(symbol=>{const callback=update=>{setStocks(prevStocks=>{const index=prevStocks.findIndex(s=>s.symbol===symbol);if(index!==-1){const updated=[...prevStocks];updated[index]={...updated[index],price:update.price,change:update.change,changePct:update.changesPercentage||update.change,volume:update.volume,quoteFetchedAt:update.quoteFetchedAt};return updated;}return prevStocks;});};updateCallbacks.set(symbol,callback);if(isWebSocketConnected){realtimeData.subscribe(symbol,callback);}else{smartPoller.startPolling(symbol,callback);}});return()=>{watchlist.forEach(symbol=>{const callback=updateCallbacks.get(symbol);if(callback){realtimeData.unsubscribe(symbol,callback);smartPoller.stopPolling(symbol);}});};},[watchlist,isWebSocketConnected]);useEffect(()=>{if(!stocks||stocks.length===0)return;if(!realtimeData||!smartPoller)return;const symbols=stocks.map(s=>s.symbol).slice(0,50);const subscriptions=new Set();symbols.forEach(symbol=>{if(heatmapSubscriptions.has(symbol))return;const handleUpdate=update=>{setHeatmapData(prev=>{const index=prev.findIndex(s=>s.symbol===update.symbol);if(index===-1)return prev;const newData=[...prev];newData[index]={...newData[index],price:update.price,changePct:update.changesPercentage||(update.change&&update.price?update.change/update.price*100:0),volume:update.volume,lastUpdate:Date.now()};return newData;});};if(realtimeData.isConnected){realtimeData.subscribe(symbol,handleUpdate);}else{smartPoller.startPolling(symbol,handleUpdate);}subscriptions.add(symbol);setHeatmapSubscriptions(prev=>new Set(prev).add(symbol));});return()=>{subscriptions.forEach(symbol=>{if(realtimeData)realtimeData.unsubscribe(symbol,()=>{});if(smartPoller)smartPoller.stopPolling(symbol);});};},[stocks,isWebSocketConnected]);const exportTableCSV=()=>{const data=filtered.map(stock=>{const row={};ALL_COLUMNS.forEach(col=>{if(visibleColumns.includes(col.key)){row[col.label]=stock[col.key]||'‚Äî';}});return row;});exportToCSV(data,'stocks.csv');};const openComparison=function(){let symbols=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];setComparisonSymbols(symbols);setShowComparison(true);};const connectionLabel=isWebSocketConnected?'LIVE':lastUpdateTime?'POLLING':'CONNECTING';const showOfflineStyle=!isWebSocketConnected&&!lastUpdateTime;const connectionTitle=isWebSocketConnected?'Real-time updates via Finnhub WebSocket':lastUpdateTime?'Updates running via smart polling':'Initializing data connection...';return React.createElement(React.Fragment,null,tournamentRunning&&React.createElement("div",{className:"tournament-live-indicator"},React.createElement("div",{className:"live-dot"}),React.createElement("span",{className:"text-green-400 text-sm font-semibold"},"TOURNAMENT RUNNING"),React.createElement("button",{onClick:()=>setShowAITournament(true),className:"ml-2 px-2 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-500"},"View")),React.createElement("div",{className:"min-h-screen p-6"},errors.length>0&&React.createElement("div",{className:"mb-6 space-y-2"},errors.map(error=>React.createElement("div",{key:error.id,className:"glass p-4 rounded-xl border border-red-500/20 bg-red-500/10"},React.createElement("div",{className:"flex items-start justify-between"},React.createElement("div",{className:"flex-1"},React.createElement("div",{className:"flex items-center gap-2 text-red-400 font-semibold"},React.createElement("i",{className:"fas fa-exclamation-triangle"}),React.createElement("span",null,error.message)),error.details&&React.createElement("div",{className:"text-sm text-slate-300 mt-1"},error.details),React.createElement("div",{className:"text-xs text-slate-500 mt-2"},new Date(error.timestamp).toLocaleTimeString())),React.createElement("button",{onClick:()=>dismissError(error.id),className:"text-slate-400 hover:text-white ml-4"},"\u2715"))))),watchlist.length>0&&React.createElement(LivePriceTicker,{stocks:stocks,watchlist:watchlist,isConnected:isWebSocketConnected}),React.createElement("header",{className:"glass rounded-2xl p-6 mb-6 animate-slide-up"},React.createElement("div",{className:"flex items-center justify-between mb-3"},React.createElement("div",null,React.createElement("h1",{className:"text-3xl font-bold text-white mb-1"},"RetailEdge Pro ",React.createElement("span",{className:"text-xs text-slate-500 font-normal ml-2"},"v2.0")),React.createElement("p",{className:"text-sm text-slate-400"},"Portfolio Tracking \u2022 Alerts \u2022 Sector-Aware AI")),React.createElement("div",{className:"flex items-center gap-3"},!authLoading&&React.createElement("div",{className:"flex items-center gap-2"},firebaseUser?React.createElement(React.Fragment,null,React.createElement("span",{className:"text-xs text-slate-400"},React.createElement("i",{className:"fas fa-user-circle mr-1"}),firebaseUser.email),React.createElement("button",{onClick:signOutUser,className:"px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm flex items-center gap-2 transition",title:"Sign out"},React.createElement("i",{className:"fas fa-sign-out-alt"}),"Sign Out")):React.createElement("button",{onClick:signInWithGoogle,className:"px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm flex items-center gap-2 transition",title:"Sign in with Google to sync across devices"},React.createElement("i",{className:"fab fa-google"}),"Sign In")))),React.createElement("div",{className:"flex items-center gap-3 flex-wrap mb-4 text-xs"},React.createElement("div",{className:`live-indicator ${showOfflineStyle?'offline':''}`,title:connectionTitle},React.createElement("div",{className:"live-dot"}),React.createElement("span",null,connectionLabel)),lastUpdateTime&&React.createElement(React.Fragment,null,React.createElement("span",{className:"text-slate-600"},"\u2022"),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:"text-slate-500"},"Updated: ",lastUpdateTime.toLocaleTimeString())),nextUpdateTime&&React.createElement(React.Fragment,null,React.createElement("span",{className:"text-slate-600"},"\u2022"),React.createElement("span",{className:"text-slate-500"},"Next: ",nextUpdateTime.toLocaleTimeString())),React.createElement("span",{className:"text-slate-600"},"\u2022"),React.createElement("span",{className:"text-emerald-400",title:`${Cache.stats().count} stocks cached, ${Cache.stats().sizeKB}KB used. ${Cache.isMarketOpen()?'Market is OPEN - cache expires faster':'Market CLOSED - using 24hr cache'}`},React.createElement("i",{className:"fas fa-database mr-1"}),Cache.stats().count," cached"),Cache.isMarketOpen()&&React.createElement(React.Fragment,null,React.createElement("span",{className:"text-slate-600"},"\u2022"),React.createElement("span",{className:"text-green-400"},React.createElement("i",{className:"fas fa-circle text-xs mr-1 animate-pulse"}),"Market Open")),React.createElement("span",{className:"text-slate-600"},"\u2022"),React.createElement(DelayBadge,null))),React.createElement("div",{className:"flex items-center gap-3 flex-wrap"},React.createElement("button",{onClick:manualRefresh,disabled:loading,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-800 disabled:cursor-not-allowed text-white rounded-lg font-semibold text-sm flex items-center gap-2 transition",title:"Refresh stock data now"},loading?React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-spinner animate-spin"}),"Refreshing..."):React.createElement(React.Fragment,null,React.createElement("i",{className:"fas fa-sync-alt"}),"Refresh")),React.createElement("button",{onClick:()=>{Cache.clear();manualRefresh();},disabled:loading,className:"px-4 py-2 bg-orange-600 hover:bg-orange-500 disabled:bg-orange-800 disabled:cursor-not-allowed text-white rounded-lg font-semibold text-sm flex items-center gap-2 transition",title:`Clear cache (${Cache.stats().count} items, ${Cache.stats().sizeKB}KB)`},React.createElement("i",{className:"fas fa-trash"}),"Clear Cache"),React.createElement("button",{onClick:()=>setShowWatchlistOnly(prev=>!prev),className:`px-4 py-2 ${showWatchlistOnly?'bg-emerald-600 hover:bg-emerald-500':'bg-slate-700 hover:bg-slate-600'} text-white rounded-lg font-semibold text-sm flex items-center gap-2 transition`,title:"Toggle watchlist-only view"},React.createElement("i",{className:`fas fa-${showWatchlistOnly?'check-circle':'star'}`}),"Watchlist (",watchlist.length,")"),React.createElement("button",{onClick:()=>setShowComparison([]),className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-balance-scale"}),"Compare"),React.createElement("button",{onClick:()=>setShowHeatmap(true),className:"px-4 py-2 bg-pink-600 hover:bg-pink-500 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-th"}),"Heatmap"),React.createElement("button",{onClick:()=>setShowStockManager(true),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-edit"}),"Stocks (",curatedStocks.length,")"),React.createElement("button",{onClick:()=>setShowWatchlistImporter(true),className:"px-4 py-2 bg-teal-600 hover:bg-teal-500 text-white rounded-lg font-semibold text-sm flex items-center gap-2",title:"Import watchlist from text, CSV, or JSON"},React.createElement("i",{className:"fas fa-file-import"}),"Import"),React.createElement("button",{onClick:()=>setShowAlerts(true),className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-bell"}),"Alerts (",alerts.filter(a=>a.active).length,")"),React.createElement("button",{onClick:()=>setShowPortfolio(true),className:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-chart-line"}),"Portfolio (",window.portfolioManager?.holdings?.length||0,")"),React.createElement("button",{onClick:()=>setShowPortfolioAllocation(true),className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-chart-pie"}),"Allocation (",watchlist.length,")"),React.createElement("button",{onClick:()=>setShowEducation(true),className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-graduation-cap"}),"Learn"),React.createElement("button",{onClick:()=>setShowAITournament(true),className:"px-4 py-2 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-trophy"}),"AI Tournament"),React.createElement("button",{onClick:()=>setShowNotifications(true),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm relative"},React.createElement("i",{className:"fas fa-bell"}),notificationCount>0&&React.createElement("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full min-w-[20px] text-center"},notificationCount)),React.createElement("button",{onClick:()=>setShowSettings(true),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm"},React.createElement("i",{className:"fas fa-cog"})),React.createElement("button",{onClick:()=>{const shortcuts=window.keyboardShortcuts?.getHelp()||[];const helpText=shortcuts.length>0?'‚å®Ô∏è KEYBOARD SHORTCUTS:\n\n'+shortcuts.map(s=>`${s.key.padEnd(15)} ${s.description}`).join('\n'):'No shortcuts registered yet';alert(helpText);},className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm flex items-center gap-2",title:"Keyboard shortcuts"},React.createElement("i",{className:"fas fa-keyboard"})))),React.createElement("div",{className:"mb-6"},React.createElement("div",{className:"flex items-center gap-2 border-b border-slate-700"},React.createElement("button",{onClick:()=>setActiveMainTab('screener'),className:`px-4 py-3 font-semibold transition flex items-center gap-2 ${activeMainTab==='screener'?'text-cyan-400 border-b-2 border-cyan-400':'text-slate-400 hover:text-white'}`},React.createElement("i",{className:"fas fa-chart-line"}),"Stock Screener"),React.createElement("button",{onClick:()=>setActiveMainTab('leaderboard'),className:`px-4 py-3 font-semibold transition flex items-center gap-2 ${activeMainTab==='leaderboard'?'text-purple-400 border-b-2 border-purple-400':'text-slate-400 hover:text-white'}`},React.createElement("i",{className:"fas fa-trophy"}),"AI Tournament Leaderboard"),React.createElement("button",{onClick:()=>setActiveMainTab('portfolio'),className:`px-4 py-3 font-semibold transition flex items-center gap-2 ${activeMainTab==='portfolio'?'text-emerald-400 border-b-2 border-emerald-400':'text-slate-400 hover:text-white'}`},React.createElement("i",{className:"fas fa-briefcase"}),"Portfolio"))),activeMainTab==='screener'&&React.createElement(React.Fragment,null,React.createElement("div",{className:"glass rounded-2xl p-6 mb-6 space-y-4 animate-slide-up"},React.createElement("div",{className:"flex gap-3"},React.createElement("button",{onClick:()=>setShowWatchlistOnly(!showWatchlistOnly),className:`px-4 py-2.5 rounded-lg font-semibold text-sm flex items-center gap-2 transition ${showWatchlistOnly?'bg-gradient-to-r from-yellow-600 to-orange-600 text-white':'bg-slate-700 hover:bg-slate-600 text-white'}`,title:showWatchlistOnly?`Showing ${watchlist.length} watchlist stocks`:'Show watchlist only'},React.createElement("i",{className:"fas fa-star"}),showWatchlistOnly?`Watchlist (${watchlist.length})`:'All Stocks'),React.createElement("div",{className:"flex-1 relative"},React.createElement("input",{type:"text",id:"stock-search",name:"stock-search",value:search,onChange:e=>setSearch(e.target.value),onKeyDown:async e=>{if(e.key==='Enter'&&search.trim()){e.preventDefault();let symbol=search.trim().toUpperCase();const nameToTicker={'NVIDIA':'NVDA','APPLE':'AAPL','MICROSOFT':'MSFT','AMAZON':'AMZN','GOOGLE':'GOOGL','TESLA':'TSLA','META':'META','FACEBOOK':'META','NETFLIX':'NFLX','GAMESTOP':'GME','COINBASE':'COIN','PALANTIR':'PLTR','WALMART':'WMT','DISNEY':'DIS','MCDONALDS':'MCD','STARBUCKS':'SBUX','INTEL':'INTC','AMD':'AMD','BOEING':'BA','FORD':'F','GM':'GM','GENERAL MOTORS':'GM'};if(nameToTicker[symbol]){symbol=nameToTicker[symbol];console.log(`üìù Converted "${search.trim()}" to ${symbol}`);}const exists=stocks.find(s=>s.symbol===symbol);if(exists){console.log('‚úÖ Stock already loaded:',symbol);setSearch('');return;}try{console.log('üîç Fetching comprehensive data for:',symbol);const stockData=await fetchSingleStockData(symbol);const ai=generateAIAnalysis(stockData);let mlPrediction={predPct:null,conf:null,trend:null};try{mlPrediction=await computeMLPrediction(symbol);}catch(e){console.warn(`ML prediction failed for ${symbol}:`,e);}const finalStock={...stockData,...ai,aiScore:ai.aiScore,mlPrediction,subscores:ai.subscores?{...ai.subscores}:null,topDrivers:ai.topDrivers?{positive:[...(ai.topDrivers.positive||[])],negative:[...(ai.topDrivers.negative||[])]}:null,bullFactors:[...(ai.bullFactors||[])],bearFactors:[...(ai.bearFactors||[])],latestNews:stockData.latestNews?[...stockData.latestNews]:[],peers:stockData.peers?[...stockData.peers]:[],earningsHistory:stockData.earningsHistory?[...stockData.earningsHistory]:[],analystGradeHistory:stockData.analystGradeHistory?[...stockData.analystGradeHistory]:[]};setStocks(prev=>{const symbolUpper=symbol.toUpperCase().trim();const exists=prev.some(s=>(s.symbol||'').toUpperCase().trim()===symbolUpper);if(exists){console.log(`‚ö†Ô∏è Stock ${symbol} already exists, replacing...`);return prev.map(s=>(s.symbol||'').toUpperCase().trim()===symbolUpper?finalStock:s);}return[finalStock,...prev];});setSearch('');if(!curatedStocks.includes(symbol)){const updated=[...new Set([...curatedStocks,symbol])];setCuratedStocks(updated);localStorage.setItem('curatedStocks',JSON.stringify(updated));console.log('üíæ Added to curated list:',symbol);}console.log('‚úÖ Added:',symbol,'-',finalStock.companyName);}catch(err){console.error('Search error:',err);addError(`Failed to fetch ${symbol}`,err.message||'Stock not found.');}}},placeholder:"Type ticker or company name & press Enter (e.g., NVDA or Nvidia)...",className:"w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500"}),React.createElement("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-slate-500 pointer-events-none"},"\u21B5 Enter")),React.createElement("select",{value:selectedSector,onChange:e=>setSelectedSector(e.target.value),className:"px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-cyan-500"},React.createElement("option",{value:""},"All Sectors"),SECTORS.map(s=>React.createElement("option",{key:s,value:s},s))),React.createElement("button",{onClick:clearFilters,className:"px-4 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm"},"Clear")),React.createElement("div",{className:"grid grid-cols-5 gap-3"},Object.entries(PRESET_SCREENS).map(_ref41=>{let[key,preset]=_ref41;return React.createElement("div",{key:key,onClick:()=>applyPreset(key),className:`preset-card ${selectedPreset===key?'active':''}`},React.createElement("div",{className:"font-semibold text-white text-sm"},preset.name),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"Click to apply"));})),React.createElement("details",{className:"text-sm"},React.createElement("summary",{className:"cursor-pointer text-slate-400 hover:text-white"},"Advanced Filters"),React.createElement("div",{className:"grid grid-cols-4 gap-4 mt-3"},[{label:'P/E',min:'pe_min',max:'pe_max'},{label:'ROE %',min:'roe_min',max:'roe_max'},{label:'Market Cap',min:'marketCap_min',max:'marketCap_max'},{label:'Change %',min:'changePct_min',max:'changePct_max'},{label:'RSI',min:'rsi_min',max:'rsi_max'}].map(f=>React.createElement("div",{key:f.label},React.createElement("label",{className:"text-xs text-slate-500 mb-1 block"},f.label),React.createElement("div",{className:"flex gap-2"},React.createElement("input",{type:"number",id:`filter-min-${f.key}`,name:`filter-min-${f.key}`,value:filters[f.min],onChange:e=>setFilters(prev=>({...prev,[f.min]:e.target.value})),placeholder:"Min",className:"w-1/2 px-2 py-1.5 bg-slate-800/50 border border-slate-700 rounded text-white text-xs focus:outline-none focus:border-cyan-500"}),React.createElement("input",{type:"number",id:`filter-max-${f.key}`,name:`filter-max-${f.key}`,value:filters[f.max],onChange:e=>setFilters(prev=>({...prev,[f.max]:e.target.value})),placeholder:"Max",className:"w-1/2 px-2 py-1.5 bg-slate-800/50 border border-slate-700 rounded text-white text-xs focus:outline-none focus:border-cyan-500"}))))))),showHeatmap&&React.createElement("div",{className:"glass rounded-2xl p-6 mb-6 animate-slide-up"},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("h3",{className:"text-lg font-bold text-white flex items-center gap-2"},React.createElement("i",{className:"fas fa-th text-pink-400"}),"Sector Rotation Heatmap"),React.createElement("button",{onClick:()=>setShowHeatmap(false),className:"text-slate-400 hover:text-white"},React.createElement("i",{className:"fas fa-times"}))),(()=>{const displayStocks=filtered||stocks;if(!displayStocks||displayStocks.length===0){return React.createElement("div",{className:"text-center py-8"},React.createElement("i",{className:"fas fa-exclamation-circle text-4xl text-slate-500 mb-3"}),React.createElement("p",{className:"text-slate-400"},"No stock data available for heatmap"),React.createElement("p",{className:"text-slate-500 text-sm mt-2"},"Try refreshing the data or adjusting filters"));}const sectorGroups={};displayStocks.forEach(stock=>{const sector=stock.sector||'Unknown';if(!sectorGroups[sector])sectorGroups[sector]=[];sectorGroups[sector].push(stock);});const sectorPerf=Object.entries(sectorGroups).map(_ref42=>{let[sector,items]=_ref42;const avgChange=items.reduce((sum,s)=>sum+parseFloat(s.changePct||0),0)/items.length;return{sector,items,avgChange};}).sort((a,b)=>b.avgChange-a.avgChange);return React.createElement("div",{className:"space-y-4"},React.createElement("div",{className:"text-center mb-4"},React.createElement("p",{className:"text-slate-400 text-sm"},"Showing ",displayStocks.length," stocks across ",sectorPerf.length," sectors")),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},sectorPerf.map(_ref43=>{let{sector,items,avgChange}=_ref43;return React.createElement("div",{key:sector,className:"bg-slate-800/50 rounded-xl p-3 border border-slate-700/50"},React.createElement("div",{className:"flex justify-between items-center mb-2 pb-2 border-b border-slate-700/30"},React.createElement("span",{className:"font-bold text-slate-200 text-sm truncate",title:sector},sector),React.createElement("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${avgChange>=0?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},avgChange>0?'+':'',avgChange.toFixed(2),"%")),React.createElement("div",{className:"grid grid-cols-3 gap-1"},items.sort((a,b)=>Math.abs(parseFloat(b.changePct||0))-Math.abs(parseFloat(a.changePct||0))).slice(0,9).map(stock=>{const pct=parseFloat(stock.changePct||0);return React.createElement("div",{key:stock.symbol,onClick:()=>{setSelectedStock(stock);setShowHeatmap(false);},className:`aspect-square rounded flex flex-col items-center justify-center cursor-pointer hover:opacity-80 hover:scale-105 transition-all p-1 ${pct>=3?'bg-green-500':pct>=1?'bg-green-600/80':pct>=0?'bg-green-800/60':pct>=-1?'bg-red-800/60':pct>=-3?'bg-red-600/80':'bg-red-500'}`,title:`${stock.symbol}: ${pct.toFixed(2)}%`},React.createElement("span",{className:"text-[10px] font-bold text-white leading-none"},stock.symbol),React.createElement("span",{className:"text-[9px] text-white/90 leading-none mt-0.5"},Math.abs(pct).toFixed(1),"%"));})),items.length>9&&React.createElement("div",{className:"text-[10px] text-slate-500 text-center mt-2"},"+ ",items.length-9," more"));})),React.createElement("div",{className:"flex justify-center gap-4 text-xs text-slate-400"},React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-3 h-3 bg-green-500 rounded"})," > +3%"),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-3 h-3 bg-green-600/80 rounded"})," +1% to +3%"),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-3 h-3 bg-green-800/60 rounded"})," 0% to +1%"),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-3 h-3 bg-red-800/60 rounded"})," -1% to 0%"),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-3 h-3 bg-red-600/80 rounded"})," -3% to -1%"),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("div",{className:"w-3 h-3 bg-red-500 rounded"})," < -3%")));})()),React.createElement("main",{className:"animate-slide-up"},loading?React.createElement("div",{className:"glass rounded-xl p-12 text-center"},React.createElement("i",{className:"fas fa-spinner animate-spin text-4xl text-cyan-400 mb-4"}),React.createElement("p",{className:"text-lg text-slate-300"},"Loading stocks..."),React.createElement("p",{className:"text-sm text-slate-500 mt-2"},loadingProgress.current>0?`Loaded ${loadingProgress.current} of ${loadingProgress.total} stocks`:`Fetching data from ${curatedStocks.length} stocks`),loadingProgress.total>0&&React.createElement("div",{className:"mt-4 w-full max-w-md mx-auto"},React.createElement("div",{className:"w-full bg-slate-700/50 rounded-full h-2 overflow-hidden"},React.createElement("div",{className:"bg-gradient-to-r from-cyan-500 to-blue-500 h-full transition-all duration-300",style:{width:`${loadingProgress.current/loadingProgress.total*100}%`}})),React.createElement("div",{className:"text-xs text-slate-400 mt-2"},Math.round(loadingProgress.current/loadingProgress.total*100),"% Complete"))):React.createElement(React.Fragment,null,isIncrementalLoading&&React.createElement(LoadingProgressBar,{current:completedSymbols.size,total:apiProgress.total}),isIncrementalLoading&&partialResults.length>0&&React.createElement("div",{className:"mb-4 p-3 bg-cyan-500/10 border border-cyan-500/20 rounded-lg flex items-center justify-between"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("i",{className:"fas fa-spinner animate-spin text-cyan-400"}),React.createElement("div",null,React.createElement("span",{className:"text-cyan-300 font-semibold"},"Loading stocks: ",completedSymbols.size," / ",apiProgress.total),React.createElement("div",{className:"text-xs text-slate-400 mt-1"},"Showing ",partialResults.length," loaded stocks..."))),React.createElement("button",{onClick:()=>{setIsIncrementalLoading(false);setLoading(false);setApiProgress({current:0,total:0});},className:"text-xs text-slate-400 hover:text-white"},"Stop Loading")),partialResults.length>0&&React.createElement("div",{className:"glass-card rounded-2xl overflow-hidden"},React.createElement("table",{className:"w-full stock-table"},React.createElement("thead",null,React.createElement("tr",{className:"text-left text-xs text-slate-400 uppercase tracking-wide"},React.createElement("th",{className:"p-3"},"Symbol"),React.createElement("th",{className:"p-3"},"Price"),React.createElement("th",{className:"p-3"},"Change"),React.createElement("th",{className:"p-3"},"Volume"),React.createElement("th",{className:"p-3"},"P/E"),React.createElement("th",{className:"p-3"},"ROE"),React.createElement("th",{className:"p-3"},"Growth"))),React.createElement("tbody",null,partialResults.map(stock=>React.createElement("tr",{key:stock.symbol,className:"table-row border-b border-slate-700/30 hover:bg-slate-700/20",onClick:()=>openStockModal(stock)},React.createElement("td",{className:"p-3 font-bold text-white"},stock.symbol),React.createElement("td",{className:"p-3 text-white"},"$",stock.price?.toFixed(2)),React.createElement("td",{className:`p-3 font-semibold ${getSentimentColor(stock.changePct)}`},formatPercent(stock.changePct)),React.createElement("td",{className:"p-3 text-slate-300"},formatNumber(stock.volume)),React.createElement("td",{className:"p-3 text-slate-300"},stock.pe?.toFixed(1)||'‚Äî'),React.createElement("td",{className:"p-3 text-slate-300"},stock.roe?.toFixed(1)||'‚Äî',"%"),React.createElement("td",{className:"p-3 text-slate-300"},stock.revenueGrowth?.toFixed(1)||'‚Äî',"%")))))),!isIncrementalLoading&&partialResults.length===0&&!loading&&React.createElement("div",{className:"text-center py-20"},React.createElement("i",{className:"fas fa-chart-line text-6xl text-slate-700 mb-4"}),React.createElement("p",{className:"text-slate-400 text-lg"},"No stocks loaded yet"),React.createElement("button",{onClick:fetchScreenerResults,className:"mt-4 px-6 py-3 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-semibold"},"Load Stocks")),filtered.length>0&&!isIncrementalLoading?React.createElement(React.Fragment,null,React.createElement("div",{className:"flex justify-between items-center mb-4"},React.createElement("div",{className:"text-sm text-slate-400"},"Showing ",filtered.length," of ",stocks.length," stocks"),React.createElement("div",{className:"flex gap-3"},React.createElement("button",{onClick:()=>openComparison(filtered.slice(0,3).map(s=>s.symbol)),className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-balance-scale"}),"Compare Top 3"),React.createElement("button",{onClick:exportTableCSV,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold text-sm flex items-center gap-2"},React.createElement("i",{className:"fas fa-file-export"}),"Export CSV"))),React.createElement("div",{className:"glass rounded-xl overflow-hidden"},React.createElement("div",{className:"overflow-x-auto"},React.createElement("table",{className:"w-full text-sm"},React.createElement("thead",null,React.createElement("tr",{className:"bg-slate-800/50 text-slate-400"},ALL_COLUMNS.filter(c=>visibleColumns.includes(c.key)).map(col=>{const glossaryEntry=FINANCIAL_GLOSSARY[col.key];const isWatchlistColumn=col.key==='watchlist';return React.createElement("th",{key:col.key,onClick:isWatchlistColumn?undefined:()=>setSortBy({key:col.key,dir:sortBy.key===col.key&&sortBy.dir==='asc'?'desc':'asc'}),className:`text-left p-4 ${isWatchlistColumn?'cursor-default':'cursor-pointer hover:text-white'} transition relative group`,title:col.tooltip||(isWatchlistColumn?'Click star icon in rows to add/remove from watchlist':'')},React.createElement("div",{className:"flex items-center gap-2"},col.label,glossaryEntry&&React.createElement("div",{className:"relative inline-block"},React.createElement("i",{className:"fas fa-info-circle text-xs text-slate-500 group-hover:text-cyan-400 transition"}),React.createElement("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 w-64 p-3 bg-slate-900 border border-cyan-500/30 rounded-lg shadow-2xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none"},React.createElement("div",{className:"text-xs text-slate-200 leading-relaxed text-left",dangerouslySetInnerHTML:{__html:glossaryEntry}}),React.createElement("div",{className:"absolute left-1/2 -translate-x-1/2 top-full w-0 h-0 border-l-8 border-l-transparent border-r-8 border-r-transparent border-t-8 border-t-slate-900"}))),!isWatchlistColumn&&sortBy.key===col.key&&React.createElement("span",null,sortBy.dir==='asc'?'‚Üë':'‚Üì')));}))),React.createElement("tbody",null,filtered.map(stock=>React.createElement("tr",{key:stock.symbol,className:"table-row border-t border-slate-700/20",onClick:()=>openStockModal(stock)},visibleColumns.includes('watchlist')&&React.createElement("td",{className:"p-4",onClick:e=>e.stopPropagation()},React.createElement("button",{onClick:e=>{e.stopPropagation();toggleWatchlist(stock.symbol);},className:`px-3 py-1.5 rounded-lg text-sm font-semibold transition-all transform hover:scale-110 ${watchlist&&Array.isArray(watchlist)&&watchlist.some(w=>w&&w.toUpperCase()===stock.symbol.toUpperCase())?'bg-yellow-500/20 text-yellow-400 hover:bg-yellow-500/30 border border-yellow-500/30':'bg-slate-700/50 text-slate-400 hover:bg-slate-600 hover:text-slate-300 border border-slate-600/30'}`,title:watchlist&&Array.isArray(watchlist)&&watchlist.some(w=>w&&w.toUpperCase()===stock.symbol.toUpperCase())?'Remove from watchlist':'Add to watchlist'},React.createElement("i",{className:`fas fa-star${watchlist&&Array.isArray(watchlist)&&watchlist.some(w=>w&&w.toUpperCase()===stock.symbol.toUpperCase())?'':'-o'}`}))),visibleColumns.includes('symbol')&&React.createElement("td",{className:"p-4"},React.createElement("div",{className:"font-semibold text-cyan-300"},stock.symbol),React.createElement("div",{className:"text-xs text-slate-500"},stock.companyName),React.createElement("div",{className:"mt-1 flex items-center gap-2"},React.createElement("span",{className:"text-[11px] text-slate-500",title:stock.quoteFetchedAt||stock.fetchedAt?`Updated: ${new Date(stock.quoteFetchedAt||stock.fetchedAt).toLocaleString()}`:'Updated: ‚Äî'},"Updated ",stock.quoteFetchedAt||stock.fetchedAt?formatTimeAgo(stock.quoteFetchedAt||stock.fetchedAt):'‚Äî'),isStaleTimestamp(stock.quoteFetchedAt||stock.fetchedAt,'quote')&&React.createElement("span",{className:"text-[10px] font-semibold px-2 py-0.5 rounded-full bg-red-500/15 text-red-300 border border-red-500/20"},"STALE"))),visibleColumns.includes('smartInsight')&&React.createElement("td",{className:"p-4"},(()=>{const insight=getSmartInsight(stock);return React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:"text-lg"},insight.icon),React.createElement("span",{className:`text-xs font-medium ${insight.color} bg-slate-800/50 px-2 py-1 rounded-full border border-slate-700/50`},insight.text));})()),visibleColumns.includes('price')&&React.createElement("td",{className:"p-4 font-mono text-white"},"$",stock.price?.toFixed(2)||'‚Äî'),visibleColumns.includes('changePct')&&React.createElement("td",{className:"p-4"},React.createElement("span",{className:`font-mono font-semibold ${getSentimentColor(stock.changePct)}`},formatPercent(stock.changePct,2))),visibleColumns.includes('sparkline')&&React.createElement("td",{className:"p-4"},stock.sparkline&&stock.sparkline.length>0?React.createElement("div",{className:"sparkline"},stock.sparkline.slice(-10).map((val,i)=>{const max=Math.max(...stock.sparkline.slice(-10));const min=Math.min(...stock.sparkline.slice(-10));const range=max-min||1;const height=(val-min)/range*28;const isGreen=i===0?true:val>=stock.sparkline.slice(-10)[i-1];return React.createElement("div",{key:i,className:"sparkline-bar",style:{height:`${height}px`,background:isGreen?'#22c55e':'#ef4444'}});})):React.createElement("span",{className:"text-slate-500"},"\u2014")),visibleColumns.includes('pe')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.pe?.toFixed(2)||'‚Äî'),visibleColumns.includes('roe')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.roe?.toFixed(2)||'‚Äî',"%"),visibleColumns.includes('roa')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.roa?.toFixed(2)||'‚Äî',"%"),visibleColumns.includes('roic')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.roic?.toFixed(2)||'‚Äî',"%"),visibleColumns.includes('grossMargin')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.grossMargin?.toFixed(2)||'‚Äî',"%"),visibleColumns.includes('operatingMargin')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.operatingMargin?.toFixed(2)||'‚Äî',"%"),visibleColumns.includes('netMargin')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.netMargin?.toFixed(2)||'‚Äî',"%"),visibleColumns.includes('revenueGrowth')&&React.createElement("td",{className:"p-4"},React.createElement("span",{className:`font-mono font-semibold ${stock.revenueGrowth>0?'text-green-400':'text-red-400'}`},stock.revenueGrowth>0?'+':'',stock.revenueGrowth?.toFixed(1)||'‚Äî',"%")),visibleColumns.includes('netIncomeGrowth')&&React.createElement("td",{className:"p-4"},React.createElement("span",{className:`font-mono font-semibold ${stock.netIncomeGrowth>0?'text-green-400':'text-red-400'}`},stock.netIncomeGrowth>0?'+':'',stock.netIncomeGrowth?.toFixed(1)||'‚Äî',"%")),visibleColumns.includes('epsGrowth')&&React.createElement("td",{className:"p-4"},React.createElement("span",{className:`font-mono font-semibold ${stock.epsGrowth>0?'text-green-400':'text-red-400'}`},stock.epsGrowth>0?'+':'',stock.epsGrowth?.toFixed(1)||'‚Äî',"%")),visibleColumns.includes('priceToBook')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.priceToBook?.toFixed(2)||'‚Äî'),visibleColumns.includes('priceToSales')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.priceToSales?.toFixed(2)||'‚Äî'),visibleColumns.includes('evToEbitda')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.evToEbitda?.toFixed(2)||'‚Äî'),visibleColumns.includes('quickRatio')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.quickRatio?.toFixed(2)||'‚Äî'),visibleColumns.includes('debtToAssets')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.debtToAssets?.toFixed(2)||'‚Äî'),visibleColumns.includes('cashRatio')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.cashRatio?.toFixed(2)||'‚Äî'),visibleColumns.includes('volume')&&React.createElement("td",{className:"p-4 font-mono text-slate-300"},formatNumber(stock.volume)),visibleColumns.includes('analystCount')&&React.createElement("td",{className:"p-4 font-mono text-cyan-300"},stock.analystCount||'‚Äî'),visibleColumns.includes('rsi')&&React.createElement("td",{className:"p-4"},React.createElement("span",{className:`font-mono ${stock.rsi<30?'text-green-400':stock.rsi>70?'text-red-400':'text-slate-300'}`},stock.rsi?.toFixed(0)||'‚Äî')),visibleColumns.includes('analystRating')&&React.createElement("td",{className:"p-4"},React.createElement("span",{className:`chip text-xs ${stock.analystRating?.startsWith('A')?'bg-green-500/20 text-green-400':stock.analystRating?.startsWith('B')?'bg-blue-500/20 text-blue-400':stock.analystRating?.startsWith('C')?'bg-yellow-500/20 text-yellow-400':'bg-red-500/20 text-red-400'}`},stock.analystRating||'‚Äî')),visibleColumns.includes('priceTargetAvg')&&React.createElement("td",{className:"p-4 font-mono text-cyan-300"},"$",stock.priceTargetAvg?.toFixed(2)||'‚Äî'),visibleColumns.includes('piotroskiScore')&&React.createElement("td",{className:"p-4"},React.createElement("span",{className:`font-mono font-semibold ${stock.piotroskiScore>=7?'text-green-400':stock.piotroskiScore>=4?'text-yellow-400':'text-red-400'}`},stock.piotroskiScore||'‚Äî',"/9")),visibleColumns.includes('altmanZScore')&&React.createElement("td",{className:"p-4"},React.createElement("span",{className:`font-mono ${stock.altmanZScore>3?'text-green-400':stock.altmanZScore>1.8?'text-yellow-400':'text-red-400'}`},stock.altmanZScore?.toFixed(1)||'‚Äî')),visibleColumns.includes('debtToEquity')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.debtToEquity?.toFixed(2)||'‚Äî'),visibleColumns.includes('currentRatio')&&React.createElement("td",{className:"p-4 font-mono text-white"},stock.currentRatio?.toFixed(2)||'‚Äî'),visibleColumns.includes('index')&&React.createElement("td",{className:"p-4"},React.createElement("span",{className:"chip bg-cyan-600/20 text-cyan-400 text-xs"},stock.index||'‚Äî')),visibleColumns.includes('mlPrediction')&&React.createElement("td",{className:"p-4"},stock.mlPrediction&&stock.mlPrediction.predPct!=null?React.createElement("div",{className:"flex flex-col"},React.createElement("span",{className:`font-mono font-semibold ${stock.mlPrediction.predPct>0?'text-green-400':stock.mlPrediction.predPct<0?'text-red-400':'text-slate-400'}`},formatMLPrediction(stock.mlPrediction.predPct)),React.createElement("span",{className:"text-xs text-slate-500 mt-0.5"},"Conf: ",stock.mlPrediction.conf,"%")):React.createElement("span",{className:"text-slate-600 font-mono"},"\u2014")),visibleColumns.includes('verdict')&&React.createElement("td",{className:"p-4"},React.createElement("span",{className:`chip ${stock.verdict==='STRONG BUY'||stock.verdict==='BUY'?'bg-green-500/20 text-green-400':stock.verdict==='SELL'||stock.verdict==='REDUCE'?'bg-red-500/20 text-red-400':'bg-yellow-500/20 text-yellow-400'}`},stock.verdict))))))))):!isIncrementalLoading&&partialResults.length===0&&filtered.length===0?React.createElement("div",{className:"glass rounded-xl p-12 text-center"},React.createElement("i",{className:"fas fa-search text-4xl mb-4 text-slate-500"}),React.createElement("p",{className:"text-lg text-slate-300"},"No stocks match your criteria"),React.createElement("p",{className:"text-sm text-slate-500 mt-2"},"Try adjusting your filters")):null))),activeMainTab==='leaderboard'&&React.createElement(TournamentLeaderboardTab,{leaderboard:tournamentLeaderboardData,isLoading:tournamentLoading,error:tournamentError,onRunTournament:()=>{const portfolioSymbols=portfolio&&Array.isArray(portfolio)?portfolio.map(p=>p.symbol).filter(Boolean):watchlist;setShowAITournament(true);}}),activeMainTab==='portfolio'&&React.createElement("div",{className:"animate-slide-up"},showPortfolio?React.createElement(PortfolioModal,{onClose:()=>setShowPortfolio(false),stocks:stocks}):React.createElement("div",{className:"glass rounded-xl p-12 text-center"},React.createElement("i",{className:"fas fa-briefcase text-4xl text-emerald-400 mb-4"}),React.createElement("h3",{className:"text-xl font-bold text-white mb-2"},"Portfolio Management"),React.createElement("p",{className:"text-slate-400 mb-4"},"Click the Portfolio button in the header to manage your holdings"),React.createElement("button",{onClick:()=>setShowPortfolio(true),className:"px-6 py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg font-semibold flex items-center gap-2 mx-auto"},React.createElement("i",{className:"fas fa-chart-line"}),"Open Portfolio"))),React.createElement("div",{className:"fixed bottom-4 right-4 z-[999] space-y-2"},toasts.map(t=>React.createElement("div",{key:t.id,className:"glass-elevated rounded-xl p-4 border border-cyan-500/20 w-[320px]"},React.createElement("div",{className:"flex items-start justify-between gap-3"},React.createElement("div",null,React.createElement("div",{className:"text-sm font-semibold text-white"},t.symbol),React.createElement("div",{className:"text-xs text-slate-300 mt-0.5"},t.message),React.createElement("div",{className:"text-xs text-slate-500 mt-2"},new Date(t.timestamp).toLocaleTimeString())),React.createElement("button",{onClick:()=>dismissToast(t.id),className:"text-slate-400 hover:text-white"},"\u2715"))))),showPortfolio&&React.createElement(PortfolioModal,{onClose:()=>setShowPortfolio(false),stocks:stocks}),showPortfolioAllocation&&React.createElement(PortfolioAllocationModal,{onClose:()=>setShowPortfolioAllocation(false),stocks:stocks,watchlist:watchlist}),showAITournament&&React.createElement(AITournamentModal,{onClose:()=>setShowAITournament(false),watchlist:stocks.map(s=>s.symbol).filter(Boolean),stocks:stocks}),showAlerts&&React.createElement(AlertsModal,{onClose:()=>setShowAlerts(false),alerts:alerts,setAlerts:setAlerts,stocks:stocks}),showComparison&&React.createElement(ComparativeAnalysisModal,{onClose:()=>setShowComparison(false),stocks:stocks,selectedSymbols:comparisonSymbols}),showStockManager&&React.createElement("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50",onClick:()=>setShowStockManager(false)},React.createElement("div",{className:"glass-elevated rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation()},React.createElement("h2",{className:"text-2xl font-bold text-white mb-4"},React.createElement("i",{className:"fas fa-edit mr-2"}),"Manage Your Stock List"),React.createElement("div",{className:"mb-6 p-4 bg-slate-800/50 rounded-lg"},React.createElement("h3",{className:"text-lg font-semibold text-white mb-3"},"Add New Stock"),React.createElement("div",{className:"flex gap-3"},React.createElement("input",{type:"text",id:"new-stock-symbol",name:"new-stock-symbol",value:newStockSymbol,onChange:e=>setNewStockSymbol(e.target.value),onKeyDown:e=>e.key==='Enter'&&addToCurated(),placeholder:"Enter ticker symbol (e.g., AAPL)",className:"flex-1 px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500"}),React.createElement("button",{onClick:addToCurated,className:"px-6 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-semibold"},"Add"))),React.createElement("div",null,React.createElement("h3",{className:"text-lg font-semibold text-white mb-3"},"Your Stocks (",curatedStocks.length,")"),React.createElement("div",{className:"grid grid-cols-2 gap-2"},curatedStocks.map(symbol=>React.createElement("div",{key:symbol,className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg"},React.createElement("span",{className:"text-cyan-300 font-mono font-semibold"},symbol),React.createElement("button",{onClick:()=>removeFromCurated(symbol),className:"px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded text-sm"},"Remove"))))),React.createElement("div",{className:"mt-6 flex justify-end"},React.createElement("button",{onClick:()=>setShowStockManager(false),className:"px-6 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold"},"Close")))),showSettings&&React.createElement("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[998] flex items-center justify-center p-4",onClick:()=>setShowSettings(false)},React.createElement("div",{className:"glass-elevated rounded-2xl p-6 max-w-2xl w-full",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"flex items-center justify-between mb-4"},React.createElement("h3",{className:"text-lg font-bold text-white"},"Column Settings"),React.createElement("button",{onClick:()=>setShowSettings(false),className:"text-slate-400 hover:text-white"},"\u2715")),React.createElement("div",{className:"space-y-3"},ALL_COLUMNS.map(col=>React.createElement("label",{key:col.key,className:`column-toggle ${visibleColumns.includes(col.key)?'active':''}`},React.createElement("input",{type:"checkbox",id:`column-${col.key}`,name:`column-${col.key}`,checked:visibleColumns.includes(col.key),onChange:e=>{setVisibleColumns(prev=>e.target.checked?[...prev,col.key]:prev.filter(k=>k!==col.key));},className:"w-4 h-4"}),React.createElement("span",{className:"text-sm text-white"},col.label),React.createElement("span",{className:"text-xs text-slate-500 ml-auto"},col.category)))),React.createElement("div",{className:"flex justify-end mt-4"},React.createElement("button",{onClick:()=>setShowSettings(false),className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-300 rounded-lg text-sm"},"Close")))),showWatchlistImporter&&React.createElement(WatchlistImporter,{onClose:()=>setShowWatchlistImporter(false),onImportSuccess:result=>{console.log(`Imported ${result.count} symbols to group "${result.group}"`);const newSymbols=result.symbols||[];setCuratedStocks(prev=>{const updated=[...new Set([...prev,...newSymbols])];localStorage.setItem('curatedStocks',JSON.stringify(updated));return updated;});setWatchlist(prev=>{const updated=[...new Set([...prev,...newSymbols])];localStorage.setItem('watchlist',JSON.stringify(updated));return updated;});setShowWatchlistImporter(false);alert(`‚úÖ Successfully imported ${result.count} symbols!\n\nSymbols added to:\n‚Ä¢ Main stocks list (will be fetched)\n‚Ä¢ Watchlist (starred)\n\nRefreshing data...`);setTimeout(()=>{manualRefresh();},500);}}),showEducation&&React.createElement(ErrorBoundary,null,React.createElement(EducationCenterModal,{onClose:()=>setShowEducation(false)})),showNotifications&&React.createElement(ErrorBoundary,null,React.createElement(NotificationBell,{onClose:()=>setShowNotifications(false)})),selectedStock&&React.createElement(ErrorBoundary,{key:selectedStock.symbol},React.createElement(StockModal,{key:selectedStock.symbol,stock:selectedStock,onClose:()=>setSelectedStock(null),watchlist:watchlist,toggleWatchlist:toggleWatchlist,detailedDataLoading:detailedDataLoading,sectorAverages:sectorAverages,portfolio:portfolio,stocks:stocks,setShowWatchlistOnly:setShowWatchlistOnly,openStockModal:openStockModal})),React.createElement(Footer,null)));}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initApp);}else{initApp();}function initApp(){try{const rootElement=document.getElementById('root');if(!rootElement){console.error('‚ùå Root element not found!');return;}if(!ReactDOM||!ReactDOM.createRoot){console.error('‚ùå ReactDOM.createRoot not available. React 18 required.');return;}ReactDOM.createRoot(rootElement).render(React.createElement(ErrorBoundary,null,React.createElement(App,null)));console.log('‚úÖ Application initialized successfully');}catch(error){console.error('‚ùå Failed to initialize application:',error);document.getElementById('root').innerHTML=`
          <div style="padding: 20px; color: white; text-align: center;">
            <h2>Application Error</h2>
            <p>${error.message}</p>
            <p>Please check the browser console for details.</p>
          </div>
        `;}}